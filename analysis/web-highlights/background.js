/*! For license information please see background.js.LICENSE.txt */
!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r=e();for(var n in r)("object"==typeof exports?exports:t)[n]=r[n]}}(self,()=>(()=>{var t={155:t=>{t.exports=function(t,e){return null==t?void 0:t[e]}},186:function(t,e,r){"use strict";var n=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var i=n(r(4627)),o=r(3029),s=function(){function t(){}return t.sanitize=function(t,e){var r=function(){};e&&"function"==typeof e.urlSanitizer&&(r=e.urlSanitizer);var n=r(t);return"string"==typeof n?n:o.encodeLink(i.sanitize(t))},t}();e.OpLinkSanitizer=s},275:function(t,e,r){"use strict";var n=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var i=r(4171),o=r(1913),s=r(887),a=r(8840),c=r(886),l=r(3029),u=n(r(1439)),h=r(5289),d=r(1915),f="<br/>",g=function(){function t(t,e){var r;this.rawDeltaOps=[],this.callbacks={},this.options=u.assign({paragraphTag:"p",encodeHtml:!0,classPrefix:"ql",inlineStyles:!1,multiLineBlockquote:!0,multiLineHeader:!0,multiLineCodeblock:!0,multiLineParagraph:!0,multiLineCustomBlock:!0,allowBackgroundClasses:!1,linkTarget:"_blank"},e,{orderedListTag:"ol",bulletListTag:"ul",listItemTag:"li"}),r=this.options.inlineStyles?"object"==typeof this.options.inlineStyles?this.options.inlineStyles:{}:void 0,this.converterOptions={encodeHtml:this.options.encodeHtml,classPrefix:this.options.classPrefix,inlineStyles:r,listItemTag:this.options.listItemTag,paragraphTag:this.options.paragraphTag,linkRel:this.options.linkRel,linkTarget:this.options.linkTarget,allowBackgroundClasses:this.options.allowBackgroundClasses,customTag:this.options.customTag,customTagAttributes:this.options.customTagAttributes,customCssClasses:this.options.customCssClasses,customCssStyles:this.options.customCssStyles},this.rawDeltaOps=t}return t.prototype._getListTag=function(t){return t.isOrderedList()?this.options.orderedListTag+"":t.isBulletList()||t.isCheckedList()||t.isUncheckedList()?this.options.bulletListTag+"":""},t.prototype.getGroupedOps=function(){var t=i.InsertOpsConverter.convert(this.rawDeltaOps,this.options),e=s.Grouper.pairOpsWithTheirBlock(t),r=s.Grouper.groupConsecutiveSameStyleBlocks(e,{blockquotes:!!this.options.multiLineBlockquote,header:!!this.options.multiLineHeader,codeBlocks:!!this.options.multiLineCodeblock,customBlocks:!!this.options.multiLineCustomBlock}),n=s.Grouper.reduceConsecutiveSameStyleBlocksToOne(r);return n=(new d.TableGrouper).group(n),(new c.ListNester).nest(n)},t.prototype.convert=function(){var t=this;return this.getGroupedOps().map(function(e){if(e instanceof a.ListGroup)return t._renderWithCallbacks(h.GroupType.List,e,function(){return t._renderList(e)});if(e instanceof a.TableGroup)return t._renderWithCallbacks(h.GroupType.Table,e,function(){return t._renderTable(e)});if(e instanceof a.BlockGroup){var r=e;return t._renderWithCallbacks(h.GroupType.Block,e,function(){return t._renderBlock(r.op,r.ops)})}return e instanceof a.BlotBlock?t._renderCustom(e.op,null):e instanceof a.VideoItem?t._renderWithCallbacks(h.GroupType.Video,e,function(){var r=e;return new o.OpToHtmlConverter(r.op,t.converterOptions).getHtml()}):t._renderWithCallbacks(h.GroupType.InlineGroup,e,function(){return t._renderInlines(e.ops,!0)})}).join("")},t.prototype._renderWithCallbacks=function(t,e,r){var n="",i=this.callbacks.beforeRender_cb;(n="function"==typeof i?i.apply(null,[t,e]):"")||(n=r());var o=this.callbacks.afterRender_cb;return"function"==typeof o?o.apply(null,[t,n]):n},t.prototype._renderList=function(t){var e=this,r=t.items[0];return l.makeStartTag(this._getListTag(r.item.op))+t.items.map(function(t){return e._renderListItem(t)}).join("")+l.makeEndTag(this._getListTag(r.item.op))},t.prototype._renderListItem=function(t){t.item.op.attributes.indent=0;var e=new o.OpToHtmlConverter(t.item.op,this.converterOptions).getHtmlParts(),r=this._renderInlines(t.item.ops,!1);return e.openingTag+r+(t.innerList?this._renderList(t.innerList):"")+e.closingTag},t.prototype._renderTable=function(t){var e=this;return l.makeStartTag("table")+l.makeStartTag("tbody")+t.rows.map(function(t){return e._renderTableRow(t)}).join("")+l.makeEndTag("tbody")+l.makeEndTag("table")},t.prototype._renderTableRow=function(t){var e=this;return l.makeStartTag("tr")+t.cells.map(function(t){return e._renderTableCell(t)}).join("")+l.makeEndTag("tr")},t.prototype._renderTableCell=function(t){var e=new o.OpToHtmlConverter(t.item.op,this.converterOptions).getHtmlParts(),r=this._renderInlines(t.item.ops,!1);return l.makeStartTag("td",{key:"data-row",value:t.item.op.attributes.table})+e.openingTag+r+e.closingTag+l.makeEndTag("td")},t.prototype._renderBlock=function(t,e){var r=this,n=new o.OpToHtmlConverter(t,this.converterOptions).getHtmlParts();if(t.isCodeBlock())return n.openingTag+l.encodeHtml(e.map(function(e){return e.isCustomEmbed()?r._renderCustom(e,t):e.insert.value}).join(""))+n.closingTag;var i=e.map(function(e){return r._renderInline(e,t)}).join("");return n.openingTag+(i||f)+n.closingTag},t.prototype._renderInlines=function(t,e){var r=this;void 0===e&&(e=!0);var n=t.length-1,i=t.map(function(t,e){return e>0&&e===n&&t.isJustNewline()?"":r._renderInline(t,null)}).join("");if(!e)return i;var o=l.makeStartTag(this.options.paragraphTag),s=l.makeEndTag(this.options.paragraphTag);return i===f||this.options.multiLineParagraph?o+i+s:o+i.split(f).map(function(t){return""===t?f:t}).join(s+o)+s},t.prototype._renderInline=function(t,e){return t.isCustomEmbed()?this._renderCustom(t,e):new o.OpToHtmlConverter(t,this.converterOptions).getHtml().replace(/\n/g,f)},t.prototype._renderCustom=function(t,e){var r=this.callbacks.renderCustomOp_cb;return"function"==typeof r?r.apply(null,[t,e]):""},t.prototype.beforeRender=function(t){"function"==typeof t&&(this.callbacks.beforeRender_cb=t)},t.prototype.afterRender=function(t){"function"==typeof t&&(this.callbacks.afterRender_cb=t)},t.prototype.renderCustomWith=function(t){this.callbacks.renderCustomOp_cb=t},t}();e.QuillDeltaToHtmlConverter=g},547:t=>{t.exports=function(t){return null!=t&&"object"==typeof t}},581:(t,e,r)=>{var n=r(9261);t.exports=function(t,e){return t&&t.length&&e&&e.length?n(t,e):t}},796:(t,e,r)=>{var n=r(7403),i=r(3316)(n);t.exports=i},886:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(8840),i=r(8735),o=function(){function t(){}return t.prototype.nest=function(t){var e=this,r=this.convertListBlocksToListGroups(t),o=this.groupConsecutiveListGroups(r),s=i.flatten(o.map(function(t){return Array.isArray(t)?e.nestListSection(t):t}));return i.groupConsecutiveElementsWhile(s,function(t,e){return t instanceof n.ListGroup&&e instanceof n.ListGroup&&t.items[0].item.op.isSameListAs(e.items[0].item.op)}).map(function(t){if(!Array.isArray(t))return t;var e=t.map(function(t){return t.items});return new n.ListGroup(i.flatten(e))})},t.prototype.convertListBlocksToListGroups=function(t){return i.groupConsecutiveElementsWhile(t,function(t,e){return t instanceof n.BlockGroup&&e instanceof n.BlockGroup&&t.op.isList()&&e.op.isList()&&t.op.isSameListAs(e.op)&&t.op.hasSameIndentationAs(e.op)}).map(function(t){return Array.isArray(t)?new n.ListGroup(t.map(function(t){return new n.ListItem(t)})):t instanceof n.BlockGroup&&t.op.isList()?new n.ListGroup([new n.ListItem(t)]):t})},t.prototype.groupConsecutiveListGroups=function(t){return i.groupConsecutiveElementsWhile(t,function(t,e){return t instanceof n.ListGroup&&e instanceof n.ListGroup})},t.prototype.nestListSection=function(t){var e=this,r=this.groupByIndent(t);return Object.keys(r).map(Number).sort().reverse().forEach(function(n){r[n].forEach(function(r){var n=t.indexOf(r);e.placeUnderParent(r,t.slice(0,n))&&t.splice(n,1)})}),t},t.prototype.groupByIndent=function(t){return t.reduce(function(t,e){var r=e.items[0].item.op.attributes.indent;return r&&(t[r]=t[r]||[],t[r].push(e)),t},{})},t.prototype.placeUnderParent=function(t,e){for(var r=e.length-1;r>=0;r--){var n=e[r];if(t.items[0].item.op.hasHigherIndentThan(n.items[0].item.op)){var i=n.items[n.items.length-1];return i.innerList?i.innerList.items=i.innerList.items.concat(t.items):i.innerList=t,!0}}return!1},t}();e.ListNester=o},887:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(4204),i=r(8735),o=r(8840),s=function(){function t(){}return t.pairOpsWithTheirBlock=function(t){for(var e,r=[],n=function(t){return!(t.isJustNewline()||t.isCustomEmbedBlock()||t.isVideo()||t.isContainerBlock())},s=function(t){return t.isInline()},a=t.length-1;a>=0;a--){var c=t[a];c.isVideo()?r.push(new o.VideoItem(c)):c.isCustomEmbedBlock()?r.push(new o.BlotBlock(c)):c.isContainerBlock()?(e=i.sliceFromReverseWhile(t,a-1,n),r.push(new o.BlockGroup(c,e.elements)),a=e.sliceStartsAt>-1?e.sliceStartsAt:a):(e=i.sliceFromReverseWhile(t,a-1,s),r.push(new o.InlineGroup(e.elements.concat(c))),a=e.sliceStartsAt>-1?e.sliceStartsAt:a)}return r.reverse(),r},t.groupConsecutiveSameStyleBlocks=function(e,r){return void 0===r&&(r={header:!0,codeBlocks:!0,blockquotes:!0,customBlocks:!0}),i.groupConsecutiveElementsWhile(e,function(e,n){return e instanceof o.BlockGroup&&n instanceof o.BlockGroup&&(r.codeBlocks&&t.areBothCodeblocksWithSameLang(e,n)||r.blockquotes&&t.areBothBlockquotesWithSameAdi(e,n)||r.header&&t.areBothSameHeadersWithSameAdi(e,n)||r.customBlocks&&t.areBothCustomBlockWithSameAttr(e,n))})},t.reduceConsecutiveSameStyleBlocksToOne=function(t){var e=n.DeltaInsertOp.createNewLineOp();return t.map(function(t){if(!Array.isArray(t))return t instanceof o.BlockGroup&&!t.ops.length&&t.ops.push(e),t;var r=t.length-1;return t[0].ops=i.flatten(t.map(function(t,n){return t.ops.length?t.ops.concat(n<r?[e]:[]):[e]})),t[0]})},t.areBothCodeblocksWithSameLang=function(t,e){return t.op.isCodeBlock()&&e.op.isCodeBlock()&&t.op.hasSameLangAs(e.op)},t.areBothSameHeadersWithSameAdi=function(t,e){return t.op.isSameHeaderAs(e.op)&&t.op.hasSameAdiAs(e.op)},t.areBothBlockquotesWithSameAdi=function(t,e){return t.op.isBlockquote()&&e.op.isBlockquote()&&t.op.hasSameAdiAs(e.op)},t.areBothCustomBlockWithSameAttr=function(t,e){return t.op.isCustomTextBlock()&&e.op.isCustomTextBlock()&&t.op.hasSameAttr(e.op)},t}();e.Grouper=s},927:(t,e,r)=>{const n=r(1580),i=r(3142),o=r(7426),s=r(5528),a=r(8227);function c(t,e){for(var r in t)if(Object.keys(e.block).includes(r))return!0;return!1}t.exports=function(t,e=s){return o(function(t,e){var r,o,s,l,u,h=new a;function d(){s=o=new a(["","\n"]),h.append(o),l={}}d();for(var f=0;f<t.length;f++){var g=t[f];if(n(g.insert))for(var p in g.insert)e.embed[p]&&(_(g.attributes),e.embed[p].call(s,g.insert[p],g.attributes));else{var m=g.insert.split("\n");if(c(g.attributes,e)){for(var y=1;y<m.length;y++)for(var b in g.attributes)if(e.block[b]){var T=e.block[b];"object"==typeof T&&(r&&r.type!==b&&(r=null),!r&&T.group&&(r={el:T.group(),type:b,value:g.attributes[p],distance:0},h.append(r.el)),r&&(r.el.append(o),r.distance=0),T=T.line),T.call(o,g.attributes,r),d();break}u=!0}else{for(var v=0;v<m.length;v++)(v>0||u)&&r&&++r.distance>=2&&(r=null),_(g.attributes,t[f+1]&&t[f+1].attributes),s.append(m[v]),v<m.length-1&&d();u=!1}}}return h;function _(t,r){var n=[],o=[];t=t||{};for(var c=s,u={};c._format;){if(u[c._format]=!0,!t[c._format]){for(var h in u)delete l[h];s=c.parent()}c=c.parent()}for(var d in t)if(e.inline[d]){if(l[d]&&l[d]===t[d])continue;r&&t[d]===r[d]?n.push(d):o.push(d),l[d]=t[d]}function f(r){var n=e.inline[r].call(null,t[r]);i(n)&&(n=new a(n)),n._format=r,s.append(n),s=n}n.forEach(f),o.forEach(f)}}(t,e).render())+"\n"}},1073:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.buildRequestError=e.APIResponseError=e.UnknownHTTPResponseError=e.isHTTPResponseError=e.RequestTimeoutError=e.isNotionClientError=e.ClientErrorCode=e.APIErrorCode=void 0;const n=r(6745);var i,o;!function(t){t.Unauthorized="unauthorized",t.RestrictedResource="restricted_resource",t.ObjectNotFound="object_not_found",t.RateLimited="rate_limited",t.InvalidJSON="invalid_json",t.InvalidRequestURL="invalid_request_url",t.InvalidRequest="invalid_request",t.ValidationError="validation_error",t.ConflictError="conflict_error",t.InternalServerError="internal_server_error",t.ServiceUnavailable="service_unavailable"}(i=e.APIErrorCode||(e.APIErrorCode={})),function(t){t.RequestTimeout="notionhq_client_request_timeout",t.ResponseError="notionhq_client_response_error"}(o=e.ClientErrorCode||(e.ClientErrorCode={}));class s extends Error{}function a(t){return(0,n.isObject)(t)&&t instanceof s}function c(t,e){return a(t)&&t.code in e}e.isNotionClientError=a;class l extends s{constructor(t="Request to Notion API has timed out"){super(t),this.code=o.RequestTimeout,this.name="RequestTimeoutError"}static isRequestTimeoutError(t){return c(t,{[o.RequestTimeout]:!0})}static rejectAfterTimeout(t,e){return new Promise((r,n)=>{const i=setTimeout(()=>{n(new l)},e);t.then(r).catch(n).then(()=>clearTimeout(i))})}}e.RequestTimeoutError=l;class u extends s{constructor(t){super(t.message),this.name="HTTPResponseError";const{code:e,status:r,headers:n,rawBodyText:i}=t;this.code=e,this.status=r,this.headers=n,this.body=i}}const h={[o.ResponseError]:!0,[i.Unauthorized]:!0,[i.RestrictedResource]:!0,[i.ObjectNotFound]:!0,[i.RateLimited]:!0,[i.InvalidJSON]:!0,[i.InvalidRequestURL]:!0,[i.InvalidRequest]:!0,[i.ValidationError]:!0,[i.ConflictError]:!0,[i.InternalServerError]:!0,[i.ServiceUnavailable]:!0};e.isHTTPResponseError=function(t){return!!c(t,h)};class d extends u{constructor(t){var e;super({...t,code:o.ResponseError,message:null!==(e=t.message)&&void 0!==e?e:`Request to Notion API failed with status: ${t.status}`}),this.name="UnknownHTTPResponseError"}static isUnknownHTTPResponseError(t){return c(t,{[o.ResponseError]:!0})}}e.UnknownHTTPResponseError=d;const f={[i.Unauthorized]:!0,[i.RestrictedResource]:!0,[i.ObjectNotFound]:!0,[i.RateLimited]:!0,[i.InvalidJSON]:!0,[i.InvalidRequestURL]:!0,[i.InvalidRequest]:!0,[i.ValidationError]:!0,[i.ConflictError]:!0,[i.InternalServerError]:!0,[i.ServiceUnavailable]:!0};class g extends u{constructor(){super(...arguments),this.name="APIResponseError"}static isAPIResponseError(t){return c(t,f)}}e.APIResponseError=g,e.buildRequestError=function(t,e){const r=function(t){if("string"!=typeof t)return;let e;try{e=JSON.parse(t)}catch(t){return}var r;return(0,n.isObject)(e)&&"string"==typeof e.message&&("string"==typeof(r=e.code)&&r in f)?{...e,code:e.code,message:e.message}:void 0}(e);return void 0!==r?new g({code:r.code,message:r.message,headers:t.headers,status:t.status,rawBodyText:e}):new d({message:void 0,headers:t.headers,status:t.status,rawBodyText:e})}},1187:(t,e,r)=>{var n=r(7379),i=r(547);t.exports=function(t){return"symbol"==typeof t||i(t)&&"[object Symbol]"==n(t)}},1366:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(5289),i=r(2229),o=r(8735),s=r(186),a=function(){function t(){}return t.sanitize=function(e,r){var a={};if(!e||"object"!=typeof e)return a;var c=["bold","italic","underline","strike","code","blockquote","code-block","renderAsBlock"],l=["background","color"],u=e.font,h=e.size,d=e.link,f=e.script,g=e.list,p=e.header,m=e.align,y=e.direction,b=e.indent,T=e.mentions,v=e.mention,_=e.width,A=e.target,w=e.rel,E=e["code-block"],S=c.concat(l,["font","size","link","script","list","header","align","direction","indent","mentions","mention","width","target","rel","code-block"]);if(c.forEach(function(t){var r=e[t];r&&(a[t]=!!r)}),l.forEach(function(r){var n=e[r];n&&(t.IsValidHexColor(n+"")||t.IsValidColorLiteral(n+"")||t.IsValidRGBColor(n+""))&&(a[r]=n)}),u&&t.IsValidFontName(u+"")&&(a.font=u),h&&t.IsValidSize(h+"")&&(a.size=h),_&&t.IsValidWidth(_+"")&&(a.width=_),d&&(a.link=s.OpLinkSanitizer.sanitize(d+"",r)),A&&t.isValidTarget(A)&&(a.target=A),w&&t.IsValidRel(w)&&(a.rel=w),E&&(t.IsValidLang(E)?a["code-block"]=E:a["code-block"]=!!E),f!==n.ScriptType.Sub&&n.ScriptType.Super!==f||(a.script=f),g!==n.ListType.Bullet&&g!==n.ListType.Ordered&&g!==n.ListType.Checked&&g!==n.ListType.Unchecked||(a.list=g),Number(p)&&(a.header=Math.min(Number(p),6)),o.find([n.AlignType.Center,n.AlignType.Right,n.AlignType.Justify,n.AlignType.Left],function(t){return t===m})&&(a.align=m),y===n.DirectionType.Rtl&&(a.direction=y),b&&Number(b)&&(a.indent=Math.min(Number(b),30)),T&&v){var I=i.MentionSanitizer.sanitize(v,r);Object.keys(I).length>0&&(a.mentions=!!T,a.mention=v)}return Object.keys(e).reduce(function(t,r){return-1===S.indexOf(r)&&(t[r]=e[r]),t},a)},t.IsValidHexColor=function(t){return!!t.match(/^#([0-9A-F]{6}|[0-9A-F]{3})$/i)},t.IsValidColorLiteral=function(t){return!!t.match(/^[a-z]{1,50}$/i)},t.IsValidRGBColor=function(t){return!!t.match(/^rgb\(((0|25[0-5]|2[0-4]\d|1\d\d|0?\d?\d),\s*){2}(0|25[0-5]|2[0-4]\d|1\d\d|0?\d?\d)\)$/i)},t.IsValidFontName=function(t){return!!t.match(/^[a-z\s0-9\- ]{1,30}$/i)},t.IsValidSize=function(t){return!!t.match(/^[a-z0-9\-]{1,20}$/i)},t.IsValidWidth=function(t){return!!t.match(/^[0-9]*(px|em|%)?$/)},t.isValidTarget=function(t){return!!t.match(/^[_a-zA-Z0-9\-]{1,50}$/)},t.IsValidRel=function(t){return!!t.match(/^[a-zA-Z\s\-]{1,250}$/i)},t.IsValidLang=function(t){return"boolean"==typeof t||!!t.match(/^[a-zA-Z\s\-\\\/\+]{1,50}$/i)},t}();e.OpAttributeSanitizer=a},1439:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.assign=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),i=0;i<e.length;i++){var o=e[i];if(null!=o)for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(n[s]=o[s])}return n}},1580:t=>{t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},1913:function(t,e,r){"use strict";var n=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var i=r(3029),o=r(5289),s=n(r(1439)),a=n(r(8735)),c=r(1366),l={serif:"font-family: Georgia, Times New Roman, serif",monospace:"font-family: Monaco, Courier New, monospace"};e.DEFAULT_INLINE_STYLES={font:function(t){return l[t]||"font-family:"+t},size:{small:"font-size: 0.75em",large:"font-size: 1.5em",huge:"font-size: 2.5em"},indent:function(t,e){var r=3*parseInt(t,10);return"padding-"+("rtl"===e.attributes.direction?"right":"left")+":"+r+"em"},direction:function(t,e){return"rtl"===t?"direction:rtl"+(e.attributes.align?"":"; text-align:inherit"):void 0}};var u=function(){function t(t,e){this.op=t,this.options=s.assign({},{classPrefix:"ql",inlineStyles:void 0,encodeHtml:!0,listItemTag:"li",paragraphTag:"p"},e)}return t.prototype.prefixClass=function(t){return this.options.classPrefix?this.options.classPrefix+"-"+t:t+""},t.prototype.getHtml=function(){var t=this.getHtmlParts();return t.openingTag+t.content+t.closingTag},t.prototype.getHtmlParts=function(){var t=this;if(this.op.isJustNewline()&&!this.op.isContainerBlock())return{openingTag:"",closingTag:"",content:o.NewLine};var e=this.getTags(),r=this.getTagAttributes();!e.length&&r.length&&e.push("span");for(var n=[],s=[],a=function(e){return"img"===e&&!!t.op.attributes.link},c=0,l=e;c<l.length;c++){var u=l[c];a(u)&&n.push(i.makeStartTag("a",this.getLinkAttrs())),n.push(i.makeStartTag(u,r)),s.push("img"===u?"":i.makeEndTag(u)),a(u)&&s.push(i.makeEndTag("a")),r=[]}return s.reverse(),{openingTag:n.join(""),content:this.getContent(),closingTag:s.join("")}},t.prototype.getContent=function(){if(this.op.isContainerBlock())return"";if(this.op.isMentions())return this.op.insert.value;var t=this.op.isFormula()||this.op.isText()?this.op.insert.value:"";return this.options.encodeHtml&&i.encodeHtml(t)||t},t.prototype.getCssClasses=function(){var t=this.op.attributes;if(this.options.inlineStyles)return[];var e=["indent","align","direction","font","size"];return this.options.allowBackgroundClasses&&e.push("background"),(this.getCustomCssClasses()||[]).concat(e.filter(function(e){return!!t[e]}).filter(function(e){return"background"!==e||c.OpAttributeSanitizer.IsValidColorLiteral(t[e])}).map(function(e){return e+"-"+t[e]}).concat(this.op.isFormula()?"formula":[]).concat(this.op.isVideo()?"video":[]).concat(this.op.isImage()?"image":[]).map(this.prefixClass.bind(this)))},t.prototype.getCssStyles=function(){var t=this,r=this.op.attributes,n=[["color"]];return!this.options.inlineStyles&&this.options.allowBackgroundClasses||n.push(["background","background-color"]),this.options.inlineStyles&&(n=n.concat([["indent"],["align","text-align"],["direction"],["font","font-family"],["size"]])),(this.getCustomCssStyles()||[]).concat(n.filter(function(t){return!!r[t[0]]}).map(function(n){var i=n[0],o=r[i],s=t.options.inlineStyles&&t.options.inlineStyles[i]||e.DEFAULT_INLINE_STYLES[i];return"object"==typeof s?s[o]:"function"==typeof s?s(o,t.op):a.preferSecond(n)+":"+o})).filter(function(t){return void 0!==t})},t.prototype.getTagAttributes=function(){if(this.op.attributes.code&&!this.op.isLink())return[];var t=this.makeAttr.bind(this),e=this.getCustomTagAttributes(),r=e?Object.keys(this.getCustomTagAttributes()).map(function(r){return t(r,e[r])}):[],n=this.getCssClasses(),i=n.length?r.concat([t("class",n.join(" "))]):r;if(this.op.isImage())return this.op.attributes.width&&(i=i.concat(t("width",this.op.attributes.width))),i.concat(t("src",this.op.insert.value));if(this.op.isACheckList())return i.concat(t("data-checked",this.op.isCheckedList()?"true":"false"));if(this.op.isFormula())return i;if(this.op.isVideo())return i.concat(t("frameborder","0"),t("allowfullscreen","true"),t("src",this.op.insert.value));if(this.op.isMentions()){var o=this.op.attributes.mention;return o.class&&(i=i.concat(t("class",o.class))),i=o["end-point"]&&o.slug?i.concat(t("href",o["end-point"]+"/"+o.slug)):i.concat(t("href","about:blank")),o.target&&(i=i.concat(t("target",o.target))),i}var s=this.getCssStyles();return s.length&&i.push(t("style",s.join(";"))),this.op.isCodeBlock()&&"string"==typeof this.op.attributes["code-block"]?i.concat(t("data-language",this.op.attributes["code-block"])):(this.op.isContainerBlock()||this.op.isLink()&&(i=i.concat(this.getLinkAttrs())),i)},t.prototype.makeAttr=function(t,e){return{key:t,value:e}},t.prototype.getLinkAttrs=function(){var t=c.OpAttributeSanitizer.isValidTarget(this.options.linkTarget||"")?this.options.linkTarget:void 0,e=c.OpAttributeSanitizer.IsValidRel(this.options.linkRel||"")?this.options.linkRel:void 0,r=this.op.attributes.target||t,n=this.op.attributes.rel||e;return[].concat(this.makeAttr("href",this.op.attributes.link)).concat(r?this.makeAttr("target",r):[]).concat(n?this.makeAttr("rel",n):[])},t.prototype.getCustomTag=function(t){if(this.options.customTag&&"function"==typeof this.options.customTag)return this.options.customTag.apply(null,[t,this.op])},t.prototype.getCustomTagAttributes=function(){if(this.options.customTagAttributes&&"function"==typeof this.options.customTagAttributes)return this.options.customTagAttributes.apply(null,[this.op])},t.prototype.getCustomCssClasses=function(){if(this.options.customCssClasses&&"function"==typeof this.options.customCssClasses){var t=this.options.customCssClasses.apply(null,[this.op]);if(t)return Array.isArray(t)?t:[t]}},t.prototype.getCustomCssStyles=function(){if(this.options.customCssStyles&&"function"==typeof this.options.customCssStyles){var t=this.options.customCssStyles.apply(null,[this.op]);if(t)return Array.isArray(t)?t:[t]}},t.prototype.getTags=function(){var t=this,e=this.op.attributes;if(!this.op.isText())return[this.op.isVideo()?"iframe":this.op.isImage()?"img":"span"];for(var r=this.options.paragraphTag||"p",n=0,i=[["blockquote"],["code-block","pre"],["list",this.options.listItemTag],["header"],["align",r],["direction",r],["indent",r]];n<i.length;n++){var s,c=i[n],l=c[0];if(e[l])return(s=this.getCustomTag(l))?[s]:"header"===l?["h"+e[l]]:[a.preferSecond(c)]}if(this.op.isCustomTextBlock())return(s=this.getCustomTag("renderAsBlock"))?[s]:[r];var u=Object.keys(e).reduce(function(e,r){var n=t.getCustomTag(r);return n&&(e[r]=n),e},{}),h=[["link","a"],["mentions","a"],["script"],["bold","strong"],["italic","em"],["strike","s"],["underline","u"],["code"]];return h.filter(function(t){return!!e[t[0]]}).concat(Object.keys(u).filter(function(t){return!h.some(function(e){return e[0]==t})}).map(function(t){return[t,u[t]]})).map(function(t){return u[t[0]]?u[t[0]]:"script"===t[0]?e[t[0]]===o.ScriptType.Sub?"sub":"sup":a.preferSecond(t)})},t}();e.OpToHtmlConverter=u},1915:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(8840),i=r(8735),o=function(){function t(){}return t.prototype.group=function(t){return this.convertTableBlocksToTableGroups(t)},t.prototype.convertTableBlocksToTableGroups=function(t){var e=this;return i.groupConsecutiveElementsWhile(t,function(t,e){return t instanceof n.BlockGroup&&e instanceof n.BlockGroup&&t.op.isTable()&&e.op.isTable()}).map(function(t){return Array.isArray(t)?new n.TableGroup(e.convertTableBlocksToTableRows(t)):t instanceof n.BlockGroup&&t.op.isTable()?new n.TableGroup([new n.TableRow([new n.TableCell(t)])]):t})},t.prototype.convertTableBlocksToTableRows=function(t){return i.groupConsecutiveElementsWhile(t,function(t,e){return t instanceof n.BlockGroup&&e instanceof n.BlockGroup&&t.op.isTable()&&e.op.isTable()&&t.op.isSameTableRowAs(e.op)}).map(function(t){return new n.TableRow(Array.isArray(t)?t.map(function(t){return new n.TableCell(t)}):[new n.TableCell(t)])})},t}();e.TableGrouper=o},1950:(t,e,r)=>{var n=r(8942)["__core-js_shared__"];t.exports=n},2013:t=>{var e="\\ud800-\\udfff",r="["+e+"]",n="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",i="\\ud83c[\\udffb-\\udfff]",o="[^"+e+"]",s="(?:\\ud83c[\\udde6-\\uddff]){2}",a="[\\ud800-\\udbff][\\udc00-\\udfff]",c="(?:"+n+"|"+i+")?",l="[\\ufe0e\\ufe0f]?",u=l+c+"(?:\\u200d(?:"+[o,s,a].join("|")+")"+l+c+")*",h="(?:"+[o+n+"?",n,s,a,r].join("|")+")",d=RegExp(i+"(?="+i+")|"+h+u,"g");t.exports=function(t){return t.match(d)||[]}},2053:t=>{t.exports=function(t){return t}},2229:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(186),i=function(){function t(){}return t.sanitize=function(e,r){var i={};return e&&"object"==typeof e?(e.class&&t.IsValidClass(e.class)&&(i.class=e.class),e.id&&t.IsValidId(e.id)&&(i.id=e.id),t.IsValidTarget(e.target+"")&&(i.target=e.target),e.avatar&&(i.avatar=n.OpLinkSanitizer.sanitize(e.avatar+"",r)),e["end-point"]&&(i["end-point"]=n.OpLinkSanitizer.sanitize(e["end-point"]+"",r)),e.slug&&(i.slug=e.slug+""),i):i},t.IsValidClass=function(t){return!!t.match(/^[a-zA-Z0-9_\-]{1,500}$/i)},t.IsValidId=function(t){return!!t.match(/^[a-zA-Z0-9_\-\:\.]{1,500}$/i)},t.IsValidTarget=function(t){return["_self","_blank","_parent","_top"].indexOf(t)>-1},t}();e.MentionSanitizer=i},2237:(t,e,r)=>{var n=r(2837),i=r(3417),o=r(2013);t.exports=function(t){return i(t)?o(t):n(t)}},2255:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.oauthIntrospect=e.oauthRevoke=e.oauthToken=e.listComments=e.createComment=e.search=e.createDatabase=e.listDatabases=e.queryDatabase=e.updateDatabase=e.getDatabase=e.appendBlockChildren=e.listBlockChildren=e.deleteBlock=e.updateBlock=e.getBlock=e.getPageProperty=e.updatePage=e.getPage=e.createPage=e.listUsers=e.getUser=e.getSelf=void 0,e.getSelf={method:"get",pathParams:[],queryParams:[],bodyParams:[],path:()=>"users/me"},e.getUser={method:"get",pathParams:["user_id"],queryParams:[],bodyParams:[],path:t=>`users/${t.user_id}`},e.listUsers={method:"get",pathParams:[],queryParams:["start_cursor","page_size"],bodyParams:[],path:()=>"users"},e.createPage={method:"post",pathParams:[],queryParams:[],bodyParams:["parent","properties","icon","cover","content","children"],path:()=>"pages"},e.getPage={method:"get",pathParams:["page_id"],queryParams:["filter_properties"],bodyParams:[],path:t=>`pages/${t.page_id}`},e.updatePage={method:"patch",pathParams:["page_id"],queryParams:[],bodyParams:["properties","icon","cover","archived","in_trash"],path:t=>`pages/${t.page_id}`},e.getPageProperty={method:"get",pathParams:["page_id","property_id"],queryParams:["start_cursor","page_size"],bodyParams:[],path:t=>`pages/${t.page_id}/properties/${t.property_id}`},e.getBlock={method:"get",pathParams:["block_id"],queryParams:[],bodyParams:[],path:t=>`blocks/${t.block_id}`},e.updateBlock={method:"patch",pathParams:["block_id"],queryParams:[],bodyParams:["embed","type","archived","in_trash","bookmark","image","video","pdf","file","audio","code","equation","divider","breadcrumb","table_of_contents","link_to_page","table_row","heading_1","heading_2","heading_3","paragraph","bulleted_list_item","numbered_list_item","quote","to_do","toggle","template","callout","synced_block","table"],path:t=>`blocks/${t.block_id}`},e.deleteBlock={method:"delete",pathParams:["block_id"],queryParams:[],bodyParams:[],path:t=>`blocks/${t.block_id}`},e.listBlockChildren={method:"get",pathParams:["block_id"],queryParams:["start_cursor","page_size"],bodyParams:[],path:t=>`blocks/${t.block_id}/children`},e.appendBlockChildren={method:"patch",pathParams:["block_id"],queryParams:[],bodyParams:["children","after"],path:t=>`blocks/${t.block_id}/children`},e.getDatabase={method:"get",pathParams:["database_id"],queryParams:[],bodyParams:[],path:t=>`databases/${t.database_id}`},e.updateDatabase={method:"patch",pathParams:["database_id"],queryParams:[],bodyParams:["title","description","icon","cover","properties","is_inline","archived","in_trash"],path:t=>`databases/${t.database_id}`},e.queryDatabase={method:"post",pathParams:["database_id"],queryParams:["filter_properties"],bodyParams:["sorts","filter","start_cursor","page_size","archived","in_trash"],path:t=>`databases/${t.database_id}/query`},e.listDatabases={method:"get",pathParams:[],queryParams:["start_cursor","page_size"],bodyParams:[],path:()=>"databases"},e.createDatabase={method:"post",pathParams:[],queryParams:[],bodyParams:["parent","properties","icon","cover","title","description","is_inline"],path:()=>"databases"},e.search={method:"post",pathParams:[],queryParams:[],bodyParams:["sort","query","start_cursor","page_size","filter"],path:()=>"search"},e.createComment={method:"post",pathParams:[],queryParams:[],bodyParams:["parent","rich_text","discussion_id"],path:()=>"comments"},e.listComments={method:"get",pathParams:[],queryParams:["block_id","start_cursor","page_size"],bodyParams:[],path:()=>"comments"},e.oauthToken={method:"post",pathParams:[],queryParams:[],bodyParams:["grant_type","code","redirect_uri","external_account"],path:()=>"oauth/token"},e.oauthRevoke={method:"post",pathParams:[],queryParams:[],bodyParams:["token"],path:()=>"oauth/revoke"},e.oauthIntrospect={method:"post",pathParams:[],queryParams:[],bodyParams:["token"],path:()=>"oauth/introspect"}},2291:(t,e,r)=>{var n=r(5650),i=r(5111),o=r(3142),s=r(1187),a=n?n.prototype:void 0,c=a?a.toString:void 0;t.exports=function t(e){if("string"==typeof e)return e;if(o(e))return i(e,t)+"";if(s(e))return c?c.call(e):"";var r=e+"";return"0"==r&&1/e==-1/0?"-0":r}},2478:(t,e,r)=>{var n=r(7250),i=r(9454),o=r(7706);t.exports=function(t,e,r){return e==e?o(t,e,r):n(t,i,r)}},2532:(t,e,r)=>{var n=r(4715),i=function(){try{var t=n(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();t.exports=i},2619:t=>{t.exports=function(t){return function(){return t}}},2837:t=>{t.exports=function(t){return t.split("")}},2945:t=>{var e=/\s/;t.exports=function(t){for(var r=t.length;r--&&e.test(t.charAt(r)););return r}},3029:(t,e)=>{"use strict";var r;function n(t){return i(r.Html).reduce(s,t)}function i(t){var e=[["&","&amp;"],["<","&lt;"],[">","&gt;"],['"',"&quot;"],["'","&#x27;"],["\\/","&#x2F;"],["\\(","&#40;"],["\\)","&#41;"]];return t===r.Html?e.filter(function(t){var e=t[0];return t[1],-1===e.indexOf("(")&&-1===e.indexOf(")")}):e.filter(function(t){var e=t[0];return t[1],-1===e.indexOf("/")})}function o(t,e){return t.replace(new RegExp(e[0],"g"),e[1])}function s(t,e){return t.replace(new RegExp(e[1],"g"),e[0].replace("\\",""))}Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.Html=0]="Html",t[t.Url=1]="Url"}(r||(r={})),e.makeStartTag=function(t,e){if(void 0===e&&(e=void 0),!t)return"";var r="";e&&(r=[].concat(e).map(function(t){return t.key+(t.value?'="'+t.value+'"':"")}).join(" "));var n=">";return"img"!==t&&"br"!==t||(n="/>"),r?"<"+t+" "+r+n:"<"+t+n},e.makeEndTag=function(t){return void 0===t&&(t=""),t&&"</"+t+">"||""},e.decodeHtml=n,e.encodeHtml=function(t,e){return void 0===e&&(e=!0),e&&(t=n(t)),i(r.Html).reduce(o,t)},e.encodeLink=function(t){var e=i(r.Url),n=e.reduce(s,t);return e.reduce(o,n)}},3142:t=>{var e=Array.isArray;t.exports=e},3316:t=>{var e=Date.now;t.exports=function(t){var r=0,n=0;return function(){var i=e(),o=16-(i-n);if(n=i,o>0){if(++r>=800)return arguments[0]}else r=0;return t.apply(void 0,arguments)}}},3317:(t,e)=>{"use strict";String.prototype.remove=function(t){return Array.isArray(t)?t.reduce(function(t,e){return t.replace(e,"")},this):"string"==typeof t?this.replace(t,""):this}},3417:t=>{var e=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");t.exports=function(t){return e.test(t)}},3449:function(t,e,r){"use strict";var n,i,o,s,a,c,l,u,h,d=this&&this.__classPrivateFieldSet||function(t,e,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(t,r):i?i.value=r:e.set(t,r),r},f=this&&this.__classPrivateFieldGet||function(t,e,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(t):n?n.value:e.get(t)};Object.defineProperty(e,"__esModule",{value:!0});const g=r(6465),p=r(1073),m=r(6745),y=r(2255),b=r(8203),T=r(7422);class v{constructor(t){var e,r,f,p,_,A;n.set(this,void 0),i.set(this,void 0),o.set(this,void 0),s.set(this,void 0),a.set(this,void 0),c.set(this,void 0),l.set(this,void 0),u.set(this,void 0),h.set(this,void 0),this.blocks={retrieve:t=>this.request({path:y.getBlock.path(t),method:y.getBlock.method,query:(0,m.pick)(t,y.getBlock.queryParams),body:(0,m.pick)(t,y.getBlock.bodyParams),auth:null==t?void 0:t.auth}),update:t=>this.request({path:y.updateBlock.path(t),method:y.updateBlock.method,query:(0,m.pick)(t,y.updateBlock.queryParams),body:(0,m.pick)(t,y.updateBlock.bodyParams),auth:null==t?void 0:t.auth}),delete:t=>this.request({path:y.deleteBlock.path(t),method:y.deleteBlock.method,query:(0,m.pick)(t,y.deleteBlock.queryParams),body:(0,m.pick)(t,y.deleteBlock.bodyParams),auth:null==t?void 0:t.auth}),children:{append:t=>this.request({path:y.appendBlockChildren.path(t),method:y.appendBlockChildren.method,query:(0,m.pick)(t,y.appendBlockChildren.queryParams),body:(0,m.pick)(t,y.appendBlockChildren.bodyParams),auth:null==t?void 0:t.auth}),list:t=>this.request({path:y.listBlockChildren.path(t),method:y.listBlockChildren.method,query:(0,m.pick)(t,y.listBlockChildren.queryParams),body:(0,m.pick)(t,y.listBlockChildren.bodyParams),auth:null==t?void 0:t.auth})}},this.databases={list:t=>this.request({path:y.listDatabases.path(),method:y.listDatabases.method,query:(0,m.pick)(t,y.listDatabases.queryParams),body:(0,m.pick)(t,y.listDatabases.bodyParams),auth:null==t?void 0:t.auth}),retrieve:t=>this.request({path:y.getDatabase.path(t),method:y.getDatabase.method,query:(0,m.pick)(t,y.getDatabase.queryParams),body:(0,m.pick)(t,y.getDatabase.bodyParams),auth:null==t?void 0:t.auth}),query:t=>this.request({path:y.queryDatabase.path(t),method:y.queryDatabase.method,query:(0,m.pick)(t,y.queryDatabase.queryParams),body:(0,m.pick)(t,y.queryDatabase.bodyParams),auth:null==t?void 0:t.auth}),create:t=>this.request({path:y.createDatabase.path(),method:y.createDatabase.method,query:(0,m.pick)(t,y.createDatabase.queryParams),body:(0,m.pick)(t,y.createDatabase.bodyParams),auth:null==t?void 0:t.auth}),update:t=>this.request({path:y.updateDatabase.path(t),method:y.updateDatabase.method,query:(0,m.pick)(t,y.updateDatabase.queryParams),body:(0,m.pick)(t,y.updateDatabase.bodyParams),auth:null==t?void 0:t.auth})},this.pages={create:t=>this.request({path:y.createPage.path(),method:y.createPage.method,query:(0,m.pick)(t,y.createPage.queryParams),body:(0,m.pick)(t,y.createPage.bodyParams),auth:null==t?void 0:t.auth}),retrieve:t=>this.request({path:y.getPage.path(t),method:y.getPage.method,query:(0,m.pick)(t,y.getPage.queryParams),body:(0,m.pick)(t,y.getPage.bodyParams),auth:null==t?void 0:t.auth}),update:t=>this.request({path:y.updatePage.path(t),method:y.updatePage.method,query:(0,m.pick)(t,y.updatePage.queryParams),body:(0,m.pick)(t,y.updatePage.bodyParams),auth:null==t?void 0:t.auth}),properties:{retrieve:t=>this.request({path:y.getPageProperty.path(t),method:y.getPageProperty.method,query:(0,m.pick)(t,y.getPageProperty.queryParams),body:(0,m.pick)(t,y.getPageProperty.bodyParams),auth:null==t?void 0:t.auth})}},this.users={retrieve:t=>this.request({path:y.getUser.path(t),method:y.getUser.method,query:(0,m.pick)(t,y.getUser.queryParams),body:(0,m.pick)(t,y.getUser.bodyParams),auth:null==t?void 0:t.auth}),list:t=>this.request({path:y.listUsers.path(),method:y.listUsers.method,query:(0,m.pick)(t,y.listUsers.queryParams),body:(0,m.pick)(t,y.listUsers.bodyParams),auth:null==t?void 0:t.auth}),me:t=>this.request({path:y.getSelf.path(),method:y.getSelf.method,query:(0,m.pick)(t,y.getSelf.queryParams),body:(0,m.pick)(t,y.getSelf.bodyParams),auth:null==t?void 0:t.auth})},this.comments={create:t=>this.request({path:y.createComment.path(),method:y.createComment.method,query:(0,m.pick)(t,y.createComment.queryParams),body:(0,m.pick)(t,y.createComment.bodyParams),auth:null==t?void 0:t.auth}),list:t=>this.request({path:y.listComments.path(),method:y.listComments.method,query:(0,m.pick)(t,y.listComments.queryParams),body:(0,m.pick)(t,y.listComments.bodyParams),auth:null==t?void 0:t.auth})},this.search=t=>this.request({path:y.search.path(),method:y.search.method,query:(0,m.pick)(t,y.search.queryParams),body:(0,m.pick)(t,y.search.bodyParams),auth:null==t?void 0:t.auth}),this.oauth={token:t=>this.request({path:y.oauthToken.path(),method:y.oauthToken.method,query:(0,m.pick)(t,y.oauthToken.queryParams),body:(0,m.pick)(t,y.oauthToken.bodyParams),auth:{client_id:t.client_id,client_secret:t.client_secret}}),introspect:t=>this.request({path:y.oauthIntrospect.path(),method:y.oauthIntrospect.method,query:(0,m.pick)(t,y.oauthIntrospect.queryParams),body:(0,m.pick)(t,y.oauthIntrospect.bodyParams),auth:{client_id:t.client_id,client_secret:t.client_secret}}),revoke:t=>this.request({path:y.oauthRevoke.path(),method:y.oauthRevoke.method,query:(0,m.pick)(t,y.oauthRevoke.queryParams),body:(0,m.pick)(t,y.oauthRevoke.bodyParams),auth:{client_id:t.client_id,client_secret:t.client_secret}})},d(this,n,null==t?void 0:t.auth,"f"),d(this,i,null!==(e=null==t?void 0:t.logLevel)&&void 0!==e?e:g.LogLevel.WARN,"f"),d(this,o,null!==(r=null==t?void 0:t.logger)&&void 0!==r?r:(0,g.makeConsoleLogger)(T.name),"f"),d(this,s,`${null!==(f=null==t?void 0:t.baseUrl)&&void 0!==f?f:"https://api.notion.com"}/v1/`,"f"),d(this,a,null!==(p=null==t?void 0:t.timeoutMs)&&void 0!==p?p:6e4,"f"),d(this,c,null!==(_=null==t?void 0:t.notionVersion)&&void 0!==_?_:v.defaultNotionVersion,"f"),d(this,l,null!==(A=null==t?void 0:t.fetch)&&void 0!==A?A:b.default,"f"),d(this,u,null==t?void 0:t.agent,"f"),d(this,h,`notionhq-client/${T.version}`,"f")}async request({path:t,method:e,query:r,body:n,auth:i}){this.log(g.LogLevel.INFO,"request start",{method:e,path:t});const o=n&&0!==Object.entries(n).length?JSON.stringify(n):void 0,d=new URL(`${f(this,s,"f")}${t}`);if(r)for(const[t,e]of Object.entries(r))void 0!==e&&(Array.isArray(e)?e.forEach(e=>d.searchParams.append(t,decodeURIComponent(e))):d.searchParams.append(t,String(e)));let m;if("object"==typeof i){const t=`${i.client_id}:${i.client_secret}`;m={authorization:`Basic ${Buffer.from(t).toString("base64")}`}}else m=this.authAsHeaders(i);const y={...m,"Notion-Version":f(this,c,"f"),"user-agent":f(this,h,"f")};void 0!==o&&(y["content-type"]="application/json");try{const r=await p.RequestTimeoutError.rejectAfterTimeout(f(this,l,"f").call(this,d.toString(),{method:e.toUpperCase(),headers:y,body:o,agent:f(this,u,"f")}),f(this,a,"f")),n=await r.text();if(!r.ok)throw(0,p.buildRequestError)(r,n);const i=JSON.parse(n);return this.log(g.LogLevel.INFO,"request success",{method:e,path:t}),i}catch(t){if(!(0,p.isNotionClientError)(t))throw t;throw this.log(g.LogLevel.WARN,"request fail",{code:t.code,message:t.message}),(0,p.isHTTPResponseError)(t)&&this.log(g.LogLevel.DEBUG,"failed response body",{body:t.body}),t}}log(t,e,r){(0,g.logLevelSeverity)(t)>=(0,g.logLevelSeverity)(f(this,i,"f"))&&f(this,o,"f").call(this,t,e,r)}authAsHeaders(t){const e={},r=null!=t?t:f(this,n,"f");return void 0!==r&&(e.authorization=`Bearer ${r}`),e}}e.default=v,n=new WeakMap,i=new WeakMap,o=new WeakMap,s=new WeakMap,a=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,h=new WeakMap,v.defaultNotionVersion="2022-06-28"},3501:t=>{t.exports=function(t,e,r){var n=-1,i=t.length;e<0&&(e=-e>i?0:i+e),(r=r>i?i:r)<0&&(r+=i),i=e>r?0:r-e>>>0,e>>>=0;for(var o=Array(i);++n<i;)o[n]=t[n+e];return o}},3655:(t,e,r)=>{var n=r(7379),i=r(1580);t.exports=function(t){if(!i(t))return!1;var e=n(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}},3945:(t,e,r)=>{var n=r(2053),i=r(5234),o=r(796);t.exports=function(t,e){return o(i(t,e,n),t+"")}},4066:t=>{var e=Function.prototype.toString;t.exports=function(t){if(null!=t){try{return e.call(t)}catch(t){}try{return t+""}catch(t){}}return""}},4171:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(4204),i=r(5289),o=r(8475),s=r(1366),a=r(6168),c=r(186),l=function(){function t(){}return t.convert=function(e,r){if(!Array.isArray(e))return[];for(var i,o,c=[],l=0,u=[].concat.apply([],e.map(a.InsertOpDenormalizer.denormalize));l<u.length;l++){var h=u[l];h.insert&&(i=t.convertInsertVal(h.insert,r))&&(o=s.OpAttributeSanitizer.sanitize(h.attributes,r),c.push(new n.DeltaInsertOp(i,o)))}return c},t.convertInsertVal=function(t,e){if("string"==typeof t)return new o.InsertDataQuill(i.DataType.Text,t);if(!t||"object"!=typeof t)return null;var r=Object.keys(t);return r.length?i.DataType.Image in t?new o.InsertDataQuill(i.DataType.Image,c.OpLinkSanitizer.sanitize(t[i.DataType.Image]+"",e)):i.DataType.Video in t?new o.InsertDataQuill(i.DataType.Video,c.OpLinkSanitizer.sanitize(t[i.DataType.Video]+"",e)):i.DataType.Formula in t?new o.InsertDataQuill(i.DataType.Formula,t[i.DataType.Formula]):new o.InsertDataCustom(r[0],t[r[0]]):null},t}();e.InsertOpsConverter=l},4204:function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i=r(5289),o=r(8475),s=n(r(8677)),a=function(){function t(t,e){"string"==typeof t&&(t=new o.InsertDataQuill(i.DataType.Text,t+"")),this.insert=t,this.attributes=e||{}}return t.createNewLineOp=function(){return new t(i.NewLine)},t.prototype.isContainerBlock=function(){return this.isBlockquote()||this.isList()||this.isTable()||this.isCodeBlock()||this.isHeader()||this.isBlockAttribute()||this.isCustomTextBlock()},t.prototype.isBlockAttribute=function(){var t=this.attributes;return!!(t.align||t.direction||t.indent)},t.prototype.isBlockquote=function(){return!!this.attributes.blockquote},t.prototype.isHeader=function(){return!!this.attributes.header},t.prototype.isTable=function(){return!!this.attributes.table},t.prototype.isSameHeaderAs=function(t){return t.attributes.header===this.attributes.header&&this.isHeader()},t.prototype.hasSameAdiAs=function(t){return this.attributes.align===t.attributes.align&&this.attributes.direction===t.attributes.direction&&this.attributes.indent===t.attributes.indent},t.prototype.hasSameIndentationAs=function(t){return this.attributes.indent===t.attributes.indent},t.prototype.hasSameAttr=function(t){return s.default(this.attributes,t.attributes)},t.prototype.hasHigherIndentThan=function(t){return(Number(this.attributes.indent)||0)>(Number(t.attributes.indent)||0)},t.prototype.isInline=function(){return!(this.isContainerBlock()||this.isVideo()||this.isCustomEmbedBlock())},t.prototype.isCodeBlock=function(){return!!this.attributes["code-block"]},t.prototype.hasSameLangAs=function(t){return this.attributes["code-block"]===t.attributes["code-block"]},t.prototype.isJustNewline=function(){return this.insert.value===i.NewLine},t.prototype.isList=function(){return this.isOrderedList()||this.isBulletList()||this.isCheckedList()||this.isUncheckedList()},t.prototype.isOrderedList=function(){return this.attributes.list===i.ListType.Ordered},t.prototype.isBulletList=function(){return this.attributes.list===i.ListType.Bullet},t.prototype.isCheckedList=function(){return this.attributes.list===i.ListType.Checked},t.prototype.isUncheckedList=function(){return this.attributes.list===i.ListType.Unchecked},t.prototype.isACheckList=function(){return this.attributes.list==i.ListType.Unchecked||this.attributes.list===i.ListType.Checked},t.prototype.isSameListAs=function(t){return!!t.attributes.list&&(this.attributes.list===t.attributes.list||t.isACheckList()&&this.isACheckList())},t.prototype.isSameTableRowAs=function(t){return!!t.isTable()&&this.isTable()&&this.attributes.table===t.attributes.table},t.prototype.isText=function(){return this.insert.type===i.DataType.Text},t.prototype.isImage=function(){return this.insert.type===i.DataType.Image},t.prototype.isFormula=function(){return this.insert.type===i.DataType.Formula},t.prototype.isVideo=function(){return this.insert.type===i.DataType.Video},t.prototype.isLink=function(){return this.isText()&&!!this.attributes.link},t.prototype.isCustomEmbed=function(){return this.insert instanceof o.InsertDataCustom},t.prototype.isCustomEmbedBlock=function(){return this.isCustomEmbed()&&!!this.attributes.renderAsBlock},t.prototype.isCustomTextBlock=function(){return this.isText()&&!!this.attributes.renderAsBlock},t.prototype.isMentions=function(){return this.isText()&&!!this.attributes.mentions},t}();e.DeltaInsertOp=a},4354:t=>{t.exports=function(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}},4627:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.sanitize=function(t){var e=t;return e=e.replace(/^\s*/gm,""),/^((https?|s?ftp|file|blob|mailto|tel):|#|\/|data:image\/)/.test(e)?e:"unsafe:"+e}},4715:(t,e,r)=>{var n=r(9624),i=r(155);t.exports=function(t,e){var r=i(t,e);return n(r)?r:void 0}},4759:(t,e,r)=>{var n,i=r(1950),o=(n=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"";t.exports=function(t){return!!o&&o in t}},4772:(t,e,r)=>{r(3317)},4872:(t,e,r)=>{t.exports={deltaToMarkdown:r(927)}},4967:(t,e,r)=>{var n="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g;t.exports=n},5111:t=>{t.exports=function(t,e){for(var r=-1,n=null==t?0:t.length,i=Array(n);++r<n;)i[r]=e(t[r],r,t);return i}},5234:(t,e,r)=>{var n=r(6912),i=Math.max;t.exports=function(t,e,r){return e=i(void 0===e?t.length-1:e,0),function(){for(var o=arguments,s=-1,a=i(o.length-e,0),c=Array(a);++s<a;)c[s]=o[e+s];s=-1;for(var l=Array(e+1);++s<e;)l[s]=o[s];return l[e]=r(c),n(t,this,l)}}},5243:(t,e,r)=>{var n=r(2291);t.exports=function(t){return null==t?"":n(t)}},5250:t=>{t.exports={encodeLink:t=>encodeURI(t).replace(/\(/i,"%28").replace(/\)/i,"%29").replace(/(\?|&)response-content-disposition=attachment.*$/,"")}},5289:(t,e)=>{"use strict";var r,n,i,o,s,a;Object.defineProperty(e,"__esModule",{value:!0}),e.NewLine="\n",function(t){t.Ordered="ordered",t.Bullet="bullet",t.Checked="checked",t.Unchecked="unchecked"}(r||(r={})),e.ListType=r,function(t){t.Sub="sub",t.Super="super"}(n||(n={})),e.ScriptType=n,function(t){t.Rtl="rtl"}(i||(i={})),e.DirectionType=i,function(t){t.Left="left",t.Center="center",t.Right="right",t.Justify="justify"}(o||(o={})),e.AlignType=o,function(t){t.Image="image",t.Video="video",t.Formula="formula",t.Text="text"}(s||(s={})),e.DataType=s,function(t){t.Block="block",t.InlineGroup="inline-group",t.List="list",t.Video="video",t.Table="table"}(a||(a={})),e.GroupType=a},5395:(t,e,r)=>{"use strict";r(275).QuillDeltaToHtmlConverter,r(1913).OpToHtmlConverter;var n=r(8840);n.InlineGroup,n.VideoItem,n.BlockGroup,n.ListGroup,n.ListItem,n.BlotBlock,r(4204).DeltaInsertOp;var i=r(8475);i.InsertDataQuill,i.InsertDataCustom;var o=r(5289);o.NewLine,o.ListType,o.ScriptType,o.DirectionType,o.AlignType,o.DataType,o.GroupType},5528:(t,e,r)=>{const n=r(8227),{encodeLink:i}=r(5250);t.exports={embed:{image:function(t){this.append("![]("+i(t)+")")},thematic_break:function(){this.open="\n---\n"+this.open}},inline:{italic:function(){return["_","_"]},bold:function(){return["**","**"]},link:function(t){return["[","]("+t+")"]}},block:{header:function({header:t}){this.open="#".repeat(t)+" "+this.open},blockquote:function(){this.open="> "+this.open},list:{group:function(){return new n(["","\n"])},line:function(t,e){if("bullet"===t.list)this.open="- "+this.open;else if("checked"===t.list)this.open="- [x] "+this.open;else if("unchecked"===t.list)this.open="- [ ] "+this.open;else if("ordered"===t.list){e.count=e.count||0;var r=++e.count;this.open=r+". "+this.open}}}}}},5650:(t,e,r)=>{var n=r(8942).Symbol;t.exports=n},6168:function(t,e,r){"use strict";var n=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var i=r(5289),o=n(r(8537)),s=n(r(1439)),a=function(){function t(){}return t.denormalize=function(t){if(!t||"object"!=typeof t)return[];if("object"==typeof t.insert||t.insert===i.NewLine)return[t];var e=o.tokenizeWithNewLines(t.insert+"");if(1===e.length)return[t];var r=s.assign({},t,{insert:i.NewLine});return e.map(function(e){return e===i.NewLine?r:s.assign({},t,{insert:e})})},t}();e.InsertOpDenormalizer=a},6465:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.logLevelSeverity=e.makeConsoleLogger=e.LogLevel=void 0;const n=r(6745);var i;!function(t){t.DEBUG="debug",t.INFO="info",t.WARN="warn",t.ERROR="error"}(i=e.LogLevel||(e.LogLevel={})),e.makeConsoleLogger=function(t){return(e,r,n)=>{console[e](`${t} ${e}:`,r,n)}},e.logLevelSeverity=function(t){switch(t){case i.DEBUG:return 20;case i.INFO:return 40;case i.WARN:return 60;case i.ERROR:return 80;default:return(0,n.assertNever)(t)}}},6745:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isObject=e.pick=e.assertNever=void 0,e.assertNever=function(t){throw new Error(`Unexpected value should never occur: ${t}`)},e.pick=function(t,e){const r=e.map(e=>[e,null==t?void 0:t[e]]);return Object.fromEntries(r)},e.isObject=function(t){return"object"==typeof t&&null!==t}},6912:t=>{t.exports=function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}},7250:t=>{t.exports=function(t,e,r,n){for(var i=t.length,o=r+(n?1:-1);n?o--:++o<i;)if(e(t[o],o,t))return o;return-1}},7292:(t,e,r)=>{var n=r(3945)(r(581));t.exports=n},7379:(t,e,r)=>{var n=r(5650),i=r(8870),o=r(9005),s=n?n.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":s&&s in Object(t)?i(t):o(t)}},7403:(t,e,r)=>{var n=r(2619),i=r(2532),o=r(2053),s=i?function(t,e){return i(t,"toString",{configurable:!0,enumerable:!1,value:n(e),writable:!0})}:o;t.exports=s},7422:t=>{"use strict";t.exports=JSON.parse('{"name":"@notionhq/client","version":"2.3.0","description":"A simple and easy to use client for the Notion API","engines":{"node":">=12"},"homepage":"https://developers.notion.com/docs/getting-started","bugs":{"url":"https://github.com/makenotion/notion-sdk-js/issues"},"repository":{"type":"git","url":"https://github.com/makenotion/notion-sdk-js/"},"keywords":["notion","notionapi","rest","notion-api"],"main":"./build/src","types":"./build/src/index.d.ts","scripts":{"prepare":"npm run build","prepublishOnly":"npm run checkLoggedIn && npm run lint && npm run test","build":"tsc","prettier":"prettier --write .","lint":"prettier --check . && eslint . --ext .ts && cspell \'**/*\' ","test":"jest ./test","check-links":"git ls-files | grep md$ | xargs -n 1 markdown-link-check","prebuild":"npm run clean","clean":"rm -rf ./build","checkLoggedIn":"./scripts/verifyLoggedIn.sh"},"author":"","license":"MIT","files":["build/package.json","build/src/**"],"dependencies":{"@types/node-fetch":"^2.5.10","node-fetch":"^2.6.1"},"devDependencies":{"@types/jest":"^28.1.4","@typescript-eslint/eslint-plugin":"^5.39.0","@typescript-eslint/parser":"^5.39.0","cspell":"^5.4.1","eslint":"^7.24.0","jest":"^28.1.2","markdown-link-check":"^3.8.7","prettier":"^2.8.8","ts-jest":"^28.0.5","typescript":"^4.8.4"}}')},7426:(t,e,r)=>{var n=r(2291),i=r(8931),o=r(8774),s=r(2237),a=r(5243),c=r(2945);t.exports=function(t,e,r){if((t=a(t))&&(r||void 0===e))return t.slice(0,c(t)+1);if(!t||!(e=n(e)))return t;var l=s(t),u=o(l,s(e))+1;return i(l,0,u).join("")}},7706:t=>{t.exports=function(t,e,r){for(var n=r-1,i=t.length;++n<i;)if(t[n]===e)return n;return-1}},8138:(t,e,r)=>{var n=r(7379),i=r(3142),o=r(547);t.exports=function(t){return"string"==typeof t||!i(t)&&o(t)&&"[object String]"==n(t)}},8203:(t,e,r)=>{"use strict";var n=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r.g)return r.g;throw new Error("unable to locate global object")}();t.exports=e=n.fetch,n.fetch&&(e.default=n.fetch.bind(n)),e.Headers=n.Headers,e.Request=n.Request,e.Response=n.Response},8227:(t,e,r)=>{const n=r(3142),i=r(8138),o=r(7292);var s=0;class a{constructor(t){this.id=++s,n(t)?(this.open=t[0],this.close=t[1]):i(t)&&(this.text=t),this.children=[]}append(t){t instanceof a||(t=new a(t)),t._parent&&o(t._parent.children,t),t._parent=this,this.children=this.children.concat(t)}render(){var t="";this.open&&(t+=this.open),this.text&&(t+=this.text);for(var e=0;e<this.children.length;e++)t+=this.children[e].render();return this.close&&(t+=this.close),t}parent(){return this._parent}}t.exports=a},8250:t=>{t.exports=function(t,e,r,n){for(var i=r-1,o=t.length;++i<o;)if(n(t[i],e))return i;return-1}},8288:(t,e,r)=>{"use strict";r(3449),r(6465),r(1073),r(9885)},8475:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.InsertDataQuill=function(t,e){this.type=t,this.value=e};e.InsertDataCustom=function(t,e){this.type=t,this.value=e}},8537:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.tokenizeWithNewLines=function(t){var e="\n";if(t===e)return[t];var r=t.split(e);if(1===r.length)return r;var n=r.length-1;return r.reduce(function(t,r,i){return i!==n?""!==r?t=t.concat(r,e):t.push(e):""!==r&&t.push(r),t},[])}},8677:(t,e,r)=>{t=r.nmd(t);var n="__lodash_hash_undefined__",i=9007199254740991,o="[object Arguments]",s="[object Array]",a="[object Boolean]",c="[object Date]",l="[object Error]",u="[object Function]",h="[object Map]",d="[object Number]",f="[object Object]",g="[object Promise]",p="[object RegExp]",m="[object Set]",y="[object String]",b="[object WeakMap]",T="[object ArrayBuffer]",v="[object DataView]",_=/^\[object .+?Constructor\]$/,A=/^(?:0|[1-9]\d*)$/,w={};w["[object Float32Array]"]=w["[object Float64Array]"]=w["[object Int8Array]"]=w["[object Int16Array]"]=w["[object Int32Array]"]=w["[object Uint8Array]"]=w["[object Uint8ClampedArray]"]=w["[object Uint16Array]"]=w["[object Uint32Array]"]=!0,w[o]=w[s]=w[T]=w[a]=w[v]=w[c]=w[l]=w[u]=w[h]=w[d]=w[f]=w[p]=w[m]=w[y]=w[b]=!1;var E="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g,S="object"==typeof self&&self&&self.Object===Object&&self,I=E||S||Function("return this")(),N=e&&!e.nodeType&&e,O=N&&t&&!t.nodeType&&t,C=O&&O.exports===N,k=C&&E.process,L=function(){try{return k&&k.binding&&k.binding("util")}catch(t){}}(),D=L&&L.isTypedArray;function x(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}function P(t){var e=-1,r=Array(t.size);return t.forEach(function(t,n){r[++e]=[n,t]}),r}function R(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r}var B,G,U,M=Array.prototype,j=Function.prototype,F=Object.prototype,$=I["__core-js_shared__"],H=j.toString,W=F.hasOwnProperty,V=(B=/[^.]+$/.exec($&&$.keys&&$.keys.IE_PROTO||""))?"Symbol(src)_1."+B:"",q=F.toString,z=RegExp("^"+H.call(W).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),K=C?I.Buffer:void 0,Y=I.Symbol,J=I.Uint8Array,X=F.propertyIsEnumerable,Z=M.splice,Q=Y?Y.toStringTag:void 0,tt=Object.getOwnPropertySymbols,et=K?K.isBuffer:void 0,rt=(G=Object.keys,U=Object,function(t){return G(U(t))}),nt=Ot(I,"DataView"),it=Ot(I,"Map"),ot=Ot(I,"Promise"),st=Ot(I,"Set"),at=Ot(I,"WeakMap"),ct=Ot(Object,"create"),lt=Dt(nt),ut=Dt(it),ht=Dt(ot),dt=Dt(st),ft=Dt(at),gt=Y?Y.prototype:void 0,pt=gt?gt.valueOf:void 0;function mt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function yt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function bt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function Tt(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new bt;++e<r;)this.add(t[e])}function vt(t){var e=this.__data__=new yt(t);this.size=e.size}function _t(t,e){for(var r=t.length;r--;)if(xt(t[r][0],e))return r;return-1}function At(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":Q&&Q in Object(t)?function(t){var e=W.call(t,Q),r=t[Q];try{t[Q]=void 0;var n=!0}catch(t){}var i=q.call(t);return n&&(e?t[Q]=r:delete t[Q]),i}(t):function(t){return q.call(t)}(t)}function wt(t){return jt(t)&&At(t)==o}function Et(t,e,r,n,i){return t===e||(null==t||null==e||!jt(t)&&!jt(e)?t!=t&&e!=e:function(t,e,r,n,i,u){var g=Rt(t),b=Rt(e),_=g?s:kt(t),A=b?s:kt(e),w=(_=_==o?f:_)==f,E=(A=A==o?f:A)==f,S=_==A;if(S&&Bt(t)){if(!Bt(e))return!1;g=!0,w=!1}if(S&&!w)return u||(u=new vt),g||Ft(t)?St(t,e,r,n,i,u):function(t,e,r,n,i,o,s){switch(r){case v:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case T:return!(t.byteLength!=e.byteLength||!o(new J(t),new J(e)));case a:case c:case d:return xt(+t,+e);case l:return t.name==e.name&&t.message==e.message;case p:case y:return t==e+"";case h:var u=P;case m:var f=1&n;if(u||(u=R),t.size!=e.size&&!f)return!1;var g=s.get(t);if(g)return g==e;n|=2,s.set(t,e);var b=St(u(t),u(e),n,i,o,s);return s.delete(t),b;case"[object Symbol]":if(pt)return pt.call(t)==pt.call(e)}return!1}(t,e,_,r,n,i,u);if(!(1&r)){var I=w&&W.call(t,"__wrapped__"),N=E&&W.call(e,"__wrapped__");if(I||N){var O=I?t.value():t,C=N?e.value():e;return u||(u=new vt),i(O,C,r,n,u)}}return!!S&&(u||(u=new vt),function(t,e,r,n,i,o){var s=1&r,a=It(t),c=a.length;if(c!=It(e).length&&!s)return!1;for(var l=c;l--;){var u=a[l];if(!(s?u in e:W.call(e,u)))return!1}var h=o.get(t);if(h&&o.get(e))return h==e;var d=!0;o.set(t,e),o.set(e,t);for(var f=s;++l<c;){var g=t[u=a[l]],p=e[u];if(n)var m=s?n(p,g,u,e,t,o):n(g,p,u,t,e,o);if(!(void 0===m?g===p||i(g,p,r,n,o):m)){d=!1;break}f||(f="constructor"==u)}if(d&&!f){var y=t.constructor,b=e.constructor;y==b||!("constructor"in t)||!("constructor"in e)||"function"==typeof y&&y instanceof y&&"function"==typeof b&&b instanceof b||(d=!1)}return o.delete(t),o.delete(e),d}(t,e,r,n,i,u))}(t,e,r,n,Et,i))}function St(t,e,r,n,i,o){var s=1&r,a=t.length,c=e.length;if(a!=c&&!(s&&c>a))return!1;var l=o.get(t);if(l&&o.get(e))return l==e;var u=-1,h=!0,d=2&r?new Tt:void 0;for(o.set(t,e),o.set(e,t);++u<a;){var f=t[u],g=e[u];if(n)var p=s?n(g,f,u,e,t,o):n(f,g,u,t,e,o);if(void 0!==p){if(p)continue;h=!1;break}if(d){if(!x(e,function(t,e){if(s=e,!d.has(s)&&(f===t||i(f,t,r,n,o)))return d.push(e);var s})){h=!1;break}}else if(f!==g&&!i(f,g,r,n,o)){h=!1;break}}return o.delete(t),o.delete(e),h}function It(t){return function(t,e,r){var n=e(t);return Rt(t)?n:function(t,e){for(var r=-1,n=e.length,i=t.length;++r<n;)t[i+r]=e[r];return t}(n,r(t))}(t,$t,Ct)}function Nt(t,e){var r,n,i=t.__data__;return("string"==(n=typeof(r=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?i["string"==typeof e?"string":"hash"]:i.map}function Ot(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return function(t){return!(!Mt(t)||function(t){return!!V&&V in t}(t))&&(Gt(t)?z:_).test(Dt(t))}(r)?r:void 0}mt.prototype.clear=function(){this.__data__=ct?ct(null):{},this.size=0},mt.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},mt.prototype.get=function(t){var e=this.__data__;if(ct){var r=e[t];return r===n?void 0:r}return W.call(e,t)?e[t]:void 0},mt.prototype.has=function(t){var e=this.__data__;return ct?void 0!==e[t]:W.call(e,t)},mt.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=ct&&void 0===e?n:e,this},yt.prototype.clear=function(){this.__data__=[],this.size=0},yt.prototype.delete=function(t){var e=this.__data__,r=_t(e,t);return!(r<0||(r==e.length-1?e.pop():Z.call(e,r,1),--this.size,0))},yt.prototype.get=function(t){var e=this.__data__,r=_t(e,t);return r<0?void 0:e[r][1]},yt.prototype.has=function(t){return _t(this.__data__,t)>-1},yt.prototype.set=function(t,e){var r=this.__data__,n=_t(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this},bt.prototype.clear=function(){this.size=0,this.__data__={hash:new mt,map:new(it||yt),string:new mt}},bt.prototype.delete=function(t){var e=Nt(this,t).delete(t);return this.size-=e?1:0,e},bt.prototype.get=function(t){return Nt(this,t).get(t)},bt.prototype.has=function(t){return Nt(this,t).has(t)},bt.prototype.set=function(t,e){var r=Nt(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this},Tt.prototype.add=Tt.prototype.push=function(t){return this.__data__.set(t,n),this},Tt.prototype.has=function(t){return this.__data__.has(t)},vt.prototype.clear=function(){this.__data__=new yt,this.size=0},vt.prototype.delete=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},vt.prototype.get=function(t){return this.__data__.get(t)},vt.prototype.has=function(t){return this.__data__.has(t)},vt.prototype.set=function(t,e){var r=this.__data__;if(r instanceof yt){var n=r.__data__;if(!it||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new bt(n)}return r.set(t,e),this.size=r.size,this};var Ct=tt?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var r=-1,n=null==t?0:t.length,i=0,o=[];++r<n;){var s=t[r];e(s)&&(o[i++]=s)}return o}(tt(t),function(e){return X.call(t,e)}))}:function(){return[]},kt=At;function Lt(t,e){return!!(e=null==e?i:e)&&("number"==typeof t||A.test(t))&&t>-1&&t%1==0&&t<e}function Dt(t){if(null!=t){try{return H.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function xt(t,e){return t===e||t!=t&&e!=e}(nt&&kt(new nt(new ArrayBuffer(1)))!=v||it&&kt(new it)!=h||ot&&kt(ot.resolve())!=g||st&&kt(new st)!=m||at&&kt(new at)!=b)&&(kt=function(t){var e=At(t),r=e==f?t.constructor:void 0,n=r?Dt(r):"";if(n)switch(n){case lt:return v;case ut:return h;case ht:return g;case dt:return m;case ft:return b}return e});var Pt=wt(function(){return arguments}())?wt:function(t){return jt(t)&&W.call(t,"callee")&&!X.call(t,"callee")},Rt=Array.isArray,Bt=et||function(){return!1};function Gt(t){if(!Mt(t))return!1;var e=At(t);return e==u||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}function Ut(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=i}function Mt(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function jt(t){return null!=t&&"object"==typeof t}var Ft=D?function(t){return function(e){return t(e)}}(D):function(t){return jt(t)&&Ut(t.length)&&!!w[At(t)]};function $t(t){return null!=(e=t)&&Ut(e.length)&&!Gt(e)?function(t,e){var r=Rt(t),n=!r&&Pt(t),i=!r&&!n&&Bt(t),o=!r&&!n&&!i&&Ft(t),s=r||n||i||o,a=s?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],c=a.length;for(var l in t)!e&&!W.call(t,l)||s&&("length"==l||i&&("offset"==l||"parent"==l)||o&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||Lt(l,c))||a.push(l);return a}(t):function(t){if(r=(e=t)&&e.constructor,e!==("function"==typeof r&&r.prototype||F))return rt(t);var e,r,n=[];for(var i in Object(t))W.call(t,i)&&"constructor"!=i&&n.push(i);return n}(t);var e}t.exports=function(t,e){return Et(t,e)}},8735:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.preferSecond=function(t){return 0===t.length?null:t.length>=2?t[1]:t[0]},e.flatten=function t(e){return e.reduce(function(e,r){return e.concat(Array.isArray(r)?t(r):r)},[])},e.find=function(t,e){if(Array.prototype.find)return Array.prototype.find.call(t,e);for(var r=0;r<t.length;r++)if(e(t[r]))return t[r]},e.groupConsecutiveElementsWhile=function(t,e){for(var r,n=[],i=0;i<t.length;i++)r=t[i],i>0&&e(r,t[i-1])?n[n.length-1].push(r):n.push([r]);return n.map(function(t){return 1===t.length?t[0]:t})},e.sliceFromReverseWhile=function(t,e,r){for(var n={elements:[],sliceStartsAt:-1},i=e;i>=0&&r(t[i]);i--)n.sliceStartsAt=i,n.elements.unshift(t[i]);return n},e.intersperse=function(t,e){return t.reduce(function(r,n,i){return r.push(n),i<t.length-1&&r.push(e),r},[])}},8774:(t,e,r)=>{var n=r(2478);t.exports=function(t,e){for(var r=t.length;r--&&n(e,t[r],0)>-1;);return r}},8840:function(t,e){"use strict";var r,n=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});e.InlineGroup=function(t){this.ops=t};var i=function(t){this.op=t},o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e}(i);e.VideoItem=o;var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e}(i);e.BlotBlock=s;e.BlockGroup=function(t,e){this.op=t,this.ops=e};e.ListGroup=function(t){this.items=t};e.ListItem=function(t,e){void 0===e&&(e=null),this.item=t,this.innerList=e};e.TableGroup=function(t){this.rows=t};e.TableRow=function(t){this.cells=t};e.TableCell=function(t){this.item=t}},8870:(t,e,r)=>{var n=r(5650),i=Object.prototype,o=i.hasOwnProperty,s=i.toString,a=n?n.toStringTag:void 0;t.exports=function(t){var e=o.call(t,a),r=t[a];try{t[a]=void 0;var n=!0}catch(t){}var i=s.call(t);return n&&(e?t[a]=r:delete t[a]),i}},8931:(t,e,r)=>{var n=r(3501);t.exports=function(t,e,r){var i=t.length;return r=void 0===r?i:r,!e&&r>=i?t:n(t,e,r)}},8942:(t,e,r)=>{var n=r(4967),i="object"==typeof self&&self&&self.Object===Object&&self,o=n||i||Function("return this")();t.exports=o},9005:t=>{var e=Object.prototype.toString;t.exports=function(t){return e.call(t)}},9261:(t,e,r)=>{var n=r(5111),i=r(2478),o=r(8250),s=r(9460),a=r(4354),c=Array.prototype.splice;t.exports=function(t,e,r,l){var u=l?o:i,h=-1,d=e.length,f=t;for(t===e&&(e=a(e)),r&&(f=n(t,s(r)));++h<d;)for(var g=0,p=e[h],m=r?r(p):p;(g=u(f,m,g,l))>-1;)f!==t&&c.call(f,g,1),c.call(t,g,1);return t}},9454:t=>{t.exports=function(t){return t!=t}},9460:t=>{t.exports=function(t){return function(e){return t(e)}}},9624:(t,e,r)=>{var n=r(3655),i=r(4759),o=r(1580),s=r(4066),a=/^\[object .+?Constructor\]$/,c=Function.prototype,l=Object.prototype,u=c.toString,h=l.hasOwnProperty,d=RegExp("^"+u.call(h).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=function(t){return!(!o(t)||i(t))&&(n(t)?d:a).test(s(t))}},9885:(t,e)=>{"use strict";async function*r(t,e){let r=e.start_cursor;do{const n=await t({...e,start_cursor:r});yield*n.results,r=n.next_cursor}while(r)}function n(t){return"page"===t.object&&"url"in t}function i(t){return"database"===t.object&&"title"in t}Object.defineProperty(e,"__esModule",{value:!0}),e.isMentionRichTextItemResponse=e.isEquationRichTextItemResponse=e.isTextRichTextItemResponse=e.isFullComment=e.isFullUser=e.isFullPageOrDatabase=e.isFullDatabase=e.isFullPage=e.isFullBlock=e.collectPaginatedAPI=e.iteratePaginatedAPI=void 0,e.iteratePaginatedAPI=r,e.collectPaginatedAPI=async function(t,e){const n=[];for await(const i of r(t,e))n.push(i);return n},e.isFullBlock=function(t){return"block"===t.object&&"type"in t},e.isFullPage=n,e.isFullDatabase=i,e.isFullPageOrDatabase=function(t){return"database"===t.object?i(t):n(t)},e.isFullUser=function(t){return"type"in t},e.isFullComment=function(t){return"created_by"in t},e.isTextRichTextItemResponse=function(t){return"text"===t.type},e.isEquationRichTextItemResponse=function(t){return"equation"===t.type},e.isMentionRichTextItemResponse=function(t){return"mention"===t.type}}},e={};function r(n){var i=e[n];if(void 0!==i)return i.exports;var o=e[n]={id:n,loaded:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.loaded=!0,o.exports}return r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{"use strict";function t(t,e){return Array(e+1).join(t)}function e(t){return t.replace(/^\n*/,"")}function n(t){for(var e=t.length;e>0&&"\n"===t[e-1];)e--;return t.substring(0,e)}function i(t){return n(e(t))}r(5395),r(4772);var o={};function s(t){return t?t.replace(/(\n+\s*)+/g,"\n"):""}function a(t){for(var e in this.options=t,this._keep=[],this._remove=[],this.blankRule={replacement:t.blankReplacement},this.keepReplacement=t.keepReplacement,this.defaultRule={replacement:t.defaultReplacement},this.array=[],t.rules)this.array.push(t.rules[e])}function c(t,e,r){for(var n=0;n<t.length;n++){var i=t[n];if(l(i,e,r))return i}}function l(t,e,r){var n=t.filter;if("string"==typeof n){if(n===e.nodeName.toLowerCase())return!0}else if(Array.isArray(n)){if(n.indexOf(e.nodeName.toLowerCase())>-1)return!0}else{if("function"!=typeof n)throw new TypeError("`filter` needs to be a string, array, or function");if(n.call(t,e,r))return!0}}o.paragraph={filter:"p",replacement:function(t){return"\n\n"+t+"\n\n"}},o.lineBreak={filter:"br",replacement:function(t,e,r){return r.br+"\n"}},o.heading={filter:["h1","h2","h3","h4","h5","h6"],replacement:function(e,r,n){var i=Number(r.nodeName.charAt(1));return"setext"===n.headingStyle&&i<3?"\n\n"+e+"\n"+t(1===i?"=":"-",e.length)+"\n\n":"\n\n"+t("#",i)+" "+e+"\n\n"}},o.blockquote={filter:"blockquote",replacement:function(t){return"\n\n"+(t=i(t).replace(/^/gm,"> "))+"\n\n"}},o.list={filter:["ul","ol"],replacement:function(t,e){var r=e.parentNode;return"LI"===r.nodeName&&r.lastElementChild===e?"\n"+t:"\n\n"+t+"\n\n"}},o.listItem={filter:"li",replacement:function(t,e,r){var n=r.bulletListMarker+"   ",o=e.parentNode;if("OL"===o.nodeName){var s=o.getAttribute("start"),a=Array.prototype.indexOf.call(o.children,e);n=(s?Number(s)+a:a+1)+".  "}var c=/\n$/.test(t);return n+(t=(t=i(t)+(c?"\n":"")).replace(/\n/gm,"\n"+" ".repeat(n.length)))+(e.nextSibling?"\n":"")}},o.indentedCodeBlock={filter:function(t,e){return"indented"===e.codeBlockStyle&&"PRE"===t.nodeName&&t.firstChild&&"CODE"===t.firstChild.nodeName},replacement:function(t,e,r){return"\n\n    "+e.firstChild.textContent.replace(/\n/g,"\n    ")+"\n\n"}},o.fencedCodeBlock={filter:function(t,e){return"fenced"===e.codeBlockStyle&&"PRE"===t.nodeName&&t.firstChild&&"CODE"===t.firstChild.nodeName},replacement:function(e,r,n){for(var i,o=((r.firstChild.getAttribute("class")||"").match(/language-(\S+)/)||[null,""])[1],s=r.firstChild.textContent,a=n.fence.charAt(0),c=3,l=new RegExp("^"+a+"{3,}","gm");i=l.exec(s);)i[0].length>=c&&(c=i[0].length+1);var u=t(a,c);return"\n\n"+u+o+"\n"+s.replace(/\n$/,"")+"\n"+u+"\n\n"}},o.horizontalRule={filter:"hr",replacement:function(t,e,r){return"\n\n"+r.hr+"\n\n"}},o.inlineLink={filter:function(t,e){return"inlined"===e.linkStyle&&"A"===t.nodeName&&t.getAttribute("href")},replacement:function(t,e){var r=e.getAttribute("href");r&&(r=r.replace(/([()])/g,"\\$1"));var n=s(e.getAttribute("title"));return n&&(n=' "'+n.replace(/"/g,'\\"')+'"'),"["+t+"]("+r+n+")"}},o.referenceLink={filter:function(t,e){return"referenced"===e.linkStyle&&"A"===t.nodeName&&t.getAttribute("href")},replacement:function(t,e,r){var n,i,o=e.getAttribute("href"),a=s(e.getAttribute("title"));switch(a&&(a=' "'+a+'"'),r.linkReferenceStyle){case"collapsed":n="["+t+"][]",i="["+t+"]: "+o+a;break;case"shortcut":n="["+t+"]",i="["+t+"]: "+o+a;break;default:var c=this.references.length+1;n="["+t+"]["+c+"]",i="["+c+"]: "+o+a}return this.references.push(i),n},references:[],append:function(t){var e="";return this.references.length&&(e="\n\n"+this.references.join("\n")+"\n\n",this.references=[]),e}},o.emphasis={filter:["em","i"],replacement:function(t,e,r){return t.trim()?r.emDelimiter+t+r.emDelimiter:""}},o.strong={filter:["strong","b"],replacement:function(t,e,r){return t.trim()?r.strongDelimiter+t+r.strongDelimiter:""}},o.code={filter:function(t){var e=t.previousSibling||t.nextSibling,r="PRE"===t.parentNode.nodeName&&!e;return"CODE"===t.nodeName&&!r},replacement:function(t){if(!t)return"";t=t.replace(/\r?\n|\r/g," ");for(var e=/^`|^ .*?[^ ].* $|`$/.test(t)?" ":"",r="`",n=t.match(/`+/gm)||[];-1!==n.indexOf(r);)r+="`";return r+e+t+e+r}},o.image={filter:"img",replacement:function(t,e){var r=s(e.getAttribute("alt")),n=e.getAttribute("src")||"",i=s(e.getAttribute("title"));return n?"!["+r+"]("+n+(i?' "'+i+'"':"")+")":""}},a.prototype={add:function(t,e){this.array.unshift(e)},keep:function(t){this._keep.unshift({filter:t,replacement:this.keepReplacement})},remove:function(t){this._remove.unshift({filter:t,replacement:function(){return""}})},forNode:function(t){return t.isBlank?this.blankRule:(e=c(this.array,t,this.options))||(e=c(this._keep,t,this.options))||(e=c(this._remove,t,this.options))?e:this.defaultRule;var e},forEach:function(t){for(var e=0;e<this.array.length;e++)t(this.array[e],e)}};var u,h="undefined"!=typeof window?window:{};!function(){var t=h.DOMParser,e=!1;try{(new t).parseFromString("","text/html")&&(e=!0)}catch(t){}return e}()?(u=function(){},function(){var t=!1;try{document.implementation.createHTMLDocument("").open()}catch(e){h.ActiveXObject&&(t=!0)}return t}()?u.prototype.parseFromString=function(t){var e=new window.ActiveXObject("htmlfile");return e.designMode="on",e.open(),e.write(t),e.close(),e}:u.prototype.parseFromString=function(t){var e=document.implementation.createHTMLDocument("");return e.open(),e.write(t),e.close(),e}):h.DOMParser;Array.prototype.reduce;r(4872),r(8288);var d=Object.defineProperty,f=(t,e,r)=>((t,e,r)=>e in t?d(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r)(t,"symbol"!=typeof e?e+"":e,r),g=(t=>(t.webApp="webApp",t.highlighter="highlighter",t.youtubeHighlighter="youtubeHighlighter",t.reader="reader",t))(g||{});const p={title:"PDF & Web Highlighter",path:"pdf-web-highlighter"},m={title:"Reader Mode + AI Summary, Notes & Annotations",path:"reader-mode"},y={...p,appId:"webhighlights",appType:"highlighter",browserType:"chrome",appDisplayname:"Web Highlights",isWebApp:!1,isExtension:!0,extensionId:"hldjnlbobkdkghfidgoecgmklcemanhm",uninstallURL:"https://tooltivity.com/extensions/youtube-highlighter/partners?ref=web-highlights",uninstallSurveyURL:"https://forms.gle/VQZnfwAqtEpLQGjB8",installedRedirectUrl:"https://web-highlights.com/blog/welcome",storePublishUrl:"https://chromewebstore.google.com/detail/web-highlights-pdf-web-hi/hldjnlbobkdkghfidgoecgmklcemanhm",featureIsEnabled:{givefreely:!0}},b={...p,appId:"webhighlights-firefox",appType:"highlighter",browserType:"firefox",isWebApp:!1,isExtension:!0,appDisplayname:"Web Highlights",extensionId:"firefox@web-highlights.com",uninstallURL:"https://tooltivity.com/extensions/youtube-highlighter/partners?ref=web-highlights",uninstallSurveyURL:"https://forms.gle/VQZnfwAqtEpLQGjB8",installedRedirectUrl:"https://web-highlights.com/blog/welcome",storePublishUrl:"https://addons.mozilla.org/firefox/addon/web-highlights-pdf-web-highlig/",featureIsEnabled:{givefreely:!1}},T={...m,appId:"reader-chrome",appType:"reader",browserType:"chrome",appDisplayname:"Reader Mode",isWebApp:!1,isExtension:!0,extensionId:"cbjbjjgipedbjgbamfodgihnfdlghcaf",extensionIdDev:"fhlkcinmabhnlpdkeffhkpppcinfmnhg",uninstallURL:"https://tooltivity.com/extensions/web-highlights/partners?ref=reader",uninstallSurveyURL:"https://forms.gle/VQZnfwAqtEpLQGjB8",installedRedirectUrl:"https://web-highlights.com/extensions/reader-mode/welcome",storePublishUrl:"https://chromewebstore.google.com/detail/cbjbjjgipedbjgbamfodgihnfdlghcaf",featureIsEnabled:{givefreely:!1}},v={title:"Youtube Highlighter & AI Summary",path:"youtube-highlighter",appId:"youtube-highlighter-chrome",appType:"youtubeHighlighter",browserType:"chrome",appDisplayname:"YouTube Highlighter",isWebApp:!1,isExtension:!0,extensionId:"jipmbenpdoghkhgapoppkjndfmcoechc",extensionIdDev:"cnpofeldfiibfdekdedbpapalneidboo",uninstallURL:"https://tooltivity.com/extensions/web-highlights/partners?ref=youtube-highlighter",uninstallSurveyURL:"https://forms.gle/VQZnfwAqtEpLQGjB8",installedRedirectUrl:"https://web-highlights.com/docs/tutorials/youtube-highlighting",storePublishUrl:"https://chromewebstore.google.com/detail/jipmbenpdoghkhgapoppkjndfmcoechc",featureIsEnabled:{givefreely:!1}},_={...m,appId:"reader-firefox",appType:"reader",browserType:"firefox",appDisplayname:"Reader Mode",isWebApp:!1,isExtension:!0,extensionId:"reader@web-highlights.com",uninstallURL:"https://tooltivity.com/extensions/web-highlights/partners?ref=reader",uninstallSurveyURL:"https://forms.gle/VQZnfwAqtEpLQGjB8",installedRedirectUrl:"https://web-highlights.com/extensions/reader-mode/welcome",storePublishUrl:"",featureIsEnabled:{givefreely:!1}},A="Not set";var w=(t=>(t.COMMANDS="COMMANDS",t))(w||{});const E=new class{sendMessage(t){try{return chrome.tabs.query({active:!0,currentWindow:!0},e=>{var r;null!=(r=e[0])&&r.id&&chrome.tabs.sendMessage(e[0].id,t)}),!0}catch{return!1}}sendRuntimeMessage(t,e){try{return e?chrome.runtime.sendMessage(t,e):chrome.runtime.sendMessage(t),!0}catch{return!1}}async readDataFromBackgroundScript(t){try{return await this.sendRuntimePortMessage(t)}catch{return"COMMANDS"===t?g.highlighter===g.reader?[{description:"Open in reader",name:"open-in-reader",shortcut:"R"},{description:"Toggle Sidebar",name:"toggle-sidebar",shortcut:"W"},{description:"Highlight Text",name:"highlight-text",shortcut:"S"},{description:"Highlight (Same Format)",name:"highlight-last-format",shortcut:"A"}]:[{description:"Highlight Text",name:"highlight-text",shortcut:"S"},{description:"Highlight (Same Format)",name:"highlight-last-format",shortcut:"A"},{description:"Toggle Sidebar",name:"toggle-sidebar",shortcut:"W"},{description:"Bookmark Page",name:"toggle-bookmark",shortcut:"B"},{description:"Open in reader",name:"open-in-reader",shortcut:"R"}]:{}}}async readCommands(){return this.readDataFromBackgroundScript("COMMANDS")}async findSpecificCommand(t){return(await this.readCommands()).find(e=>e.name===t)}async sendRuntimePortMessage(t){return new Promise((e,r)=>{var n,i;(typeof chrome>"u"||null==(n=null==chrome?void 0:chrome.runtime)||!n.connect)&&r("Chrome Runtime API is not available.");try{const n=null==(i=null==chrome?void 0:chrome.runtime)?void 0:i.connect({name:t}),o=t=>{n.onMessage.removeListener(o),n.disconnect(),e(t)},s=()=>{r("Port disconnected unexpectedly.")};n.onMessage.addListener(o),n.onDisconnect.addListener(s)}catch(t){r(t)}})}};function S(t,e){return"string"==typeof(null==e?void 0:e.method)&&typeof t[null==e?void 0:e.method]<"u"}function I(t){this.message=t}I.prototype=new Error,I.prototype.name="InvalidCharacterError";var N=typeof window<"u"&&window.atob&&window.atob.bind(window)||function(t){var e=String(t).replace(/=+$/,"");if(e.length%4==1)throw new I("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,n,i=0,o=0,s="";n=e.charAt(o++);~n&&(r=i%4?64*r+n:n,i++%4)?s+=String.fromCharCode(255&r>>(-2*i&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return s};function O(t){this.message=t}O.prototype=new Error,O.prototype.name="InvalidTokenError";const C="jwt_webmarker";function k(t){try{return function(t,e){if("string"!=typeof t)throw new O("Invalid token specified");var r=!0===(e=e||{}).header?0:1;try{return JSON.parse(function(t){var e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Illegal base64url string!"}try{return function(t){return decodeURIComponent(N(t).replace(/(.)/g,function(t,e){var r=e.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}(e)}catch{return N(e)}}(t.split(".")[r]))}catch(t){throw new O("Invalid token specified: "+t.message)}}(t)||void 0}catch{return}}class L{constructor(t=C){this.key=t}async getJwt(){return typeof window>"u"?"":localStorage[this.key]}async getJwtPayload(){return function(t=C){try{return k(localStorage[t])}catch{return}}(this.key)}setJwt(t){try{localStorage[this.key]=t}catch{}}}const D={production:!0,mode:"prod",MISC_SERVER_URL:"https://web-highlights-misc-server.herokuapp.com",BACKEND_URL:"https://api.web-highlights.com",BACKEND_URL_FALLBACK:"https://web-highlights-a56e6dd216b0.herokuapp.com",BLOG_URL:"https://web-highlights.com/blog",WEBSITE_URL:"https://web-highlights.com",DOCS_URL:"https://web-highlights.com/docs/",FRONTEND_URL:"https://app.web-highlights.com",PRIVACY_URL:"https://web-highlights.com/legal/privacy-policy",EXTENSION_ID:"hldjnlbobkdkghfidgoecgmklcemanhm",PADDLE_VENDOR_ID:169421},x="mnjhhninaaaldmcgodimaadhpkaigbpp",P=function(){var t;const e=(null==(t=Ji())?void 0:t.environment)??D,r="https://app.web-highlights.com/oauth/notion";return{LINKED_IN_URL:"https://www.linkedin.com/company/86328566",FACEBOOK_URL:"https://www.facebook.com/webhighlightscom/",INSTAGRAM_URL:"https://www.instagram.com/web_highlights/",LINKED_IN_URL_PRIVATE:"https://www.linkedin.com/in/marius-bongarts-6b3638171",TWITTER_URL:"https://twitter.com/WebHighlights_",TWITTER_URL_PRIVATE:"https://twitter.com/MariusBongarts",GITHUB_LINK_PRIVATE:"https://github.com/MariusBongarts",LINK_TREE_PRIVATE:"https://linktr.ee/MariusBongarts",GITHUB_LINK:"https://github.com/Web-Highlights",AVATAR_MARIUS_B:"https://avatars.githubusercontent.com/u/38838885?s=256&v=4",AVATAR_WEB_HIGHLIGHTS:"https://avatars.githubusercontent.com/u/110981256?s=256&v=4",MEDIUM_URL_PRIVATE:"https://medium.com/@mariusbongarts",LEGAL_TOS_LINK:`${e.WEBSITE_URL}/legal/terms-of-service`,DISCOVER_LINK:`${e.WEBSITE_URL}/discover`,LEGAL_PRIVACY_LINK:`${e.WEBSITE_URL}/legal/privacy-policy`,LEGAL_IMPRINT_LINK:`${e.WEBSITE_URL}/legal/imprint`,FAQ_LINK:`${e.WEBSITE_URL}/faq`,BLOG_LINK:`${e.WEBSITE_URL}/blog`,RELEASE_NOTES_LINK:`${e.WEBSITE_URL}/blog/release-notes`,markIdAttrKey:"markid",markMediatypeAttrKey:"media-type",TOOLBOX_CONTAINS_HIGHLIGHT_CLASS:"contains-highlight",HIGHLIGHT_CLASS:"webhighlights-highlight",CONTAINS_TAGS_CLASS:"webhighlight-with-tags",CONTAINS_NOTES_CLASS:"webhighlight-with-notes",CHROME_EXTENSION_LINK:"https://chromewebstore.google.com/detail/web-highlights-pdf-web-hi/hldjnlbobkdkghfidgoecgmklcemanhm",EDGE_EXTENSION_LINK:"https://microsoftedge.microsoft.com/addons/detail/web-highlights-pdf-we/ghdpaajjhmlfkogblgeibaabcpjfgldn",SIDEBAR_HTML_ATTRS:{ALIGNMENT:"alignment",SIDEBAR_WIDTH:"sidebar-width"},NOTION_REDIRECT_URL:r,NOTION_AUTH_URL:`https://api.notion.com/v1/oauth/authorize?client_id=4f5934df-e74b-4318-b381-604df7b3e06d&response_type=code&owner=user&redirect_uri=${encodeURIComponent(r)}`,DAILY_NOTION_API_EXPORT_LIMIT:1,DAILY_CAPACITIES_API_EXPORT_LIMIT:1,DAILY_YOUTUBE_VIDEO_LIMIT:1,DAILY_AI_SUMMARY_LIMIT:1,DAILY_AI_CHATS_LIMIT:1,GLOBAL_STYLE_VARIABLES_ID:"web-highlights-global-style-variables",HISTORY_OVERVIEW_PAGINATION_STEP:35}}();function R(t,e){const r=function(t){const e=function(t){return document.getElementById(t)}(t);if(e)return e;const r=document.createElement("style");return r.id=t,document.body.append(r),r}(t);r.innerHTML!==e&&(r.innerHTML=e)}const B={slate:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94a3b8",500:"#64748b",600:"#475569",700:"#334155",800:"#1e293b",900:"#0f172a",950:"#020617"},primary:{50:"rgb(188, 220, 205)",100:"rgb(154, 208, 185)",200:"rgb(120, 197, 164)",300:"rgb(86, 186, 144)",400:"rgb(53, 176, 125)",500:"rgb(0, 179, 122)",600:"hsl(161, 100%, 33%)",700:"hsl(161, 100%, 31%)",800:"hsl(161, 100%, 29%)",900:"hsl(161, 100%, 25%)",950:"hsl(161, 100%, 20%)"},secondary:{50:"hsl(218, 22%, 27%)",100:"hsl(218, 22%, 23%)",200:"hsl(218, 22%, 22%)",300:"hsl(218, 22%, 19%)",400:"hsl(218, 22%, 17%)",500:"hsl(218, 22%, 15%)",600:"hsl(218, 22%, 13%)",700:"hsl(218, 22%, 11%)",800:"hsl(218, 22%, 9%)",900:"hsl(218, 22%, 5%)",950:"hsl(218, 22%, 3%)"},gray:{50:"#f9fafb",100:"#f3f4f6",200:"#e5e7eb",300:"#d1d5db",400:"#9ca3af",500:"#6b7280",600:"#4b5563",700:"#374151",800:"#1f2937",900:"#111827",950:"#030712"},zinc:{50:"#fafafa",100:"#f4f4f5",200:"#e4e4e7",300:"#d4d4d8",400:"#a1a1aa",500:"#71717a",600:"#52525b",700:"#3f3f46",800:"#27272a",900:"#18181b",950:"#09090b"},neutral:{50:"#fafafa",100:"#f5f5f5",200:"#e5e5e5",300:"#d4d4d4",400:"#a3a3a3",500:"#737373",600:"#525252",700:"#404040",800:"#262626",900:"#171717",950:"#0a0a0a"},stone:{50:"#fafaf9",100:"#f5f5f4",200:"#e7e5e4",300:"#d6d3d1",400:"#a8a29e",500:"#78716c",600:"#57534e",700:"#44403c",800:"#292524",900:"#1c1917",950:"#0c0a09"},red:{50:"#fef2f2",100:"#fee2e2",200:"#fecaca",300:"#fca5a5",400:"#f87171",500:"#ef4444",600:"#dc2626",700:"#b91c1c",800:"#991b1b",900:"#7f1d1d",950:"#450a0a"},orange:{50:"#fff7ed",100:"#ffedd5",200:"#fed7aa",300:"#fdba74",400:"#fb923c",500:"#f97316",600:"#ea580c",700:"#c2410c",800:"#9a3412",900:"#7c2d12",950:"#431407"},amber:{50:"#fffbeb",100:"#fef3c7",200:"#fde68a",300:"#fcd34d",400:"#fbbf24",500:"#f59e0b",600:"#d97706",700:"#b45309",800:"#92400e",900:"#78350f",950:"#451a03"},yellow:{50:"#fefce8",100:"#fef9c3",200:"#fef08a",300:"#fde047",400:"#facc15",500:"#eab308",600:"#ca8a04",700:"#a16207",800:"#854d0e",900:"#713f12",950:"#422006"},lime:{50:"#f7fee7",100:"#ecfccb",200:"#d9f99d",300:"#bef264",400:"#a3e635",500:"#84cc16",600:"#65a30d",700:"#4d7c0f",800:"#3f6212",900:"#365314",950:"#1a2e05"},green:{50:"#f0fdf4",100:"#dcfce7",200:"#bbf7d0",300:"#86efac",400:"#4ade80",500:"#22c55e",600:"#16a34a",700:"#15803d",800:"#166534",900:"#14532d",950:"#052e16"},emerald:{50:"#ecfdf5",100:"#d1fae5",200:"#a7f3d0",300:"#6ee7b7",400:"#34d399",500:"#10b981",600:"#059669",700:"#047857",800:"#065f46",900:"#064e3b",950:"#022c22"},teal:{50:"#f0fdfa",100:"#ccfbf1",200:"#99f6e4",300:"#5eead4",400:"#2dd4bf",500:"#14b8a6",600:"#0d9488",700:"#0f766e",800:"#115e59",900:"#134e4a",950:"#042f2e"},cyan:{50:"#ecfeff",100:"#cffafe",200:"#a5f3fc",300:"#67e8f9",400:"#22d3ee",500:"#06b6d4",600:"#0891b2",700:"#0e7490",800:"#155e75",900:"#164e63",950:"#083344"},sky:{50:"#f0f9ff",100:"#e0f2fe",200:"#bae6fd",300:"#7dd3fc",400:"#38bdf8",500:"#0ea5e9",600:"#0284c7",700:"#0369a1",800:"#075985",900:"#0c4a6e",950:"#082f49"},blue:{50:"#eff6ff",100:"#dbeafe",200:"#bfdbfe",300:"#93c5fd",400:"#60a5fa",500:"#3b82f6",600:"#2563eb",700:"#1d4ed8",800:"#1e40af",900:"#1e3a8a",950:"#172554"},indigo:{50:"#eef2ff",100:"#e0e7ff",200:"#c7d2fe",300:"#a5b4fc",400:"#818cf8",500:"#6366f1",600:"#4f46e5",700:"#4338ca",800:"#3730a3",900:"#312e81",950:"#1e1b4b"},violet:{50:"#f5f3ff",100:"#ede9fe",200:"#ddd6fe",300:"#c4b5fd",400:"#a78bfa",500:"#8b5cf6",600:"#7c3aed",700:"#6d28d9",800:"#5b21b6",900:"#4c1d95",950:"#2e1065"},purple:{50:"#faf5ff",100:"#f3e8ff",200:"#e9d5ff",300:"#d8b4fe",400:"#c084fc",500:"#a855f7",600:"#9333ea",700:"#7e22ce",800:"#6b21a8",900:"#581c87",950:"#3b0764"},fuchsia:{50:"#fdf4ff",100:"#fae8ff",200:"#f5d0fe",300:"#f0abfc",400:"#e879f9",500:"#d946ef",600:"#c026d3",700:"#a21caf",800:"#86198f",900:"#701a75",950:"#4a044e"},pink:{50:"#fdf2f8",100:"#fce7f3",200:"#fbcfe8",300:"#f9a8d4",400:"#f472b6",500:"#ec4899",600:"#db2777",700:"#be185d",800:"#9d174d",900:"#831843",950:"#500724"},rose:{50:"#fff1f2",100:"#ffe4e6",200:"#fecdd3",300:"#fda4af",400:"#fb7185",500:"#f43f5e",600:"#e11d48",700:"#be123c",800:"#9f1239",900:"#881337",950:"#4c0519"}},G={"wh-primary-color":"var(--wh-primary-500)","wh-primary-color-hover":"#00a16e","wh-primary-color-transparent":"#00aa7424","wh-primary-color-transparent-light":"#00a8730f","wh-primary-color-transparent-strong":"#00a87340","wh-primary-light":"#53e3a6","wh-primary-dark":"#007f4b","wh-primary-dark-hover":"#017444","wh-primary-shadow":"#00b07841","wh-primary-shadow-2":"#00b07870","wh-primary-border-color":"#c8c8c870","wh-warning-color":"#ff5a1f","wh-warning-color-light":"#feecdc","wh-ai-primary-decimal":"167, 139, 250","wh-ai-secondary-decimal  ":"147, 51, 234","wh-ai-accent-decimal":"244, 114, 182","wh-ai-primary":"rgba(var(--wh-ai-primary-decimal), 1)","wh-ai-secondary":"rgba(var(--wh-ai-secondary-decimal), 1)","wh-ai-accent":"rgba(var(--wh-ai-accent-decimal), 1)","secondary-color":"#3d4455","secondary-color-hover":"#3a4052","secondary-color-transparent":"#3d44556b","secondary-light":"#4c556d","secondary-dark":"#252934","secondary-dark-hover":"#191b22","secondary-dark-transparent":"#2e2d2d46","highlight-color":"#92ffaa","error-color":"#d62d4c","error-color-light":"#fde8e8","error-info":"#14854e","success-color":"#0e9f6e","success-color-light":"#def7ec","font-color":"#2f3237","font-color-light":"#626364","font-color-dark":"#252525","wh-font-family":'\'SF Pro Display\', \'Inter\', ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"',"font-family":"var(--wh-font-family)","font-size":"12px","webhighlights-font-size":"12px","wh-link-color":"#1d9bf0","wh-form-active-color":"#3b82f6","wh-accent-blue":"#1f6feb","wh-mobile-breakpoint":"767px",BREAKPOINT_XS:"575px",BREAKPOINT_S:"767px",BREAKPOINT_M:"991px",BREAKPOINT_L:"1199px",BREAKPOINT_XL:"1399px",BREAKPOINT_XXL:"1699px","wh-danger-color":"var(--wh-red-600)","wh-danger-color-hover":"var(--wh-red-700)","wh-font-size":"13px","wh-blockquote-line-height":"1.3"},U=[...Object.keys(B).map(t=>Object.keys(B[t]).map(e=>{const r=B[t][e];return{property:`wh-${t}-${e}`,value:{dark:r,light:r}}})).flat(),...Object.keys(G).map(t=>({property:t,value:{dark:G[t],light:G[t]}})),{property:"wh-bg-base",value:{dark:"var(--wh-secondary-600)",light:"hsl(0, 0%, 100%)"}},{property:"wh-bg-base-hover",value:{dark:"var(--wh-secondary-500)",light:"var(--wh-gray-50)"}},{property:"wh-border-base",value:{dark:"var(--wh-secondary-200)",light:"hsl(20, 6%, 94%)"}},{property:"wh-border-base-hover",value:{dark:"var(--wh-secondary-100)",light:"hsl(20, 6%, 90%)"}},{property:"wh-border-base-strong",value:{dark:"var(--wh-secondary-100)",light:"hsl(24, 6%, 85%)"}},{property:"wh-border-base-strong-hover",value:{dark:"var(--wh-secondary-50)",light:"hsl(24, 6%, 70%)"}},{property:"wh-bg-base-hover-strong",value:{dark:"var(--wh-secondary-300)",light:"var(--wh-gray-100)"}},{property:"wh-bg-back",value:{dark:"var(--wh-secondary-700)",light:"hsl(0, 0%, 100%)"}},{property:"wh-bg-back-strong",value:{dark:"var(--wh-secondary-800)",light:"var(--wh-gray-100)"}},{property:"wh-bg-back-strong-hover",value:{dark:"var(--wh-secondary-900)",light:"var(--wh-gray-200)"}},{property:"wh-bg-back-hover",value:{dark:"var(--wh-secondary-600)",light:"var(--wh-neutral-50)"}},{property:"wh-bg-back-hover-strong",value:{dark:"var(--wh-secondary-800)",light:"var(--wh-neutral-100)"}},{property:"wh-border-back",value:{dark:"var(--wh-secondary-100)",light:"#e7e5e4"}},{property:"wh-border-back-strong",value:{dark:"var(--wh-secondary-50)",light:"#d6d3d1"}},{property:"wh-bg-front",value:{dark:"var(--wh-secondary-400)",light:"hsl(0, 0%, 100%)"}},{property:"wh-bg-front-strong",value:{dark:"var(--wh-secondary-200)",light:"var(--wh-neutral-100)"}},{property:"wh-bg-front-strong-hover",value:{dark:"var(--wh-secondary-50)",light:"var(--wh-neutral-200)"}},{property:"wh-bg-front-hover",value:{dark:"var(--wh-secondary-300)",light:"hsl(0, 0%, 98%)"}},{property:"wh-bg-front-hover-strong",value:{dark:"var(--wh-secondary-200)",light:"hsl(0, 0%, 95%)"}},{property:"wh-border-front",value:{dark:"hsl(227, 20%, 25%)",light:"#e7e5e4"}},{property:"wh-border-front-strong",value:{dark:"hsl(227, 20%, 35%)",light:"#d6d3d1"}},{property:"wh-text-stronger",value:{dark:"hsla(0, 0%, 100%, 0.95)",light:"hsl(45, 8%, 25%)"}},{property:"wh-text-strongest",value:{dark:"hsla(0, 0%, 100%, 1)",light:"hsl(45, 8%, 20%)"}},{property:"wh-text-strong",value:{dark:"rgba(255, 255, 255, 0.9)",light:"rgb(55, 53, 47)"}},{property:"wh-text",value:{dark:"rgba(255, 255, 255, 0.85)",light:"rgb(55, 53, 47)"}},{property:"wh-text-hover",value:{dark:"var(--wh-text-strong)",light:"var(--wh-text-strong)"}},{property:"wh-text-light",value:{dark:"rgba(255, 255, 255, 0.78)",light:"rgb(55, 53, 47, 0.9)"}},{property:"wh-text-lighter",value:{dark:"rgba(255, 255, 255, 0.66)",light:"rgb(55, 53, 47, 0.7)"}},{property:"wh-text-lightest",value:{dark:"rgba(255, 255, 255, 0.55)",light:"rgb(55, 53, 47, 0.5)"}},{property:"wh-border-color",value:{dark:"hsla(0, 0%, 100%, 0.15)",light:"var(--wh-gray-300)"}},{property:"wh-border-color-strong",value:{dark:"hsla(0, 0%, 100%, 0.25)",light:"var(--wh-gray-400)"}},{property:"wh-note-editor-bg-color",value:{dark:"hsl(221, 27%, 17%)",light:"rgb(247, 246, 243)"}},{property:"wh-note-editor-bg-color-preview",value:{dark:"hsl(221, 27%, 15%)",light:"rgba(247, 246, 243, 0.85)"}},{property:"wh-bg-tags",value:{dark:"var(--wh-secondary-300)",light:"var(--wh-bg-front-strong)"}},{property:"wh-bg-tags-hover",value:{dark:"var(--wh-secondary-200)",light:"var(--wh-bg-front-strong-hover)"}},{property:"wh-syntax-bg-color",value:{dark:"rgba(255, 255, 255, 0.05)",light:"rgb(230, 230, 230)"}},{property:"wh-fallback-img-color",value:{dark:"var(--wh-secondary-600)",light:"var(--wh-gray-100)"}},{property:"wh-bg-disabled",value:{dark:"hsl(220, 22%, 18%)",light:"#e7e9ec"}},{property:"wh-bg-notification-unread",value:{dark:"hsla(161, 100%, 20%, 0.15)",light:"rgba(187, 219, 204, 0.2)"}},{property:"wh-bg-notification-unread-hover",value:{dark:"hsla(161, 100%, 20%, 0.05)",light:"rgba(187, 219, 204, 0.1)"}},{property:"wh-subtle-gray",value:{dark:"rgb(255, 255, 255, 0.1)",light:"rgb(128, 128, 128, 0.15)"}},{property:"wh-shadow",value:{dark:"inset 0 0 0.5px 1px hsla(0, 0%, 100%, 0.1),\n      /* 2. shadow ring  */ 0 0 0 1px hsla(230, 13%, 9%, 0.075),\n      /* 3. multiple soft shadows  */ 0 0.3px 0.4px hsla(230, 13%, 9%, 0.02),\n      0 0.9px 1.5px hsla(230, 13%, 9%, 0.045),\n      0 3.5px 6px hsla(230, 13%, 9%, 0.09)",light:"inset 0 0 0.5px 1px hsla(0, 0%, 100%, 0.1),\n      /* 2. shadow ring  */ 0 0 0 1px hsla(230, 13%, 9%, 0.075),\n      /* 3. multiple soft shadows  */ 0 0.3px 0.4px hsla(230, 13%, 9%, 0.02),\n      0 0.9px 1.5px hsla(230, 13%, 9%, 0.045),\n      0 3.5px 6px hsla(230, 13%, 9%, 0.09)"}},{property:"wh-shadow-primary",value:{dark:"var(--wh-primary-500) 0px 0px 0px 1px inset,\n      var(--wh-primary-500) 0px 0px 1px",light:"var(--wh-primary-500) 0px 0px 0px 1px inset,\n      var(--wh-primary-500) 0px 0px 1px"}},{property:"wh-skeleton-bg",value:{dark:"var(--wh-secondary-300)",light:"var(--wh-gray-200)"}},{property:"wh-skeleton-bg-hover",value:{dark:"var(--wh-secondary-200)",light:"var(--wh-gray-300)"}},{property:"wh-skeleton-bg-strong",value:{dark:"var(--wh-secondary-200)",light:"var(--wh-gray-300)"}},{property:"wh-skeleton-bg-strong-hover",value:{dark:"var(--wh-secondary-100)",light:"var(--wh-gray-400)"}}];function M(t){const e=t??(typeof window>"u"||"function"!=typeof window.matchMedia?"light":window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),r=U.map(t=>((t,e)=>({property:t.property,value:t.value[e]}))(t,e));!function(t){const e=function(t){return`:root { ${t.map(({property:t,value:e})=>`${t.startsWith("--")?t:`--${t}`}: ${e};`).join("")} }`}(t);R(P.GLOBAL_STYLE_VARIABLES_ID,e)}(r)}async function j(){try{const t=await bn.getJwtPayload();return t?{_id:t._id}:null}catch(t){return console.warn("Failed to get current user for action recording:",t),null}}var F=(t=>(t.BASIC="BASIC",t.EXPERT="EXPERT",t))(F||{});var $=(t=>(t.BLOCKQUOTE="blockquote",t.PARAGRAPH="paragraph",t.HEADING_1="heading1",t.HEADING_2="heading2",t.HEADING_3="heading3",t.BULLET_LIST_ITEM="bulletListItem",t.IMAGE="image",t.CODE="code",t))($||{});function H(t){return"image"===(null==t?void 0:t.mediaType)&&!(null==t||!t.imageSrc)}Object.values($);var W,V=(t=>(t.trash="trash",t["copy-file"]="copy-file",t.blockquote="blockquote",t["file-pdf"]="file-pdf",t["file-html"]="file-html",t.settings="settings",t.rocket="rocket",t.search="search",t.bulb="bulb",t.star="star",t["delete-x"]="delete-x",t.twitter="twitter",t.box="box",t["mark-icon"]="mark-icon",t.linkedin="linkedin",t.facebook="facebook",t.clock="clock",t.calendar="calendar",t["external-link"]="external-link",t["cloud-off"]="cloud-off",t.cloud="cloud",t["cloud-check"]="cloud-check",t["plus-circle"]="plus-circle",t["minus-circle"]="minus-circle",t.info="info",t["x-circle"]="x-circle",t["check-circle"]="check-circle",t["thumbs-up"]="thumbs-up",t["thumbs-down"]="thumbs-down",t.brain="brain",t["arrow-right"]="arrow-right",t.eye="eye",t["eye-off"]="eye-off",t["feather-edit-3"]="feather-edit-3",t.tag="tag",t.home="home",t.bookmark="bookmark",t["align-left"]="align-left",t["align-right"]="align-right",t["push-right"]="push-right",t["sidebar-overlay"]="sidebar-overlay",t["sidebar-expand"]="sidebar-expand",t.sun="sun",t.moon="moon",t.power="power",t.image="image",t["book-open"]="book-open",t.bell="bell",t["minimize-2"]="minimize-2",t["maximize-2"]="maximize-2",t["lock-icon"]="lock-icon",t.link="link",t["unlock-icon"]="unlock-icon",t.menu="menu",t.list="list",t.logout="logout",t["chevron-right"]="chevron-right",t["chevron-left"]="chevron-left",t.history="history",t.globe="globe",t.grid="grid",t["arrows-down-up"]="arrows-down-up",t.filter="filter",t["filter-2"]="filter-2",t.groups="groups",t["size-small"]="size-small",t["size-medium"]="size-medium",t["size-large"]="size-large",t["alert-circle"]="alert-circle",t.save="save",t.user="user",t["arrow-up-circle"]="arrow-up-circle",t.compass="compass",t.zap="zap",t.smartphone="smartphone",t.capacities="capacities",t.notion="notion",t.obsidian="obsidian",t.book="book",t.colorPalette="colorPalette",t.type="type",t.crown="crown",t.command="command",t.circle="circle",t.dragDots="dragDots",t.weava="weava",t.pocket="pocket",t.mail="mail",t.repeat="repeat",t.inbox="inbox",t.flame="flame",t.medal="medal",t["check-badge"]="check-badge",t.check="check",t.dot="dot",t["curved-arrow-left"]="curved-arrow-left",t["buyer-pay-icon"]="buyer-pay-icon",t["save-plant"]="save-plant",t.reader="reader",t.download="download",t.font="font",t["auto-color-mode"]="auto-color-mode",t["paint-brush"]="paint-brush",t.width="width",t.height="height",t.plus="plus",t.pause="pause",t["reader-extension-icon"]="reader-extension-icon",t.gift="gift",t.notebook="notebook",t.share="share",t["ai-stars"]="ai-stars",t["chevron-down"]="chevron-down",t.collapse="collapse",t.expand="expand",t.clipboard="clipboard",t.target="target",t.pin="pin",t.play="play",t.youtube="youtube",t.diigo="diigo",t["stop-circle"]="stop-circle",t["rotate-ccw"]="rotate-ccw",t))(V||{});(W||(W={})).WEB_HIGHLIGHT="web-highlight";const q=["#fdffb4","#f8b6a8","#a7e8c8","#f7c2d6","#c3bbec","#c3effc"];for(var z=[],K=[],Y=typeof Uint8Array<"u"?Uint8Array:Array,J="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",X=0;X<64;++X)z[X]=J[X],K[J.charCodeAt(X)]=X;function Z(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");return-1===r&&(r=e),[r,r===e?0:4-r%4]}function Q(t){return z[t>>18&63]+z[t>>12&63]+z[t>>6&63]+z[63&t]}function tt(t,e,r){for(var n,i=[],o=e;o<r;o+=3)n=(t[o]<<16&16711680)+(t[o+1]<<8&65280)+(255&t[o+2]),i.push(Q(n));return i.join("")}K[45]=62,K[95]=63;var et=function(t){var e,r,n=Z(t),i=n[0],o=n[1],s=new Y(function(t,e,r){return 3*(e+r)/4-r}(0,i,o)),a=0,c=o>0?i-4:i;for(r=0;r<c;r+=4)e=K[t.charCodeAt(r)]<<18|K[t.charCodeAt(r+1)]<<12|K[t.charCodeAt(r+2)]<<6|K[t.charCodeAt(r+3)],s[a++]=e>>16&255,s[a++]=e>>8&255,s[a++]=255&e;return 2===o&&(e=K[t.charCodeAt(r)]<<2|K[t.charCodeAt(r+1)]>>4,s[a++]=255&e),1===o&&(e=K[t.charCodeAt(r)]<<10|K[t.charCodeAt(r+1)]<<4|K[t.charCodeAt(r+2)]>>2,s[a++]=e>>8&255,s[a++]=255&e),s},rt=function(t){for(var e,r=t.length,n=r%3,i=[],o=16383,s=0,a=r-n;s<a;s+=o)i.push(tt(t,s,s+o>a?a:s+o));return 1===n?(e=t[r-1],i.push(z[e>>2]+z[e<<4&63]+"==")):2===n&&(e=(t[r-2]<<8)+t[r-1],i.push(z[e>>10]+z[e>>4&63]+z[e<<2&63]+"=")),i.join("")},nt=function(t,e,r,n,i){var o,s,a=8*i-n-1,c=(1<<a)-1,l=c>>1,u=-7,h=r?i-1:0,d=r?-1:1,f=t[e+h];for(h+=d,o=f&(1<<-u)-1,f>>=-u,u+=a;u>0;o=256*o+t[e+h],h+=d,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=n;u>0;s=256*s+t[e+h],h+=d,u-=8);if(0===o)o=1-l;else{if(o===c)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,n),o-=l}return(f?-1:1)*s*Math.pow(2,o-n)},it=function(t,e,r,n,i,o){var s,a,c,l=8*o-i-1,u=(1<<l)-1,h=u>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:o-1,g=n?1:-1,p=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=u):(s=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-s))<1&&(s--,c*=2),(e+=s+h>=1?d/c:d*Math.pow(2,1-h))*c>=2&&(s++,c/=2),s+h>=u?(a=0,s=u):s+h>=1?(a=(e*c-1)*Math.pow(2,i),s+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,i),s=0));i>=8;t[r+f]=255&a,f+=g,a/=256,i-=8);for(s=s<<i|a,l+=i;l>0;t[r+f]=255&s,f+=g,s/=256,l-=8);t[r+f-g]|=128*p},ot=function(t,e){return function(t,e){var r="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=o,e.SlowBuffer=function(t){return+t!=t&&(t=0),o.alloc(+t)},e.INSPECT_MAX_BYTES=50;var n=2147483647;function i(t){if(t>n)throw new RangeError('The value "'+t+'" is invalid for option "size"');var e=new Uint8Array(t);return Object.setPrototypeOf(e,o.prototype),e}function o(t,e,r){if("number"==typeof t){if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return c(t)}return s(t,e,r)}function s(t,e,r){if("string"==typeof t)return function(t,e){if(("string"!=typeof e||""===e)&&(e="utf8"),!o.isEncoding(e))throw new TypeError("Unknown encoding: "+e);var r=0|d(t,e),n=i(r),s=n.write(t,e);return s!==r&&(n=n.slice(0,s)),n}(t,e);if(ArrayBuffer.isView(t))return function(t){if(U(t,Uint8Array)){var e=new Uint8Array(t);return u(e.buffer,e.byteOffset,e.byteLength)}return l(t)}(t);if(null==t)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+babelHelpers.typeof(t));if(U(t,ArrayBuffer)||t&&U(t.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(U(t,SharedArrayBuffer)||t&&U(t.buffer,SharedArrayBuffer)))return u(t,e,r);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=t.valueOf&&t.valueOf();if(null!=n&&n!==t)return o.from(n,e,r);var s=function(t){if(o.isBuffer(t)){var e=0|h(t.length),r=i(e);return 0===r.length||t.copy(r,0,0,e),r}return void 0!==t.length?"number"!=typeof t.length||M(t.length)?i(0):l(t):"Buffer"===t.type&&Array.isArray(t.data)?l(t.data):void 0}(t);if(s)return s;if(typeof Symbol<"u"&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return o.from(t[Symbol.toPrimitive]("string"),e,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+babelHelpers.typeof(t))}function a(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function c(t){return a(t),i(t<0?0:0|h(t))}function l(t){for(var e=t.length<0?0:0|h(t.length),r=i(e),n=0;n<e;n+=1)r[n]=255&t[n];return r}function u(t,e,r){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(r||0))throw new RangeError('"length" is outside of buffer bounds');var n;return n=void 0===e&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,e):new Uint8Array(t,e,r),Object.setPrototypeOf(n,o.prototype),n}function h(t){if(t>=n)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n.toString(16)+" bytes");return 0|t}function d(t,e){if(o.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||U(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+babelHelpers.typeof(t));var r=t.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return R(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return B(t).length;default:if(i)return n?-1:R(t).length;e=(""+e).toLowerCase(),i=!0}}function f(t,e,r){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0)||(r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return N(this,e,r);case"utf8":case"utf-8":return w(this,e,r);case"ascii":return S(this,e,r);case"latin1":case"binary":return I(this,e,r);case"base64":return A(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function g(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function p(t,e,r,n,i){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),M(r=+r)&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(i)return-1;r=t.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof e&&(e=o.from(e,n)),o.isBuffer(e))return 0===e.length?-1:m(t,e,r,n,i);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):m(t,[e],r,n,i);throw new TypeError("val must be string, number or Buffer")}function m(t,e,r,n,i){var o,s=1,a=t.length,c=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;s=2,a/=2,c/=2,r/=2}function l(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(i){var u=-1;for(o=r;o<a;o++)if(l(t,o)===l(e,-1===u?0:o-u)){if(-1===u&&(u=o),o-u+1===c)return u*s}else-1!==u&&(o-=o-u),u=-1}else for(r+c>a&&(r=a-c),o=r;o>=0;o--){for(var h=!0,d=0;d<c;d++)if(l(t,o+d)!==l(e,d)){h=!1;break}if(h)return o}return-1}function y(t,e,r,n){r=Number(r)||0;var i=t.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=e.length;n>o/2&&(n=o/2);for(var s=0;s<n;++s){var a=parseInt(e.substr(2*s,2),16);if(M(a))return s;t[r+s]=a}return s}function b(t,e,r,n){return G(R(e,t.length-r),t,r,n)}function T(t,e,r,n){return G(function(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,n)}function v(t,e,r,n){return G(B(e),t,r,n)}function _(t,e,r,n){return G(function(t,e){for(var r,n,i,o=[],s=0;s<t.length&&!((e-=2)<0);++s)n=(r=t.charCodeAt(s))>>8,i=r%256,o.push(i),o.push(n);return o}(e,t.length-r),t,r,n)}function A(t,e,r){return 0===e&&r===t.length?rt(t):rt(t.slice(e,r))}function w(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var o,s,a,c,l=t[i],u=null,h=l>239?4:l>223?3:l>191?2:1;if(i+h<=r)switch(h){case 1:l<128&&(u=l);break;case 2:128==(192&(o=t[i+1]))&&(c=(31&l)<<6|63&o)>127&&(u=c);break;case 3:o=t[i+1],s=t[i+2],128==(192&o)&&128==(192&s)&&(c=(15&l)<<12|(63&o)<<6|63&s)>2047&&(c<55296||c>57343)&&(u=c);break;case 4:o=t[i+1],s=t[i+2],a=t[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(c=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&c<1114112&&(u=c)}null===u?(u=65533,h=1):u>65535&&(u-=65536,n.push(u>>>10&1023|55296),u=56320|1023&u),n.push(u),i+=h}return function(t){var e=t.length;if(e<=E)return String.fromCharCode.apply(String,t);for(var r="",n=0;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=E));return r}(n)}e.kMaxLength=n,o.TYPED_ARRAY_SUPPORT=function(){try{var t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch{return!1}}(),!o.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&"function"==typeof console.error&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(t,e,r){return s(t,e,r)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(t,e,r){return function(t,e,r){return a(t),t<=0?i(t):void 0!==e?"string"==typeof r?i(t).fill(e,r):i(t).fill(e):i(t)}(t,e,r)},o.allocUnsafe=function(t){return c(t)},o.allocUnsafeSlow=function(t){return c(t)},o.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==o.prototype},o.compare=function(t,e){if(U(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),U(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(t)||!o.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;for(var r=t.length,n=e.length,i=0,s=Math.min(r,n);i<s;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0},o.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return o.alloc(0);var r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;var n=o.allocUnsafe(e),i=0;for(r=0;r<t.length;++r){var s=t[r];if(U(s,Uint8Array))i+s.length>n.length?o.from(s).copy(n,i):Uint8Array.prototype.set.call(n,s,i);else{if(!o.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(n,i)}i+=s.length}return n},o.byteLength=d,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)g(this,e,e+1);return this},o.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)g(this,e,e+3),g(this,e+1,e+2);return this},o.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)g(this,e,e+7),g(this,e+1,e+6),g(this,e+2,e+5),g(this,e+3,e+4);return this},o.prototype.toString=function(){var t=this.length;return 0===t?"":0===arguments.length?w(this,0,t):f.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(t){if(!o.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===o.compare(this,t)},o.prototype.inspect=function(){var t="",r=e.INSPECT_MAX_BYTES;return t=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(t+=" ... "),"<Buffer "+t+">"},r&&(o.prototype[r]=o.prototype.inspect),o.prototype.compare=function(t,e,r,n,i){if(U(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+babelHelpers.typeof(t));if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),e<0||r>t.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&e>=r)return 0;if(n>=i)return-1;if(e>=r)return 1;if(this===t)return 0;for(var s=(i>>>=0)-(n>>>=0),a=(r>>>=0)-(e>>>=0),c=Math.min(s,a),l=this.slice(n,i),u=t.slice(e,r),h=0;h<c;++h)if(l[h]!==u[h]){s=l[h],a=u[h];break}return s<a?-1:a<s?1:0},o.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},o.prototype.indexOf=function(t,e,r){return p(this,t,e,r,!0)},o.prototype.lastIndexOf=function(t,e,r){return p(this,t,e,r,!1)},o.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-e;if((void 0===r||r>i)&&(r=i),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return y(this,t,e,r);case"utf8":case"utf-8":return b(this,t,e,r);case"ascii":case"latin1":case"binary":return T(this,t,e,r);case"base64":return v(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _(this,t,e,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var E=4096;function S(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}function I(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}function N(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=e;o<r;++o)i+=j[t[o]];return i}function O(t,e,r){for(var n=t.slice(e,r),i="",o=0;o<n.length-1;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function C(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function k(t,e,r,n,i,s){if(!o.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<s)throw new RangeError('"value" argument is out of bounds');if(r+n>t.length)throw new RangeError("Index out of range")}function L(t,e,r,n,i,o){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function D(t,e,r,n,i){return e=+e,r>>>=0,i||L(t,0,r,4),it(t,e,r,n,23,4),r+4}function x(t,e,r,n,i){return e=+e,r>>>=0,i||L(t,0,r,8),it(t,e,r,n,52,8),r+8}o.prototype.slice=function(t,e){var r=this.length;(t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t);var n=this.subarray(t,e);return Object.setPrototypeOf(n,o.prototype),n},o.prototype.readUintLE=o.prototype.readUIntLE=function(t,e,r){t>>>=0,e>>>=0,r||C(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n},o.prototype.readUintBE=o.prototype.readUIntBE=function(t,e,r){t>>>=0,e>>>=0,r||C(t,e,this.length);for(var n=this[t+--e],i=1;e>0&&(i*=256);)n+=this[t+--e]*i;return n},o.prototype.readUint8=o.prototype.readUInt8=function(t,e){return t>>>=0,e||C(t,1,this.length),this[t]},o.prototype.readUint16LE=o.prototype.readUInt16LE=function(t,e){return t>>>=0,e||C(t,2,this.length),this[t]|this[t+1]<<8},o.prototype.readUint16BE=o.prototype.readUInt16BE=function(t,e){return t>>>=0,e||C(t,2,this.length),this[t]<<8|this[t+1]},o.prototype.readUint32LE=o.prototype.readUInt32LE=function(t,e){return t>>>=0,e||C(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},o.prototype.readUint32BE=o.prototype.readUInt32BE=function(t,e){return t>>>=0,e||C(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},o.prototype.readIntLE=function(t,e,r){t>>>=0,e>>>=0,r||C(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*e)),n},o.prototype.readIntBE=function(t,e,r){t>>>=0,e>>>=0,r||C(t,e,this.length);for(var n=e,i=1,o=this[t+--n];n>0&&(i*=256);)o+=this[t+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*e)),o},o.prototype.readInt8=function(t,e){return t>>>=0,e||C(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},o.prototype.readInt16LE=function(t,e){t>>>=0,e||C(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},o.prototype.readInt16BE=function(t,e){t>>>=0,e||C(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},o.prototype.readInt32LE=function(t,e){return t>>>=0,e||C(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},o.prototype.readInt32BE=function(t,e){return t>>>=0,e||C(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},o.prototype.readFloatLE=function(t,e){return t>>>=0,e||C(t,4,this.length),nt(this,t,!0,23,4)},o.prototype.readFloatBE=function(t,e){return t>>>=0,e||C(t,4,this.length),nt(this,t,!1,23,4)},o.prototype.readDoubleLE=function(t,e){return t>>>=0,e||C(t,8,this.length),nt(this,t,!0,52,8)},o.prototype.readDoubleBE=function(t,e){return t>>>=0,e||C(t,8,this.length),nt(this,t,!1,52,8)},o.prototype.writeUintLE=o.prototype.writeUIntLE=function(t,e,r,n){t=+t,e>>>=0,r>>>=0,n||k(this,t,e,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[e]=255&t;++o<r&&(i*=256);)this[e+o]=t/i&255;return e+r},o.prototype.writeUintBE=o.prototype.writeUIntBE=function(t,e,r,n){t=+t,e>>>=0,r>>>=0,n||k(this,t,e,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=t/o&255;return e+r},o.prototype.writeUint8=o.prototype.writeUInt8=function(t,e,r){return t=+t,e>>>=0,r||k(this,t,e,1,255,0),this[e]=255&t,e+1},o.prototype.writeUint16LE=o.prototype.writeUInt16LE=function(t,e,r){return t=+t,e>>>=0,r||k(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},o.prototype.writeUint16BE=o.prototype.writeUInt16BE=function(t,e,r){return t=+t,e>>>=0,r||k(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},o.prototype.writeUint32LE=o.prototype.writeUInt32LE=function(t,e,r){return t=+t,e>>>=0,r||k(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},o.prototype.writeUint32BE=o.prototype.writeUInt32BE=function(t,e,r){return t=+t,e>>>=0,r||k(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},o.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e>>>=0,!n){var i=Math.pow(2,8*r-1);k(this,t,e,r,i-1,-i)}var o=0,s=1,a=0;for(this[e]=255&t;++o<r&&(s*=256);)t<0&&0===a&&0!==this[e+o-1]&&(a=1),this[e+o]=(t/s|0)-a&255;return e+r},o.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e>>>=0,!n){var i=Math.pow(2,8*r-1);k(this,t,e,r,i-1,-i)}var o=r-1,s=1,a=0;for(this[e+o]=255&t;--o>=0&&(s*=256);)t<0&&0===a&&0!==this[e+o+1]&&(a=1),this[e+o]=(t/s|0)-a&255;return e+r},o.prototype.writeInt8=function(t,e,r){return t=+t,e>>>=0,r||k(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},o.prototype.writeInt16LE=function(t,e,r){return t=+t,e>>>=0,r||k(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},o.prototype.writeInt16BE=function(t,e,r){return t=+t,e>>>=0,r||k(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},o.prototype.writeInt32LE=function(t,e,r){return t=+t,e>>>=0,r||k(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},o.prototype.writeInt32BE=function(t,e,r){return t=+t,e>>>=0,r||k(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},o.prototype.writeFloatLE=function(t,e,r){return D(this,t,e,!0,r)},o.prototype.writeFloatBE=function(t,e,r){return D(this,t,e,!1,r)},o.prototype.writeDoubleLE=function(t,e,r){return x(this,t,e,!0,r)},o.prototype.writeDoubleBE=function(t,e,r){return x(this,t,e,!1,r)},o.prototype.copy=function(t,e,r,n){if(!o.isBuffer(t))throw new TypeError("argument should be a Buffer");if(r||(r=0),!n&&0!==n&&(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r||0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var i=n-r;return this===t&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(e,r,n):Uint8Array.prototype.set.call(t,this.subarray(r,n),e),i},o.prototype.fill=function(t,e,r,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!o.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===t.length){var i=t.charCodeAt(0);("utf8"===n&&i<128||"latin1"===n)&&(t=i)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;var s;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(s=e;s<r;++s)this[s]=t;else{var a=o.isBuffer(t)?t:o.from(t,n),c=a.length;if(0===c)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(s=0;s<r-e;++s)this[s+e]=a[s%c]}return this};var P=/[^+/0-9A-Za-z-_]/g;function R(t,e){e=e||1/0;for(var r,n=t.length,i=null,o=[],s=0;s<n;++s){if((r=t.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(e-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;o.push(r)}else if(r<2048){if((e-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function B(t){return et(function(t){if((t=(t=t.split("=")[0]).trim().replace(P,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function G(t,e,r,n){for(var i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}function U(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function M(t){return t!=t}var j=function(){for(var t="0123456789abcdef",e=new Array(256),r=0;r<16;++r)for(var n=16*r,i=0;i<16;++i)e[n+i]=t[r]+t[i];return e}()}(e={exports:{}},e.exports),e.exports}(),st=ot.Buffer;ot.SlowBuffer,ot.INSPECT_MAX_BYTES,ot.kMaxLength;var at=function(t,e){return at=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])},at(t,e)};function ct(t,e){function r(){this.constructor=t}at(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var lt=function(t){function e(r){var n=t.call(this,r)||this;return Object.setPrototypeOf(n,e.prototype),n}return ct(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"BSONError"},enumerable:!1,configurable:!0}),e}(Error),ut=function(t){function e(r){var n=t.call(this,r)||this;return Object.setPrototypeOf(n,e.prototype),n}return ct(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"BSONTypeError"},enumerable:!1,configurable:!0}),e}(TypeError);function ht(t){return t&&t.Math==Math&&t}function dt(){return ht("object"==typeof globalThis&&globalThis)||ht("object"==typeof window&&window)||ht("object"==typeof self&&self)||ht("object"==typeof r.g&&r.g)||Function("return this")()}var ft=function(t){var e=function(){var t=dt();return"object"==typeof t.navigator&&"ReactNative"===t.navigator.product}()?"BSON: For React Native please polyfill crypto.getRandomValues, e.g. using: https://www.npmjs.com/package/react-native-get-random-values.":"BSON: No cryptographic implementation for random bytes present, falling back to a less secure implementation.";console.warn(e);for(var r=st.alloc(t),n=0;n<t;++n)r[n]=Math.floor(256*Math.random());return r},gt=function(){if(typeof window<"u"){var t=window.crypto||window.msCrypto;if(t&&t.getRandomValues)return function(e){return t.getRandomValues(st.alloc(e))}}return typeof r.g<"u"&&r.g.crypto&&r.g.crypto.getRandomValues?function(t){return r.g.crypto.getRandomValues(st.alloc(t))}:ft}();function pt(t){return"[object Uint8Array]"===Object.prototype.toString.call(t)}function mt(t){return"object"==typeof t&&null!==t}function yt(t,e){var r=!1;return function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return r||(console.warn(e),r=!0),t.apply(this,n)}}function bt(t){if(ArrayBuffer.isView(t))return st.from(t.buffer,t.byteOffset,t.byteLength);if(function(t){return["[object ArrayBuffer]","[object SharedArrayBuffer]"].includes(Object.prototype.toString.call(t))}(t))return st.from(t);throw new ut("Must use either Buffer or TypedArray")}var Tt=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|[0-9a-f]{12}4[0-9a-f]{3}[89ab][0-9a-f]{15})$/i,vt=function(t){return"string"==typeof t&&Tt.test(t)},_t=function(t){if(!vt(t))throw new ut('UUID string representations must be a 32 or 36 character hex string (dashes excluded/included). Format: "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" or "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".');var e=t.replace(/-/g,"");return st.from(e,"hex")},At=function(t,e){return void 0===e&&(e=!0),e?t.toString("hex",0,4)+"-"+t.toString("hex",4,6)+"-"+t.toString("hex",6,8)+"-"+t.toString("hex",8,10)+"-"+t.toString("hex",10,16):t.toString("hex")},wt=Math.pow(2,53),Et=-Math.pow(2,53),St=function(){function t(e,r){if(!(this instanceof t))return new t(e,r);if(!(null==e||"string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer||Array.isArray(e)))throw new ut("Binary can only be constructed from string, Buffer, TypedArray, or Array<number>");this.sub_type=r??t.BSON_BINARY_SUBTYPE_DEFAULT,null==e?(this.buffer=st.alloc(t.BUFFER_SIZE),this.position=0):("string"==typeof e?this.buffer=st.from(e,"binary"):Array.isArray(e)?this.buffer=st.from(e):this.buffer=bt(e),this.position=this.buffer.byteLength)}return t.prototype.put=function(e){if("string"==typeof e&&1!==e.length)throw new ut("only accepts single character String");if("number"!=typeof e&&1!==e.length)throw new ut("only accepts single character Uint8Array or Array");var r;if((r="string"==typeof e?e.charCodeAt(0):"number"==typeof e?e:e[0])<0||r>255)throw new ut("only accepts number in a valid unsigned byte range 0-255");if(this.buffer.length>this.position)this.buffer[this.position++]=r;else{var n=st.alloc(t.BUFFER_SIZE+this.buffer.length);this.buffer.copy(n,0,0,this.buffer.length),this.buffer=n,this.buffer[this.position++]=r}},t.prototype.write=function(t,e){if(e="number"==typeof e?e:this.position,this.buffer.length<e+t.length){var r=st.alloc(this.buffer.length+t.length);this.buffer.copy(r,0,0,this.buffer.length),this.buffer=r}ArrayBuffer.isView(t)?(this.buffer.set(bt(t),e),this.position=e+t.byteLength>this.position?e+t.length:this.position):"string"==typeof t&&(this.buffer.write(t,e,t.length,"binary"),this.position=e+t.length>this.position?e+t.length:this.position)},t.prototype.read=function(t,e){return e=e&&e>0?e:this.position,this.buffer.slice(t,t+e)},t.prototype.value=function(t){return(t=!!t)&&this.buffer.length===this.position?this.buffer:t?this.buffer.slice(0,this.position):this.buffer.toString("binary",0,this.position)},t.prototype.length=function(){return this.position},t.prototype.toJSON=function(){return this.buffer.toString("base64")},t.prototype.toString=function(t){return this.buffer.toString(t)},t.prototype.toExtendedJSON=function(t){t=t||{};var e=this.buffer.toString("base64"),r=Number(this.sub_type).toString(16);return t.legacy?{$binary:e,$type:1===r.length?"0"+r:r}:{$binary:{base64:e,subType:1===r.length?"0"+r:r}}},t.prototype.toUUID=function(){if(this.sub_type===t.SUBTYPE_UUID)return new It(this.buffer.slice(0,this.position));throw new lt('Binary sub_type "'.concat(this.sub_type,'" is not supported for converting to UUID. Only "').concat(t.SUBTYPE_UUID,'" is currently supported.'))},t.fromExtendedJSON=function(e,r){var n,i;if(r=r||{},"$binary"in e?r.legacy&&"string"==typeof e.$binary&&"$type"in e?(i=e.$type?parseInt(e.$type,16):0,n=st.from(e.$binary,"base64")):"string"!=typeof e.$binary&&(i=e.$binary.subType?parseInt(e.$binary.subType,16):0,n=st.from(e.$binary.base64,"base64")):"$uuid"in e&&(i=4,n=_t(e.$uuid)),!n)throw new ut("Unexpected Binary Extended JSON format ".concat(JSON.stringify(e)));return 4===i?new It(n):new t(n,i)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){var t=this.value(!0);return'new Binary(Buffer.from("'.concat(t.toString("hex"),'", "hex"), ').concat(this.sub_type,")")},t.BSON_BINARY_SUBTYPE_DEFAULT=0,t.BUFFER_SIZE=256,t.SUBTYPE_DEFAULT=0,t.SUBTYPE_FUNCTION=1,t.SUBTYPE_BYTE_ARRAY=2,t.SUBTYPE_UUID_OLD=3,t.SUBTYPE_UUID=4,t.SUBTYPE_MD5=5,t.SUBTYPE_ENCRYPTED=6,t.SUBTYPE_COLUMN=7,t.SUBTYPE_USER_DEFINED=128,t}();Object.defineProperty(St.prototype,"_bsontype",{value:"Binary"});var It=function(t){function e(r){var n,i,o=this;if(null==r)n=e.generate();else if(r instanceof e)n=st.from(r.buffer),i=r.__id;else if(ArrayBuffer.isView(r)&&16===r.byteLength)n=bt(r);else{if("string"!=typeof r)throw new ut("Argument passed in UUID constructor must be a UUID, a 16 byte Buffer or a 32/36 character hex string (dashes excluded/included, format: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx).");n=_t(r)}return(o=t.call(this,n,4)||this).__id=i,o}return ct(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this.buffer},set:function(t){this.buffer=t,e.cacheHexString&&(this.__id=At(t))},enumerable:!1,configurable:!0}),e.prototype.toHexString=function(t){if(void 0===t&&(t=!0),e.cacheHexString&&this.__id)return this.__id;var r=At(this.id,t);return e.cacheHexString&&(this.__id=r),r},e.prototype.toString=function(t){return t?this.id.toString(t):this.toHexString()},e.prototype.toJSON=function(){return this.toHexString()},e.prototype.equals=function(t){if(!t)return!1;if(t instanceof e)return t.id.equals(this.id);try{return new e(t).id.equals(this.id)}catch{return!1}},e.prototype.toBinary=function(){return new St(this.id,St.SUBTYPE_UUID)},e.generate=function(){var t=gt(16);return t[6]=15&t[6]|64,t[8]=63&t[8]|128,st.from(t)},e.isValid=function(t){return!!t&&(t instanceof e||("string"==typeof t?vt(t):!(!pt(t)||16!==t.length||64!=(240&t[6])||128&~t[8])))},e.createFromHexString=function(t){return new e(_t(t))},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return'new UUID("'.concat(this.toHexString(),'")')},e}(St),Nt=function(){function t(e,r){if(!(this instanceof t))return new t(e,r);this.code=e,this.scope=r}return t.prototype.toJSON=function(){return{code:this.code,scope:this.scope}},t.prototype.toExtendedJSON=function(){return this.scope?{$code:this.code,$scope:this.scope}:{$code:this.code}},t.fromExtendedJSON=function(e){return new t(e.$code,e.$scope)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){var t=this.toJSON();return'new Code("'.concat(String(t.code),'"').concat(t.scope?", ".concat(JSON.stringify(t.scope)):"",")")},t}();Object.defineProperty(Nt.prototype,"_bsontype",{value:"Code"});var Ot=function(){function t(e,r,n,i){if(!(this instanceof t))return new t(e,r,n,i);var o=e.split(".");2===o.length&&(n=o.shift(),e=o.shift()),this.collection=e,this.oid=r,this.db=n,this.fields=i||{}}return Object.defineProperty(t.prototype,"namespace",{get:function(){return this.collection},set:function(t){this.collection=t},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){var t=Object.assign({$ref:this.collection,$id:this.oid},this.fields);return null!=this.db&&(t.$db=this.db),t},t.prototype.toExtendedJSON=function(t){t=t||{};var e={$ref:this.collection,$id:this.oid};return t.legacy||(this.db&&(e.$db=this.db),e=Object.assign(e,this.fields)),e},t.fromExtendedJSON=function(e){var r=Object.assign({},e);return delete r.$ref,delete r.$id,delete r.$db,new t(e.$ref,e.$id,e.$db,r)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){var t=void 0===this.oid||void 0===this.oid.toString?this.oid:this.oid.toString();return'new DBRef("'.concat(this.namespace,'", new ObjectId("').concat(String(t),'")').concat(this.db?', "'.concat(this.db,'"'):"",")")},t}();Object.defineProperty(Ot.prototype,"_bsontype",{value:"DBRef"});var Ct=void 0;try{Ct=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}var kt=4294967296,Lt=kt*kt,Dt=Lt/2,xt={},Pt={},Rt=function(){function t(e,r,n){if(void 0===e&&(e=0),!(this instanceof t))return new t(e,r,n);"bigint"==typeof e?Object.assign(this,t.fromBigInt(e,!!r)):"string"==typeof e?Object.assign(this,t.fromString(e,!!r)):(this.low=0|e,this.high=0|r,this.unsigned=!!n),Object.defineProperty(this,"__isLong__",{value:!0,configurable:!1,writable:!1,enumerable:!1})}return t.fromBits=function(e,r,n){return new t(e,r,n)},t.fromInt=function(e,r){var n,i,o;return r?(o=0<=(e>>>=0)&&e<256)&&(i=Pt[e])?i:(n=t.fromBits(e,(0|e)<0?-1:0,!0),o&&(Pt[e]=n),n):(o=-128<=(e|=0)&&e<128)&&(i=xt[e])?i:(n=t.fromBits(e,e<0?-1:0,!1),o&&(xt[e]=n),n)},t.fromNumber=function(e,r){if(isNaN(e))return r?t.UZERO:t.ZERO;if(r){if(e<0)return t.UZERO;if(e>=Lt)return t.MAX_UNSIGNED_VALUE}else{if(e<=-Dt)return t.MIN_VALUE;if(e+1>=Dt)return t.MAX_VALUE}return e<0?t.fromNumber(-e,r).neg():t.fromBits(e%kt|0,e/kt|0,r)},t.fromBigInt=function(e,r){return t.fromString(e.toString(),r)},t.fromString=function(e,r,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return t.ZERO;if("number"==typeof r?(n=r,r=!1):r=!!r,(n=n||10)<2||36<n)throw RangeError("radix");var i;if((i=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===i)return t.fromString(e.substring(1),r,n).neg();for(var o=t.fromNumber(Math.pow(n,8)),s=t.ZERO,a=0;a<e.length;a+=8){var c=Math.min(8,e.length-a),l=parseInt(e.substring(a,a+c),n);if(c<8){var u=t.fromNumber(Math.pow(n,c));s=s.mul(u).add(t.fromNumber(l))}else s=(s=s.mul(o)).add(t.fromNumber(l))}return s.unsigned=r,s},t.fromBytes=function(e,r,n){return n?t.fromBytesLE(e,r):t.fromBytesBE(e,r)},t.fromBytesLE=function(e,r){return new t(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,r)},t.fromBytesBE=function(e,r){return new t(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],r)},t.isLong=function(t){return mt(t)&&!0===t.__isLong__},t.fromValue=function(e,r){return"number"==typeof e?t.fromNumber(e,r):"string"==typeof e?t.fromString(e,r):t.fromBits(e.low,e.high,"boolean"==typeof r?r:e.unsigned)},t.prototype.add=function(e){t.isLong(e)||(e=t.fromValue(e));var r=this.high>>>16,n=65535&this.high,i=this.low>>>16,o=65535&this.low,s=e.high>>>16,a=65535&e.high,c=e.low>>>16,l=0,u=0,h=0,d=0;return h+=(d+=o+(65535&e.low))>>>16,d&=65535,u+=(h+=i+c)>>>16,h&=65535,l+=(u+=n+a)>>>16,u&=65535,l+=r+s,l&=65535,t.fromBits(h<<16|d,l<<16|u,this.unsigned)},t.prototype.and=function(e){return t.isLong(e)||(e=t.fromValue(e)),t.fromBits(this.low&e.low,this.high&e.high,this.unsigned)},t.prototype.compare=function(e){if(t.isLong(e)||(e=t.fromValue(e)),this.eq(e))return 0;var r=this.isNegative(),n=e.isNegative();return r&&!n?-1:!r&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},t.prototype.comp=function(t){return this.compare(t)},t.prototype.divide=function(e){if(t.isLong(e)||(e=t.fromValue(e)),e.isZero())throw Error("division by zero");if(Ct){if(!this.unsigned&&-2147483648===this.high&&-1===e.low&&-1===e.high)return this;var r=(this.unsigned?Ct.div_u:Ct.div_s)(this.low,this.high,e.low,e.high);return t.fromBits(r,Ct.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?t.UZERO:t.ZERO;var n,i,o;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return t.UZERO;if(e.gt(this.shru(1)))return t.UONE;o=t.UZERO}else{if(this.eq(t.MIN_VALUE))return e.eq(t.ONE)||e.eq(t.NEG_ONE)?t.MIN_VALUE:e.eq(t.MIN_VALUE)?t.ONE:(n=this.shr(1).div(e).shl(1)).eq(t.ZERO)?e.isNegative()?t.ONE:t.NEG_ONE:(i=this.sub(e.mul(n)),o=n.add(i.div(e)));if(e.eq(t.MIN_VALUE))return this.unsigned?t.UZERO:t.ZERO;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();o=t.ZERO}for(i=this;i.gte(e);){n=Math.max(1,Math.floor(i.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(n)/Math.LN2),a=s<=48?1:Math.pow(2,s-48),c=t.fromNumber(n),l=c.mul(e);l.isNegative()||l.gt(i);)n-=a,l=(c=t.fromNumber(n,this.unsigned)).mul(e);c.isZero()&&(c=t.ONE),o=o.add(c),i=i.sub(l)}return o},t.prototype.div=function(t){return this.divide(t)},t.prototype.equals=function(e){return t.isLong(e)||(e=t.fromValue(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},t.prototype.eq=function(t){return this.equals(t)},t.prototype.getHighBits=function(){return this.high},t.prototype.getHighBitsUnsigned=function(){return this.high>>>0},t.prototype.getLowBits=function(){return this.low},t.prototype.getLowBitsUnsigned=function(){return this.low>>>0},t.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.eq(t.MIN_VALUE)?64:this.neg().getNumBitsAbs();var e,r=0!==this.high?this.high:this.low;for(e=31;e>0&&!(r&1<<e);e--);return 0!==this.high?e+33:e+1},t.prototype.greaterThan=function(t){return this.comp(t)>0},t.prototype.gt=function(t){return this.greaterThan(t)},t.prototype.greaterThanOrEqual=function(t){return this.comp(t)>=0},t.prototype.gte=function(t){return this.greaterThanOrEqual(t)},t.prototype.ge=function(t){return this.greaterThanOrEqual(t)},t.prototype.isEven=function(){return!(1&this.low)},t.prototype.isNegative=function(){return!this.unsigned&&this.high<0},t.prototype.isOdd=function(){return!(1&~this.low)},t.prototype.isPositive=function(){return this.unsigned||this.high>=0},t.prototype.isZero=function(){return 0===this.high&&0===this.low},t.prototype.lessThan=function(t){return this.comp(t)<0},t.prototype.lt=function(t){return this.lessThan(t)},t.prototype.lessThanOrEqual=function(t){return this.comp(t)<=0},t.prototype.lte=function(t){return this.lessThanOrEqual(t)},t.prototype.modulo=function(e){if(t.isLong(e)||(e=t.fromValue(e)),Ct){var r=(this.unsigned?Ct.rem_u:Ct.rem_s)(this.low,this.high,e.low,e.high);return t.fromBits(r,Ct.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))},t.prototype.mod=function(t){return this.modulo(t)},t.prototype.rem=function(t){return this.modulo(t)},t.prototype.multiply=function(e){if(this.isZero())return t.ZERO;if(t.isLong(e)||(e=t.fromValue(e)),Ct){var r=Ct.mul(this.low,this.high,e.low,e.high);return t.fromBits(r,Ct.get_high(),this.unsigned)}if(e.isZero())return t.ZERO;if(this.eq(t.MIN_VALUE))return e.isOdd()?t.MIN_VALUE:t.ZERO;if(e.eq(t.MIN_VALUE))return this.isOdd()?t.MIN_VALUE:t.ZERO;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(t.TWO_PWR_24)&&e.lt(t.TWO_PWR_24))return t.fromNumber(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,i=65535&this.high,o=this.low>>>16,s=65535&this.low,a=e.high>>>16,c=65535&e.high,l=e.low>>>16,u=65535&e.low,h=0,d=0,f=0,g=0;return f+=(g+=s*u)>>>16,g&=65535,d+=(f+=o*u)>>>16,f&=65535,d+=(f+=s*l)>>>16,f&=65535,h+=(d+=i*u)>>>16,d&=65535,h+=(d+=o*l)>>>16,d&=65535,h+=(d+=s*c)>>>16,d&=65535,h+=n*u+i*l+o*c+s*a,h&=65535,t.fromBits(f<<16|g,h<<16|d,this.unsigned)},t.prototype.mul=function(t){return this.multiply(t)},t.prototype.negate=function(){return!this.unsigned&&this.eq(t.MIN_VALUE)?t.MIN_VALUE:this.not().add(t.ONE)},t.prototype.neg=function(){return this.negate()},t.prototype.not=function(){return t.fromBits(~this.low,~this.high,this.unsigned)},t.prototype.notEquals=function(t){return!this.equals(t)},t.prototype.neq=function(t){return this.notEquals(t)},t.prototype.ne=function(t){return this.notEquals(t)},t.prototype.or=function(e){return t.isLong(e)||(e=t.fromValue(e)),t.fromBits(this.low|e.low,this.high|e.high,this.unsigned)},t.prototype.shiftLeft=function(e){return t.isLong(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?t.fromBits(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):t.fromBits(0,this.low<<e-32,this.unsigned)},t.prototype.shl=function(t){return this.shiftLeft(t)},t.prototype.shiftRight=function(e){return t.isLong(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?t.fromBits(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):t.fromBits(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},t.prototype.shr=function(t){return this.shiftRight(t)},t.prototype.shiftRightUnsigned=function(e){if(t.isLong(e)&&(e=e.toInt()),0==(e&=63))return this;var r=this.high;if(e<32){var n=this.low;return t.fromBits(n>>>e|r<<32-e,r>>>e,this.unsigned)}return 32===e?t.fromBits(r,0,this.unsigned):t.fromBits(r>>>e-32,0,this.unsigned)},t.prototype.shr_u=function(t){return this.shiftRightUnsigned(t)},t.prototype.shru=function(t){return this.shiftRightUnsigned(t)},t.prototype.subtract=function(e){return t.isLong(e)||(e=t.fromValue(e)),this.add(e.neg())},t.prototype.sub=function(t){return this.subtract(t)},t.prototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},t.prototype.toNumber=function(){return this.unsigned?(this.high>>>0)*kt+(this.low>>>0):this.high*kt+(this.low>>>0)},t.prototype.toBigInt=function(){return BigInt(this.toString())},t.prototype.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},t.prototype.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},t.prototype.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},t.prototype.toSigned=function(){return this.unsigned?t.fromBits(this.low,this.high,!1):this},t.prototype.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(t.MIN_VALUE)){var r=t.fromNumber(e),n=this.div(r),i=n.mul(r).sub(this);return n.toString(e)+i.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var o=t.fromNumber(Math.pow(e,6),this.unsigned),s=this,a="";;){var c=s.div(o),l=(s.sub(c.mul(o)).toInt()>>>0).toString(e);if((s=c).isZero())return l+a;for(;l.length<6;)l="0"+l;a=""+l+a}},t.prototype.toUnsigned=function(){return this.unsigned?this:t.fromBits(this.low,this.high,!0)},t.prototype.xor=function(e){return t.isLong(e)||(e=t.fromValue(e)),t.fromBits(this.low^e.low,this.high^e.high,this.unsigned)},t.prototype.eqz=function(){return this.isZero()},t.prototype.le=function(t){return this.lessThanOrEqual(t)},t.prototype.toExtendedJSON=function(t){return t&&t.relaxed?this.toNumber():{$numberLong:this.toString()}},t.fromExtendedJSON=function(e,r){var n=t.fromString(e.$numberLong);return r&&r.relaxed?n.toNumber():n},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return'new Long("'.concat(this.toString(),'"').concat(this.unsigned?", true":"",")")},t.TWO_PWR_24=t.fromInt(16777216),t.MAX_UNSIGNED_VALUE=t.fromBits(-1,-1,!0),t.ZERO=t.fromInt(0),t.UZERO=t.fromInt(0,!0),t.ONE=t.fromInt(1),t.UONE=t.fromInt(1,!0),t.NEG_ONE=t.fromInt(-1),t.MAX_VALUE=t.fromBits(-1,2147483647,!1),t.MIN_VALUE=t.fromBits(0,-2147483648,!1),t}();Object.defineProperty(Rt.prototype,"__isLong__",{value:!0}),Object.defineProperty(Rt.prototype,"_bsontype",{value:"Long"});var Bt=/^(\+|-)?(\d+|(\d*\.\d*))?(E|e)?([-+])?(\d+)?$/,Gt=/^(\+|-)?(Infinity|inf)$/i,Ut=/^(\+|-)?NaN$/i,Mt=6111,jt=-6176,Ft=[124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),$t=[248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),Ht=[120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),Wt=/^([-+])?(\d+)?$/;function Vt(t){return!isNaN(parseInt(t,10))}function qt(t){var e=Rt.fromNumber(1e9),r=Rt.fromNumber(0);if(!(t.parts[0]||t.parts[1]||t.parts[2]||t.parts[3]))return{quotient:t,rem:r};for(var n=0;n<=3;n++)r=(r=r.shiftLeft(32)).add(new Rt(t.parts[n],0)),t.parts[n]=r.div(e).low,r=r.modulo(e);return{quotient:t,rem:r}}function zt(t,e){throw new ut('"'.concat(t,'" is not a valid Decimal128 string - ').concat(e))}var Kt=function(){function t(e){if(!(this instanceof t))return new t(e);if("string"==typeof e)this.bytes=t.fromString(e).bytes;else{if(!pt(e))throw new ut("Decimal128 must take a Buffer or string");if(16!==e.byteLength)throw new ut("Decimal128 must take a Buffer of 16 bytes");this.bytes=e}}return t.fromString=function(e){var r,n=!1,i=!1,o=!1,s=0,a=0,c=0,l=0,u=0,h=[0],d=0,f=0,g=0,p=0,m=0,y=0,b=new Rt(0,0),T=new Rt(0,0),v=0;if(e.length>=7e3)throw new ut(e+" not a valid Decimal128 string");var _=e.match(Bt),A=e.match(Gt),w=e.match(Ut);if(!_&&!A&&!w||0===e.length)throw new ut(e+" not a valid Decimal128 string");if(_){var E=_[2],S=_[4],I=_[5],N=_[6];S&&void 0===N&&zt(e,"missing exponent power"),S&&void 0===E&&zt(e,"missing exponent base"),void 0===S&&(I||N)&&zt(e,"missing e before exponent")}if(("+"===e[v]||"-"===e[v])&&(n="-"===e[v++]),!Vt(e[v])&&"."!==e[v]){if("i"===e[v]||"I"===e[v])return new t(st.from(n?$t:Ht));if("N"===e[v])return new t(st.from(Ft))}for(;Vt(e[v])||"."===e[v];)"."!==e[v]?(d<34&&("0"!==e[v]||o)&&(o||(u=a),o=!0,h[f++]=parseInt(e[v],10),d+=1),o&&(c+=1),i&&(l+=1),a+=1,v+=1):(i&&zt(e,"contains multiple periods"),i=!0,v+=1);if(i&&!a)throw new ut(e+" not a valid Decimal128 string");if("e"===e[v]||"E"===e[v]){var O=e.substr(++v).match(Wt);if(!O||!O[2])return new t(st.from(Ft));m=parseInt(O[0],10),v+=O[0].length}if(e[v])return new t(st.from(Ft));if(g=0,d){if(p=d-1,1!==(s=c))for(;0===h[u+s-1];)s-=1}else g=0,p=0,h[0]=0,c=1,d=1,s=0;for(m<=l&&l-m>16384?m=jt:m-=l;m>Mt;){if((p+=1)-g>34){if(h.join("").match(/^0+$/)){m=Mt;break}zt(e,"overflow")}m-=1}for(;m<jt||d<c;){if(0===p&&s<d){m=jt,s=0;break}if(d<c?c-=1:p-=1,m<Mt)m+=1;else{if(h.join("").match(/^0+$/)){m=Mt;break}zt(e,"overflow")}}if(p-g+1<s){var C=a;i&&(u+=1,C+=1),n&&(u+=1,C+=1);var k=parseInt(e[u+p+1],10),L=0;if(k>=5&&(L=1,5===k))for(L=h[p]%2==1?1:0,y=u+p+2;y<C;y++)if(parseInt(e[y],10)){L=1;break}if(L)for(var D=p;D>=0;D--)if(++h[D]>9&&(h[D]=0,0===D)){if(!(m<Mt))return new t(st.from(n?$t:Ht));m+=1,h[D]=1}}if(b=Rt.fromNumber(0),T=Rt.fromNumber(0),0===s)b=Rt.fromNumber(0),T=Rt.fromNumber(0);else if(p-g<17)for(D=g,T=Rt.fromNumber(h[D++]),b=new Rt(0,0);D<=p;D++)T=(T=T.multiply(Rt.fromNumber(10))).add(Rt.fromNumber(h[D]));else{for(D=g,b=Rt.fromNumber(h[D++]);D<=p-17;D++)b=(b=b.multiply(Rt.fromNumber(10))).add(Rt.fromNumber(h[D]));for(T=Rt.fromNumber(h[D++]);D<=p;D++)T=(T=T.multiply(Rt.fromNumber(10))).add(Rt.fromNumber(h[D]))}var x=function(t,e){if(!t&&!e)return{high:Rt.fromNumber(0),low:Rt.fromNumber(0)};var r=t.shiftRightUnsigned(32),n=new Rt(t.getLowBits(),0),i=e.shiftRightUnsigned(32),o=new Rt(e.getLowBits(),0),s=r.multiply(i),a=r.multiply(o),c=n.multiply(i),l=n.multiply(o);return s=s.add(a.shiftRightUnsigned(32)),a=new Rt(a.getLowBits(),0).add(c).add(l.shiftRightUnsigned(32)),{high:s=s.add(a.shiftRightUnsigned(32)),low:l=a.shiftLeft(32).add(new Rt(l.getLowBits(),0))}}(b,Rt.fromString("100000000000000000"));x.low=x.low.add(T),function(t,e){var r=t.high>>>0,n=e.high>>>0;return r<n||r===n&&t.low>>>0<e.low>>>0}(x.low,T)&&(x.high=x.high.add(Rt.fromNumber(1))),r=m+6176;var P={low:Rt.fromNumber(0),high:Rt.fromNumber(0)};x.high.shiftRightUnsigned(49).and(Rt.fromNumber(1)).equals(Rt.fromNumber(1))?(P.high=P.high.or(Rt.fromNumber(3).shiftLeft(61)),P.high=P.high.or(Rt.fromNumber(r).and(Rt.fromNumber(16383).shiftLeft(47))),P.high=P.high.or(x.high.and(Rt.fromNumber(0x7fffffffffff)))):(P.high=P.high.or(Rt.fromNumber(16383&r).shiftLeft(49)),P.high=P.high.or(x.high.and(Rt.fromNumber(562949953421311)))),P.low=x.low,n&&(P.high=P.high.or(Rt.fromString("9223372036854775808")));var R=st.alloc(16);return v=0,R[v++]=255&P.low.low,R[v++]=P.low.low>>8&255,R[v++]=P.low.low>>16&255,R[v++]=P.low.low>>24&255,R[v++]=255&P.low.high,R[v++]=P.low.high>>8&255,R[v++]=P.low.high>>16&255,R[v++]=P.low.high>>24&255,R[v++]=255&P.high.low,R[v++]=P.high.low>>8&255,R[v++]=P.high.low>>16&255,R[v++]=P.high.low>>24&255,R[v++]=255&P.high.high,R[v++]=P.high.high>>8&255,R[v++]=P.high.high>>16&255,R[v++]=P.high.high>>24&255,new t(R)},t.prototype.toString=function(){for(var t,e=0,r=new Array(36),n=0;n<r.length;n++)r[n]=0;var i,o,s,a=0,c=!1,l={parts:[0,0,0,0]},u=[];a=0;var h=this.bytes,d=h[a++]|h[a++]<<8|h[a++]<<16|h[a++]<<24,f=h[a++]|h[a++]<<8|h[a++]<<16|h[a++]<<24,g=h[a++]|h[a++]<<8|h[a++]<<16|h[a++]<<24,p=h[a++]|h[a++]<<8|h[a++]<<16|h[a++]<<24;a=0,(new Rt(d,f),new Rt(g,p)).lessThan(Rt.ZERO)&&u.push("-");var m=p>>26&31;if(m>>3==3){if(30===m)return u.join("")+"Infinity";if(31===m)return"NaN";t=p>>15&16383,i=8+(p>>14&1)}else i=p>>14&7,t=p>>17&16383;var y=t-6176;if(l.parts[0]=(16383&p)+((15&i)<<14),l.parts[1]=g,l.parts[2]=f,l.parts[3]=d,0===l.parts[0]&&0===l.parts[1]&&0===l.parts[2]&&0===l.parts[3])c=!0;else for(s=3;s>=0;s--){var b=0,T=qt(l);if(l=T.quotient,b=T.rem.low)for(o=8;o>=0;o--)r[9*s+o]=b%10,b=Math.floor(b/10)}if(c)e=1,r[a]=0;else for(e=36;!r[a];)e-=1,a+=1;var v=e-1+y;if(v>=34||v<=-7||y>0){if(e>34)return u.push("".concat(0)),y>0?u.push("E+".concat(y)):y<0&&u.push("E".concat(y)),u.join("");for(u.push("".concat(r[a++])),(e-=1)&&u.push("."),n=0;n<e;n++)u.push("".concat(r[a++]));u.push("E"),v>0?u.push("+".concat(v)):u.push("".concat(v))}else if(y>=0)for(n=0;n<e;n++)u.push("".concat(r[a++]));else{var _=e+y;if(_>0)for(n=0;n<_;n++)u.push("".concat(r[a++]));else u.push("0");for(u.push(".");_++<0;)u.push("0");for(n=0;n<e-Math.max(_-1,0);n++)u.push("".concat(r[a++]))}return u.join("")},t.prototype.toJSON=function(){return{$numberDecimal:this.toString()}},t.prototype.toExtendedJSON=function(){return{$numberDecimal:this.toString()}},t.fromExtendedJSON=function(e){return t.fromString(e.$numberDecimal)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return'new Decimal128("'.concat(this.toString(),'")')},t}();Object.defineProperty(Kt.prototype,"_bsontype",{value:"Decimal128"});var Yt=function(){function t(e){if(!(this instanceof t))return new t(e);e instanceof Number&&(e=e.valueOf()),this.value=+e}return t.prototype.valueOf=function(){return this.value},t.prototype.toJSON=function(){return this.value},t.prototype.toString=function(t){return this.value.toString(t)},t.prototype.toExtendedJSON=function(t){return t&&(t.legacy||t.relaxed&&isFinite(this.value))?this.value:Object.is(Math.sign(this.value),-0)?{$numberDouble:"-".concat(this.value.toFixed(1))}:{$numberDouble:Number.isInteger(this.value)?this.value.toFixed(1):this.value.toString()}},t.fromExtendedJSON=function(e,r){var n=parseFloat(e.$numberDouble);return r&&r.relaxed?n:new t(n)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){var t=this.toExtendedJSON();return"new Double(".concat(t.$numberDouble,")")},t}();Object.defineProperty(Yt.prototype,"_bsontype",{value:"Double"});var Jt=function(){function t(e){if(!(this instanceof t))return new t(e);e instanceof Number&&(e=e.valueOf()),this.value=0|+e}return t.prototype.valueOf=function(){return this.value},t.prototype.toString=function(t){return this.value.toString(t)},t.prototype.toJSON=function(){return this.value},t.prototype.toExtendedJSON=function(t){return t&&(t.relaxed||t.legacy)?this.value:{$numberInt:this.value.toString()}},t.fromExtendedJSON=function(e,r){return r&&r.relaxed?parseInt(e.$numberInt,10):new t(e.$numberInt)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return"new Int32(".concat(this.valueOf(),")")},t}();Object.defineProperty(Jt.prototype,"_bsontype",{value:"Int32"});var Xt=function(){function t(){if(!(this instanceof t))return new t}return t.prototype.toExtendedJSON=function(){return{$maxKey:1}},t.fromExtendedJSON=function(){return new t},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return"new MaxKey()"},t}();Object.defineProperty(Xt.prototype,"_bsontype",{value:"MaxKey"});var Zt=function(){function t(){if(!(this instanceof t))return new t}return t.prototype.toExtendedJSON=function(){return{$minKey:1}},t.fromExtendedJSON=function(){return new t},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return"new MinKey()"},t}();Object.defineProperty(Zt.prototype,"_bsontype",{value:"MinKey"});var Qt=new RegExp("^[0-9a-fA-F]{24}$"),te=null,ee=Symbol("id"),re=function(){function t(e){if(!(this instanceof t))return new t(e);var r;if("object"==typeof e&&e&&"id"in e){if("string"!=typeof e.id&&!ArrayBuffer.isView(e.id))throw new ut("Argument passed in must have an id that is of type string or Buffer");r="toHexString"in e&&"function"==typeof e.toHexString?st.from(e.toHexString(),"hex"):e.id}else r=e;if(null==r||"number"==typeof r)this[ee]=t.generate("number"==typeof r?r:void 0);else if(ArrayBuffer.isView(r)&&12===r.byteLength)this[ee]=r instanceof st?r:bt(r);else{if("string"!=typeof r)throw new ut("Argument passed in does not match the accepted types");if(12===r.length){var n=st.from(r);if(12!==n.byteLength)throw new ut("Argument passed in must be a string of 12 bytes");this[ee]=n}else{if(24!==r.length||!Qt.test(r))throw new ut("Argument passed in must be a string of 12 bytes or a string of 24 hex characters or an integer");this[ee]=st.from(r,"hex")}}t.cacheHexString&&(this.__id=this.id.toString("hex"))}return Object.defineProperty(t.prototype,"id",{get:function(){return this[ee]},set:function(e){this[ee]=e,t.cacheHexString&&(this.__id=e.toString("hex"))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"generationTime",{get:function(){return this.id.readInt32BE(0)},set:function(t){this.id.writeUInt32BE(t,0)},enumerable:!1,configurable:!0}),t.prototype.toHexString=function(){if(t.cacheHexString&&this.__id)return this.__id;var e=this.id.toString("hex");return t.cacheHexString&&!this.__id&&(this.__id=e),e},t.getInc=function(){return t.index=(t.index+1)%16777215},t.generate=function(e){"number"!=typeof e&&(e=Math.floor(Date.now()/1e3));var r=t.getInc(),n=st.alloc(12);return n.writeUInt32BE(e,0),null===te&&(te=gt(5)),n[4]=te[0],n[5]=te[1],n[6]=te[2],n[7]=te[3],n[8]=te[4],n[11]=255&r,n[10]=r>>8&255,n[9]=r>>16&255,n},t.prototype.toString=function(t){return t?this.id.toString(t):this.toHexString()},t.prototype.toJSON=function(){return this.toHexString()},t.prototype.equals=function(e){if(null==e)return!1;if(e instanceof t)return this[ee][11]===e[ee][11]&&this[ee].equals(e[ee]);if("string"==typeof e&&t.isValid(e)&&12===e.length&&pt(this.id))return e===st.prototype.toString.call(this.id,"latin1");if("string"==typeof e&&t.isValid(e)&&24===e.length)return e.toLowerCase()===this.toHexString();if("string"==typeof e&&t.isValid(e)&&12===e.length)return st.from(e).equals(this.id);if("object"==typeof e&&"toHexString"in e&&"function"==typeof e.toHexString){var r=e.toHexString(),n=this.toHexString().toLowerCase();return"string"==typeof r&&r.toLowerCase()===n}return!1},t.prototype.getTimestamp=function(){var t=new Date,e=this.id.readUInt32BE(0);return t.setTime(1e3*Math.floor(e)),t},t.createPk=function(){return new t},t.createFromTime=function(e){var r=st.from([0,0,0,0,0,0,0,0,0,0,0,0]);return r.writeUInt32BE(e,0),new t(r)},t.createFromHexString=function(e){if(typeof e>"u"||null!=e&&24!==e.length)throw new ut("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");return new t(st.from(e,"hex"))},t.isValid=function(e){if(null==e)return!1;try{return new t(e),!0}catch{return!1}},t.prototype.toExtendedJSON=function(){return this.toHexString?{$oid:this.toHexString()}:{$oid:this.toString("hex")}},t.fromExtendedJSON=function(e){return new t(e.$oid)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return'new ObjectId("'.concat(this.toHexString(),'")')},t.index=Math.floor(16777215*Math.random()),t}();Object.defineProperty(re.prototype,"generate",{value:yt(function(t){return re.generate(t)},"Please use the static `ObjectId.generate(time)` instead")}),Object.defineProperty(re.prototype,"getInc",{value:yt(function(){return re.getInc()},"Please use the static `ObjectId.getInc()` instead")}),Object.defineProperty(re.prototype,"get_inc",{value:yt(function(){return re.getInc()},"Please use the static `ObjectId.getInc()` instead")}),Object.defineProperty(re,"get_inc",{value:yt(function(){return re.getInc()},"Please use the static `ObjectId.getInc()` instead")}),Object.defineProperty(re.prototype,"_bsontype",{value:"ObjectID"});var ne=function(){function t(e,r){if(!(this instanceof t))return new t(e,r);if(this.pattern=e,this.options=function(t){return t.split("").sort().join("")}(r??""),-1!==this.pattern.indexOf("\0"))throw new lt("BSON Regex patterns cannot contain null bytes, found: ".concat(JSON.stringify(this.pattern)));if(-1!==this.options.indexOf("\0"))throw new lt("BSON Regex options cannot contain null bytes, found: ".concat(JSON.stringify(this.options)));for(var n=0;n<this.options.length;n++)if("i"!==this.options[n]&&"m"!==this.options[n]&&"x"!==this.options[n]&&"l"!==this.options[n]&&"s"!==this.options[n]&&"u"!==this.options[n])throw new lt("The regular expression option [".concat(this.options[n],"] is not supported"))}return t.parseOptions=function(t){return t?t.split("").sort().join(""):""},t.prototype.toExtendedJSON=function(t){return(t=t||{}).legacy?{$regex:this.pattern,$options:this.options}:{$regularExpression:{pattern:this.pattern,options:this.options}}},t.fromExtendedJSON=function(e){if("$regex"in e){if("string"==typeof e.$regex)return new t(e.$regex,t.parseOptions(e.$options));if("BSONRegExp"===e.$regex._bsontype)return e}if("$regularExpression"in e)return new t(e.$regularExpression.pattern,t.parseOptions(e.$regularExpression.options));throw new ut("Unexpected BSONRegExp EJSON object form: ".concat(JSON.stringify(e)))},t}();Object.defineProperty(ne.prototype,"_bsontype",{value:"BSONRegExp"});var ie=function(){function t(e){if(!(this instanceof t))return new t(e);this.value=e}return t.prototype.valueOf=function(){return this.value},t.prototype.toString=function(){return this.value},t.prototype.inspect=function(){return'new BSONSymbol("'.concat(this.value,'")')},t.prototype.toJSON=function(){return this.value},t.prototype.toExtendedJSON=function(){return{$symbol:this.value}},t.fromExtendedJSON=function(e){return new t(e.$symbol)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t}();Object.defineProperty(ie.prototype,"_bsontype",{value:"Symbol"});var oe=function(t){function e(r,n){var i=this;return i instanceof e?(i=Rt.isLong(r)?t.call(this,r.low,r.high,!0)||this:mt(r)&&typeof r.t<"u"&&typeof r.i<"u"?t.call(this,r.i,r.t,!0)||this:t.call(this,r,n,!0)||this,Object.defineProperty(i,"_bsontype",{value:"Timestamp",writable:!1,configurable:!1,enumerable:!1}),i):new e(r,n)}return ct(e,t),e.prototype.toJSON=function(){return{$timestamp:this.toString()}},e.fromInt=function(t){return new e(Rt.fromInt(t,!0))},e.fromNumber=function(t){return new e(Rt.fromNumber(t,!0))},e.fromBits=function(t,r){return new e(t,r)},e.fromString=function(t,r){return new e(Rt.fromString(t,!0,r))},e.prototype.toExtendedJSON=function(){return{$timestamp:{t:this.high>>>0,i:this.low>>>0}}},e.fromExtendedJSON=function(t){return new e(t.$timestamp)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return"new Timestamp({ t: ".concat(this.getHighBits(),", i: ").concat(this.getLowBits()," })")},e.MAX_VALUE=Rt.MAX_UNSIGNED_VALUE,e}(Rt),se=2147483647,ae=-2147483648,ce=0x8000000000000000,le=-0x8000000000000000,ue={$oid:re,$binary:St,$uuid:St,$symbol:ie,$numberInt:Jt,$numberDecimal:Kt,$numberDouble:Yt,$numberLong:Rt,$minKey:Zt,$maxKey:Xt,$regex:ne,$regularExpression:ne,$timestamp:oe};function he(t,e){if(void 0===e&&(e={}),"number"==typeof t){if(e.relaxed||e.legacy)return t;if(Math.floor(t)===t){if(t>=ae&&t<=se)return new Jt(t);if(t>=le&&t<=ce)return Rt.fromNumber(t)}return new Yt(t)}if(null==t||"object"!=typeof t)return t;if(t.$undefined)return null;for(var r=Object.keys(t).filter(function(e){return e.startsWith("$")&&null!=t[e]}),n=0;n<r.length;n++){var i=ue[r[n]];if(i)return i.fromExtendedJSON(t,e)}if(null!=t.$date){var o=t.$date,s=new Date;return e.legacy?"number"==typeof o?s.setTime(o):"string"==typeof o&&s.setTime(Date.parse(o)):"string"==typeof o?s.setTime(Date.parse(o)):Rt.isLong(o)?s.setTime(o.toNumber()):"number"==typeof o&&e.relaxed&&s.setTime(o),s}if(null!=t.$code){var a=Object.assign({},t);return t.$scope&&(a.$scope=he(t.$scope)),Nt.fromExtendedJSON(t)}if(function(t){return mt(t)&&null!=t.$id&&"string"==typeof t.$ref&&(null==t.$db||"string"==typeof t.$db)}(t)||t.$dbPointer){var c=t.$ref?t:t.$dbPointer;if(c instanceof Ot)return c;var l=Object.keys(c).filter(function(t){return t.startsWith("$")}),u=!0;if(l.forEach(function(t){-1===["$ref","$id","$db"].indexOf(t)&&(u=!1)}),u)return Ot.fromExtendedJSON(c)}return t}function de(t){var e=t.toISOString();return 0!==t.getUTCMilliseconds()?e:e.slice(0,-5)+"Z"}function fe(t,e){if(("object"==typeof t||"function"==typeof t)&&null!==t){var r=e.seenObjects.findIndex(function(e){return e.obj===t});if(-1!==r){var n=e.seenObjects.map(function(t){return t.propertyName}),i=n.slice(0,r).map(function(t){return"".concat(t," -> ")}).join(""),o=n[r],s=" -> "+n.slice(r+1,n.length-1).map(function(t){return"".concat(t," -> ")}).join(""),a=n[n.length-1],c=" ".repeat(i.length+o.length/2),l="-".repeat(s.length+(o.length+a.length)/2-1);throw new ut("Converting circular structure to EJSON:\n"+"    ".concat(i).concat(o).concat(s).concat(a,"\n")+"    ".concat(c,"\\").concat(l,"/"))}e.seenObjects[e.seenObjects.length-1].obj=t}if(Array.isArray(t))return function(t,e){return t.map(function(t,r){e.seenObjects.push({propertyName:"index ".concat(r),obj:null});try{return fe(t,e)}finally{e.seenObjects.pop()}})}(t,e);if(void 0===t)return null;if(t instanceof Date||function(t){return mt(t)&&"[object Date]"===Object.prototype.toString.call(t)}(t)){var u=t.getTime(),h=u>-1&&u<2534023188e5;return e.legacy?e.relaxed&&h?{$date:t.getTime()}:{$date:de(t)}:e.relaxed&&h?{$date:de(t)}:{$date:{$numberLong:t.getTime().toString()}}}if(!("number"!=typeof t||e.relaxed&&isFinite(t))){if(Math.floor(t)===t){var d=t>=le&&t<=ce;if(t>=ae&&t<=se)return{$numberInt:t.toString()};if(d)return{$numberLong:t.toString()}}return{$numberDouble:t.toString()}}if(t instanceof RegExp||function(t){return"[object RegExp]"===Object.prototype.toString.call(t)}(t)){var f=t.flags;if(void 0===f){var g=t.toString().match(/[gimuy]*$/);g&&(f=g[0])}return new ne(t.source,f).toExtendedJSON(e)}return null!=t&&"object"==typeof t?function(t,e){if(null==t||"object"!=typeof t)throw new lt("not an object instance");var r=t._bsontype;if(typeof r>"u"){var n={};for(var i in t){e.seenObjects.push({propertyName:i,obj:null});try{var o=fe(t[i],e);"__proto__"===i?Object.defineProperty(n,i,{value:o,writable:!0,enumerable:!0,configurable:!0}):n[i]=o}finally{e.seenObjects.pop()}}return n}if(function(t){return mt(t)&&Reflect.has(t,"_bsontype")&&"string"==typeof t._bsontype}(t)){var s=t;if("function"!=typeof s.toExtendedJSON){var a=pe[t._bsontype];if(!a)throw new ut("Unrecognized or invalid _bsontype: "+t._bsontype);s=a(s)}return"Code"===r&&s.scope?s=new Nt(s.code,fe(s.scope,e)):"DBRef"===r&&s.oid&&(s=new Ot(fe(s.collection,e),fe(s.oid,e),fe(s.db,e),fe(s.fields,e))),s.toExtendedJSON(e)}throw new lt("_bsontype must be a string, but was: "+typeof r)}(t,e):t}var ge,pe={Binary:function(t){return new St(t.value(),t.sub_type)},Code:function(t){return new Nt(t.code,t.scope)},DBRef:function(t){return new Ot(t.collection||t.namespace,t.oid,t.db,t.fields)},Decimal128:function(t){return new Kt(t.bytes)},Double:function(t){return new Yt(t.value)},Int32:function(t){return new Jt(t.value)},Long:function(t){return Rt.fromBits(null!=t.low?t.low:t.low_,null!=t.low?t.high:t.high_,null!=t.low?t.unsigned:t.unsigned_)},MaxKey:function(){return new Xt},MinKey:function(){return new Zt},ObjectID:function(t){return new re(t)},ObjectId:function(t){return new re(t)},BSONRegExp:function(t){return new ne(t.pattern,t.options)},Symbol:function(t){return new ie(t.value)},Timestamp:function(t){return oe.fromBits(t.low,t.high)}};!function(t){function e(t,e){var r=Object.assign({},{relaxed:!0,legacy:!1},e);return"boolean"==typeof r.relaxed&&(r.strict=!r.relaxed),"boolean"==typeof r.strict&&(r.relaxed=!r.strict),JSON.parse(t,function(t,e){if(-1!==t.indexOf("\0"))throw new lt("BSON Document field names cannot contain null bytes, found: ".concat(JSON.stringify(t)));return he(e,r)})}function r(t,e,r,n){null!=r&&"object"==typeof r&&(n=r,r=0),null!=e&&"object"==typeof e&&!Array.isArray(e)&&(n=e,e=void 0,r=0);var i=fe(t,Object.assign({relaxed:!0,legacy:!1},n,{seenObjects:[{propertyName:"(root)",obj:null}]}));return JSON.stringify(i,e,r)}t.parse=e,t.stringify=r,t.serialize=function(t,e){return e=e||{},JSON.parse(r(t,e))},t.deserialize=function(t,r){return r=r||{},e(JSON.stringify(t),r)}}(ge||(ge={}));var me=dt();me.Map?me.Map:function(){function t(t){void 0===t&&(t=[]),this._keys=[],this._values={};for(var e=0;e<t.length;e++)if(null!=t[e]){var r=t[e],n=r[0],i=r[1];this._keys.push(n),this._values[n]={v:i,i:this._keys.length-1}}}t.prototype.clear=function(){this._keys=[],this._values={}},t.prototype.delete=function(t){var e=this._values[t];return null!=e&&(delete this._values[t],this._keys.splice(e.i,1),!0)},t.prototype.entries=function(){var t=this,e=0;return{next:function(){var r=t._keys[e++];return{value:void 0!==r?[r,t._values[r].v]:void 0,done:void 0===r}}}},t.prototype.forEach=function(t,e){e=e||this;for(var r=0;r<this._keys.length;r++){var n=this._keys[r];t.call(e,this._values[n].v,n,e)}},t.prototype.get=function(t){return this._values[t]?this._values[t].v:void 0},t.prototype.has=function(t){return null!=this._values[t]},t.prototype.keys=function(){var t=this,e=0;return{next:function(){var r=t._keys[e++];return{value:void 0!==r?r:void 0,done:void 0===r}}}},t.prototype.set=function(t,e){return this._values[t]?(this._values[t].v=e,this):(this._keys.push(t),this._values[t]={v:e,i:this._keys.length-1},this)},t.prototype.values=function(){var t=this,e=0;return{next:function(){var r=t._keys[e++];return{value:void 0!==r?t._values[r].v:void 0,done:void 0===r}}}},Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!1,configurable:!0})}(),Rt.fromNumber(wt),Rt.fromNumber(Et);var ye=new Uint8Array(8);new DataView(ye.buffer,ye.byteOffset,ye.byteLength),st.alloc(17825792);const be={CONTEXT_MENU_SAVE_TEXT:"CONTEXT_MENU_SAVE_TEXT",CONTEXT_MENU_SAVE_BOOKMARK:"CONTEXT_MENU_SAVE_BOOKMARK",CONTEXT_MENU_SAVE_IMAGE:"CONTEXT_MENU_SAVE_IMAGE",CONTEXT_OPEN_IN_READER:"CONTEXT_OPEN_IN_READER"};function Te(t,e){return t.id===e}var ve=(t=>(t.marks="marks",t.bookmarks="bookmarks",t.chromesettings="chromesettings",t.pagecontents="pagecontents",t.aichats="aichats",t))(ve||{});function _e(t){return Object.values(ve).includes(t)&&"chromesettings"!==t}Object.values(ve);var Ae=(t=>(t.marks="marks",t.bookmarks="bookmarks",t.chromesettings="chromesettings",t.pagecontents="pagecontents",t.aichats="aichats",t))(Ae||{}),we=(t=>(t.actions="actions",t.contents="contents",t))(we||{});function Ee(t){return{_id:(new re).toString(),createdAt:Date.now(),updatedAt:0,_objectStore:t}}const Se={...Ee(ve.chromesettings),showMarkerPopup:!0,showLeftSidebarWidget:!1,showToolboxAutomatically:!1,defaultHighlightColor:q[0]||"#fdffb4",recentColors:[q[0]||"#fdffb4"],blacklistedUrls:[],showLearningTeaser:!1,chromeRatingPromptDismissed:!1,sidebarOptions:{sidebarWidth:400,sidebarAlignment:"left",sidebarBehavior:"push"},preferredColorMode:"dark",showBackupDialogPrompt:!0,backupDialogPromptInterval:100,autoDownloadPageContent:!0,youtubeOptions:{enableAutoscrolling:!0,enableStickyPlayer:!1}},Ie={jwt_webmarker:"",lastSyncDateInMillis:0,lastServerFetchInMillis:0,notionOAuthToken:null,capacitiesToken:null,signUpPromptDismissed:!1,chromeRatingPromptDismissed:!1,upgradeDealPromptDismissed:!1,lastUserPromptShownAtInMillis:0,lastUpdatedKey:null,isEmailActivated:!1,readerFontSize:20,readerColorMode:"auto",readerLayoutWidth:700,readerLineHeight:1.6,spreadTheWordPromptDismissed:!1,serverConfigJsonString:null,clientId:"",chromeSettingsJsonString:JSON.stringify(Se)};function Ne(){var t;return typeof chrome<"u"&&!(null==(t=null==chrome?void 0:chrome.storage)||!t.sync)}const Oe=new class{async getStorage(){return new Promise(t=>{try{chrome.storage.sync.get(e=>{const r={...Ie,...e};t(r)})}catch{t(Ie)}})}async getValue(t){const e=Ie[t];return new Promise(r=>{try{chrome.storage.sync.get(n=>{r(n[t]??e)})}catch{r(e)}})}setValue(t,e){try{const r={[t]:e};chrome.storage.sync.set(r);const n={lastUpdatedKey:t};chrome.storage.sync.set(n),this.getStorage().then(r=>{eo.dispatch("chromeStorageChanged",{detail:{...r,[t]:e}})})}catch{}return Ne()}clear(){var t,e;try{if(typeof chrome>"u")return;null==(e=null==(t=null==chrome?void 0:chrome.storage)?void 0:t.sync)||e.clear()}catch{}}parseToJsonObject(t){if("object"==typeof t)return t;try{return JSON.parse(t)}catch{return null}}async getChromeSettings(){try{const t=await this.getValue("chromeSettingsJsonString");if(!t)return Se;const e=this.parseToJsonObject(t);if("object"!=typeof e||!e)return Se;const r=await bn.getJwtPayload();return(null==r?void 0:r._id)&&(null==e?void 0:e._user)&&e._user!==(null==r?void 0:r._id)?Se:e}catch(t){return console.error("Error getting chrome settings",t),Se}}async updateChromeSettings(t,{skipSync:e}={}){const[r,n]=await Promise.all([bn.getJwtPayload(),this.getChromeSettings()]);let i;return i=(null==r?void 0:r._id)&&(null==t?void 0:t._user)&&t._user!==(null==r?void 0:r._id)?{...Se,...t,...Ee(ve.chromesettings),_user:null==r?void 0:r._id}:{...n,...t,_user:(null==r?void 0:r._id)||(null==n?void 0:n._user)},i.sidebarOptions.sidebarWidth||(i.sidebarOptions.sidebarWidth=Se.sidebarOptions.sidebarWidth),i.sidebarOptions.sidebarAlignment||(i.sidebarOptions.sidebarAlignment=Se.sidebarOptions.sidebarAlignment),i.sidebarOptions.sidebarBehavior||(i.sidebarOptions.sidebarBehavior=Se.sidebarOptions.sidebarBehavior),e||(i.needsSync=!0),i.updatedAt=Date.now(),this.setValue("chromeSettingsJsonString",JSON.stringify(i)),i}},Ce=Oe,ke="url";V.circle,V.circle,V.circle,V["auto-color-mode"],V.circle;const Le=["http://","https://","http://www.","https://www.","www."],De=["http://localhost:8080/reader.html","http://localhost:9070/reader.html","http://localhost:8080/viewer.html"],xe=["http://localhost:8080","http://localhost:9090","http://localhost:9080","http://localhost:9070","http://localhost:9040"],Pe=["web-highlights.com","pre.web-highlights.com","localhost:2000"],Re=["app.web-highlights.com","pre-app.web-highlights.com","localhost:5173"],Be=Le.map(t=>Pe.map(e=>`${t}${e}/discover`)).flat(1),Ge=["guid","bookguid","openid.claimed_id","ref_","page","jk","vjk","file","uri","pageId","pageid","url","term"],Ue=["#/epubreader?bookguid=","#/notes/","#/lessons/"],Me=["/watch","/search"],je=Le.map(t=>Re.map(e=>`${t}${e}`)).flat(1),Fe=(Le.map(t=>Pe.map(e=>`${t}${e}`)).flat(1),["localhost:8080/defaultblacklisted","localhost:8080/defaultblacklistedWildcard/*","newtab/*","extensions/*","drive.google.com/*","docs.google.com/*","medium.com/new-story/*","medium.com/p/[^/]+/edit","photos.google.com/*","accounts.google.com/*","calendar.google.com/*","chrome.google.com/webstore/*","webhighlights.firebaseapp.com/*","paypal.com/*","slack.com/*","office.com/*","onedrive.live.com/*","yahoo.com/*","firebase.google.com/*","feedly.com/*","typeform.com/*","pornhub.com/*","redtube.com/*","youporn.com/*","com/*","com/*","com/*","tube8.com/*","xvideos.com/*","xnxx.com/*","google.com/maps/*"]);function $e(t){var e;let r=t;return He(r)?ir(r):Ve(r)?r:(r=(null==(e=null==r?void 0:r.split("#")[0])?void 0:e.split("?")[0])||"",r.endsWith("/")&&(r=r.slice(0,-1)),`(${r})(\\/?)(?:\\s|#|\\?[\\w]{1,}|\\/(\\s)|\\/(#)|($))`)}function He(t){try{const e=new URL(t);return ze(e.href)||Ge.some(t=>e.searchParams.has(t))}catch{return!1}}function We(t){try{const e=new URL(t);return Ue.some(t=>e.hash.includes(t))}catch{return!1}}function Ve(t){try{const e=new URL(t);return Me.some(t=>e.href.toLowerCase().includes(t.toLowerCase()))}catch{return Me.some(e=>t.toLowerCase().includes(e.toLowerCase()))}}function qe(t){return decodeURIComponent(t).split("?file=")[1]??""}function ze(t){return!(!Ye(t)&&!function(t){return null==t?void 0:t.startsWith("moz-extension://")}(t))&&Ke(t)}function Ke(t){const e=t.includes("viewer.html?file="),r=!!qe(t);return e&&r}function Ye(t){return(null==t?void 0:t.startsWith("chrome-extension://"))||t.startsWith("http://localhost:8080/viewer.html")}function Je(t){Ye(t)&&(t=t.split("?file=")[1]??"");try{const e=new URL(t);return((null==e?void 0:e.pathname)||"").endsWith(".pdf")||function(){var t;if(typeof window>"u"||typeof document>"u")return!1;const e=null==(t=null==document?void 0:document.body)?void 0:t.firstChild;return"EMBED"===(null==e?void 0:e.tagName)&&"application/pdf"===(null==e?void 0:e.getAttribute("type"))}()}catch{return!1}}const Xe=()=>{var t,e;return typeof chrome>"u"?D.EXTENSION_ID:lr()?(null==(t=null==chrome?void 0:chrome.i18n)?void 0:t.getMessage("@@extension_id"))??D.EXTENSION_ID:(null==(e=null==chrome?void 0:chrome.runtime)?void 0:e.id)??D.EXTENSION_ID};function Ze(t){return`${lr()?"moz-extension":"chrome-extension"}://${Xe()}/${t}`}function Qe(t){return t=function(t){const e=(null==t?void 0:t.replace(/https:\/\/|http:\/\/|www.|/gi,""))??"";return e.endsWith("/")?e.slice(0,-1):e}(t),(t=null==t?void 0:t.split("/")[0])??""}function tr(t){return xe.some(e=>t.startsWith(e))&&!cr()}const er=t=>je.some(e=>t.startsWith(e))||(t=>Be.some(e=>t.startsWith(e)))(t),rr=()=>!(typeof window>"u"||typeof document>"u"||!document.querySelector(Xr.Reader.TAG));function nr(t,e){return null==t?void 0:t.replaceAll(" ","+").replaceAll("%20",e)}function ir(t){try{const e=new URL(t),r=new URLSearchParams(e.search);return Array.from(r.keys()).filter(t=>!Ge.includes(t)).forEach(t=>r.delete(t)),e.search=r.toString(),e.toString().toLowerCase()}catch{return t.toLowerCase()}}function or(t,e){try{if(!t||!e||"string"!=typeof t||"string"!=typeof e)return!1;const r=t=>t.toLowerCase();if(t=r(t),e=r(e),Ke(t)){const r=qe(t);if(null!=r&&r.startsWith("file:")){const t=decodeURIComponent(r).split("/"),n=nr(t[t.length-1]||"","+");return nr(decodeURIComponent(e),"+").endsWith(n)}const n=$e(decodeURIComponent(r)),i=new RegExp(n),o=decodeURIComponent(qe(e));return i.test(o)}if(Ve(t)||Ve(e))return t===e;if(He(t)||He(e))return ir(t)===ir(e);if(We(t)||We(e))return t===e;const n=$e(decodeURIComponent(t));return new RegExp(n).test(decodeURIComponent(e))}catch(t){return console.error(t),!1}}je.map(t=>`${t}/reader`);const sr=t=>((t=>(t||location.href).startsWith("chrome-extension://")||(t||location.href).startsWith("moz-extension://")||(t||location.href).startsWith("extension://"))(t)||function(t){return De.some(e=>t.startsWith(e))&&!cr()}(t))&&t.includes("reader.html");async function ar(t){return new Promise(e=>setTimeout(()=>e(),t))}function cr(){var t;return"chrome"in window&&typeof chrome<"u"&&!(null==(t=null==chrome?void 0:chrome.runtime)||!t.id)}function lr(){var t;return!(typeof globalThis>"u")&&"navigator"in globalThis&&ur(null==(t=globalThis.navigator)?void 0:t.userAgent)}Object.values({HIGHLIGHT_WEBSITE:"highlight-website",OPEN_WEBSITE_IN_READER_MODE:"open-website-in-reader-mode",HIGHLIGHT_NOTES:"highlight-in-notes",HIGHLIGHT_YOUTUBE_VIDEO:"highlight-youtube-video",YOUTUBE_AI_SUMMARY:"youtube-ai-summary",WEBSITE_AI_SUMMARY:"website-ai-summary",YOUTUBE_TRANSCRIPT_GENERATOR:"youtube-transcript-generator",YOUTUBE_TRANSCRIPT_READER:"youtube-transcript-reader"});const ur=t=>null==t?void 0:t.toLowerCase().includes("firefox");function hr(){return cr()||function(){var t,e;try{return typeof chrome<"u"&&((null==(t=null==chrome?void 0:chrome.runtime)?void 0:t.id)===b.extensionId||(null==(e=null==chrome?void 0:chrome.runtime)?void 0:e.id)===_.extensionId)}catch(t){return console.error("Error in isFirefoxExtensionEnvironment",t),!1}}()}const dr=t=>null!==t;var fr=(t=>(t.CREATE="CREATE",t.UPDATE="UPDATE",t.DELETE="DELETE",t))(fr||{});function gr(t){return"CREATE"===t.type}function pr(t){return"UPDATE"===t.type}function mr(t){return"DELETE"===t.type}Object.values(fr);const yr=()=>{var t;return(null==(t=Ji())?void 0:t.clientId)??"server"};function br(t,e){const r=`${t.type}-${t.entityType}-${t.entityId}`.toLowerCase();return t.type===fr.UPDATE?`${r}-${e}`:r}function Tr(){const t=Date.now();return{timestamp:t,clientId:yr(),createdAt:t,updatedAt:t,_objectStore:we.actions}}function vr({entity:t,userId:e}){const r=fr.CREATE;return{...Tr(),id:br({type:r,entityType:t._objectStore,entityId:t._id},void 0),type:r,entityType:t._objectStore,entityId:t._id,_user:e,payload:qi(t,t._objectStore)}}function _r({entityType:t,entityId:e,updates:r,previousValues:n,userId:i}){const o=fr.UPDATE,s={},a={};if(Object.keys(r).forEach(t=>{const e=t,i=n[e],o=r[e];(function(t,e){return JSON.stringify(t)===JSON.stringify(e)})(i,o)||(s[e]=o,a[e]=i)}),0===Object.keys(s).length)return null;const c=Date.now(),l={updatedAt:c,...s};return{...Tr(),id:br({type:o,entityType:t,entityId:e},c),type:o,entityType:t,entityId:e,_user:i,payload:qi(l,t),previousValues:qi(a,t)}}function Ar({entityType:t,entityId:e,userId:r}){const n=fr.DELETE;return{...Tr(),type:n,id:br({type:n,entityType:t,entityId:e},void 0),entityType:t,entityId:e,_user:r}}function wr(t,e){return t.timestamp-e.timestamp}function Er(t){return!(!t||"object"!=typeof t)&&"_id"in t&&"_objectStore"in t}function Sr(t){const e=[],r=[],n=new Map;for(const i of t.sort(wr))if(gr(i))e.push(i);else if(pr(i))r.push(i);else if(mr(i)){const t=n.get(i.entityId);(void 0===t||i.timestamp>t)&&n.set(i.entityId,i.timestamp)}const i=new Map;for(const t of r){const e=i.get(t.entityId)??{};i.set(t.entityId,{...e,...t.payload})}const o=[];for(const t of e){t._id&&(t._id=t._id.toString()),t._user&&(t._user=t._user.toString());const e=t.payload,r=t.entityId;if(!r)continue;const s=n.get(r);if(void 0!==s&&s>=t.timestamp)continue;const a={_id:r,_objectStore:t.entityType,_user:t._user},c={...e},l=i.get(r),u={...l?{...c,...l}:c,...a};Er(u)&&o.push(u)}return o}function Ir(t){return t.map(t=>({...vr({entity:t,userId:t._user}),lastSync:t.lastSync}))}const Nr={dev:{UPDATE_ACTIONS_THRESHOLD:8,COMPACTION_AMOUNT:4},prod:{UPDATE_ACTIONS_THRESHOLD:200,COMPACTION_AMOUNT:100}};function Or(t,{timeZone:e,todayOffset:r}={}){const n=new Date(Date.now()+864e5*(r??0));try{return t.toLocaleDateString(void 0,{timeZone:e})===n.toLocaleDateString(void 0,{timeZone:e})}catch{return t.toLocaleDateString()===n.toLocaleDateString()}}function Cr({_user:t,lastSync:e,...r}){return r}const kr="createdAt";function Lr(t,e,r="asc",n){return((e[n]??e[kr]??0)-(t[n]??t[kr]??0))*("desc"===r?-1:1)}function Dr(t,e){return t.localeCompare(e,"en",{sensitivity:"base"})}function xr(t,e){return Dr(t.name,e.name)}function Pr(t,e){return Dr(t.name,e.name)}const Rr=(t,e)=>e.count-t.count,Br=(t,e)=>e.matchScore!==t.matchScore?e.matchScore-t.matchScore:e.matchScore<60||t.matchScore<60?Rr(t,e):0;function Gr(t){if(!t)return-1;if(0===t.repetitions)return 3;if(t.disableLearning)return 0;const e=(t.easinessFactor-1.3)/(3.2-1.3),r=(0===e?0:.1)*(6-Math.min(t.repetitions,6)),n=Math.abs(r-e),i=r>e&&t.repetitions>1?e-r/t.repetitions:n<.08?e/2.5:e-r,o=Math.max(i,0),s=Math.round(100*o);return Math.min(s,100)}function Ur(t){return t>=80?"Long-Term Memory":t>=60&&t<80?"Confident Recall":t>=40&&t<60?"Moderate Recall":t>=20&&t<40?"Short-Term Memory":t>=0&&t<20?"New Knowledge":"Not Yet Learned"}const Mr={"Long-Term Memory":{id:"Long-Term Memory",isActive:t=>!(null!=t&&t.disableLearning)&&"Long-Term Memory"===Ur(Gr(t)),label:"Long-Term Memory",color:"#46B446"},"Confident Recall":{id:"Confident Recall",isActive:t=>!(null!=t&&t.disableLearning)&&"Confident Recall"===Ur(Gr(t)),label:"Confident Recall",color:"#A9B935"},"Moderate Recall":{id:"Moderate Recall",isActive:t=>!(null!=t&&t.disableLearning)&&"Moderate Recall"===Ur(Gr(t)),label:"Good Recall",color:"#E9C63A"},"Short-Term Memory":{id:"Short-Term Memory",isActive:t=>!(null!=t&&t.disableLearning)&&"Short-Term Memory"===Ur(Gr(t)),label:"Moderate Recall",color:"#E79E3D"},"New Knowledge":{id:"New Knowledge",isActive:t=>!(null!=t&&t.disableLearning)&&"New Knowledge"===Ur(Gr(t)),label:"Likely to forget",color:"#DB4646"},"Not Yet Learned":{id:"Not Yet Learned",isActive:t=>!(null!=t&&t.disableLearning)&&"Not Yet Learned"===Ur(Gr(t)),label:"Not Yet Learned",color:"#ccc"},Discarded:{id:"Discarded",isActive:t=>!(null==t||!t.disableLearning),label:"Discarded",color:"#555555"}};function jr(t){var e,r,n,i;const o=new Date(Date.now()),s=new Date((null==(e=t.learningItem)?void 0:e.nextReviewInMillis)??0),a=new Date((null==(r=t.learningItem)?void 0:r.lastLearned)??0);return!(null!=(n=null==t?void 0:t.learningItem)&&n.disableLearning)&&!(null==(i=null==t?void 0:t.learningItem)||!i.nextReviewInMillis)&&s.getTime()<o.getTime()&&a.toDateString()!==o.toDateString()}function Fr(t){const e=new Map;for(const r of t){const t=Qe(r.url);if(!t)continue;const n=t.toLowerCase(),i=e.get(n);i?i.count+=1:e.set(n,{name:t,count:1})}return Array.from(e.values(),({name:t,count:e})=>({name:t,count:e})).sort(Pr)}Object.values(Mr),["andrebedendo@gmail.com","xyzgcd123@gmail.com"].map(t=>t.toLowerCase());var $r=(t=>(t.OFFLINE="OFFLINE",t.FREE="FREE",t.FREE_TRIAL="FREE_TRIAL",t.PREMIUM="PREMIUM",t.ULTIMATE="ULTIMATE",t))($r||{}),Hr=(t=>(t.ONE_MONTH="1M",t.ONE_YEAR="1Y",t.LIFETIME="Lifetime",t))(Hr||{});function Wr(t){return Ui(t)?function(t){var e;return{entityId:t._id,body:t.messages??[],entityType:ve.aichats,contentType:"application/json",contentLength:(null==(e=t.messages)?void 0:e.length)??0,needsSync:t.lastSync?0:1}}(t):Gi(t)?function(t){var e;return{entityId:t._id,body:t.content??"",entityType:ve.pagecontents,contentType:"text/html",contentLength:(null==(e=t.content)?void 0:e.length)??0,needsSync:t.lastSync?0:1}}(t):null}const Vr=(t,e)=>{const r=new Map,n=t=>{const e=t??[];for(const t of e){if(!t)continue;const e=t.toLowerCase(),n=r.get(e);n?n.count+=1:r.set(e,{name:t,count:1})}};for(const e of t)n(e.tags);for(const t of e)n(t.tags);return Array.from(r.values(),({name:t,count:e})=>({name:t,count:e})).sort(xr)};function qr(t,e){return(Array.isArray(e)?e:[]).reduce((e,r)=>{if("string"!=typeof r)return e;try{return e[r=r.split(" ").join("")]=`${t}-${r}`,e}catch{return e}},{})}var zr,Kr,Yr,Jr,Xr;function Zr(t,e){const r=function(t,e){return t.map(t=>({tagName:t,options:e}))}(t,e);eo.dispatch("defineComponent",{detail:{componentDefinitions:r}})}(t=>{const e=class{};f(e,"TAG","AppSidebar"),f(e,"TEST_IDS",{...qr(e.TAG,["SIDEBAR_CONTAINER","MAIN_NAV_DASHBOARD_BTN","MAIN_NAV_LEARNING_BTN","MAIN_NAV_SEARCH_BTN","MAIN_NAV_DISCOVER_BTN","MAIN_NAV_UPGRADE_BTN","FOOTER_NAV_SETTINGS_BTN","FOOTER_NAV_CHANGE_COLOR","FOOTER_NAV_LEARNING","FOOTER_NAV_LOGOUT","TAGS_VIEW","ORIGINS_VIEW","COLORS_VIEW","IMAGES_VIEW","TRIAL_WARNING","TRIAL_INFO","DOCUMENTS_VIEW"]),GRID_VIEW_BTN:t=>`GRID_VIEW_BTN-${t}`,GRID_VIEW_BTN_BADGE:t=>`GRID_VIEW_BTN_BADGE-${t}`});let r=e;t.AppSidebar=r;const n=class{};f(n,"TAG","AppLayout"),f(n,"TEST_IDS",qr(n.TAG,["MOBILE_NAV","SIDEBAR_NAV","MOBILE_MENU_SIDEBAR_BTN","MOBILE_MENU_SEARCH_BTN","MOBILE_MENU_LEARNING_BTN","MOBILE_MENU_HOME_BTN"]));let i=n;t.AppLayout=i;const o=class{};f(o,"TAG","ImportView"),f(o,"TEST_IDS",{...qr(o.TAG,["NO_URL","ERROR_TITLE","ERROR_DESCRIPTION","LOADING"])});let s=o;t.ImportView=s;const a=class{};f(a,"TAG","TagsOverviewComponent"),f(a,"TEST_IDS",{...qr(a.TAG,["TAG"])});let c=a;t.TagsOverviewComponent=c;const l=class{};f(l,"TAG","WebsitesOverviewComponent"),f(l,"TEST_IDS",{...qr(l.TAG,["TAG"])});let u=l;t.WebsitesOverviewComponent=u})(zr||(zr={})),(t=>{const e=class{};f(e,"TAG","ExtensionDevPage"),f(e,"TEST_IDS",{...qr(e.TAG,["TOGGLE_SIDEBAR_BTN","HIGHLIGHT_IMAGE_1","HIGHLIGHT_IMAGE_2","TEST_TOO_LARGE_ENTITY","ADD_NEW_DOM_ELEMENT","BROWSER_ACTION_OPEN_READER_BTN","TEST_YOUTUBE_VIDEO_1","TEST_YOUTUBE_VIDEO_2","TEST_DATA_FROM_DEPRECATED_ENDPOINTS"]),SHORTCUT_BTN:t=>`${e.TAG}_shortcut_btn_${t}`}),f(e,"LATER_ADDED_TEXT","This text was added programmatically");let r=e;t.ExtensionDevPage=r;const n=class{};f(n,"TAG","webhighlights-demo"),f(n,"TEST_IDS",qr(n.TAG,[""]));let i=n;t.Demo=i})(Kr||(Kr={})),(t=>{const e=class{};f(e,"TAG","webhighlights-element-registry"),f(e,"TEST_IDS",qr(e.TAG,[""]));let r=e;t.ElementRegistry=r;const n=class{};f(n,"TAG","webhighlights-image-indicator"),f(n,"TEST_IDS",qr(n.TAG,[])),f(n,"CLASSES",{IMAGE_HIGHLIGHT_INDICATOR_CLASS:"webhighlights-image-indicator"});let i=n;t.ImageIndicator=i})(Yr||(Yr={})),(t=>{const e=class{};f(e,"TAG","webhighlights-browser-action-mock"),f(e,"TEST_IDS",qr(e.TAG,["HIGHLIGHT_IMAGE_2"]));let r=e;t.BrowserActionMock=r;const n=class{};f(n,"TAG","webhighlights-kindle-import-helper"),f(n,"TEST_IDS",qr(n.TAG,[]));let i=n;t.KindleImportHelper=i;const o=class{};f(o,"TAG","webhighlights-youtube-highlight-button"),f(o,"TEST_IDS",qr(o.TAG,[]));let s=o;t.YoutubeHighlightButton=s;const a=class{};f(a,"TAG","webhighlights-notifications-pdf"),f(a,"TEST_IDS",qr(a.TAG,[]));let c=a;t.NotificationsPdf=c;const l=class{};f(l,"TAG","webhighlights-pdf-local-file-info"),f(l,"TEST_IDS",qr(l.TAG,[]));let u=l;t.PdfLocalFileInfo=u;const h=class{};f(h,"TAG","webhighlights-text-notification"),f(h,"TEST_IDS",qr(h.TAG,[]));let d=h;t.TextNotification=d})(Jr||(Jr={})),(t=>{const e=class{};f(e,"TAG","webhighlights-add-content"),f(e,"CONTENT_BOX_ID","add-content-html-box"),f(e,"URL_INPUT_ID","url-input-url"),f(e,"TEST_IDS",qr(e.TAG,["URL_INPUT","TEXT_INPUT","CREATE_BTN","CLOSE_BTN","SEARCH_BTN","text_TAB","URL_TAB","PDF_TAB"]));let r=e;t.AddContent=r;const n=class{};f(n,"TAG","webhighlights-create-bookmark"),f(n,"TEST_IDS",qr(n.TAG,["TITLE_INPUT","URL_INPUT","DESCRIPTION_INPUT","IMAGE"]));let i=n;t.CreateBookmark=i;const o=class{};f(o,"TAG","webhighlights-account-info"),f(o,"TEST_IDS",{...qr(o.TAG,["ACCOUNT_INFO","USER_NAME","AVATAR","EMAIL","SIGN_UP_CTA_BTN"])});let s=o;t.AccountInfo=s;const a=class{};f(a,"TAG","webhighlights-auth"),f(a,"TEST_IDS",qr(a.TAG,["AUTH_TYPE_SWITCH_BTN","TOS_PRIVACY_INFO","TITLE"]));let c=a;t.Auth=c;const l=class{};f(l,"TAG","webhighlights-avatar"),f(l,"TEST_IDS",qr(l.TAG,["POPUP_TOOLBOX"]));let u=l;t.Avatar=u;const h=class{};f(h,"TAG","webhighlights-backup-or-sync-prompt"),f(h,"TEST_IDS",{...qr(h.TAG,["CTA_BACKUP","CTA_SYNC","BACKUP_INTERVAL_INPUT","DISMISS_CHECKBOX_INPUT"])});let d=h;t.BackupOrSyncPrompt=d;const g=class{};f(g,"TAG","webhighlights-blacklisted-urls"),f(g,"TEST_IDS",{...qr(g.TAG,["ADD_URL_INPUT","ADD_URL_BTN"]),LIST_ENTRY:t=>`${g.TAG}-LIST_ENTRY_${t}`,INPUT_VALUE:t=>`${g.TAG}-INPUT_VALUE_${t}`,DELETE_BTN:t=>`${g.TAG}-DELETE_BTN_${t}`});let p=g;t.BlacklistesUrls=p;const m=class{};f(m,"TAG","webhighlights-cancel-subscription"),f(m,"TEST_IDS",{...qr(m.TAG,["STEP_TITLE","STEP_DESCRIPTION","ERROR_MESSAGE","PROCEED_BTN","BACK_BTN","KEEP_SUBSCRIPTION_BTN","CANCEL_NOW_BTN","CLOSE_BUBBLE_BTN","FEEDBACK_TEXTAREA","CHAR_COUNT","LOADING","NO_SUBSCRIPTION_MESSAGE","CONTINUE_CANCEL_BTN","FOUNDER_BUBBLE"]),RADIO_OPTION:t=>`${m.TAG}-RADIO_OPTION-${t}`});let y=m;t.CancelSubscription=y;const b=class{};f(b,"TAG","webhighlights-reader"),f(b,"TEST_IDS",qr(b.TAG,[]));let T=b;t.Reader=T;const v=class{};f(v,"TAG","webhighlights-bookmark-details"),f(v,"TEST_IDS",qr(v.TAG,[]));let _=v;t.BookmarkDetails=_;const A=class{};f(A,"TAG","webhighlights-bookmark-preview"),f(A,"TEST_IDS",qr(A.TAG,["PREVIEW_ITEM"]));let w=A;t.BookmarkPreview=w;const E=class{};f(E,"TAG","webhighlights-bookmark-preview-highlights-notes-info"),f(E,"TEST_IDS",{...qr(E.TAG,["BADGE_HIGHLIGHTS","BADGE_NOTES"])});let S=E;t.BookmarkPreviewHighlightsNotesInfo=S;const I=class{};f(I,"TAG","webhighlights-change-color-mode"),f(I,"TEST_IDS",qr(I.TAG,[]));let N=I;t.ChangeColorMode=N;const O=class{};f(O,"TAG","webhighlights-chrome-rating-prompt"),f(O,"TEST_IDS",{...qr(O.TAG,["DECLINE_BTN","CONFIRM_BTN","CHROME_STORE_LINK"])});let C=O;t.ChromeRatingPrompt=C;const k=class{};f(k,"TAG","webhighlights-chrome-settings"),f(k,"TEST_IDS",{...qr(k.TAG,[])});let L=k;t.ChromeSettings=L;const D=class{};f(D,"TAG","webhighlights-clipboard-button"),f(D,"TEST_IDS",qr(D.TAG,[""]));let x=D;t.ClipboardButton=x;const P=class{};f(P,"TAG","webhighlights-color-picker"),f(P,"TEST_IDS",qr(P.TAG,[""]));let R=P;t.ColorPicker=R;const B=class{};f(B,"TAG","webhighlights-datetimepicker"),f(B,"TEST_IDS",qr(B.TAG,["PREVIEW_TEXT","DATE_INPUT","HOUR_INPUT","MINUTE_INPUT","CANCEL_BTN","CONFIRM_BTN"]));let G=B;t.DatetimePicker=G;const U=class{};f(U,"TAG","webhighlights-dialog"),f(U,"TEST_IDS",{...qr(U.TAG,[])});let M=U;t.Dialog=M;const j=class{};f(j,"TAG","webhighlights-discount-info"),f(j,"TEST_IDS",qr(j.TAG,["TEXT","AVATAR"]));let F=j;t.DiscountInfo=F;const $=class{};f($,"TAG","webhighlights-dots-menu"),f($,"TEST_IDS",{...qr($.TAG,["BTN"]),DROPDOWN_ITEM:t=>`${$.TAG}-dropdown-item-${t}`});let H=$;t.DotsMenu=H;const W=class{};f(W,"TAG","webhighlights-entity-grid"),f(W,"TEST_IDS",qr(W.TAG,[]));let V=W;t.EntityGrid=V;const q=class{};f(q,"TAG","webhighlights-expiry-info"),f(q,"TEST_IDS",qr(q.TAG,["EXPIRY_INFO","CTA_TEXT","CTA_BTN","BEFORE_MARCH_25_INFO"]));let z=q;t.ExpiryInfo=z;const K=class{};f(K,"TAG","webhighlights-fallback-img"),f(K,"TEST_IDS",{...qr(K.TAG,[])});let Y=K;t.FallbackImage=Y;const J=class{};f(J,"TAG","webhighlights-favicon"),f(J,"TEST_IDS",qr(J.TAG,["image"]));let X=J;t.Favicon=X;const Z=class{};f(Z,"TAG","webhighlights-image-with-fallback"),f(Z,"TEST_IDS",qr(Z.TAG,["IMAGE","FALLBACK_IMAGE"]));let Q=Z;t.ImageWithFallback=Q;const tt=class{};f(tt,"TAG","webhighlights-ai-summary"),f(tt,"TEST_IDS",{...qr(tt.TAG,["SKELETON","CONTENT","ERROR","TOOLBAR","TOGGLE_SUMMARY_DETAILS_BTN","SUMMARY_TYPE","DETAILS","AI_SUMMARY_CONTAINER","REGENERATE_SUMMARY_BTN","DELETE_SUMMARY_BTN","AI_SUMMARY_DOTS_MENU","SUMMARY_TYPE_DOTS_MENU","LENGTH_SLIDER"]),SUMMARY_TYPE_OPTION:t=>`${tt.TAG}-SUMMARY_TYPE_OPTION-${t}`});let et=tt;t.AiSummary=et;const rt=class{};f(rt,"TAG","webhighlights-ai-chat"),f(rt,"TEST_IDS",qr(rt.TAG,["EMPTY_STATE_UPGRADE_BTN","RESTART_BTN","SEND_MESSAGE_BTN","STOP_STREAMING_BTN","INPUT","SESSION_ERROR"]));let nt=rt;t.AiChat=nt;const it=class{};f(it,"TAG","webhighlights-ai-summary-btn"),f(it,"TEST_IDS",qr(it.TAG,["BTN","TOOLTIP"]));let ot=it;t.AiSummaryBtn=ot;const st=class{};f(st,"TAG","webhighlights-grid"),f(st,"TEST_IDS",qr(st.TAG,["PAGES_COUNT_BADGE","HIGHLIGHTS_COUNT_BADGE","SWITCH_TO_HIGHLIGHTS","SWITCH_TO_PAGES","PAGINATION_STEP_BTN","PAGINATION_STEP_PREV_BTN","PAGINATION_STEP_NEXT_BTN","PAGINATION_INFO","EMPTY_STATE"]));let at=st;t.Grid=at;const ct=class{};f(ct,"TAG","webhighlights-grid-toolbar"),f(ct,"TEST_IDS",qr(ct.TAG,[]));let lt=ct;t.GridToolbar=lt;const ut=class{};f(ut,"TAG","webhighlights-highlighter-mode-selector"),f(ut,"TEST_IDS",{...qr(ut.TAG,[]),HIGHLIGHTER_MODE_OPTION_INPUT:t=>`highlighter-mode-option-input-${t}`,HIGHLIGHTER_MODE_OPTION_CONTAINER:t=>`highlighter-mode-option-container-${t}`});let ht=ut;t.HighlighterModeSelector=ht;const dt=class{};f(dt,"TAG","webhighlights-icon"),f(dt,"TEST_IDS",qr(dt.TAG,[""]));let ft=dt;t.Icon=ft;const gt=class{};f(gt,"TAG","webhighlights-image-viewer"),f(gt,"TEST_IDS",{...qr(gt.TAG,["IMG","OUTSIDE_CONTAINER"])});let pt=gt;t.ImageViewer=pt;const mt=class{};f(mt,"TAG","webhighlights-imprint"),f(mt,"TEST_IDS",qr(mt.TAG,[""]));let yt=mt;t.Imprint=yt;const bt=class{};f(bt,"TAG","webhighlights-invoices"),f(bt,"TEST_IDS",{...qr(bt.TAG,[""])});let Tt=bt;t.Invoices=Tt;const vt=class{};f(vt,"TAG","webhighlights-learning-btn"),f(vt,"TEST_IDS",qr(vt.TAG,[]));let _t=vt;t.LearningBtn=_t;const At=class{};f(At,"TAG","webhighlights-learning-dashboard"),f(At,"TEST_IDS",qr(At.TAG,["POPOVER","BOOKMARK_DETAILS_POPOVER","CONFIDENCE_MAIN","GO_BACK_BTN","SELECTED_CATEGORY"]));let wt=At;t.LearningDashboard=wt;const Et=class{};f(Et,"TAG","webhighlights-learning-reminder"),f(Et,"TEST_IDS",qr(Et.TAG,["CONTINUE_LEARNING_BTN"]));let St=Et;t.LearningReminder=St;const It=class{};f(It,"TAG","webhighlights-learning-settings"),f(It,"TEST_IDS",{...qr(It.TAG,["SHOW_TEASER_CHECKBOX"])});let Nt=It;t.LearningSettings=Nt;const Ot=class{};f(Ot,"TAG","webhighlights-learning-streak-overview"),f(Ot,"TEST_IDS",{...qr(Ot.TAG,["MAX_STREAK","CURRENT_STREAK","DAYS_LEARNT"]),DAY_CHECK_ICON:t=>`${Ot.TAG}-DAY_CHECK_ICON-${t}`});let Ct=Ot;t.LearningStreakOverview=Ct;const kt=class{};f(kt,"TAG","webhighlights-legal-footer"),f(kt,"TEST_IDS",qr(kt.TAG,["FAQ_LINK","BLOG_LINK","TOS_LINK","PRIVACY_LINK","IMPRINT_LINK","COOKIE_LINK"]));let Lt=kt;t.LegalFooter=Lt;const Dt=class{};f(Dt,"TAG","webhighlights-like-button"),f(Dt,"TEST_IDS",{...qr(Dt.TAG,["INPUT_CHECKBOX"])});let xt=Dt;t.LikeButton=xt;const Pt=class{};f(Pt,"TAG","webhighlights-link-preview"),f(Pt,"TEST_IDS",qr(Pt.TAG,["TITLE","URL","DESCRIPTION","IMAGE"]));let Rt=Pt;t.LinkPreview=Rt;const Bt=class{};f(Bt,"TAG","webhighlights-loading"),f(Bt,"TEST_IDS",qr(Bt.TAG,[]));let Gt=Bt;t.Loading=Gt;const Ut=class{};f(Ut,"TAG","webhighlights-loading-text"),f(Ut,"TEST_IDS",qr(Ut.TAG,[""]));let Mt=Ut;t.LoadingText=Mt;const jt=class{};f(jt,"TAG","webhighlights-lobby-container"),f(jt,"TEST_IDS",qr(jt.TAG,[""]));let Ft=jt;t.LobbyContainer=Ft;const $t=class{};f($t,"TAG","webhighlights-lobby-container-extension"),f($t,"TEST_IDS",qr($t.TAG,[""]));let Ht=$t;t.LobbyContainerExtension=Ht;const Wt=class{};f(Wt,"TAG","webhighlights-logo"),f(Wt,"TEST_IDS",qr(Wt.TAG,[]));let Vt=Wt;t.Logo=Vt;const qt=class{};f(qt,"TAG","webhighlights-logo-animated"),f(qt,"TEST_IDS",qr(qt.TAG,[""]));let zt=qt;t.LogoAnimated=zt;const Kt=class{};f(Kt,"TAG","webhighlights-mark-blockquotes-teaser"),f(Kt,"TEST_IDS",qr(Kt.TAG,[""]));let Yt=Kt;t.MarkBlockQuotesTeaser=Yt;const Jt=class{};f(Jt,"TAG","webhighlights-mark-element"),f(Jt,"TEST_IDS",qr(Jt.TAG,["TOOLBAR","RICH_EDITOR","TAGS","CONTAINER"]));let Xt=Jt;t.MarkElement=Xt;const Zt=class{static preload(){Zr([this.TAG,ft.TAG,R.TAG,x.TAG,ae.TAG])}};f(Zt,"TAG","webhighlights-mark-element-toolbar"),f(Zt,"TEST_IDS",qr(Zt.TAG,["CONTAINER","TOGGLE_NOTES_BTN","TOGGLE_TAGS_BTN","COLOR_PICKER","COPY_BTN","DELETE_BTN","TOGGLE_SIDEBAR_BTN","OPEN_MEDIA_TYPE_DROPDOWN_BTN"]));let Qt=Zt;t.MarkElementToolbar=Qt;const te=class{};f(te,"TAG","webhighlights-mark-media-item"),f(te,"TEST_IDS",{...qr(te.TAG,["DELETE_BTN","EXPAND_IMG"])});let ee=te;t.MarkMediaItem=ee;const re=class{};f(re,"TAG","webhighlights-mark-preview"),f(re,"TEST_IDS",qr(re.TAG,[]));let ne=re;t.MarkPreview=ne;const ie=class{};f(ie,"TAG","webhighlights-media-type-dropdown"),f(ie,"TEST_IDS",{...qr(ie.TAG,[])});let oe=ie;t.MediaTypeDropdown=oe;const se=class{};f(se,"TAG","webhighlights-media-type-dropdown-item"),f(se,"TEST_IDS",{...qr(se.TAG,[]),HIGHLIGHT_BTN:t=>`${se.TAG}_DROPDOWN_ITEM-${t}`});let ae=se;t.MediaTypeDropdownItem=ae;const ce=class{};f(ce,"TAG","webhighlights-media-type-menu"),f(ce,"TEST_IDS",{...qr(ce.TAG,["ENABLE_MODE_OVERLAY","ENABLE_MODE_BTN"]),HIGHLIGHT_BTN:t=>`${ce.TAG}_HIGHLIGHT_BTN-${t}`});let le=ce;t.MediaTypeMenu=le;const ue=class{};f(ue,"TAG","webhighlights-modal"),f(ue,"TEST_IDS",qr(ue.TAG,["CONTAINER","CLOSE_BTN"]));let he=ue;t.Modal=he;const de=class{};f(de,"TAG","webhighlights-notes-editor"),f(de,"TEST_IDS",{...qr(de.TAG,["NOTES_CONTAINER"])});let fe=de;t.NotesEditor=fe;const ge=class{};f(ge,"TAG","webhighlights-notifications-btn"),f(ge,"TEST_IDS",qr(ge.TAG,["BTN","BADGE"]));let pe=ge;t.NotificationsBtn=pe;const me=class{};f(me,"TAG","webhighlights-notifications-list"),f(me,"TEST_IDS",qr(me.TAG,[]));let ye=me;t.NotificationsList=ye;const be=class{};f(be,"TAG","webhighlights-payment-method"),f(be,"TEST_IDS",{...qr(be.TAG,[""])});let Te=be;t.PaymentMethod=Te;const ve=class{};f(ve,"TAG","webhighlights-pdf-hint"),f(ve,"TEST_IDS",qr(ve.TAG,[]));let _e=ve;t.PdfHint=_e;const Ae=class{};f(Ae,"TAG","webhighlights-popover"),f(Ae,"TEST_IDS",{...qr(Ae.TAG,["CLOSE_BTN"])});let we=Ae;t.Popover=we;const Ee=class{};f(Ee,"TAG","webhighlights-premium-benefits"),f(Ee,"TEST_IDS",{...qr(Ee.TAG,[""])});let Se=Ee;t.PremiumBenefits=Se;const Ie=class{};f(Ie,"TAG","webhighlights-pricing"),f(Ie,"TEST_IDS",qr(Ie.TAG,["SWITCH_TO_YEARLY_BTN","SWITCH_TO_MONTHLY_BTN","SWITCH_TO_LIFETIME","YEARLY_SAVE_INFO"]));let Ne=Ie;t.Pricing=Ne;const Oe=class{};f(Oe,"TAG","webhighlights-privacy-policy"),f(Oe,"TEST_IDS",qr(Oe.TAG,[""]));let Ce=Oe;t.PrivacyPolicy=Ce;const ke=class{};f(ke,"TAG","webhighlights-recent-colors"),f(ke,"TEST_IDS",qr(ke.TAG,[""]));let Le=ke;t.RecentColors=Le;const De=class{};f(De,"TAG","webhighlights-reminder"),f(De,"TEST_IDS",qr(De.TAG,["SNOOZE_BTN","CLOCK_ICON","DOTS_MENU","LABEL","LOADING","DELETE_BTN"]));let xe=De;t.Reminder=xe;const Pe=class{};f(Pe,"TAG","webhighlights-reset-password"),f(Pe,"TEST_IDS",{...qr(Pe.TAG,["NEW_PASSWORD_INPUT","SUBMIT_BTN","ERROR_MSG","SUCCESSS_MSG"])});let Re=Pe;t.ResetPassword=Re;const Be=class{};f(Be,"TAG","webhighlights-search"),f(Be,"TEST_IDS",{...qr(Be.TAG,["LOADING","SEARCH_ENTITY","NO_RESULTS_INFO"]),SEARCH_TYPE_FILTER:t=>`SEARCH_TYPE_FILTER_${Be.TAG}-${t}`});let Ge=Be;t.Search=Ge;const Ue=class{};f(Ue,"TAG","webhighlights-searchbar"),f(Ue,"TEST_IDS",{...qr(Ue.TAG,["INPUT","SUBMIT_BTN","CLEAR_BTN","CANCEL_BTN"])});let Me=Ue;t.SearchBar=Me;const je=class{};f(je,"TAG","webhighlights-settings"),f(je,"TEST_IDS",{...qr(je.TAG,["ACCOUNT_INFO"]),VIEW_BTN:t=>`${je.TAG}_${t}-VIEW_BTN`});let Fe=je;t.Settings=Fe;const $e=class{};f($e,"TAG","webhighlights-share-button"),f($e,"TEST_IDS",{...qr($e.TAG,["SHARE_BUTTON","UNSHARE_BUTTON","CONTAINER","SOCIAL_CONTAINER","SOCIAL_FACEBOOK","SOCIAL_LINKEDIN","SOCIAL_TWITTER","SHARE_TO_FEED_CHECKBOX"])});let He=$e;t.ShareButton=He;const We=class{};f(We,"TAG","webhighlights-share-social"),f(We,"TEST_IDS",qr(We.TAG,[""]));let Ve=We;t.ShareSocial=Ve;const qe=class{};f(qe,"TAG","webhighlights-shortcut"),f(qe,"TEST_IDS",qr(qe.TAG,[""]));let ze=qe;t.Shortcut=ze;const Ke=class{};f(Ke,"TAG","webhighlights-sign-up-prompt"),f(Ke,"TEST_IDS",{...qr(Ke.TAG,["CTA","CANCEL_BTN"])});let Ye=Ke;t.SignUpPrompt=Ye;const Je=class{};f(Je,"TAG","webhighlights-sync-indicator"),f(Je,"CLASSES",{hasTooLargeEntities:"has-too-large-payload-entities"}),f(Je,"TEST_IDS",qr(Je.TAG,["SYNC_BTN","UNSYNCED_ENTITIES_BADGE","TOOLTIP","SYNC_PROGRESS_INFO","CLOUD_OFF_ICON","CLOUD_CHECK_ICON","UPDATING_LOADING_SPINNER"]));let Xe=Je;t.SyncIndicator=Xe;const Ze=class{};f(Ze,"TAG","webhighlights-tag"),f(Ze,"TEST_IDS",{...qr(Ze.TAG,["DELETE_BTN","BADGE","SELECT_BTN"])});let Qe=Ze;t.Tag=Qe;const tr=class{};f(tr,"TAG","webhighlights-tags"),f(tr,"TEST_IDS",{...qr(tr.TAG,["INPUT","EXISTING_TAG"])});let er=tr;t.Tags=er;const rr=class{};f(rr,"TAG","webhighlights-terms-of-service"),f(rr,"TEST_IDS",qr(rr.TAG,[""]));let nr=rr;t.TermsOfService=nr;const ir=class{};f(ir,"TAG","webhighlights-testimonial-item"),f(ir,"TEST_IDS",{...qr(ir.TAG,[])});let or=ir;t.TestimonialItem=or;const sr=class{};f(sr,"TAG","webhighlights-testimonials-grid"),f(sr,"TEST_IDS",{...qr(sr.TAG,[])});let ar=sr;t.TestimonialsGrid=ar;const cr=class{};f(cr,"TAG","webhighlights-toasts"),f(cr,"TEST_IDS",qr(cr.TAG,[""]));let lr=cr;t.Toasts=lr;const ur=class{};f(ur,"TAG","webhighlights-toggle-button"),f(ur,"TEST_IDS",qr(ur.TAG,[""]));let hr=ur;t.ToggleButton=hr;const dr=class{};f(dr,"TAG","webhighlights-tooltip"),f(dr,"TEST_IDS",qr(dr.TAG,[""]));let fr=dr;t.Tooltip=fr;const gr=class{};f(gr,"TAG","webhighlights-upgrade-deal-prompt"),f(gr,"TEST_IDS",{...qr(gr.TAG,["CTA","CANCEL_BTN"])});let pr=gr;t.UpgradeDealPrompt=pr;const mr=class{};f(mr,"TAG","webhighlights-upgrade-needed"),f(mr,"TEST_IDS",{...qr(mr.TAG,["CTA_BTN","HEADLINE"])});let yr=mr;t.UpgradeNeeded=yr;const br=class{};f(br,"TAG","webhighlights-marker"),f(br,"TEST_IDS",qr(br.TAG,["POPUP_TOOLBOX"]));let Tr=br;t.Marker=Tr;class vr{}f(vr,"TAG","webhighlights-popup-toolbox"),f(vr,"TEST_IDS",{}),t.PopupToolbox=vr;const _r=class{};f(_r,"TAG","webhighlights-sidebar"),f(_r,"TEST_IDS",qr(_r.TAG,["MAIN_COMPONENT"]));let Ar=_r;t.Sidebar=Ar;const wr=class{};f(wr,"TAG","webhighlights-page-content-preview"),f(wr,"TEST_IDS",qr(wr.TAG,["OPEN_IN_READER_BUTTON","SKELETON","CONTENT_MISSING_TITLE"]));let Er=wr;t.PageContentPreview=Er;const Sr=class{};f(Sr,"TAG","webhighlights-documents-list"),f(Sr,"TEST_IDS",qr(Sr.TAG,["DOCUMENT_ITEM","DOCUMENT_DOWNLOAD_BUTTON","DOCUMENT_URL","STORAGE_USAGE_TEXT","GET_MORE_STORAGE_BTN","AUTO_DOWNLOAD_ALERT_ICON","DOCUMENT_DELETE_BUTTON"]));let Ir=Sr;t.DocumentsList=Ir;const Nr=class{};f(Nr,"TAG","webhighlights-delete-entity-list"),f(Nr,"TEST_IDS",qr(Nr.TAG,["ENTITY_URL","DELETE_ENTITY_BTN","DELETE_ALL_ENTITIES_BTN"]));let Or=Nr;t.DeleteEntityList=Or;const Cr=class{};f(Cr,"TAG","webhighlights-dropdown"),f(Cr,"TEST_IDS",{...qr(Cr.TAG,["TRIGGER","CONTENT"])});let kr=Cr;t.Dropdown=kr;const Lr=class{};f(Lr,"TAG","webhighlights-spread-the-word-prompt"),f(Lr,"TEST_IDS",qr(Lr.TAG,["CTA","CANCEL_BTN","EMAIL_INPUT","URL_INPUT","LINKED_IN_SHARE_BTN","X_SHARE_BTN","FACEBOOK_SHARE_BTN","CLOSE_BTN","JOIN_GIVEAWAY_BTN","NO_THANKS_BTN","DONE_CONTAINER","POST_URL","WINNER_CHANCE_INFO","INPUT_ERROR"]));let Dr=Lr;t.SpreadTheWordPrompt=Dr;const xr=class{};f(xr,"TAG","webhighlights-skeleton"),f(xr,"TEST_IDS",qr(xr.TAG,["CONTAINER"]));let Pr=xr;t.Skeleton=Pr;const Rr=class{};f(Rr,"TAG","webhighlights-youtube-loading"),f(Rr,"TEST_IDS",qr(Rr.TAG,["LOADING_TEXT"]));let Br=Rr;t.YoutubeLoading=Br})(Xr||(Xr={}));const Qr=qr("webhighlights-bookmark-preview-item",["FAVICON","IMAGE","TITLE","DESCRIPTION","URL"]);var tn,en;(t=>{const e=class{};f(e,"TAG","webhighlights-ai-chat-message"),f(e,"TEST_IDS",qr(e.TAG,[]));let r=e;t.AiChatMessageComponent=r;const n=class{};f(n,"TAG","webhighlights-ai-chat-empty-state"),f(n,"TEST_IDS",qr(n.TAG,["UPGRADE_BTN","SUB_TEXT"]));let i=n;t.AiChatEmptyState=i;const o=class{};f(o,"TAG","webhighlights-bookmark-details-dots-menu"),f(o,"TEST_IDS",qr(o.TAG,[]));let s=o;t.BookmarkDetailsDotsMenu=s;const a=class{};f(a,"TAG","webhighlights-add-content-btn"),f(a,"TEST_IDS",qr(a.TAG,["ADD_CONTENT_BTN"]));let c=a;t.AddContentBtn=c;const l=class{};f(l,"TAG","webhighlights-bookmark-details-preview"),f(l,"TEST_IDS",{...qr(l.TAG,["URL_LINK","IMAGE","TITLE_INPUT","DESCRIPTION_INPUT","TOGGLE_BOOKMARK_BTN","OPEN_APP_BTN","OPEN_PAGE_BTN","REMINDER","DOTS_MENU","SHARE_BTN"]),INTEGRATION_LINK:t=>`INTEGRATION_LINK-${t}`});let u=l;t.BookmarkDetailsPreview=u;const h=class{};f(h,"TAG","webhighlights-bookmark-details-sub-toolbar"),f(h,"TEST_IDS",{...qr(h.TAG,["TAGS","AI_SUMMARY","SHARE_BTN"]),INTEGRATION_LINK:t=>`INTEGRATION_LINK-${t}`});let d=h;t.BookmarkDetailsSubToolbar=d;const g=class{};f(g,"TAG","webhighlights-toast"),f(g,"TEST_IDS",qr(g.TAG,["CONTAINER","VARIANT_ICON","CONTENT","CLOSE_BTN","CTA_BTN"]));let p=g;t.Toast=p;const m=class{};f(m,"TAG","webhighlights-backup-export-btn"),f(m,"TEST_IDS",{...qr(m.TAG,["LOADING","DOWNLOAD_ANCHOR_ELEMENT","EXPORT_BTN"])});let y=m;t.BackupExportBtn=y;const b=class{};f(b,"TAG","webhighlights-backup-import"),f(b,"TEST_IDS",{...qr(b.TAG,["IMPORT_BTN","UPLOADED_BACKUP_FILE_INFO","CHOOSE_FILE_BTN","FILE_INPUT","IMPORT_BTN","KEEP_EXISTING_DATA_CHECKBOX"])});let T=b;t.BackupImport=T;const v=class{};f(v,"TAG","webhighlights-bookmark-details-grid"),f(v,"TEST_IDS",qr(v.TAG,["EMPTY_STATE"]));let _=v;t.BookmarkDetailsGrid=_;const A=class{};f(A,"TAG","webhighlights-bookmark-details-main"),f(A,"TEST_IDS",qr(A.TAG,["NOTEBOOK_TAB","READER_TAB","AI_CHAT_TAB"]));let w=A;t.BookmarkDetailsMain=w;const E=class{};f(E,"TAG","webhighlights-bookmark-preview-grid"),f(E,"TEST_IDS",{...Qr,...qr(E.TAG,[])});let S=E;t.BookmarkPreviewGrid=S;const I=class{};f(I,"TAG","webhighlights-bookmark-preview-list"),f(I,"TEST_IDS",{...Qr,...qr(I.TAG,[])});let N=I;t.BookmarkPreviewList=N;const O=class{};f(O,"TAG","webhighlights-bookmark-preview-tags"),f(O,"TEST_IDS",{...qr(O.TAG,[""])});let C=O;t.BookmarkPreviewTags=C;const k=class{};f(k,"TAG","webhighlights-capacities-api-integration"),f(k,"TEST_IDS",{...qr(k.TAG,["TOKEN_INPUT"])});let L=k;t.CapacitiesApiIntegration=L;const D=class{};f(D,"TAG","webhighlights-change-password-form"),f(D,"TEST_IDS",{...qr(D.TAG,["OLD_PASSWORD","NEW_PASSWORD","SUBMIT_BTN","ERROR_MSG","SUCCESSS_MSG"])});let x=D;t.ChangePasswordForm=x;const P=class{};f(P,"TAG","webhighlights-color-tile"),f(P,"TEST_IDS",qr(P.TAG,[""]));let R=P;t.ColorTile=R;const B=class{};f(B,"TAG","webhighlights-forgot-password"),f(B,"TEST_IDS",qr(B.TAG,[""]));let G=B;t.ForgotPassword=G;const U=class{};f(U,"TAG","webhighlights-forgot-password-form"),f(U,"TEST_IDS",{...qr(U.TAG,["EMAIL","GO_BACK_BTN","SUBMIT_BTN","ERROR_MSG","SUCCESSS_MSG"])});let M=U;t.ForgotPasswordForm=M;const j=class{};f(j,"TAG","webhighlights-google-sign-in"),f(j,"TEST_IDS",qr(j.TAG,[""]));let F=j;t.GoogleSignIn=F;const $=class{};f($,"TAG","webhighlights-grid-filters"),f($,"TEST_IDS",qr($.TAG,["FILTER_TAG"]));let H=$;t.GridFilters=H;const W=class{};f(W,"TAG","webhighlights-grid-toolbar-selector"),f(W,"TEST_IDS",qr(W.TAG,[]));let V=W;t.GridToolbarSelector=V;const q=class{};f(q,"TAG","webhighlights-learning-categories"),f(q,"TEST_IDS",qr(q.TAG,["CATEGORY_CARD"]));let z=q;t.LearningCategories=z;const K=class{};f(K,"TAG","webhighlights-learning-confidence"),f(K,"TEST_IDS",qr(K.TAG,["CONFIDENCE"]));let Y=K;t.LearningConfidence=Y;const J=class{};f(J,"TAG","webhighlights-learning-confidence-bar"),f(J,"TEST_IDS",qr(J.TAG,[]));let X=J;t.LearningConfidenceBar=X;const Z=class{};f(Z,"TAG","webhighlights-learning-marks-list"),f(Z,"TEST_IDS",qr(Z.TAG,["MARK_LIST_ITEM","MARK_LIST_ITEM_HEADER_ROW","MARK_LIST_ITEM_TEXT","UN_DISCARD_BTN","DISCARD_BTN"]));let Q=Z;t.LearningMarksList=Q;const tt=class{};f(tt,"TAG","webhighlights-learning-pagination"),f(tt,"TEST_IDS",qr(tt.TAG,["PAGINATION_INFO","PAGINATION_PREV_BTN","PAGINATION_NEXT_BTN"]));let et=tt;t.LearningPagination=et;const rt=class{};f(rt,"TAG","webhighlights-learning-schedule"),f(rt,"TEST_IDS",qr(rt.TAG,["LEARNED_YESTERDAY_COUNT","LEARNED_TODAY_COUNT","DUE_TOMORROW_COUNT","TODAY_LEARN_BTN"]));let nt=rt;t.LearningSchedule=nt;const it=class{};f(it,"TAG","webhighlights-learning-session"),f(it,"TEST_IDS",qr(it.TAG,["CURRENT_CARD_INFO"]));let ot=it;t.LearningSession=ot;const st=class{};f(st,"TAG","webhighlights-learning-session-card"),f(st,"TEST_IDS",qr(st.TAG,["KNOW_IT_BTN","DONT_KNOW_IT_BTN","DISCARD_BTN"]));let at=st;t.LearningSessionCard=at;const ct=class{};f(ct,"TAG","webhighlights-learning-session-result"),f(ct,"TEST_IDS",qr(ct.TAG,["CONTINUE_LEARNING_BTN","KNOWN_CARDS_COUNT","NOT_KNOWN_CARDS_COUNT","DISCARDED_CARDS_COUNT","STREAK_FIGURE","STREAK_TEXT","TOTAL_CARDS_COUNT","GO_TO_DASHBOARD_BTN"]));let lt=ct;t.LearningSessionResult=lt;const ut=class{};f(ut,"TAG","webhighlights-learning-status"),f(ut,"TEST_IDS",{...qr(ut.TAG,[]),ROW:t=>`${ut.TAG}-ROW-${t.split(" ").join("-")}`,COUNT:t=>`${ut.TAG}-COUNT-${t.split(" ").join("-")}`,COUNT_RELATIVE:t=>`${ut.TAG}-PROGRESS-${t.split(" ").join("-")}`});let ht=ut;t.LearningStatus=ht;const dt=class{};f(dt,"TAG","webhighlights-mark-preview-list"),f(dt,"TEST_IDS",qr(dt.TAG,["URL"]));let ft=dt;t.MarkPreviewList=ft;const gt=class{};f(gt,"TAG","webhighlights-notifications-list-item"),f(gt,"TEST_IDS",qr(gt.TAG,["TITLE","CTA_LINK"]));let pt=gt;t.NotificationsListItem=pt;const mt=class{};f(mt,"TAG","webhighlights-notion-api-integration"),f(mt,"TEST_IDS",{...qr(mt.TAG,["AUTHORIZE_LINK"])});let yt=mt;t.NotionApiIntegration=yt;const bt=class{};f(bt,"TAG","webhighlights-price"),f(bt,"TEST_IDS",qr(bt.TAG,["PRICE","INTERVAL_INFO","HINT"]));let Tt=bt;t.Price=Tt;const vt=class{};f(vt,"TAG","webhighlights-pricing-plan-container"),f(vt,"TEST_IDS",{...qr(vt.TAG,["HEADLINE","FEATURE_LIST"]),CHECKOUT_BTN:t=>`${vt.TAG}-${t}_BTN`,CONTAINER:t=>`${vt.TAG}-${t}`});let _t=vt;t.PricingPlanContainer=_t;const At=class{};f(At,"TAG","webhighlights-search-entity"),f(At,"TEST_IDS",{...qr(At.TAG,["CONTAINER","SEARCH_TYPE_INDICATOR","SEARCH_ENTITY_CONTENT","SEARCH_ENTITY_DETAILS","SEARCH_ENTITY_DATE","SEARCH_ENTITY_URL"]),SEARCH_TYPE_INDICATOR:t=>`SEARCH_TYPE_INDICATOR_${At.TAG}-${t}`});let wt=At;t.SearchEntity=wt;const Et=class{};f(Et,"TAG","webhighlights-share-link"),f(Et,"TEST_IDS",{...qr(Et.TAG,["INPUT","COPY_BTN"])});let St=Et;t.ShareLink=St;const It=class{};f(It,"TAG","webhighlights-sign-in-form"),f(It,"TEST_IDS",{...qr(It.TAG,["EMAIL","PASSWORD","PASSWORD_2","SIGN_IN_BTN","GOOGLE_SIGN_IN","ERROR_MSG","RESEND_EMAIL_BTN","FORGOT_PASSWORD_BTN"])});let Nt=It;t.SignInForm=Nt;const Ot=class{};f(Ot,"TAG","webhighlights-sign-up"),f(Ot,"TEST_IDS",{...qr(Ot.TAG,["EMAIL","PASSWORD_1","PASSWORD_2","PRIVACY_CHECKBOX","SIGN_UP_BTN","GOOGLE_SIGN_UP","ERROR_MSG"])});let Ct=Ot;t.SignUp=Ct;const kt=class{};f(kt,"TAG","webhighlights-sign-up-form"),f(kt,"TEST_IDS",{...qr(kt.TAG,["EMAIL","PASSWORD","PASSWORD_1","PASSWORD_2","PRIVACY_CHECKBOX","SIGN_UP_BTN","GOOGLE_SIGN_UP","ERROR_MSG"])});let Lt=kt;t.SignUpForm=Lt;const Dt=class{};f(Dt,"TAG","webhighlights-social-auth"),f(Dt,"TEST_IDS",{...qr(Dt.TAG,["GOOGLE_AUTH_BTN"])});let xt=Dt;t.SocialAuth=xt;const Pt=class{};f(Pt,"TAG","webhighlights-settings-account"),f(Pt,"TEST_IDS",{...qr(Pt.TAG,["CHANGE_PASSWORD_BTN","EMAIL_ADDRESS","DELETE_ACCOUNT_BTN","LOGOUT_BTN","LINKED_ACCOUNT_LABEL"])});let Rt=Pt;t.SettingsAccount=Rt;const Bt=class{};f(Bt,"TAG","webhighlights-settings-backup"),f(Bt,"TEST_IDS",{...qr(Bt.TAG,[""])});let Gt=Bt;t.SettingsBackup=Gt;const Ut=class{};f(Ut,"TAG","webhighlights-settings-billing"),f(Ut,"TEST_IDS",{...qr(Ut.TAG,["CURRENT_PLAN_INFO","CHANGE_PAYMENT_METHOD_LINK","USERPLAN_INFO","EXPIRY_INFO","CANCEL_NOW_BTN"])});let Mt=Ut;t.SettingsBilling=Mt;const jt=class{};f(jt,"TAG","webhighlights-settings-integrations"),f(jt,"TEST_IDS",{...qr(jt.TAG,[]),INTEGRATION_ITEM:t=>`${jt.TAG}INTEGRATION_ITEM-${t}`});let Ft=jt;t.SettingsIntegrations=Ft;const $t=class{};f($t,"TAG","webhighlights-settings-integration-item"),f($t,"TEST_IDS",{...qr($t.TAG,[])});let Ht=$t;t.SettingsIntegrationItem=Ht;const Wt=class{};f(Wt,"TAG","webhighlights-settings-integration-preview"),f(Wt,"TEST_IDS",{...qr(Wt.TAG,[])});let Vt=Wt;t.SettingsIntegrationPreview=Vt;const qt=class{};f(qt,"TAG","webhighlights-settings-notifications"),f(qt,"TEST_IDS",{...qr(qt.TAG,["BACKUP_INTERVAL_INPUT"])});let zt=qt;t.SettingsNotifications=zt;const Kt=class{};f(Kt,"TAG","webhighlights-settings-documents"),f(Kt,"TEST_IDS",{...qr(Kt.TAG,[""])});let Yt=Kt;t.SettingsDocuments=Yt;const Jt=class{};f(Jt,"TAG","webhighlights-settings-settings"),f(Jt,"TEST_IDS",{...qr(Jt.TAG,[""])});let Xt=Jt;t.SettingsSettings=Xt;const Zt=class{};f(Zt,"TAG","webhighlights-sign-in"),f(Zt,"TEST_IDS",{...qr(Zt.TAG,["EMAIL","PASSWORD","PASSWORD_2","SIGN_IN_BTN","GOOGLE_SIGN_IN","ERROR_MSG","RESEND_EMAIL_BTN"])});let Qt=Zt;t.SignIn=Qt;const te=class{};f(te,"TAG","webhighlights-tag-suggestions"),f(te,"TEST_IDS",{...qr(te.TAG,["SUGGESTION_TAG","PREVIEW_TAG"])});let ee=te;t.TagSuggestions=ee;const re=class{};f(re,"TAG","webhighlights-file-import"),f(re,"TEST_IDS",{...qr(re.TAG,["FILE_INPUT","UPLOADED_FILE_INFO","CHOOSE_FILE_BTN","IMPORT_BTN"])});let ne=re;t.FileImport=ne;const ie=class{};f(ie,"TAG","webhighlights-highlighter"),f(ie,"TEST_IDS",qr(ie.TAG,["HIGHLIGHT_BTN","HIGHLIGHT_ICON","HIDE_POPUP_BTN","HIDE_POPUP_ALWAYS","HIDE_POPUP_UNTIL_NEXT_VISIT","HIDE_POPUP_ON_CURRENT_WEBSITE"]));let oe=ie;t.Highlighter=oe;const se=class{};f(se,"TAG","webhighlights-reader-content"),f(se,"TEST_IDS",qr(se.TAG,[])),f(se,"EVENTS",{READY:`${se.TAG}-ready`});let ae=se;t.ReaderContent=ae;const ce=class{};f(ce,"TAG","webhighlights-youtube-player"),f(ce,"TEST_IDS",qr(ce.TAG,[]));let le=ce;t.YoutubePlayer=le;const ue=class{};f(ue,"TAG","webhighlights-youtube-transcript"),f(ue,"TEST_IDS",qr(ue.TAG,[]));let he=ue;t.YoutubeTranscript=he;const de=class{};f(de,"TAG","webhighlights-reader-controls"),f(de,"TEST_IDS",{...qr(de.TAG,["TOGGLE_SIDEBAR_BTN","FONT_SIZE_BTN_PLUS","FONT_SIZE_BTN_MINUS","CHANGE_COLOR_MODE_BTN","LINE_HEIGHT_BTN_PLUS","LINE_HEIGHT_BTN_MINUS","LAYOUT_WIDTH_BTN_PLUS","LAYOUT_WIDTH_BTN_MINUS","TEXT_LAYOUT_BTN","COLOR_MODE_DROPDOWN","ADD_CONTENT_BTN","PLAY_PAUSE_BTN"]),COLOR_MODE_BTN:t=>`COLOR_MODE_BTN_${de.TAG}-${t}`});let fe=de;t.ReaderControls=fe;const ge=class{};f(ge,"TAG","webhighlights-reader-control-dropdown"),f(ge,"TEST_IDS",qr(ge.TAG,[]));let pe=ge;t.ReaderControlDropdown=pe;const me=class{};f(me,"TAG","webhighlights-popup-toolbox-menu"),f(me,"TEST_IDS",qr(me.TAG,["MENU_CONTAINER","MARK_ELEMENT_TOOLBAR"]));let ye=me;t.PopupToolboxMenu=ye;const be=class{};f(be,"TAG","webhighlights-action-toolbar"),f(be,"TEST_IDS",qr(be.TAG,["DELETE_BTN"]));let Te=be;t.ActionToolbar=Te;const ve=class{};f(ve,"TAG","webhighlights-column-resizer"),f(ve,"TEST_IDS",qr(ve.TAG,[]));let _e=ve;t.ColumnResizerComponent=_e;const Ae=class{};f(Ae,"TAG","webhighlights-domains-view"),f(Ae,"TEST_IDS",{...qr(Ae.TAG,["SEARCH_INPUT"])});let we=Ae;t.DomainsView=we;const Ee=class{};f(Ee,"TAG","webhighlights-filtered-overview"),f(Ee,"TEST_IDS",{...qr(Ee.TAG,["TAGS_CONTAINER","BOOKMARKS_CONTAINER","MARKS_CONTAINER","RELATED_TAGS"])});let Se=Ee;t.FilteredOverview=Se;const Ie=class{};f(Ie,"TAG","webhighlights-header-toggle"),f(Ie,"TEST_IDS",{...qr(Ie.TAG,["CONTAINER","ACCORDIAN_VIEW_BTN","TAGS_VIEW_BTN","DOMAINS_VIEW_BTN","MARK_VIEW_BTN","SEARCH_BTN"])});let Ne=Ie;t.HeaderToggle=Ne;const Oe=class{};f(Oe,"TAG","webhighlights-header-toolbox"),f(Oe,"TEST_IDS",{...qr(Oe.TAG,["CONTAINER","NOTIFICATIONS_BTN","NOTIFICATIONS_BADGE"])});let Ce=Oe;t.HeaderToolbox=Ce;const ke=class{};f(ke,"TAG","webhighlights-history-view"),f(ke,"TEST_IDS",{...qr(ke.TAG,["SEARCH_INPUT"])});let Le=ke;t.HistoryOverviewView=Le;const De=class{};f(De,"TAG","webhighlights-main-component"),f(De,"TEST_IDS",qr(De.TAG,["IS_BLACKLISTED_INFO","SIGN_UP_EMPTY_INFO","BOOKMARK_DETAILS","BOOKMARK_DETAILS_POPOVER","POPOVER","EMPTY_STATE_CONTAINER","TOGGLE_SIDEBAR_BTN","BADGE_INDICATOR","RECENTLY_UPDATED_CONTAINER"]));let xe=De;t.MainComponentPage=xe;const Pe=class{};f(Pe,"TAG","webhighlights-mark-badge"),f(Pe,"TEST_IDS",qr(Pe.TAG,[]));let Re=Pe;t.MarkBadge=Re;const Be=class{};f(Be,"TAG","webhighlights-overview-empty-state"),f(Be,"TEST_IDS",qr(Be.TAG,[]));let Ge=Be;t.MarkOverviewEmptyState=Ge;const Ue=class{};f(Ue,"TAG","webhighlights-shortcut-overview"),f(Ue,"TEST_IDS",qr(Ue.TAG,[]));let Me=Ue;t.ShortcutOverview=Me;const je=class{};f(je,"TAG","webhighlights-sidebar-footer"),f(je,"TEST_IDS",qr(je.TAG,["SETTINGS_ICON","LEARN_BTN","SHORTCUT_BTN","LEARN_BTN_BADGE","DASHBOARD_LINK","BLACKLIST_TOGGLE_BTN","UPGRADE_BTN","GIFT_BTN"]));let Fe=je;t.SidebarFooter=Fe;const $e=class{};f($e,"TAG","webhighlights-sidebar-options"),f($e,"TEST_IDS",qr($e.TAG,[]));let He=$e;t.SidebarOptions=He;const We=class{};f(We,"TAG","webhighlights-tags-view"),f(We,"TEST_IDS",{...qr(We.TAG,["SEARCH_INPUT"])});let Ve=We;t.TagsView=Ve;const qe=class{};f(qe,"TAG","webhighlights-selected-tag-view"),f(qe,"TEST_IDS",{...qr(qe.TAG,["SELECTED_TAG_INFO"])});let ze=qe;t.SelectedTagView=ze;const Ke=class{};f(Ke,"TAG","webhighlights-selected-domain-view"),f(Ke,"TEST_IDS",{...qr(Ke.TAG,["SELECTED_TAG_INFO"])});let Ye=Ke;t.SelectedDomainView=Ye;const Je=class{};f(Je,"TAG","webhighlights-show-popup-selector"),f(Je,"TEST_IDS",{...qr(Je.TAG,["HIDE_POPUP_BTN"]),SHOW_POPUP_OPTION:t=>`highlighter-mode-option-input-${t}`,SHOW_POPUP_OPTION_CONTAINER:t=>`highlighter-mode-option-container-${t}`});let Xe=Je;t.ShowPopupSelector=Xe})(tn||(tn={})),(t=>{const e=class{};f(e,"TAG","WebsiteLikeBtn"),f(e,"TEST_IDS",{...qr(e.TAG,["BTN"])});let r=e;t.WebsiteLikeBtn=r;const n=class{};f(n,"TAG","webhighlights-legal-footer"),f(n,"TEST_IDS",qr(n.TAG,["FAQ_LINK","BLOG_LINK","TOS_LINK","PRIVACY_LINK","IMPRINT_LINK","COOKIE_LINK","TOOLS_LINK"]));let i=n;t.WebsiteFooter=i;const o=class{};f(o,"TAG","WebsiteNavbar"),f(o,"TEST_IDS",{...qr(o.TAG,["BTN"]),NAV_ITEM_LINK:t=>`NAV_ITEM_LINK-${t}`});let s=o;t.WebsiteNavbar=s;const a=class{};f(a,"TAG","WebsiteDiscoverFeed"),f(a,"TEST_IDS",{...qr(a.TAG,["BTN"]),FEED_TYPE_LINK:t=>`FEED_TYPE_LINK-${t}`});let c=a;t.WebsiteDiscoverFeed=c;const l=class{};f(l,"TAG","WebsitePageNotFound"),f(l,"TEST_IDS",{...qr(l.TAG,["CONTAINER","TITLE","DESCRIPTION","LINK"])});let u=l;t.WebsitePageNotFound=u;const h=class{};f(h,"TAG","WebsiteLegalDisclaimer"),f(h,"TEST_IDS",{...qr(h.TAG,["DISCLAIMER"])});let d=h;t.WebsiteLegalDisclaimer=d;const g=class{};f(g,"TAG","AddToBrowserCta"),f(g,"TEST_IDS",{...qr(g.TAG,[]),LABEL:t=>`LABEL-${t}`,LINK:t=>`LINK-${t}`});let p=g;t.AddToBrowserCta=p;const m=class{};f(m,"TAG","WebsiteFinderTool"),f(m,"TEST_IDS",{...qr(m.TAG,["EXAMPLE_WEBSITES","CTA_LINK"])});let y=m;t.WebsiteFinderTool=y;const b=class{};f(b,"TAG","ReaderView"),f(b,"TEST_IDS",{...qr(b.TAG,[]),INSTALL_CTA_DIALOG:t=>`INSTALL_CTA_DIALOG-${t}`});let T=b;t.ReaderView=T})(en||(en={}));const rn=t=>!!t&&(null!=t&&t.notes?!(null==t||!t.notes)&&"<p></p>"!==t.notes:!(null==t||!t.richText)&&(t=>{var e,r,n,i,o;return(null==t?void 0:t.richText)&&(t.richText&&(null==(r=null==(e=t.richText)?void 0:e.ops)?void 0:r.length)>1||t.richText&&"\n"!==(null==(o=null==(i=null==(n=t.richText)?void 0:n.ops)?void 0:i[0])?void 0:o.insert))})(t));W.WEB_HIGHLIGHT;!function(t){function e(t,e){if(e&&e.documentElement)t=e,e=arguments[2];else if(!t||!t.documentElement)throw new Error("First argument to Readability constructor should be a document object.");if(e=e||{},this._doc=t,this._docJSDOMParser=this._doc.firstChild.__JSDOMParser__,this._articleTitle=null,this._articleByline=null,this._articleDir=null,this._articleSiteName=null,this._attempts=[],this._metadata={},this._debug=!!e.debug,this._maxElemsToParse=e.maxElemsToParse||this.DEFAULT_MAX_ELEMS_TO_PARSE,this._nbTopCandidates=e.nbTopCandidates||this.DEFAULT_N_TOP_CANDIDATES,this._charThreshold=e.charThreshold||this.DEFAULT_CHAR_THRESHOLD,this._classesToPreserve=this.CLASSES_TO_PRESERVE.concat(e.classesToPreserve||[]),this._keepClasses=!!e.keepClasses,this._serializer=e.serializer||function(t){return t.innerHTML},this._disableJSONLD=!!e.disableJSONLD,this._allowedVideoRegex=e.allowedVideoRegex||this.REGEXPS.videos,this._linkDensityModifier=e.linkDensityModifier||0,this._flags=this.FLAG_STRIP_UNLIKELYS|this.FLAG_WEIGHT_CLASSES|this.FLAG_CLEAN_CONDITIONALLY,this._debug){let t=function(t){if(t.nodeType==t.TEXT_NODE)return`${t.nodeName} ("${t.textContent}")`;let e=Array.from(t.attributes||[],function(t){return`${t.name}="${t.value}"`}).join(" ");return`<${t.localName} ${e}>`};this.log=function(){if(typeof console<"u"){let e=Array.from(arguments,e=>e&&e.nodeType==this.ELEMENT_NODE?t(e):e);e.unshift("Reader: (Readability)"),console.log(...e)}else if(typeof dump<"u"){var e=Array.prototype.map.call(arguments,function(e){return e&&e.nodeName?t(e):e}).join(" ");dump("Reader: (Readability) "+e+"\n")}}}else this.log=function(){}}e.prototype={FLAG_STRIP_UNLIKELYS:1,FLAG_WEIGHT_CLASSES:2,FLAG_CLEAN_CONDITIONALLY:4,ELEMENT_NODE:1,TEXT_NODE:3,DEFAULT_MAX_ELEMS_TO_PARSE:0,DEFAULT_N_TOP_CANDIDATES:5,DEFAULT_TAGS_TO_SCORE:"section,h2,h3,h4,h5,h6,p,td,pre".toUpperCase().split(","),DEFAULT_CHAR_THRESHOLD:500,REGEXPS:{unlikelyCandidates:/-ad-|ai2html|banner|breadcrumbs|combx|comment|community|cover-wrap|disqus|extra|footer|gdpr|header|legends|menu|related|remark|replies|rss|shoutbox|sidebar|skyscraper|social|sponsor|supplemental|ad-break|agegate|pagination|pager|popup|yom-remote/i,okMaybeItsACandidate:/and|article|body|column|content|main|shadow/i,positive:/article|body|content|entry|hentry|h-entry|main|page|pagination|post|text|blog|story/i,negative:/-ad-|hidden|^hid$| hid$| hid |^hid |banner|combx|comment|com-|contact|footer|gdpr|masthead|media|meta|outbrain|promo|related|scroll|share|shoutbox|sidebar|skyscraper|sponsor|shopping|tags|widget/i,extraneous:/print|archive|comment|discuss|e[\-]?mail|share|reply|all|login|sign|single|utility/i,byline:/byline|author|dateline|writtenby|p-author/i,replaceFonts:/<(\/?)font[^>]*>/gi,normalize:/\s{2,}/g,videos:/\/\/(www\.)?((dailymotion|youtube|youtube-nocookie|player\.vimeo|v\.qq)\.com|(archive|upload\.wikimedia)\.org|player\.twitch\.tv)/i,shareElements:/(\b|_)(share|sharedaddy)(\b|_)/i,nextLink:/(next|weiter|continue|>([^\|]|$)|([^\|]|$))/i,prevLink:/(prev|earl|old|new|<|)/i,tokenize:/\W+/g,whitespace:/^\s*$/,hasContent:/\S$/,hashUrl:/^#.+/,srcsetUrl:/(\S+)(\s+[\d.]+[xw])?(\s*(?:,|$))/g,b64DataUrl:/^data:\s*([^\s;,]+)\s*;\s*base64\s*,/i,commas:/\u002C|\u060C|\uFE50|\uFE10|\uFE11|\u2E41|\u2E34|\u2E32|\uFF0C/g,jsonLdArticleTypes:/^Article|AdvertiserContentArticle|NewsArticle|AnalysisNewsArticle|AskPublicNewsArticle|BackgroundNewsArticle|OpinionNewsArticle|ReportageNewsArticle|ReviewNewsArticle|Report|SatiricalArticle|ScholarlyArticle|MedicalScholarlyArticle|SocialMediaPosting|BlogPosting|LiveBlogPosting|DiscussionForumPosting|TechArticle|APIReference$/,adWords:/^(ad(vertising|vertisement)?|pub(licit)?|werb(ung)?|||Anuncio)$/iu,loadingWords:/^((loading|||chargement|cargando)(|\.\.\.)?)$/iu},UNLIKELY_ROLES:["menu","menubar","complementary","navigation","alert","alertdialog","dialog"],DIV_TO_P_ELEMS:new Set(["BLOCKQUOTE","DL","DIV","IMG","OL","P","PRE","TABLE","UL"]),ALTER_TO_DIV_EXCEPTIONS:["DIV","ARTICLE","SECTION","P","OL","UL"],PRESENTATIONAL_ATTRIBUTES:["align","background","bgcolor","border","cellpadding","cellspacing","frame","hspace","rules","style","valign","vspace"],DEPRECATED_SIZE_ATTRIBUTE_ELEMS:["TABLE","TH","TD","HR","PRE"],PHRASING_ELEMS:["ABBR","AUDIO","B","BDO","BR","BUTTON","CITE","CODE","DATA","DATALIST","DFN","EM","EMBED","I","IMG","INPUT","KBD","LABEL","MARK","MATH","METER","NOSCRIPT","OBJECT","OUTPUT","PROGRESS","Q","RUBY","SAMP","SCRIPT","SELECT","SMALL","SPAN","STRONG","SUB","SUP","TEXTAREA","TIME","VAR","WBR"],CLASSES_TO_PRESERVE:["page"],HTML_ESCAPE_MAP:{lt:"<",gt:">",amp:"&",quot:'"',apos:"'"},_postProcessContent(t){this._fixRelativeUris(t),this._simplifyNestedElements(t),this._keepClasses||this._cleanClasses(t)},_removeNodes(t,e){if(this._docJSDOMParser&&t._isLiveNodeList)throw new Error("Do not pass live node lists to _removeNodes");for(var r=t.length-1;r>=0;r--){var n=t[r],i=n.parentNode;i&&(!e||e.call(this,n,r,t))&&i.removeChild(n)}},_replaceNodeTags(t,e){if(this._docJSDOMParser&&t._isLiveNodeList)throw new Error("Do not pass live node lists to _replaceNodeTags");for(const r of t)this._setNodeTag(r,e)},_forEachNode(t,e){Array.prototype.forEach.call(t,e,this)},_findNode(t,e){return Array.prototype.find.call(t,e,this)},_someNode(t,e){return Array.prototype.some.call(t,e,this)},_everyNode(t,e){return Array.prototype.every.call(t,e,this)},_getAllNodesWithTag:(t,e)=>t.querySelectorAll?t.querySelectorAll(e.join(",")):[].concat.apply([],e.map(function(e){var r=t.getElementsByTagName(e);return Array.isArray(r)?r:Array.from(r)})),_cleanClasses(t){var e=this._classesToPreserve,r=(t.getAttribute("class")||"").split(/\s+/).filter(t=>e.includes(t)).join(" ");for(r?t.setAttribute("class",r):t.removeAttribute("class"),t=t.firstElementChild;t;t=t.nextElementSibling)this._cleanClasses(t)},_isUrl(t){try{return new URL(t),!0}catch{return!1}},_fixRelativeUris(t){var e=this._doc.baseURI,r=this._doc.documentURI;function n(t){if(e==r&&"#"==t.charAt(0))return t;try{return new URL(t,e).href}catch{}return t}var i=this._getAllNodesWithTag(t,["a"]);this._forEachNode(i,function(t){var e=t.getAttribute("href");if(e)if(0===e.indexOf("javascript:"))if(1===t.childNodes.length&&t.childNodes[0].nodeType===this.TEXT_NODE){var r=this._doc.createTextNode(t.textContent);t.parentNode.replaceChild(r,t)}else{for(var i=this._doc.createElement("span");t.firstChild;)i.appendChild(t.firstChild);t.parentNode.replaceChild(i,t)}else t.setAttribute("href",n(e))});var o=this._getAllNodesWithTag(t,["img","picture","figure","video","audio","source"]);this._forEachNode(o,function(t){var e=t.getAttribute("src"),r=t.getAttribute("poster"),i=t.getAttribute("srcset");if(e&&t.setAttribute("src",n(e)),r&&t.setAttribute("poster",n(r)),i){var o=i.replace(this.REGEXPS.srcsetUrl,function(t,e,r,i){return n(e)+(r||"")+i});t.setAttribute("srcset",o)}})},_simplifyNestedElements(t){for(var e=t;e;){if(e.parentNode&&["DIV","SECTION"].includes(e.tagName)&&(!e.id||!e.id.startsWith("readability"))){if(this._isElementWithoutContent(e)){e=this._removeAndGetNext(e);continue}if(this._hasSingleTagInsideElement(e,"DIV")||this._hasSingleTagInsideElement(e,"SECTION")){for(var r=e.children[0],n=0;n<e.attributes.length;n++)r.setAttributeNode(e.attributes[n].cloneNode());e.parentNode.replaceChild(r,e),e=r;continue}}e=this._getNextNode(e)}},_getArticleTitle(){var t=this._doc,e="",r="";try{"string"!=typeof(e=r=t.title.trim())&&(e=r=this._getInnerText(t.getElementsByTagName("title")[0]))}catch{}var n=!1;function i(t){return t.split(/\s+/).length}if(/ [\|\-\\\/>] /.test(e)){n=/ [\\\/>] /.test(e);let t=Array.from(r.matchAll(/ [\|\-\\\/>] /gi));i(e=r.substring(0,t.pop().index))<3&&(e=r.replace(/^[^\|\-\\\/>]*[\|\-\\\/>]/gi,""))}else if(e.includes(": ")){var o=this._getAllNodesWithTag(t,["h1","h2"]),s=e.trim(),a=this._someNode(o,function(t){return t.textContent.trim()===s});a||(i(e=r.substring(r.lastIndexOf(":")+1))<3?e=r.substring(r.indexOf(":")+1):i(r.substr(0,r.indexOf(":")))>5&&(e=r))}else if(e.length>150||e.length<15){var c=t.getElementsByTagName("h1");1===c.length&&(e=this._getInnerText(c[0]))}var l=i(e=e.trim().replace(this.REGEXPS.normalize," "));return l<=4&&(!n||l!=i(r.replace(/[\|\-\\\/>]+/g,""))-1)&&(e=r),e},_prepDocument(){var t=this._doc;this._removeNodes(this._getAllNodesWithTag(t,["style"])),t.body&&this._replaceBrs(t.body),this._replaceNodeTags(this._getAllNodesWithTag(t,["font"]),"SPAN")},_nextNode(t){for(var e=t;e&&e.nodeType!=this.ELEMENT_NODE&&this.REGEXPS.whitespace.test(e.textContent);)e=e.nextSibling;return e},_replaceBrs(t){this._forEachNode(this._getAllNodesWithTag(t,["br"]),function(t){for(var e=t.nextSibling,r=!1;(e=this._nextNode(e))&&"BR"==e.tagName;){r=!0;var n=e.nextSibling;e.remove(),e=n}if(r){var i=this._doc.createElement("p");for(t.parentNode.replaceChild(i,t),e=i.nextSibling;e;){if("BR"==e.tagName){var o=this._nextNode(e.nextSibling);if(o&&"BR"==o.tagName)break}if(!this._isPhrasingContent(e))break;var s=e.nextSibling;i.appendChild(e),e=s}for(;i.lastChild&&this._isWhitespace(i.lastChild);)i.lastChild.remove();"P"===i.parentNode.tagName&&this._setNodeTag(i.parentNode,"DIV")}})},_setNodeTag(t,e){if(this.log("_setNodeTag",t,e),this._docJSDOMParser)return t.localName=e.toLowerCase(),t.tagName=e.toUpperCase(),t;for(var r=t.ownerDocument.createElement(e);t.firstChild;)r.appendChild(t.firstChild);t.parentNode.replaceChild(r,t),t.readability&&(r.readability=t.readability);for(var n=0;n<t.attributes.length;n++)r.setAttributeNode(t.attributes[n].cloneNode());return r},_prepArticle(t){this._cleanStyles(t),this._markDataTables(t),this._fixLazyImages(t),this._cleanConditionally(t,"form"),this._cleanConditionally(t,"fieldset"),this._clean(t,"object"),this._clean(t,"embed"),this._clean(t,"footer"),this._clean(t,"link"),this._clean(t,"aside");var e=this.DEFAULT_CHAR_THRESHOLD;this._forEachNode(t.children,function(t){this._cleanMatchedNodes(t,function(t,r){return this.REGEXPS.shareElements.test(r)&&t.textContent.length<e})}),this._clean(t,"iframe"),this._clean(t,"input"),this._clean(t,"textarea"),this._clean(t,"select"),this._clean(t,"button"),this._cleanHeaders(t),this._cleanConditionally(t,"table"),this._cleanConditionally(t,"ul"),this._cleanConditionally(t,"div"),this._replaceNodeTags(this._getAllNodesWithTag(t,["h1"]),"h2"),this._removeNodes(this._getAllNodesWithTag(t,["p"]),function(t){return 0===this._getAllNodesWithTag(t,["img","embed","object","iframe"]).length&&!this._getInnerText(t,!1)}),this._forEachNode(this._getAllNodesWithTag(t,["br"]),function(t){var e=this._nextNode(t.nextSibling);e&&"P"==e.tagName&&t.remove()}),this._forEachNode(this._getAllNodesWithTag(t,["table"]),function(t){var e=this._hasSingleTagInsideElement(t,"TBODY")?t.firstElementChild:t;if(this._hasSingleTagInsideElement(e,"TR")){var r=e.firstElementChild;if(this._hasSingleTagInsideElement(r,"TD")){var n=r.firstElementChild;n=this._setNodeTag(n,this._everyNode(n.childNodes,this._isPhrasingContent)?"P":"DIV"),t.parentNode.replaceChild(n,t)}}})},_initializeNode(t){switch(t.readability={contentScore:0},t.tagName){case"DIV":t.readability.contentScore+=5;break;case"PRE":case"TD":case"BLOCKQUOTE":t.readability.contentScore+=3;break;case"ADDRESS":case"OL":case"UL":case"DL":case"DD":case"DT":case"LI":case"FORM":t.readability.contentScore-=3;break;case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"TH":t.readability.contentScore-=5}t.readability.contentScore+=this._getClassWeight(t)},_removeAndGetNext(t){var e=this._getNextNode(t,!0);return t.remove(),e},_getNextNode(t,e){if(!e&&t.firstElementChild)return t.firstElementChild;if(t.nextElementSibling)return t.nextElementSibling;do{t=t.parentNode}while(t&&!t.nextElementSibling);return t&&t.nextElementSibling},_textSimilarity(t,e){var r=t.toLowerCase().split(this.REGEXPS.tokenize).filter(Boolean),n=e.toLowerCase().split(this.REGEXPS.tokenize).filter(Boolean);if(!r.length||!n.length)return 0;var i=n.filter(t=>!r.includes(t));return 1-i.join(" ").length/n.join(" ").length},_isValidByline(t,e){var r=t.getAttribute("rel"),n=t.getAttribute("itemprop"),i=t.textContent.trim().length;return("author"===r||n&&n.includes("author")||this.REGEXPS.byline.test(e))&&!!i&&i<100},_getNodeAncestors(t,e){e=e||0;for(var r=0,n=[];t.parentNode&&(n.push(t.parentNode),!e||++r!==e);)t=t.parentNode;return n},_grabArticle(t){this.log("**** grabArticle ****");var e=this._doc,r=null!==t;if(!(t=t||this._doc.body))return this.log("No body found in document. Abort."),null;for(var n=t.innerHTML;;){this.log("Starting grabArticle loop");var i=this._flagIsActive(this.FLAG_STRIP_UNLIKELYS),o=[],s=this._doc.documentElement;let Y=!0;for(;s;){"HTML"===s.tagName&&(this._articleLang=s.getAttribute("lang"));var a=s.className+" "+s.id;if(this._isProbablyVisible(s))if("true"!=s.getAttribute("aria-modal")||"dialog"!=s.getAttribute("role"))if(this._articleByline||this._metadata.byline||!this._isValidByline(s,a))if(Y&&this._headerDuplicatesTitle(s))this.log("Removing header: ",s.textContent.trim(),this._articleTitle.trim()),Y=!1,s=this._removeAndGetNext(s);else{if(i){if(this.REGEXPS.unlikelyCandidates.test(a)&&!this.REGEXPS.okMaybeItsACandidate.test(a)&&!this._hasAncestorTag(s,"table")&&!this._hasAncestorTag(s,"code")&&"BODY"!==s.tagName&&"A"!==s.tagName){this.log("Removing unlikely candidate - "+a),s=this._removeAndGetNext(s);continue}if(this.UNLIKELY_ROLES.includes(s.getAttribute("role"))){this.log("Removing content with role "+s.getAttribute("role")+" - "+a),s=this._removeAndGetNext(s);continue}}if("DIV"!==s.tagName&&"SECTION"!==s.tagName&&"HEADER"!==s.tagName&&"H1"!==s.tagName&&"H2"!==s.tagName&&"H3"!==s.tagName&&"H4"!==s.tagName&&"H5"!==s.tagName&&"H6"!==s.tagName||!this._isElementWithoutContent(s)){if(this.DEFAULT_TAGS_TO_SCORE.includes(s.tagName)&&o.push(s),"DIV"===s.tagName){for(var c=null,l=s.firstChild;l;){var u=l.nextSibling;if(this._isPhrasingContent(l))null!==c?c.appendChild(l):this._isWhitespace(l)||(c=e.createElement("p"),s.replaceChild(c,l),c.appendChild(l));else if(null!==c){for(;c.lastChild&&this._isWhitespace(c.lastChild);)c.lastChild.remove();c=null}l=u}if(this._hasSingleTagInsideElement(s,"P")&&this._getLinkDensity(s)<.25){var h=s.children[0];s.parentNode.replaceChild(h,s),s=h,o.push(s)}else this._hasChildBlockElement(s)||(s=this._setNodeTag(s,"P"),o.push(s))}s=this._getNextNode(s)}else s=this._removeAndGetNext(s)}else{for(var d=this._getNextNode(s,!0),f=this._getNextNode(s),g=null;f&&f!=d;){var p=f.getAttribute("itemprop");if(p&&p.includes("name")){g=f;break}f=this._getNextNode(f)}this._articleByline=(g??s).textContent.trim(),s=this._removeAndGetNext(s)}else s=this._removeAndGetNext(s);else this.log("Removing hidden node - "+a),s=this._removeAndGetNext(s)}var m=[];this._forEachNode(o,function(t){if(t.parentNode&&!(typeof t.parentNode.tagName>"u")){var e=this._getInnerText(t);if(!(e.length<25)){var r=this._getNodeAncestors(t,5);if(0!==r.length){var n=0;n+=1,n+=e.split(this.REGEXPS.commas).length,n+=Math.min(Math.floor(e.length/100),3),this._forEachNode(r,function(t,e){if(t.tagName&&t.parentNode&&!(typeof t.parentNode.tagName>"u")){if(typeof t.readability>"u"&&(this._initializeNode(t),m.push(t)),0===e)var r=1;else r=1===e?2:3*e;t.readability.contentScore+=n/r}})}}}});for(var y=[],b=0,T=m.length;b<T;b+=1){var v=m[b],_=v.readability.contentScore*(1-this._getLinkDensity(v));v.readability.contentScore=_,this.log("Candidate:",v,"with score "+_);for(var A=0;A<this._nbTopCandidates;A++){var w=y[A];if(!w||_>w.readability.contentScore){y.splice(A,0,v),y.length>this._nbTopCandidates&&y.pop();break}}}var E,S=y[0]||null,I=!1;if(null===S||"BODY"===S.tagName){for(S=e.createElement("DIV"),I=!0;t.firstChild;)this.log("Moving child out:",t.firstChild),S.appendChild(t.firstChild);t.appendChild(S),this._initializeNode(S)}else if(S){for(var N=[],O=1;O<y.length;O++)y[O].readability.contentScore/S.readability.contentScore>=.75&&N.push(this._getNodeAncestors(y[O]));if(N.length>=3)for(E=S.parentNode;"BODY"!==E.tagName;){for(var C=0,k=0;k<N.length&&C<3;k++)C+=Number(N[k].includes(E));if(C>=3){S=E;break}E=E.parentNode}S.readability||this._initializeNode(S),E=S.parentNode;for(var L=S.readability.contentScore,D=L/3;"BODY"!==E.tagName;)if(E.readability){var x=E.readability.contentScore;if(x<D)break;if(x>L){S=E;break}L=E.readability.contentScore,E=E.parentNode}else E=E.parentNode;for(E=S.parentNode;"BODY"!=E.tagName&&1==E.children.length;)E=(S=E).parentNode;S.readability||this._initializeNode(S)}var P=e.createElement("DIV");r&&(P.id="readability-content");for(var R=Math.max(10,.2*S.readability.contentScore),B=(E=S.parentNode).children,G=0,U=B.length;G<U;G++){var M=B[G],j=!1;if(this.log("Looking at sibling node:",M,M.readability?"with score "+M.readability.contentScore:""),this.log("Sibling has score",M.readability?M.readability.contentScore:"Unknown"),M===S)j=!0;else{var F=0;if(M.className===S.className&&""!==S.className&&(F+=.2*S.readability.contentScore),M.readability&&M.readability.contentScore+F>=R)j=!0;else if("P"===M.nodeName){var $=this._getLinkDensity(M),H=this._getInnerText(M),W=H.length;(W>80&&$<.25||W<80&&W>0&&0===$&&-1!==H.search(/\.( |$)/))&&(j=!0)}}j&&(this.log("Appending node:",M),this.ALTER_TO_DIV_EXCEPTIONS.includes(M.nodeName)||(this.log("Altering sibling:",M,"to div."),M=this._setNodeTag(M,"DIV")),P.appendChild(M),B=E.children,G-=1,U-=1)}if(this._debug&&this.log("Article content pre-prep: "+P.innerHTML),this._prepArticle(P),this._debug&&this.log("Article content post-prep: "+P.innerHTML),I)S.id="readability-page-1",S.className="page";else{var V=e.createElement("DIV");for(V.id="readability-page-1",V.className="page";P.firstChild;)V.appendChild(P.firstChild);P.appendChild(V)}this._debug&&this.log("Article content after paging: "+P.innerHTML);var q=!0,z=this._getInnerText(P,!0).length;if(z<this._charThreshold)if(q=!1,t.innerHTML=n,this._attempts.push({articleContent:P,textLength:z}),this._flagIsActive(this.FLAG_STRIP_UNLIKELYS))this._removeFlag(this.FLAG_STRIP_UNLIKELYS);else if(this._flagIsActive(this.FLAG_WEIGHT_CLASSES))this._removeFlag(this.FLAG_WEIGHT_CLASSES);else if(this._flagIsActive(this.FLAG_CLEAN_CONDITIONALLY))this._removeFlag(this.FLAG_CLEAN_CONDITIONALLY);else{if(this._attempts.sort(function(t,e){return e.textLength-t.textLength}),!this._attempts[0].textLength)return null;P=this._attempts[0].articleContent,q=!0}if(q){var K=[E,S].concat(this._getNodeAncestors(E));return this._someNode(K,function(t){if(!t.tagName)return!1;var e=t.getAttribute("dir");return!!e&&(this._articleDir=e,!0)}),P}}},_unescapeHtmlEntities(t){if(!t)return t;var e=this.HTML_ESCAPE_MAP;return t.replace(/&(quot|amp|apos|lt|gt);/g,function(t,r){return e[r]}).replace(/&#(?:x([0-9a-f]+)|([0-9]+));/gi,function(t,e,r){var n=parseInt(e||r,e?16:10);return(0==n||n>1114111||n>=55296&&n<=57343)&&(n=65533),String.fromCodePoint(n)})},_getJSONLD(t){var e,r=this._getAllNodesWithTag(t,["script"]);return this._forEachNode(r,function(t){if(!e&&"application/ld+json"===t.getAttribute("type"))try{var r=t.textContent.replace(/^\s*<!\[CDATA\[|\]\]>\s*$/g,""),n=JSON.parse(r);if(Array.isArray(n)&&(n=n.find(t=>t["@type"]&&t["@type"].match(this.REGEXPS.jsonLdArticleTypes)),!n))return;var i=/^https?\:\/\/schema\.org\/?$/;if(!(("string"==typeof n["@context"]&&n["@context"].match(i)||"object"==typeof n["@context"]&&"string"==typeof n["@context"]["@vocab"]&&n["@context"]["@vocab"].match(i))&&(!n["@type"]&&Array.isArray(n["@graph"])&&(n=n["@graph"].find(t=>(t["@type"]||"").match(this.REGEXPS.jsonLdArticleTypes))),n&&n["@type"]&&n["@type"].match(this.REGEXPS.jsonLdArticleTypes))))return;if(e={},"string"==typeof n.name&&"string"==typeof n.headline&&n.name!==n.headline){var o=this._getArticleTitle(),s=this._textSimilarity(n.name,o)>.75,a=this._textSimilarity(n.headline,o)>.75;e.title=a&&!s?n.headline:n.name}else"string"==typeof n.name?e.title=n.name.trim():"string"==typeof n.headline&&(e.title=n.headline.trim());n.author&&("string"==typeof n.author.name?e.byline=n.author.name.trim():Array.isArray(n.author)&&n.author[0]&&"string"==typeof n.author[0].name&&(e.byline=n.author.filter(function(t){return t&&"string"==typeof t.name}).map(function(t){return t.name.trim()}).join(", "))),"string"==typeof n.description&&(e.excerpt=n.description.trim()),n.publisher&&"string"==typeof n.publisher.name&&(e.siteName=n.publisher.name.trim()),"string"==typeof n.datePublished&&(e.datePublished=n.datePublished.trim())}catch(t){this.log(t.message)}}),e||{}},_getArticleMetadata(t){var e={},r={},n=this._doc.getElementsByTagName("meta"),i=/\s*(article|dc|dcterm|og|twitter)\s*:\s*(author|creator|description|published_time|title|site_name)\s*/gi,o=/^\s*(?:(dc|dcterm|og|twitter|parsely|weibo:(article|webpage))\s*[-\.:]\s*)?(author|creator|pub-date|description|title|site_name)\s*$/i;this._forEachNode(n,function(t){var e=t.getAttribute("name"),n=t.getAttribute("property"),s=t.getAttribute("content");if(s){var a=null,c=null;n&&(a=n.match(i))&&(c=a[0].toLowerCase().replace(/\s/g,""),r[c]=s.trim()),!a&&e&&o.test(e)&&(c=e,s&&(c=c.toLowerCase().replace(/\s/g,"").replace(/\./g,":"),r[c]=s.trim()))}}),e.title=t.title||r["dc:title"]||r["dcterm:title"]||r["og:title"]||r["weibo:article:title"]||r["weibo:webpage:title"]||r.title||r["twitter:title"]||r["parsely-title"],e.title||(e.title=this._getArticleTitle());const s="string"!=typeof r["article:author"]||this._isUrl(r["article:author"])?void 0:r["article:author"];return e.byline=t.byline||r["dc:creator"]||r["dcterm:creator"]||r.author||r["parsely-author"]||s,e.excerpt=t.excerpt||r["dc:description"]||r["dcterm:description"]||r["og:description"]||r["weibo:article:description"]||r["weibo:webpage:description"]||r.description||r["twitter:description"],e.siteName=t.siteName||r["og:site_name"],e.publishedTime=t.datePublished||r["article:published_time"]||r["parsely-pub-date"]||null,e.title=this._unescapeHtmlEntities(e.title),e.byline=this._unescapeHtmlEntities(e.byline),e.excerpt=this._unescapeHtmlEntities(e.excerpt),e.siteName=this._unescapeHtmlEntities(e.siteName),e.publishedTime=this._unescapeHtmlEntities(e.publishedTime),e},_isSingleImage(t){for(;t;){if("IMG"===t.tagName)return!0;if(1!==t.children.length||""!==t.textContent.trim())return!1;t=t.children[0]}return!1},_unwrapNoscriptImages(t){var e=Array.from(t.getElementsByTagName("img"));this._forEachNode(e,function(t){for(var e=0;e<t.attributes.length;e++){var r=t.attributes[e];switch(r.name){case"src":case"srcset":case"data-src":case"data-srcset":return}if(/\.(jpg|jpeg|png|webp)/i.test(r.value))return}t.remove()});var r=Array.from(t.getElementsByTagName("noscript"));this._forEachNode(r,function(e){if(this._isSingleImage(e)){var r=t.createElement("div");r.innerHTML=e.innerHTML;var n=e.previousElementSibling;if(n&&this._isSingleImage(n)){var i=n;"IMG"!==i.tagName&&(i=n.getElementsByTagName("img")[0]);for(var o=r.getElementsByTagName("img")[0],s=0;s<i.attributes.length;s++){var a=i.attributes[s];if(""!==a.value&&("src"===a.name||"srcset"===a.name||/\.(jpg|jpeg|png|webp)/i.test(a.value))){if(o.getAttribute(a.name)===a.value)continue;var c=a.name;o.hasAttribute(c)&&(c="data-old-"+c),o.setAttribute(c,a.value)}}e.parentNode.replaceChild(r.firstElementChild,n)}}})},_removeScripts(t){this._removeNodes(this._getAllNodesWithTag(t,["script","noscript"]))},_hasSingleTagInsideElement(t,e){return 1==t.children.length&&t.children[0].tagName===e&&!this._someNode(t.childNodes,function(t){return t.nodeType===this.TEXT_NODE&&this.REGEXPS.hasContent.test(t.textContent)})},_isElementWithoutContent(t){return!(t.nodeType!==this.ELEMENT_NODE||t.textContent.trim().length||t.children.length&&t.children.length!=t.getElementsByTagName("br").length+t.getElementsByTagName("hr").length)},_hasChildBlockElement(t){return this._someNode(t.childNodes,function(t){return this.DIV_TO_P_ELEMS.has(t.tagName)||this._hasChildBlockElement(t)})},_isPhrasingContent(t){return t.nodeType===this.TEXT_NODE||this.PHRASING_ELEMS.includes(t.tagName)||("A"===t.tagName||"DEL"===t.tagName||"INS"===t.tagName)&&this._everyNode(t.childNodes,this._isPhrasingContent)},_isWhitespace(t){return t.nodeType===this.TEXT_NODE&&0===t.textContent.trim().length||t.nodeType===this.ELEMENT_NODE&&"BR"===t.tagName},_getInnerText(t,e){e=typeof e>"u"||e;var r=t.textContent.trim();return e?r.replace(this.REGEXPS.normalize," "):r},_getCharCount(t,e){return e=e||",",this._getInnerText(t).split(e).length-1},_cleanStyles(t){if(t&&"svg"!==t.tagName.toLowerCase()){for(var e=0;e<this.PRESENTATIONAL_ATTRIBUTES.length;e++)t.removeAttribute(this.PRESENTATIONAL_ATTRIBUTES[e]);this.DEPRECATED_SIZE_ATTRIBUTE_ELEMS.includes(t.tagName)&&(t.removeAttribute("width"),t.removeAttribute("height"));for(var r=t.firstElementChild;null!==r;)this._cleanStyles(r),r=r.nextElementSibling}},_getLinkDensity(t){var e=this._getInnerText(t).length;if(0===e)return 0;var r=0;return this._forEachNode(t.getElementsByTagName("a"),function(t){var e=t.getAttribute("href"),n=e&&this.REGEXPS.hashUrl.test(e)?.3:1;r+=this._getInnerText(t).length*n}),r/e},_getClassWeight(t){if(!this._flagIsActive(this.FLAG_WEIGHT_CLASSES))return 0;var e=0;return"string"==typeof t.className&&""!==t.className&&(this.REGEXPS.negative.test(t.className)&&(e-=25),this.REGEXPS.positive.test(t.className)&&(e+=25)),"string"==typeof t.id&&""!==t.id&&(this.REGEXPS.negative.test(t.id)&&(e-=25),this.REGEXPS.positive.test(t.id)&&(e+=25)),e},_clean(t,e){var r=["object","embed","iframe"].includes(e);this._removeNodes(this._getAllNodesWithTag(t,[e]),function(t){if(r){for(var e=0;e<t.attributes.length;e++)if(this._allowedVideoRegex.test(t.attributes[e].value))return!1;if("object"===t.tagName&&this._allowedVideoRegex.test(t.innerHTML))return!1}return!0})},_hasAncestorTag(t,e,r,n){r=r||3,e=e.toUpperCase();for(var i=0;t.parentNode;){if(r>0&&i>r)return!1;if(t.parentNode.tagName===e&&(!n||n(t.parentNode)))return!0;t=t.parentNode,i++}return!1},_getRowAndColumnCount(t){for(var e=0,r=0,n=t.getElementsByTagName("tr"),i=0;i<n.length;i++){var o=n[i].getAttribute("rowspan")||0;o&&(o=parseInt(o,10)),e+=o||1;for(var s=0,a=n[i].getElementsByTagName("td"),c=0;c<a.length;c++){var l=a[c].getAttribute("colspan")||0;l&&(l=parseInt(l,10)),s+=l||1}r=Math.max(r,s)}return{rows:e,columns:r}},_markDataTables(t){for(var e=t.getElementsByTagName("table"),r=0;r<e.length;r++){var n=e[r];if("presentation"!=n.getAttribute("role"))if("0"!=n.getAttribute("datatable"))if(n.getAttribute("summary"))n._readabilityDataTable=!0;else{var i=n.getElementsByTagName("caption")[0];if(i&&i.childNodes.length)n._readabilityDataTable=!0;else{var o=function(t){return!!n.getElementsByTagName(t)[0]};if(["col","colgroup","tfoot","thead","th"].some(o))this.log("Data table because found data-y descendant"),n._readabilityDataTable=!0;else if(n.getElementsByTagName("table")[0])n._readabilityDataTable=!1;else{var s=this._getRowAndColumnCount(n);1!=s.columns&&1!=s.rows?s.rows>=10||s.columns>4?n._readabilityDataTable=!0:n._readabilityDataTable=s.rows*s.columns>10:n._readabilityDataTable=!1}}}else n._readabilityDataTable=!1;else n._readabilityDataTable=!1}},_fixLazyImages(t){this._forEachNode(this._getAllNodesWithTag(t,["img","picture","figure"]),function(t){if(t.src&&this.REGEXPS.b64DataUrl.test(t.src)){var e=this.REGEXPS.b64DataUrl.exec(t.src);if("image/svg+xml"===e[1])return;for(var r=!1,n=0;n<t.attributes.length;n++){var i=t.attributes[n];if("src"!==i.name&&/\.(jpg|jpeg|png|webp)/i.test(i.value)){r=!0;break}}if(r){var o=e[0].length;t.src.length-o<133&&t.removeAttribute("src")}}if(!(t.src||t.srcset&&"null"!=t.srcset)||t.className.toLowerCase().includes("lazy"))for(var s=0;s<t.attributes.length;s++)if("src"!==(i=t.attributes[s]).name&&"srcset"!==i.name&&"alt"!==i.name){var a=null;if(/\.(jpg|jpeg|png|webp)\s+\d/.test(i.value)?a="srcset":/^\s*\S+\.(jpg|jpeg|png|webp)\S*\s*$/.test(i.value)&&(a="src"),a)if("IMG"===t.tagName||"PICTURE"===t.tagName)t.setAttribute(a,i.value);else if("FIGURE"===t.tagName&&!this._getAllNodesWithTag(t,["img","picture"]).length){var c=this._doc.createElement("img");c.setAttribute(a,i.value),t.appendChild(c)}}})},_getTextDensity(t,e){var r=this._getInnerText(t,!0).length;if(0===r)return 0;var n=0,i=this._getAllNodesWithTag(t,e);return this._forEachNode(i,t=>n+=this._getInnerText(t,!0).length),n/r},_cleanConditionally(t,e){this._flagIsActive(this.FLAG_CLEAN_CONDITIONALLY)&&this._removeNodes(this._getAllNodesWithTag(t,[e]),function(t){var r=function(t){return t._readabilityDataTable},n="ul"===e||"ol"===e;if(!n){var i=0,o=this._getAllNodesWithTag(t,["ul","ol"]);this._forEachNode(o,t=>i+=this._getInnerText(t).length),n=i/this._getInnerText(t).length>.9}if("table"===e&&r(t)||this._hasAncestorTag(t,"table",-1,r)||this._hasAncestorTag(t,"code")||[...t.getElementsByTagName("table")].some(t=>t._readabilityDataTable))return!1;var s=this._getClassWeight(t);if(this.log("Cleaning Conditionally",t),s+0<0)return!0;if(this._getCharCount(t,",")<10){for(var a=t.getElementsByTagName("p").length,c=t.getElementsByTagName("img").length,l=t.getElementsByTagName("li").length-100,u=t.getElementsByTagName("input").length,h=this._getTextDensity(t,["h1","h2","h3","h4","h5","h6"]),d=0,f=this._getAllNodesWithTag(t,["object","embed","iframe"]),g=0;g<f.length;g++){for(var p=0;p<f[g].attributes.length;p++)if(this._allowedVideoRegex.test(f[g].attributes[p].value))return!1;if("object"===f[g].tagName&&this._allowedVideoRegex.test(f[g].innerHTML))return!1;d++}var m=this._getInnerText(t);if(this.REGEXPS.adWords.test(m)||this.REGEXPS.loadingWords.test(m))return!0;var y=m.length,b=this._getLinkDensity(t),T=["SPAN","LI","TD"].concat(Array.from(this.DIV_TO_P_ELEMS)),v=this._getTextDensity(t,T),_=this._hasAncestorTag(t,"figure"),A=(()=>{const t=[];return!_&&c>1&&a/c<.5&&t.push(`Bad p to img ratio (img=${c}, p=${a})`),!n&&l>a&&t.push(`Too many li's outside of a list. (li=${l} > p=${a})`),u>Math.floor(a/3)&&t.push(`Too many inputs per p. (input=${u}, p=${a})`),!n&&!_&&h<.9&&y<25&&(0===c||c>2)&&b>0&&t.push(`Suspiciously short. (headingDensity=${h}, img=${c}, linkDensity=${b})`),!n&&s<25&&b>.2+this._linkDensityModifier&&t.push(`Low weight and a little linky. (linkDensity=${b})`),s>=25&&b>.5+this._linkDensityModifier&&t.push(`High weight and mostly links. (linkDensity=${b})`),(1===d&&y<75||d>1)&&t.push(`Suspicious embed. (embedCount=${d}, contentLength=${y})`),0===c&&0===v&&t.push(`No useful content. (img=${c}, textDensity=${v})`),!!t.length&&(this.log("Checks failed",t),!0)})();if(n&&A){for(var w=0;w<t.children.length;w++)if(t.children[w].children.length>1)return A;let e=t.getElementsByTagName("li").length;if(c==e)return!1}return A}return!1})},_cleanMatchedNodes(t,e){for(var r=this._getNextNode(t,!0),n=this._getNextNode(t);n&&n!=r;)n=e.call(this,n,n.className+" "+n.id)?this._removeAndGetNext(n):this._getNextNode(n)},_cleanHeaders(t){let e=this._getAllNodesWithTag(t,["h1","h2"]);this._removeNodes(e,function(t){let e=this._getClassWeight(t)<0;return e&&this.log("Removing header with low class weight:",t),e})},_headerDuplicatesTitle(t){if("H1"!=t.tagName&&"H2"!=t.tagName)return!1;var e=this._getInnerText(t,!1);return this.log("Evaluating similarity of header:",e,this._articleTitle),this._textSimilarity(this._articleTitle,e)>.75},_flagIsActive(t){return(this._flags&t)>0},_removeFlag(t){this._flags=this._flags&~t},_isProbablyVisible:t=>(!t.style||"none"!=t.style.display)&&(!t.style||"hidden"!=t.style.visibility)&&!t.hasAttribute("hidden")&&(!t.hasAttribute("aria-hidden")||"true"!=t.getAttribute("aria-hidden")||t.className&&t.className.includes&&t.className.includes("fallback-image")),parse(){if(this._maxElemsToParse>0){var t=this._doc.getElementsByTagName("*").length;if(t>this._maxElemsToParse)throw new Error("Aborting parsing document; "+t+" elements found")}this._unwrapNoscriptImages(this._doc);var e=this._disableJSONLD?{}:this._getJSONLD(this._doc);this._removeScripts(this._doc),this._prepDocument();var r=this._getArticleMetadata(e);this._metadata=r,this._articleTitle=r.title;var n=this._grabArticle();if(!n)return null;if(this.log("Grabbed: "+n.innerHTML),this._postProcessContent(n),!r.excerpt){var i=n.getElementsByTagName("p");i.length&&(r.excerpt=i[0].textContent.trim())}var o=n.textContent;return{title:this._articleTitle,byline:r.byline||this._articleByline,dir:this._articleDir,lang:this._articleLang,content:this._serializer(n),textContent:o,length:o.length,excerpt:r.excerpt,siteName:r.siteName||this._articleSiteName,publishedTime:r.publishedTime}}},t.exports=e}({exports:{}});function nn(t,e){return t.map(t=>{const r=e.filter(e=>e._bookmark===t._id);return{...t,marksCount:r.length,notesCount:r.filter(rn).length}})}!function(t){var e={unlikelyCandidates:/-ad-|ai2html|banner|breadcrumbs|combx|comment|community|cover-wrap|disqus|extra|footer|gdpr|header|legends|menu|related|remark|replies|rss|shoutbox|sidebar|skyscraper|social|sponsor|supplemental|ad-break|agegate|pagination|pager|popup|yom-remote/i,okMaybeItsACandidate:/and|article|body|column|content|main|shadow/i};function r(t){return(!t.style||"none"!=t.style.display)&&!t.hasAttribute("hidden")&&(!t.hasAttribute("aria-hidden")||"true"!=t.getAttribute("aria-hidden")||t.className&&t.className.includes&&t.className.includes("fallback-image"))}t.exports=function(t,n={}){"function"==typeof n&&(n={visibilityChecker:n});var i={minScore:20,minContentLength:140,visibilityChecker:r};n=Object.assign(i,n);var o=t.querySelectorAll("p, pre, article"),s=t.querySelectorAll("div > br");if(s.length){var a=new Set(o);[].forEach.call(s,function(t){a.add(t.parentNode)}),o=Array.from(a)}var c=0;return[].some.call(o,function(t){if(!n.visibilityChecker(t))return!1;var r=t.className+" "+t.id;if(e.unlikelyCandidates.test(r)&&!e.okMaybeItsACandidate.test(r)||t.matches("li p"))return!1;var i=t.textContent.trim().length;return!(i<n.minContentLength)&&(c+=Math.sqrt(i-n.minContentLength))>n.minScore})}}({exports:{}}),V["feather-edit-3"],V.link,V["file-pdf"];var on=(t=>(t[t.bookmarks=ve.bookmarks]="bookmarks",t[t.marks=ve.marks]="marks",t.notes="notes",t.tag="tag",t))(on||{});function sn(t,{allMarks:e,allBookmarks:r}){const n=t.toLowerCase(),i=t=>null!=t&&t.toLowerCase().includes(n),o=t=>{if(!t.tags||0===t.tags.length)return!1;for(let e=0;e<t.tags.length;e+=1){const r=t.tags[e];if(r&&r.toLowerCase().includes(n))return!0}return!1},s=[],a=[];for(let t=0;t<e.length;t+=1){const r=e[t];r&&((i(null==r?void 0:r.text)||i(null==r?void 0:r.url)||o(r))&&s.push(r),rn(r)&&i(r.notes??"")&&a.push(r))}const c=r.filter(t=>i(null==t?void 0:t.title)||i(null==t?void 0:t.url)||o(t)),l=(t,e)=>Lr(t,e,"asc","createdAt"),u=s.slice().sort(l),h=c.slice().sort(l),d=function({allTags:t,searchValue:e,existingTags:r}){if(!Array.isArray(t))return[];const n=t.filter(t=>!(null!=r&&r.some(e=>e.toLowerCase()===t.name.toLowerCase())));if("string"!=typeof e||null==e||!e.length)return n.sort(Rr);const i=e.toLowerCase();return n.filter(t=>t.name.toLowerCase().includes(i)).map(t=>{const r=function(t,e){if(t.toLowerCase()===e.toLowerCase())return 100;if(t.toLowerCase().startsWith(e.toLowerCase()))return 90;if(t.toLowerCase().includes(e.toLowerCase()))return 70;const r=function(t,e){var r;const n=[];if(0===t.length)return e.length;if(0===e.length)return t.length;for(let r=0;r<=e.length;r++)n[r]=new Array(t.length+1).fill(0),n[r]&&(n[r][0]=r);for(let e=0;e<=t.length;e++)n[0]&&(n[0][e]=e);for(let r=1;r<=e.length;r++)for(let i=1;i<=t.length;i++)e.charAt(r-1)===t.charAt(i-1)?n[r]&&n[r-1]&&(n[r][i]=n[r-1][i-1]||0):n[r]&&n[r-1]&&(n[r][i]=Math.min((n[r-1][i-1]||0)+1,(n[r][i-1]||0)+1,(n[r-1][i]||0)+1));return(null==(r=n[e.length])?void 0:r[t.length])||0}(t.toLowerCase(),e.toLowerCase());return Math.max(50-r,0)}(t.name,e),n=t.count>=5?5:t.count%5;return{...t,matchScore:r+n}}).sort(Br)}({allTags:Vr(e,r),searchValue:n});return{marks:u,bookmarks:nn(h,e),tags:d,marksWithNotes:a}}Object.values(on),V.tag,V.blockquote,V["feather-edit-3"],V.globe;const an=t=>`getAllFromObjectStore-${t}`,cn=new class{constructor(){f(this,"dataCache",new Map),f(this,"isQueryRunning",new Map)}get db(){var t;return null==(t=Ji())?void 0:t.db}async addActionsToCache(t){const e=await this.getAllActions();let r=[...e];for(const n of t)r=e.some(t=>t.id===n.id)?r.map(t=>t.id===n.id?n:t):[...r,n];this.setInDataCache(an(we.actions),r.sort(wr))}getFromDataCache(t){const e=this.dataCache.get(t);return e?e.data:null}setInDataCache(t,e){this.dataCache.set(t,{data:e,timestamp:Date.now()})}clearDataCache(){this.dataCache.clear()}async isActionCompactionNeeded(){var t;const e=await this.getAllActions(),{UPDATE_ACTIONS_THRESHOLD:r}=!1===(null==(t=Ji())?void 0:t.environment.production)?Nr.dev:Nr.prod;return e.filter(pr).length>=r}async getAllFromObjectStore(t){var e;const r=an(t);try{if(this.isQueryRunning.get(r))return await ar(10),this.getAllFromObjectStore(t);this.isQueryRunning.set(r,!0);const n=this.getFromDataCache(r);if(n)return n;const i=null==(e=Ji())?void 0:e.db;if(!i)return[];const o=await i.getAllFromObjectStore(t);return this.setInDataCache(r,o),o}catch(t){return console.error(t),[]}finally{this.isQueryRunning.set(r,!1)}}async getAllActions(){return(await this.getAllFromObjectStore(we.actions)).sort(wr)}async getAllEntities(){try{return Sr(await this.getAllActions())}catch(t){return console.error(t),[]}}async getMarks(){return(await this.getAllEntities()).filter(Pi)}async getBookmarks(){return(await this.getAllEntities()).filter(Ri)}async getPageContents(){return(await this.getAllEntities()).filter(Gi)}async getTags(){const[t,e]=await Promise.all([this.getMarks(),this.getBookmarks()]);return Vr(t??[],e??[])}async getActionsThatNeedSync(){return(await this.getAllActions()).filter(t=>!t.lastSync)}async getSidebarCountData(){const[t,e,r,n]=await Promise.all([this.getTags(),this.getPageContents(),this.getMarks(),this.getBookmarks()]);return{tagsCount:t.length,marksCount:r.length,bookmarksCount:n.length,originsCount:Fr(n).length,imagesCount:r.filter(H).length,pageContentsCount:e.length}}async getLearningStatus(){return function(t){var e,r,n,i,o;let s=0,a=0,c=0,l=0,u=0,h=0;for(const d of t)try{if(!d.learningItem){h++;continue}if(null!=(e=d.learningItem)&&e.lastLearned&&Or(new Date((null==(r=d.learningItem)?void 0:r.lastLearned)??0))&&s++,null!=(n=d.learningItem)&&n.lastLearned&&Or(new Date((null==(i=d.learningItem)?void 0:i.lastLearned)??0),{todayOffset:-1})&&a++,null!=(o=d.learningItem)&&o.disableLearning){c++;continue}d.learningItem&&jr(d)&&l++,d.learningItem.nextReviewInMillis&&Or(new Date(d.learningItem.nextReviewInMillis),{todayOffset:1})&&u++,d.learningItem&&jr(d)}catch(t){console.error(t)}return{learntTodayCount:s,dueCount:l,unlearnedCount:h,disabledCount:c,learntYesterdayCount:a,dueTomorrowCount:u,marksToLearnCount:l+h}}(await this.getMarks())}async getAllCount(t){return(await this.getAllEntities()).filter(e=>e._objectStore===t).length}async getBookmarksWithCount(){const[t,e]=await Promise.all([this.getBookmarks(),this.getMarks()]);return function(t,e){const r=new Map;for(const t of e){const e=t._bookmark;if(!e)continue;let n=r.get(e);n||(n={marksCount:0,notesCount:0},r.set(e,n)),n.marksCount++,rn(t)&&n.notesCount++}return t.map(t=>{const e=r.get(t._id);return{...t,marksCount:(null==e?void 0:e.marksCount)??0,notesCount:(null==e?void 0:e.notesCount)??0}}).sort((t,e)=>Lr(t,e,"asc","createdAt"))}(t,e)}async getActionsCount(){return(await this.getAllActions()).length}async getMarksForBookmark(t){return(await this.getMarks()).filter(e=>e._bookmark===t._id)}async getLastHighlightedMark(){return(await this.getMarks()).sort((t,e)=>e.createdAt-t.createdAt)[0]||null}async getEntitiesForSearchValue({searchValue:t}){t=t.toLowerCase();const[e,r]=await Promise.all([this.getMarks(),this.getBookmarks()]);return sn(t,{allMarks:e,allBookmarks:r})}async getMarksForTag(t){return(await this.getMarks()).filter(e=>e.tags.some(e=>e.toLowerCase()===t.toLowerCase()))}async getMarksForDomain(t){return(await this.getMarks()).filter(e=>{var r;return(null==(r=Qe(e.url))?void 0:r.toLowerCase())===t.toLowerCase()})}async getBookmarksForTag(t){const[e,r]=await Promise.all([this.getMarks(),this.getBookmarks()]),n=r.filter(e=>e.tags.some(e=>e.toLowerCase()===t.toLowerCase()));return nn(n,e)}async getBookmarksForDomain(t){const[e,r]=await Promise.all([this.getMarks(),this.getBookmarks()]);return r.filter(e=>Qe(e.url).toLowerCase()===t.toLowerCase()).map(t=>{const r=e.filter(e=>e._bookmark===t._id);return{...t,marksCount:r.length,notesCount:r.filter(rn).length}})}async getAllOrigins(){return Fr(await this.getBookmarks()??[])}async getUnReachablePageContents(){const[t,e]=await Promise.all([this.getPageContents(),this.getBookmarks()]);return function({allPageContents:t,allBookmarks:e}){return t.filter(r=>(t=>!e.some(e=>or(e.url,t.url)))(r)||(e=>t.some(t=>or(t.url,e.url)&&t.createdAt>e.createdAt))(r))}({allPageContents:t,allBookmarks:e})}async getBookmarkForUrl({currentUrl:t,canonicalLink:e,asin:r}){return(await this.getBookmarks()).find(n=>r?function(t){return"kindle"===(null==t?void 0:t.type)}(n)&&n.asin===r:function(t,e,r){var n,i;if(!He(e)&&!He(t.url)){const e=rr();if(r&&t.canonicalLink&&!e)return(null==r?void 0:r.toLowerCase())===(null==(n=t.canonicalLink)?void 0:n.toLowerCase());if((null==r?void 0:r.toLowerCase())===(null==(i=t.url)?void 0:i.toLowerCase()))return!0}return or(null==t?void 0:t.url,e)}(n,t,e))??null}async getPageContentForUrl(t){var e,r;return(null==(r=null==(e=(await this.getPageContents()).filter(e=>or(e.url,t.url)))?void 0:e.sort((t,e)=>e.createdAt-t.createdAt))?void 0:r[0])||null}async getContentEntitiesThatNeedSync(){var t;try{return(null==(t=this.db)?void 0:t.getContentEntitiesThatNeedSync())||[]}catch(t){return console.error(t),[]}}async getEntityById(t){const e=await this.getAllEntities();return Array.isArray(e)&&e.length?e.find(e=>e._id===t._id):null}async getBookmark(t){return this.getEntityById({_id:t._id})}async getBackupData(){const t=await this.getAllEntities(),e=t.filter(Pi),r=t.filter(Ri),n=t.filter(Bi),i=t.filter(Gi),o=t.filter(Ui);return{marks:e,bookmarks:r,chromeSettings:n[0]||Se,pagecontents:i,aichats:o}}async getAiChats(){return(await this.getAllEntities()).filter(Ui)}async getAiChatByReferenceId(t){return(await this.getAiChats()).find(e=>e._referenceId===t)??null}async getPageContentSizeUsedInBytes(){return(await this.getPageContents()).reduce((t,e)=>t+e.length,0)}async getAllActionsForEntityType(t){return(await this.getAllActions()).filter(e=>e.entityType===t)}async getContentEntities(t){var e;return(null==(e=this.db)?void 0:e.getContentEntities(t))??[]}async getContentEntity(t){var e;return(null==(e=this.db)?void 0:e.getContentEntity(t))??null}},ln=new class{constructor(t){this.dbQueries=t}get db(){var t;const e=null==(t=Ji())?void 0:t.db;return e||console.error("Db not found in DbActions"),e}clearDataCache(){this.dbQueries.clearDataCache()}async clearDatabases(){var t;await(null==(t=this.db)?void 0:t.clearDatabases()),this.clearDataCache()}async importBackupData(t,e){if(!function(t){return!(null===t||"object"!=typeof t||!Array.isArray(null==t?void 0:t.bookmarks)||!Array.isArray(null==t?void 0:t.marks)||typeof t.chromeSettings>"u")}(t))throw new Error("Invalid import backup data");const r=await this.dbQueries.getAllActions(),n=await this.dbQueries.getAllEntities();try{const r=function(t){const e=function({marks:t,bookmarks:e,chromeSettings:r,pagecontents:n,aichats:i}){return{bookmarks:e.map(Cr),marks:t.map(Cr),chromeSettings:Cr(r),pagecontents:(null==n?void 0:n.map(Cr))??[],aichats:(null==i?void 0:i.map(Cr))??[]}}(t);return{bookmarks:e.bookmarks.map(ji),marks:e.marks.map(Mi),chromeSettings:Fi(e.chromeSettings),pagecontents:(e.pagecontents??[]).map($i),aichats:(e.aichats??[]).map(Hi)}}(t),i=[...r.bookmarks,...r.marks,...r.pagecontents??[],...r.aichats??[]],o=[...r.pagecontents??[],...r.aichats??[]].map(t=>Wr(t)).filter(dr)??[],s=Ir(i);if(await Promise.all([this.createOrUpdateContents(o),this.createOrUpdateActions(s),un(t.chromeSettings)]),null!=e&&e.removeExistingData){const t=n.filter(t=>!i.some(e=>e._id===t._id));await this.createEntityDeleteActions(t.map(t=>({entityType:t._objectStore,entityId:t._id,userId:t._user})))}}catch(t){console.log(t),hn({content:"Something went wrong, restoring old data...",variant:"error",uniqueId:"general-error"}),await this.createOrUpdateActions(r)}}async createEntityCreateAction(t){const e=t.map(vr).filter(dr);await this.createOrUpdateActions(e)}async createEntityUpdateAction(t){const e=t.map(_r).filter(dr);await this.createOrUpdateActions(e)}async createEntityDeleteActions(t){const e=t.map(Ar);await this.createOrUpdateActions(e)}async markEntitiesAsDeleted({entityType:t,entities:e}){const r=await j();await this.createEntityDeleteActions(e.map(e=>({entityType:t,entityId:e._id,userId:null==r?void 0:r._id})))}async createOrUpdateEntities({entityType:t,entities:e}){if(_e(t)){if(_e(t)){const r=await j(),n=Sr(await this.dbQueries.getAllActionsForEntityType(t)),i=e.filter(t=>!n.some(e=>e._id===t._id)),o=i.map(t=>({entity:t,userId:null==r?void 0:r._id})),s=e.filter(t=>n.some(e=>e._id===t._id)),a=s.map(e=>{const i=n.find(t=>t._id===e._id);return i?{entityType:t,entityId:e._id,updates:e,previousValues:i,userId:null==r?void 0:r._id}:null}).filter(dr),c=[...i,...s].map(t=>Vi(t)?Wr(t):null).filter(dr);await Promise.allSettled([this.createEntityCreateAction(o),this.createEntityUpdateAction(a),this.createOrUpdateContents(c)])}}else console.warn(`Entity type {${t}} is not syncable!`)}async createOrUpdateActions(t){var e;await(null==(e=this.db)?void 0:e.createOrUpdateActions(t)),await this.dbQueries.addActionsToCache(t),await this.dbQueries.isActionCompactionNeeded()&&await this.runActionCompaction()}async runActionCompaction(){var t,e,r;const n=function(t,{UPDATE_ACTIONS_THRESHOLD:e,COMPACTION_AMOUNT:r}){const n=t.sort(wr),i=n.filter(pr);if(i.length<e)return{compactedCreateActions:[],deletedUpdateActionIds:[]};const o=n.filter(gr),s=new Map,a=i.slice(0,r),c=[];for(const t of a){const e=s.get(t.entityId)||o.find(e=>e.entityId===t.entityId);e&&(c.push(t.id),s.set(t.entityId,{...e,timestamp:e.timestamp>t.timestamp?e.timestamp:t.timestamp,payload:{...e.payload,...t.payload}}))}return{compactedCreateActions:Array.from(s.values()).sort(wr),deletedUpdateActionIds:c}}(await this.dbQueries.getAllActions(),!1===(null==(t=Ji())?void 0:t.environment.production)?Nr.dev:Nr.prod);n.compactedCreateActions.length&&await(null==(e=this.db)?void 0:e.createOrUpdateActions(n.compactedCreateActions)),n.deletedUpdateActionIds.length&&await(null==(r=this.db)?void 0:r.deleteActionsInTransaction(n.deletedUpdateActionIds)),this.clearDataCache()}async deleteDataFromOtherUsers(){var t,e;const r=await j();if(!r)return{deletedActions:0};const n=(await(null==(t=this.db)?void 0:t.getAllUniqueUserIds())??[]).filter(t=>t!==r._id);if(0===n.length)return{deletedActions:0};this.clearDataCache();const i=await Ce.getChromeSettings();null!=i&&i._user&&i._user!==r._id&&await Ce.updateChromeSettings(Se);const o=[];for(const t of n){const r=await(null==(e=this.db)?void 0:e.getActionIdsForUser(t))??[];o.push(...r)}return await this.deleteActionsInTransaction(o),this.clearDataCache(),{deletedActions:o.length}}async createOrUpdateContents(t){var e;await(null==(e=this.db)?void 0:e.createOrUpdateContents(t))}async deleteActionsInTransaction(t){var e;t.length&&(await(null==(e=this.db)?void 0:e.deleteActionsInTransaction(t)),this.clearDataCache())}async deleteActions(t){t.length&&(await this.deleteActionsInTransaction(t.map(t=>t.id)),this.clearDataCache())}async doMigration(t){var e,r,n,i;try{if(!await(null==(e=this.db)?void 0:e.dbHasDeprecatedObjectStores()))return;const o=await(null==(r=this.db)?void 0:r.getAllEntitiesFromDeprecatedObjectStores());if(null==o||!o.length)return;const s=await this.dbQueries.getAllEntities(),a=o.filter(t=>!s.some(e=>e._id===t._id)),c=await(null==(n=this.db)?void 0:n.getDeprecatedChromeSettings());c&&await Ce.updateChromeSettings(c);const l=Ir(a);await this.createOrUpdateActions(l);const u=a.map(t=>Vi(t)?Wr(t):null).filter(dr);await this.createOrUpdateContents(u),this.clearDataCache();const h=await this.dbQueries.getAllEntities();await(null==(i=this.db)?void 0:i.runMigrationGarbageCollector(h)),await t.chromeSyncService.executeSyncPromise(),this.clearDataCache()}catch(t){console.error("Error during migration:",t)}}}(cn);async function un(t,e={}){const{chromeSyncService:r}=Yi(),n=await Ce.updateChromeSettings(t,e);typeof t.preferredColorMode<"u"&&M(t.preferredColorMode),eo.dispatch("updatedChromeSettings",{detail:n}),r.executeSync()}function hn(t){(function(){let t=document.querySelector(Xr.Toasts.TAG);t||(t=document.createElement(Xr.Toasts.TAG),document.body.append(t))})(),setTimeout(()=>{eo.dispatch("showToast",{detail:t})},0)}function dn(t){Zr([Xr.Dialog.TAG],{lazy:!1});const e=Xr.Dialog.TAG;let r=document.querySelector(Xr.Dialog.TAG);t.keepCurrentDialog&&(r=null);const n=!!r;return r||(r=document.createElement(e)),r.props=t,r.props.onDialogClosed=e=>{null==r||r.remove(),t.dialogClosedCallback&&t.dialogClosedCallback(e)},n||document.body.append(r),r}function fn(t){t.length&&dn({dialogName:"delete-entity-list",options:{closable:!0,props:{actions:t,alertOptions:{icon:V.info,title:"Some of your content is too large to sync",variant:"warning",text:"Some of your highlights or pages are too large to sync. That means they are not synced to your account \n          and will not be available on other devices and in the web app. \n          You can keep them to use them locally or delete them here."}}}})}V.notion,V.smartphone,V["copy-file"],V.capacities,V.weava,V.diigo,V.pocket,V.pocket,V.bookmark;function gn(t){var e,r,n,i,o,s;if(!t)return $r.OFFLINE;const a=(new Date).getTime(),c=((null==(e=t.userPlan)?void 0:e.expiresDateMillis)??0)>a,l=typeof t.premium>"u"&&typeof(null==(r=t.userPlan)?void 0:r.subscription_id)>"u",u=null==(n=t.userPlan)?void 0:n.type;if(t.premium||l)return c&&u===$r.ULTIMATE?$r.ULTIMATE:$r.PREMIUM;if(c&&t.userPlan&&u){const e=u===$r.PREMIUM&&t.userPlan.expiresDateMillis<17110656e5&&!(null!=(i=t.userPlan)&&i.subscription_id),r=u===$r.PREMIUM&&72580284e5===t.userPlan.expiresDateMillis&&!(null!=(o=t.userPlan)&&o.subscription_id);return e||r?$r.ULTIMATE:u}return(null==(s=t.userPlan)?void 0:s.type)===$r.FREE_TRIAL&&t.userPlan.expiresDateMillis>a?$r.FREE_TRIAL:$r.FREE}function pn(t,e){return yn(t,{activeUserPlan:gn(e??null),user:e})}const mn=1679745752934;function yn(t,{activeUserPlan:e,user:r}){return!(!function(t,e){return"sync"===t&&1675008111780===(null==e?void 0:e.createdAt)}(t,r)&&"backup"!==t&&e!==$r.FREE_TRIAL&&e!==$r.ULTIMATE&&("sync"===t?!function(t){var e,r,n;return(null==(e=null==t?void 0:t.userPlan)?void 0:e.type)!==$r.PREMIUM&&(null==(r=null==t?void 0:t.userPlan)?void 0:r.type)!==$r.ULTIMATE&&((null==(n=null==t?void 0:t.userPlan)?void 0:n.type)&&t.userPlan.expiresDateMillis<mn||(null==t?void 0:t.createdAt)&&t.createdAt<mn)}(r)&&e!==$r.PREMIUM:"share"!==t||e!==$r.PREMIUM))}const bn=new class extends L{constructor(){super(C)}get chromeStorageIsAvailable(){return Ne()}async getJwt(){return this.chromeStorageIsAvailable?Ce.getValue(C):super.getJwt()}async getJwtPayload(){try{return k(await this.getJwt())??void 0}catch{return}}async getActivePlan(){return gn(await this.getJwtPayload()??null)}async canSync(){const t=await this.getJwtPayload();return!!t&&pn("sync",t)}async canGenerateUnlimitedAiSummary(){const t=await this.getJwtPayload();return!!t&&pn("unlimited-ai-summary",t)}async canGenerateUnlimitedYoutubeVideo(){const t=await this.getJwtPayload();return!!t&&pn("unlimited-youtube-video",t)}async canGenerateUnlimitedAiChats(){const t=await this.getJwtPayload();return!!t&&pn("unlimited-ai-chats",t)}async isLoggedIn(){return!!await this.getJwtPayload()}setJwt(t){this.chromeStorageIsAvailable?Ce.setValue("jwt_webmarker",t):super.setJwt(t)}},Tn="entityId",vn="entityType",_n="timestamp",An="_user",wn="entityId",En="contentType",Sn="entityType",In="needsSync",Nn=[Ae.marks,Ae.bookmarks,Ae.chromesettings,Ae.pagecontents,Ae.aichats];var On=function(t,e){return On=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},On(t,e)};function Cn(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}On(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function kn(t,e){var r,n,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function Ln(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Dn(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s}function xn(t,e,r){if(r||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)(n||!(i in e))&&(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))}function Pn(t){return this instanceof Pn?(this.v=t,this):new Pn(t)}function Rn(t){return"function"==typeof t}function Bn(t){var e=t(function(t){Error.call(t),t.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var Gn=Bn(function(t){return function(e){t(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map(function(t,e){return e+1+") "+t.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}});function Un(t,e){if(t){var r=t.indexOf(e);0<=r&&t.splice(r,1)}}var Mn=function(){function t(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var t,e,r,n,i;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var s=Ln(o),a=s.next();!a.done;a=s.next())a.value.remove(this)}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}else o.remove(this);var c=this.initialTeardown;if(Rn(c))try{c()}catch(t){i=t instanceof Gn?t.errors:[t]}var l=this._finalizers;if(l){this._finalizers=null;try{for(var u=Ln(l),h=u.next();!h.done;h=u.next()){var d=h.value;try{$n(d)}catch(t){i=i??[],t instanceof Gn?i=xn(xn([],Dn(i)),Dn(t.errors)):i.push(t)}}}catch(t){r={error:t}}finally{try{h&&!h.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}}if(i)throw new Gn(i)}},t.prototype.add=function(e){var r;if(e&&e!==this)if(this.closed)$n(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(r=this._finalizers)&&void 0!==r?r:[]).push(e)}},t.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},t.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},t.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&Un(e,t)},t.prototype.remove=function(e){var r=this._finalizers;r&&Un(r,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}(),jn=Mn.EMPTY;function Fn(t){return t instanceof Mn||t&&"closed"in t&&Rn(t.remove)&&Rn(t.add)&&Rn(t.unsubscribe)}function $n(t){Rn(t)?t():t.unsubscribe()}function Hn(t){!function(t,e){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];setTimeout.apply(void 0,xn([t,e],Dn(r)))}(function(){throw t})}function Wn(){}function Vn(t){t()}var qn=function(t){function e(e){var r=t.call(this)||this;return r.isStopped=!1,e?(r.destination=e,Fn(e)&&e.add(r)):r.destination=Jn,r}return Cn(e,t),e.create=function(t,e,r){return new Kn(t,e,r)},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(Mn),zn=function(){function t(t){this.partialObserver=t}return t.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(t){Yn(t)}},t.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(t){Yn(t)}else Yn(t)},t.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(t){Yn(t)}},t}(),Kn=function(t){function e(e,r,n){var i,o=t.call(this)||this;return i=Rn(e)||!e?{next:e??void 0,error:r??void 0,complete:n??void 0}:e,o.destination=new zn(i),o}return Cn(e,t),e}(qn);function Yn(t){Hn(t)}var Jn={closed:!0,next:Wn,error:function(t){throw t},complete:Wn},Xn="function"==typeof Symbol&&Symbol.observable||"@@observable";function Zn(t){return t}var Qn=function(){function t(t){t&&(this._subscribe=t)}return t.prototype.lift=function(e){var r=new t;return r.source=this,r.operator=e,r},t.prototype.subscribe=function(t,e,r){var n=this,i=function(t){return t&&t instanceof qn||function(t){return t&&Rn(t.next)&&Rn(t.error)&&Rn(t.complete)}(t)&&Fn(t)}(t)?t:new Kn(t,e,r);return Vn(function(){var t=n,e=t.operator,r=t.source;i.add(e?e.call(i,r):r?n._subscribe(i):n._trySubscribe(i))}),i},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},t.prototype.forEach=function(t,e){var r=this;return new(e=ti(e))(function(e,n){var i=new Kn({next:function(e){try{t(e)}catch(t){n(t),i.unsubscribe()}},error:n,complete:e});r.subscribe(i)})},t.prototype._subscribe=function(t){var e;return null===(e=this.source)||void 0===e?void 0:e.subscribe(t)},t.prototype[Xn]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(t){return 0===t.length?Zn:1===t.length?t[0]:function(e){return t.reduce(function(t,e){return e(t)},e)}}(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=ti(t))(function(t,r){var n;e.subscribe(function(t){return n=t},function(t){return r(t)},function(){return t(n)})})},t.create=function(e){return new t(e)},t}();function ti(t){var e;return null!==(e=t??undefined)&&void 0!==e?e:Promise}function ei(t){return function(e){if(function(t){return Rn(null==t?void 0:t.lift)}(e))return e.lift(function(e){try{return t(e,this)}catch(t){this.error(t)}});throw new TypeError("Unable to lift unknown Observable type")}}function ri(t,e,r,n,i){return new ni(t,e,r,n,i)}var ni=function(t){function e(e,r,n,i,o,s){var a=t.call(this,e)||this;return a.onFinalize=o,a.shouldUnsubscribe=s,a._next=r?function(t){try{r(t)}catch(t){e.error(t)}}:t.prototype._next,a._error=i?function(t){try{i(t)}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._error,a._complete=n?function(){try{n()}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._complete,a}return Cn(e,t),e.prototype.unsubscribe=function(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;t.prototype.unsubscribe.call(this),!r&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}},e}(qn),ii=Bn(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),oi=function(t){function e(){var e=t.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return Cn(e,t),e.prototype.lift=function(t){var e=new si(this,this);return e.operator=t,e},e.prototype._throwIfClosed=function(){if(this.closed)throw new ii},e.prototype.next=function(t){var e=this;Vn(function(){var r,n;if(e._throwIfClosed(),!e.isStopped){e.currentObservers||(e.currentObservers=Array.from(e.observers));try{for(var i=Ln(e.currentObservers),o=i.next();!o.done;o=i.next())o.value.next(t)}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}}})},e.prototype.error=function(t){var e=this;Vn(function(){if(e._throwIfClosed(),!e.isStopped){e.hasError=e.isStopped=!0,e.thrownError=t;for(var r=e.observers;r.length;)r.shift().error(t)}})},e.prototype.complete=function(){var t=this;Vn(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var e=t.observers;e.length;)e.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(e){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var e=this,r=this,n=r.hasError,i=r.isStopped,o=r.observers;return n||i?jn:(this.currentObservers=null,o.push(t),new Mn(function(){e.currentObservers=null,Un(o,t)}))},e.prototype._checkFinalizedStatuses=function(t){var e=this,r=e.hasError,n=e.thrownError,i=e.isStopped;r?t.error(n):i&&t.complete()},e.prototype.asObservable=function(){var t=new Qn;return t.source=this,t},e.create=function(t,e){return new si(t,e)},e}(Qn),si=function(t){function e(e,r){var n=t.call(this)||this;return n.destination=e,n.source=r,n}return Cn(e,t),e.prototype.next=function(t){var e,r;null===(r=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===r||r.call(e,t)},e.prototype.error=function(t){var e,r;null===(r=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===r||r.call(e,t)},e.prototype.complete=function(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)},e.prototype._subscribe=function(t){var e,r;return null!==(r=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==r?r:jn},e}(oi),ai=function(){return Date.now()},ci=function(t){function e(e,r){return t.call(this)||this}return Cn(e,t),e.prototype.schedule=function(t,e){return this},e}(Mn),li=function(t){function e(e,r){var n=t.call(this,e,r)||this;return n.scheduler=e,n.work=r,n.pending=!1,n}return Cn(e,t),e.prototype.schedule=function(t,e){var r;if(void 0===e&&(e=0),this.closed)return this;this.state=t;var n=this.id,i=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(i,n,e)),this.pending=!0,this.delay=e,this.id=null!==(r=this.id)&&void 0!==r?r:this.requestAsyncId(i,this.id,e),this},e.prototype.requestAsyncId=function(t,e,r){return void 0===r&&(r=0),function(t,e){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return setInterval.apply(void 0,xn([t,e],Dn(r)))}(t.flush.bind(t,this),r)},e.prototype.recycleAsyncId=function(t,e,r){if(void 0===r&&(r=0),null!=r&&this.delay===r&&!1===this.pending)return e;null!=e&&function(t){clearInterval(t)}(e)},e.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var r=this._execute(t,e);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,e){var r,n=!1;try{this.work(t)}catch(t){n=!0,r=t||new Error("Scheduled action threw falsy error")}if(n)return this.unsubscribe(),r},e.prototype.unsubscribe=function(){if(!this.closed){var e=this.id,r=this.scheduler,n=r.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Un(n,this),null!=e&&(this.id=this.recycleAsyncId(r,e,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(ci),ui=function(){function t(e,r){void 0===r&&(r=t.now),this.schedulerActionCtor=e,this.now=r}return t.prototype.schedule=function(t,e,r){return void 0===e&&(e=0),new this.schedulerActionCtor(this,t).schedule(r,e)},t.now=ai,t}(),hi=function(t){function e(e,r){void 0===r&&(r=ui.now);var n=t.call(this,e,r)||this;return n.actions=[],n._active=!1,n}return Cn(e,t),e.prototype.flush=function(t){var e=this.actions;if(this._active)e.push(t);else{var r;this._active=!0;do{if(r=t.execute(t.state,t.delay))break}while(t=e.shift());if(this._active=!1,r){for(;t=e.shift();)t.unsubscribe();throw r}}},e}(ui),di=new hi(li);var fi=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function gi(t){return Rn(null==t?void 0:t.then)}function pi(t){return Rn(t[Xn])}function mi(t){return Symbol.asyncIterator&&Rn(null==t?void 0:t[Symbol.asyncIterator])}function yi(t){return new TypeError("You provided "+(null!==t&&"object"==typeof t?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var bi="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function Ti(t){return Rn(null==t?void 0:t[bi])}function vi(t){return function(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(t,e||[]),o=[];return n=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",function(t){return function(e){return Promise.resolve(e).then(t,l)}}),n[Symbol.asyncIterator]=function(){return this},n;function s(t,e){i[t]&&(n[t]=function(e){return new Promise(function(r,n){o.push([t,e,r,n])>1||a(t,e)})},e&&(n[t]=e(n[t])))}function a(t,e){try{!function(t){t.value instanceof Pn?Promise.resolve(t.value.v).then(c,l):u(o[0][2],t)}(i[t](e))}catch(t){u(o[0][3],t)}}function c(t){a("next",t)}function l(t){a("throw",t)}function u(t,e){t(e),o.shift(),o.length&&a(o[0][0],o[0][1])}}(this,arguments,function(){var e,r,n;return kn(this,function(i){switch(i.label){case 0:e=t.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,Pn(e.read())];case 3:return r=i.sent(),n=r.value,r.done?[4,Pn(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return[4,Pn(n)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function _i(t){return Rn(null==t?void 0:t.getReader)}function Ai(t){if(t instanceof Qn)return t;if(null!=t){if(pi(t))return function(t){return new Qn(function(e){var r=t[Xn]();if(Rn(r.subscribe))return r.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(t);if(fi(t))return function(t){return new Qn(function(e){for(var r=0;r<t.length&&!e.closed;r++)e.next(t[r]);e.complete()})}(t);if(gi(t))return function(t){return new Qn(function(e){t.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,Hn)})}(t);if(mi(t))return wi(t);if(Ti(t))return function(t){return new Qn(function(e){var r,n;try{for(var i=Ln(t),o=i.next();!o.done;o=i.next()){var s=o.value;if(e.next(s),e.closed)return}}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}e.complete()})}(t);if(_i(t))return function(t){return wi(vi(t))}(t)}throw yi(t)}function wi(t){return new Qn(function(e){(function(t,e){var r,n,i,o;return function(t,e,r,n){return new(r||(r=Promise))(function(i,o){function s(t){try{c(n.next(t))}catch(t){o(t)}}function a(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){t.done?i(t.value):function(t){return t instanceof r?t:new r(function(e){e(t)})}(t.value).then(s,a)}c((n=n.apply(t,e||[])).next())})}(this,void 0,void 0,function(){var s,a;return kn(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),r=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t=Ln(t),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(e){return new Promise(function(n,i){!function(t,e,r,n){Promise.resolve(n).then(function(e){t({value:e,done:r})},e)}(n,i,(e=t[r](e)).done,e.value)})}}}(t),c.label=1;case 1:return[4,r.next()];case 2:if((n=c.sent()).done)return[3,4];if(s=n.value,e.next(s),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),i={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),n&&!n.done&&(o=r.return)?[4,o.call(r)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})})(t,e).catch(function(t){return e.error(t)})})}function Ei(t,e,r,n,i){void 0===n&&(n=0),void 0===i&&(i=!1);var o=e.schedule(function(){r(),i?t.add(this.schedule(null,n)):this.unsubscribe()},n);if(t.add(o),!i)return o}function Si(t,e){return void 0===e&&(e=0),ei(function(r,n){r.subscribe(ri(n,function(r){return Ei(n,t,function(){return n.next(r)},e)},function(){return Ei(n,t,function(){return n.complete()},e)},function(r){return Ei(n,t,function(){return n.error(r)},e)}))})}function Ii(t,e){return void 0===e&&(e=0),ei(function(r,n){n.add(t.schedule(function(){return r.subscribe(n)},e))})}function Ni(t,e){if(!t)throw new Error("Iterable cannot be null");return new Qn(function(r){Ei(r,e,function(){var n=t[Symbol.asyncIterator]();Ei(r,e,function(){n.next().then(function(t){t.done?r.complete():r.next(t.value)})},0,!0)})})}function Oi(t,e,r){return void 0===r&&(r=1/0),Rn(e)?Oi(function(r,n){return function(t){return ei(function(e,r){var n=0;e.subscribe(ri(r,function(e){r.next(t.call(undefined,e,n++))}))})}(function(t,i){return e(r,t,n,i)})(Ai(t(r,n)))},r):("number"==typeof e&&(r=e),ei(function(e,n){return function(t,e,r,n){var i=[],o=0,s=0,a=!1,c=function(){a&&!i.length&&!o&&e.complete()},l=function(t){o++;var a=!1;Ai(r(t,s++)).subscribe(ri(e,function(t){e.next(t)},function(){a=!0},void 0,function(){if(a)try{o--;for(var t=function(){var t=i.shift();l(t)};i.length&&o<n;)t();c()}catch(t){e.error(t)}}))};return t.subscribe(ri(e,function(t){return o<n?l(t):i.push(t)},function(){a=!0,c()})),function(){}}(e,n,t,r)}))}function Ci(){return Oi(Zn,1)}function ki(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Ci()(function(t,e){return e?function(t,e){if(null!=t){if(pi(t))return function(t,e){return Ai(t).pipe(Ii(e),Si(e))}(t,e);if(fi(t))return function(t,e){return new Qn(function(r){var n=0;return e.schedule(function(){n===t.length?r.complete():(r.next(t[n++]),r.closed||this.schedule())})})}(t,e);if(gi(t))return function(t,e){return Ai(t).pipe(Ii(e),Si(e))}(t,e);if(mi(t))return Ni(t,e);if(Ti(t))return function(t,e){return new Qn(function(r){var n;return Ei(r,e,function(){n=t[bi](),Ei(r,e,function(){var t,e,i;try{e=(t=n.next()).value,i=t.done}catch(t){return void r.error(t)}i?r.complete():r.next(e)},0,!0)}),function(){return Rn(null==n?void 0:n.return)&&n.return()}})}(t,e);if(_i(t))return function(t,e){return Ni(vi(t),e)}(t,e)}throw yi(t)}(t,e):Ai(t)}(t,function(t){return function(t){return t&&Rn(t.schedule)}(function(t){return t[t.length-1]}(t))?t.pop():void 0}(t)))}class Li extends Error{constructor(t){super(t),this.name="PayloadTooLargeError"}}function Di(t){return t instanceof Li}function xi(t){return new Set(t.map(t=>t.entityId)).size}function Pi(t){return t._objectStore===ve.marks}function Ri(t){return t._objectStore===ve.bookmarks}function Bi(t){return t._objectStore===ve.chromesettings}function Gi(t){return t._objectStore===ve.pagecontents}function Ui(t){return t._objectStore===ve.aichats}function Mi(t){return Wi(t,ve.marks)}function ji(t){return Wi(t,ve.bookmarks)}function Fi(t){return Wi(t,ve.chromesettings)}function $i(t){return Wi(t,ve.pagecontents)}function Hi(t){return Wi(t,ve.aichats)}function Wi(t,e){return{...t,_objectStore:e}}function Vi(t){return Ui(t)||Gi(t)}function qi(t,e){const{_id:r,_user:n,_objectStore:i,...o}=t,s=o;return e===ve.aichats?{...s,messages:void 0}:e===ve.pagecontents?{...s,content:void 0}:s}f(class t{constructor(t){f(this,"executeSyncInProgress",!1),f(this,"serverSyncInProgress",!1),f(this,"_chromeSyncStatus",{chromeSyncState:"OFFLINE",actionsThatNeedSync:[],unsyncedEntitiesCount:0}),f(this,"areAllServersOffline",!1),f(this,"executeSyncSubscription$"),f(this,"executeSync$",new oi),f(this,"isContentSyncInProgress",!1),this.options=t,this.startExecuteSyncDebouncer(),this.executeSync()}get chromeSyncStatus(){return this._chromeSyncStatus}set setChromeSyncStatus(t){eo.dispatch("chromeSyncStatusChanged",{detail:t}),this._chromeSyncStatus=t}async getCurrentUser(){return bn.getJwtPayload()}async resolveChromeSyncState({numberOfActionsThatNeedSync:t}){const e=await this.getCurrentUser();if(!e)return"OFFLINE";const r=gn(e);return this.serverSyncInProgress?"UPDATING":this.areAllServersOffline?"ALL_SERVERS_OFFLINE":r===$r.OFFLINE?"OFFLINE":0===t?"UP_TO_DATE":"SERVER_ERROR"===this.chromeSyncStatus.chromeSyncState?"SERVER_ERROR":yn("sync",{activeUserPlan:r,user:e??null})?"NEEDS_SYNC":"PREMIUM_REQUIRED"}async readChromeSyncStatus(){const t=await cn.getActionsThatNeedSync();return{chromeSyncState:await this.resolveChromeSyncState({numberOfActionsThatNeedSync:(null==t?void 0:t.length)??0}),actionsThatNeedSync:t??[],unsyncedEntitiesCount:xi(t)}}async executeSyncPromise(){return new Promise(t=>{this.executeSync(()=>{t()})})}startExecuteSyncDebouncer(){this.executeSyncSubscription$&&(this.executeSyncSubscription$.unsubscribe(),this.executeSyncSubscription$=void 0),this.executeSyncSubscription$=ki(this.executeSync$.pipe(function(t,e){return void 0===e&&(e=di),ei(function(t,r){var n=null,i=null,o=null,s=function(){if(n){n.unsubscribe(),n=null;var t=i;i=null,r.next(t)}};function a(){var t=o+200,i=e.now();if(i<t)return n=this.schedule(void 0,t-i),void r.add(n);s()}t.subscribe(ri(r,function(t){i=t,o=e.now(),n||(n=e.schedule(a,200),r.add(n))},function(){s(),r.complete()},void 0,function(){i=n=null}))})}())).subscribe(t=>{this.runSync(t)})}executeSync(t){this.executeSync$.next({callback:t})}runSync({callback:t}){if(this.executeSyncInProgress)this.executeSync$.next({callback:t});else{this.executeSyncInProgress=!0;try{const e=e=>{t&&t(),this.executeSyncInProgress=!1,this.readChromeSyncStatus().then(t=>{e&&(t.chromeSyncState=e),this.setChromeSyncStatus=t,this.checkForBackupOrSyncDialog()}),this.runChromeSettingsSync(),this.runContentSync()};this.readChromeSyncStatus().then(async t=>{this.setChromeSyncStatus=t;const{chromeSyncState:r,actionsThatNeedSync:n}=t;if("OFFLINE"!==r&&"UP_TO_DATE"!==r&&"PREMIUM_REQUIRED"!==r){n.length&&(this.setChromeSyncStatus={...this.chromeSyncStatus,chromeSyncState:"UPDATING"});try{const t=await this.getCurrentUser();if(!t)throw new Error("Can not sync because user is not signed in.");let r=0;const i=20,o=(null==n?void 0:n.length)>i,s=async(e,s,a=i)=>{if(e=e.filter(t=>!t.isTooLargeToSync),!e.length)return;const c=Math.ceil(e.length/a),l=[],u=async e=>{try{await s(e),await this.updateActionsAfterSync(e,t)}catch(t){throw t}};for(let t=0;t<c;t++){const i=async()=>{const i=t*a,s=i+a,c=e.slice(i,s),l=10*t;await ar(l);try{await u(c)}catch(t){if(!Di(t))throw t;for(const t of c)try{await u([t])}catch(e){if(!Di(e))throw e;t.isTooLargeToSync=!0}}o&&(r=Math.min(r+a,n.length),eo.dispatch("chromeSyncProgress",{detail:{current:r,of:n.length}}));const h=e.filter(t=>t.isTooLargeToSync);h.length&&(hn({content:"Content is too large to sync. Click to review.",variant:"error",uniqueId:"too-large-payload",duration:1e4,onContentClick:()=>{fn(this.chromeSyncStatus.actionsThatNeedSync.filter(t=>t.isTooLargeToSync))}}),await ln.createOrUpdateActions(h))};l.push(i)}await Promise.all(l.map(t=>t()))};o&&eo.dispatch("chromeSyncProgress",{detail:{current:1,of:n.length}}),await s(n,t=>this.options.httpFacade.syncActions({actions:t})),eo.dispatch("chromeSyncProgress",{detail:{current:n.length,of:n.length}}),this.updateLastSync(),e()}catch(t){console.error("Error during executeSync",t),(t=>401===(null==t?void 0:t.statusCode))(t)&&(await async function(){await bn.getJwtPayload()&&(eo.dispatch("loginNeeded",{detail:{authType:"signIn"}}),hn({content:"Your token expired. Please login again.",variant:"warn",uniqueId:"token-expired",duration:1e4}))}(),eo.dispatch("loggedOut",{detail:null})),e("SERVER_ERROR")}}else e()})}catch(t){console.error(t)}}}async runContentSync(){if(this.isContentSyncInProgress)setTimeout(async()=>{await this.runContentSync()},100);else try{if(this.isContentSyncInProgress=!0,!await bn.canSync())return;const t=await cn.getContentEntitiesThatNeedSync();for(const e of t)try{await this.options.httpFacade.createContent(e),e.needsSync=0,await ln.createOrUpdateContents([e])}catch(t){Di(t)&&(e.needsSync=0,e.isPayloadTooLargeToSync=!0,await ln.createOrUpdateContents([e])),console.error("Error during 'runContentSync'",t)}}catch(t){console.error("Error during 'runContentSync'",t)}finally{this.isContentSyncInProgress=!1}}async runChromeSettingsSync(){if(!await bn.canSync())return;const t=await Ce.getChromeSettings();t.needsSync&&(await this.options.httpFacade.updateChromeStorage(t),t.needsSync=!1,await un(t,{skipSync:!0}))}async updateAreAllServersOffline({areAllServersOffline:t}){return this.areAllServersOffline=t,this.updateChromeSyncState()}updateLastSync(t=Date.now()){this.options.lastSyncDateInMillis!==t&&(this.options={...this.options,lastSyncDateInMillis:t},Ce.setValue("lastSyncDateInMillis",t))}async addServerActionsIntoLocalDb(t){const e=await this.getCurrentUser();if(e)try{t.length&&(await ln.createOrUpdateActions(t.map(t=>({...t,lastSync:Date.now(),_user:e._id}))),cn.clearDataCache()),this.executeSync()}catch(t){console.error(t)}finally{this.updateLastSync(),Ce.setValue("lastServerFetchInMillis",Date.now())}}async updateActionsAfterSync(t,e){try{await ln.createOrUpdateActions(t.map(t=>({...t,lastSync:Date.now(),_user:e._id})))}catch(t){console.error("Error during 'updateActionsWithUserIdAfterSync'",t)}}async addContentToPageContents(t,e){return(null==t?void 0:t.map(t=>{var r;return{...t,content:null==(r=e.find(e=>e.url===t.url))?void 0:r.content}}))??[]}async addMessagesToAiChat(t,e){return(null==t?void 0:t.map(t=>{var r;const n=null==(r=e.find(e=>e._id===t._id))?void 0:r.messages;return Array.isArray(n)?{...t,messages:n}:t}))??[]}static create(e){if(t.instance)return t.instance;const r=new t(e);return t.instance=r,r}static createForUnitTests(e){return new t(e)}async updateChromeSyncState(t){const e=await(null==cn?void 0:cn.getActionsThatNeedSync())??[];this.setChromeSyncStatus={chromeSyncState:t||await this.resolveChromeSyncState({numberOfActionsThatNeedSync:e.length}),actionsThatNeedSync:e??[],unsyncedEntitiesCount:xi(e)}}async checkForBackupOrSyncDialog(){var t;const e=this.chromeSyncStatus.unsyncedEntitiesCount,r=await Ce.getChromeSettings();if(e>0&&function({chromeSettings:t,unsyncedEntitiesCount:e}){var r;const n=t.showBackupDialogPrompt,i=t.backupDialogPromptInterval,o=function(t){return`backup_prompt_dismissed_${t}`}(e),s=e>=i&&n&&!(null!=(r=null==t?void 0:t.dismissedBackupPromptIds)&&r.includes(o))&&e>=i&&e%i===0;return s&&un({dismissedBackupPromptIds:[...t.dismissedBackupPromptIds??[],o]}),s}({chromeSettings:r,unsyncedEntitiesCount:e})&&dn({dialogName:"backup-or-sync-prompt",options:{headerOptions:{showLogo:!0,showCloseButton:!0}}}),0===e&&"UP_TO_DATE"===this.chromeSyncStatus.chromeSyncState&&((null==(t=null==r?void 0:r.dismissedBackupPromptIds)?void 0:t.length)??0)>0)return un({dismissedBackupPromptIds:[]})}async loadActionsFromServer(){this.serverSyncInProgress=!0;try{const t=Yi().clientId,e=await cn.getAllActions(),r=e.some(t=>!t.lastSync);if(!e.length||r)return await this.options.httpFacade.loadAllActionsForUser();const n=e.filter(e=>e.clientId!==t).map(t=>t.timestamp),i=e.filter(e=>e.clientId===t).map(t=>t.timestamp),o=null!=n&&n.length?Math.max(...n)??0:null,s=null!=i&&i.length?Math.max(...i)??0:null;return await this.options.httpFacade.loadActionsForSync({clientId:t,latestTimestampForeignClientId:o,latestTimestampInternalClientId:s})}catch(t){throw this.setChromeSyncStatus={...this.chromeSyncStatus,chromeSyncState:"SERVER_ERROR"},t}finally{this.serverSyncInProgress=!1}}},"instance");const zi=()=>`webhighlightsContext${(()=>{try{return hr()?Xe():tr(location.origin)?x+"Dev":""}catch(t){return console.debug("Error in resolveContextId",t),""}})()}`;function Ki(){return typeof window>"u"?null:window[zi()]??null}function Yi(){const t=Ki();if(!function(t){const e=t||Ki();return!!(e&&e.chromeSyncService&&e.db&&e.httpFacade)}(t))throw new Error("Context not initialized. Call 'initContext' first.");return t}function Ji(){try{return Yi()}catch{return null}}const Xi="webhighlights-notifications",Zi=()=>`${Xi}${(()=>{try{return hr()?Xe():tr(location.origin)?x+"Dev":""}catch(t){return console.debug("Error in resolveNotificationContextId",t),""}})()}`,Qi=`[id^="${Xi}"]`;function to(){let t=document.getElementById(Zi());return t||(t=function(){const t=document.createElement("div");t.id=Zi();const e=Ji();return t&&e&&hr()&&(t.setAttribute("data-browser-type",e.appConfig.browserType),t.setAttribute("data-app-type",e.appConfig.appType)),document.body.append(t),t}()),t}const eo={subscribe:function(t,e,r){const n=to();n.addEventListener(t,e);let i=[];return null!=r&&r.listenAcrossExtensions&&(i=[...document.querySelectorAll(Qi)].filter(t=>t.id!==to().id),i.forEach(r=>{r.addEventListener(t,e)})),{unsubscribe:()=>{n.removeEventListener(t,e),i.forEach(r=>{r.removeEventListener(t,e)})}}},unsubscribe:function(t,e){return to().removeEventListener(t,e)},dispatch:function(t,e){to().dispatchEvent(new CustomEvent(t,e))}};f(class t{constructor(t){f(this,"subscriptions",[]),this.options=t}static create(e){return t._singleton?t._singleton:new t(e)}start(){this.stop(),this.subscriptions=[eo.subscribe("updatedMark",t=>this.options.updatedMark(t.detail)),eo.subscribe("deletedMark",t=>this.options.deletedMark(t.detail)),eo.subscribe("bookmarkSelected",t=>this.options.bookmarkSelected(t.detail[0],t.detail[1])),eo.subscribe("openInReader",t=>this.options.openInReader(t.detail[0]))]}stop(){this.subscriptions.forEach(t=>{t.unsubscribe()})}},"_singleton"),Date.now(),Object.values({CANCEL_BY_USER:"Cancelled by user",SEND_NEW_MESSAGE:"Cancelled by sending new message"});const ro=()=>!(typeof window>"u")&&window.innerWidth<=767;V.clock,V.history,V.history,V.eye,ro(),ro();ve.bookmarks,ve.marks,ve.bookmarks,ve.bookmarks,ve.bookmarks,ve.bookmarks,ve.bookmarks,ve.marks,ro(),new class{constructor(){f(this,"pressedKeys",{}),f(this,"keyUpListener"),f(this,"keyDownListener")}handleKeydown(t){this.pressedKeys[t.key]=!0}handleKeyUp(t){this.pressedKeys[t.key]=!1}start(){this.keyDownListener=this.handleKeydown.bind(this),this.keyUpListener=this.handleKeyUp.bind(this),window.addEventListener("keydown",this.keyDownListener),window.addEventListener("keyup",this.keyUpListener)}stop(){this.keyDownListener&&window.removeEventListener("keydown",this.keyDownListener),this.keyUpListener&&window.removeEventListener("keyup",this.keyUpListener)}isKeyPressed(t){return!!this.pressedKeys[t]}};const no=12345678;$r.FREE_TRIAL,$r.PREMIUM,Hr.ONE_MONTH,$r.PREMIUM,Hr.ONE_MONTH,$r.ULTIMATE,Hr.ONE_YEAR,$r.ULTIMATE,Hr.ONE_YEAR,$r.PREMIUM,Hr.LIFETIME,$r.PREMIUM,$r.ULTIMATE,Hr.ONE_YEAR;F.BASIC;g.webApp;$r.PREMIUM,$r.PREMIUM,$r.ULTIMATE,$r.ULTIMATE,$r.ULTIMATE,Hr.LIFETIME,$r.PREMIUM,Hr.LIFETIME,$r.ULTIMATE,Hr.ONE_YEAR,$r.ULTIMATE,Hr.ONE_MONTH,$r.PREMIUM,Hr.ONE_YEAR,$r.PREMIUM,Hr.ONE_MONTH,V.user,V.save,V.settings,V["arrow-up-circle"],V.zap,V.bell,V.reader;const io=y;var oo=function(t,e,r,n){return new(r||(r=Promise))(function(i,o){function s(t){try{c(n.next(t))}catch(t){o(t)}}function a(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(s,a)}c((n=n.apply(t,e||[])).next())})};function so(){chrome.commands.getAll().then(t=>{var e,r,n,i,o,s,a,c,l;const u=null!==(n=null===(r=null!==(e=t.find(t=>"highlight-text"===t.name))&&void 0!==e?e:null)||void 0===r?void 0:r.shortcut)&&void 0!==n?n:A,h=null!==(s=null===(o=null!==(i=t.find(t=>"toggle-bookmark"===t.name))&&void 0!==i?i:null)||void 0===o?void 0:o.shortcut)&&void 0!==s?s:A,d=null!==(l=null===(c=null!==(a=t.find(t=>"open-in-reader"===t.name))&&void 0!==a?a:null)||void 0===c?void 0:c.shortcut)&&void 0!==l?l:A;chrome.contextMenus.removeAll(),io.appType===g.reader&&chrome.contextMenus.create({id:be.CONTEXT_OPEN_IN_READER,title:"Open in reader "+(d?`[${d}]`:""),contexts:["page"]}),io.appType===g.highlighter&&(chrome.contextMenus.create({id:be.CONTEXT_MENU_SAVE_BOOKMARK,title:"Save page as bookmark "+(h?`[${h}]`:""),contexts:["page"]}),chrome.contextMenus.create({id:be.CONTEXT_MENU_SAVE_TEXT,title:"Highlight selected text "+(u?`[${u}]`:""),contexts:["selection"]})),chrome.contextMenus.create({id:be.CONTEXT_MENU_SAVE_IMAGE,title:"Save image",contexts:["image"]})})}function ao(t){co(function(t){return Ze(`viewer.html?file=${encodeURIComponent(t)}`)}(t))}function co(t,e={}){try{e.newTab?chrome.tabs.create({url:t,active:!0}):chrome.tabs.update({url:t,active:!0})}catch(t){console.warn(t)}}function lo(t){Ce.getChromeSettings().then(e=>oo(this,void 0,void 0,function*(){if(t.url&&t.id){const r=function(t,e){return function(t,e){var r;const n=null==(r=Ji())?void 0:r.appConfig;return(!rr()||null==n||!n.isWebApp)&&([...e,...Fe].some(e=>function(t,e){try{const r=e.endsWith("/*");return e=`^(?:www.|(?:http|https|ftp|ftps|chrome|file|)://(?:www.|))${e}`,r||(e=`${e}(?:$|/$)`),RegExp(e).test(t)}catch{return!1}}(t,e))||er(t))}(t,e)}(t.url,e.blacklistedUrls);try{yield function(t,e,r){return oo(this,void 0,void 0,function*(){const n=Je(r),i={text:"Off",color:"#252934"},o={text:"PDF",color:"#d8261c"},s=t?i.text:n?o.text:"",a=t?i.color:n?o.color:"";return Promise.all([uo({tabId:e,urlIsBlackListed:t,url:r}),ho(e,s),fo(e,a)])})}(r,t.id,t.url)}catch(t){console.warn(t)}}}))}function uo(t){return oo(this,arguments,void 0,function*({tabId:t,urlIsBlackListed:e,url:r}){let n="marker-icon";const i=function(t){try{if(!t)return!1;const e=new URL(t);return(e.hostname.includes("youtube.com")||e.hostname.includes("youtu.be"))&&null!==function(t){var e,r=t.match(/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?)|(shorts\/))\??v?=?([^#&?]*).*/);return r&&11===(null==(e=r[8])?void 0:e.length)?r[8]:null}(t)}catch{return!1}}(r);i&&(n="marker-icon-youtube");const o=io.appType===g.youtubeHighlighter;(e||o&&!i)&&!sr(r)&&(n="marker-icon-disabled"),yield chrome.action.setIcon({path:`../../../../assets/${n}.png`,tabId:t})})}function ho(t,e){return oo(this,void 0,void 0,function*(){e&&(yield chrome.action.setBadgeText({text:e,tabId:t}))})}function fo(t,e){return oo(this,void 0,void 0,function*(){e&&(yield chrome.action.setBadgeBackgroundColor({color:e,tabId:t}))})}const go=new class{constructor(t){f(this,"dbName","WebHighlights"),f(this,"version",4),f(this,"db"),f(this,"indexedDb"),this.indexedDb=t}async dbHasDeprecatedObjectStores(){await this.openDB();const t=this.db.objectStoreNames;return Nn.some(e=>t.contains(e))}async runMigrationGarbageCollector(t){try{await new Promise(async(e,r)=>{try{if((await this.getAllEntitiesFromDeprecatedObjectStores()).every(e=>t.some(t=>t._id===e._id))){console.debug("All deprecated object stores have been migrated. Clearing the deprecated object stores...");const t=Nn.filter(t=>this.db.objectStoreNames.contains(t)),n=this.db.transaction(t,"readwrite");for(const e of t)n.objectStore(e).clear();n.oncomplete=()=>{e()},n.onerror=t=>{r(t.target.error)}}else console.debug("Some deprecated object stores have not been migrated. Keeping them for now...."),e()}catch(t){console.error("Error during migration garbage collector:",t)}})}catch(t){console.error("Error during migration garbage collector:",t)}}async openDB(t){return new Promise((e,r)=>{const n=this.indexedDb.open(this.dbName,t??this.version),i=async t=>{this.db=t.target.result,null==n||n.removeEventListener("success",i),e(this.db)},o=async t=>{var i;const s=null==(i=t.target.error)?void 0:i.message;if(null!=s&&s.includes("is less than the existing version")){console.warn(`Self-healing db version: '${s}'`);const t=s.match(/\((\d+)\).*\((\d+)\)/);if(t){const n=Number(t[2]);if("number"==typeof n&&Number.isInteger(n)&&n>this.version)try{const t=await this.openDB(n);return void e(t)}catch(t){console.error("Failed to open database with new version:",t),r(t)}}}null==n||n.removeEventListener("error",o),r(t.target.error)};n.addEventListener("success",i),n.addEventListener("error",o),n.onupgradeneeded=async t=>{this.initObjectStores(t)}})}initObjectStores(t){const e=t.target.result;if(!e.objectStoreNames.contains(we.actions)){const t=e.createObjectStore(we.actions,{keyPath:"id"});t.createIndex(Tn,Tn,{unique:!1}),t.createIndex(vn,vn,{unique:!1}),t.createIndex(_n,_n,{unique:!1}),t.createIndex(An,An,{unique:!1})}if(!e.objectStoreNames.contains(we.contents)){const t=e.createObjectStore(we.contents,{keyPath:"entityId"});t.createIndex(En,En),t.createIndex(Sn,Sn),t.createIndex(wn,wn),t.createIndex(In,In)}}getObjectStore(t,e){return this.db.transaction(t,e).objectStore(t)}async getDeprecatedChromeSettings(){return(this.db.objectStoreNames.contains(Ae.chromesettings)?await this.getAllFromObjectStore(Ae.chromesettings):[])[0]??null}async getAllEntitiesFromDeprecatedObjectStores(){return[...this.db.objectStoreNames.contains(Ae.marks)?await this.getAllFromObjectStore(Ae.marks):[],...this.db.objectStoreNames.contains(Ae.bookmarks)?await this.getAllFromObjectStore(Ae.bookmarks):[],...this.db.objectStoreNames.contains(Ae.pagecontents)?await this.getAllFromObjectStore(Ae.pagecontents):[],...this.db.objectStoreNames.contains(Ae.aichats)?await this.getAllFromObjectStore(Ae.aichats):[]]}async getAllFromObjectStore(t){return await this.openDB(),new Promise((e,r)=>{const n=this.getObjectStore(t,"readonly").getAll(),i=t=>{null==n||n.removeEventListener("success",i);const r=t.target.result;e(r)},o=()=>{r(),null==n||n.removeEventListener("error",o)};n.addEventListener("success",i),n.addEventListener("error",o)})}async getContentEntitiesThatNeedSync(){await this.openDB();const t=this.db.transaction([we.contents],"readonly").objectStore(we.contents).index(In);return new Promise((e,r)=>{const n=t.getAll(1);n.onsuccess=()=>{const t=n.result;e(t)},n.onerror=()=>{console.error("Error getting content entities that need sync:",n.error),r(n.error)}})}async getContentEntities(t){await this.openDB();const e=this.db.transaction([we.contents],"readonly").objectStore(we.contents).index(Sn).getAll(t);return new Promise((t,r)=>{e.onsuccess=()=>{const r=e.result;t(r)},e.onerror=()=>{r(e.error)}})}async clearDatabases(){try{return await this.openDB(),new Promise((t,e)=>{const r=[Ae.marks,Ae.bookmarks,Ae.chromesettings,Ae.pagecontents,Ae.aichats,we.actions,we.contents].filter(t=>this.db.objectStoreNames.contains(t)),n=this.db.transaction(r,"readwrite");for(const t of r)n.objectStore(t).clear();n.oncomplete=()=>{t()},n.onerror=t=>{e(t.target.error)}})}catch{console.error("Error while clearing database")}}async createOrUpdateActions(t){if(!t.length)return;const e=await this.openDB();return new Promise(async(r,n)=>{const i=e.transaction([we.actions],"readwrite"),o=i.objectStore(we.actions);for(const e of t)o.put(e);i.oncomplete=async()=>{const e=t.filter(t=>t.type===fr.DELETE&&(t=>t===ve.aichats||t===ve.pagecontents)(t.entityType)).map(t=>t.entityId);e.length&&await this.deleteContentEntities(e),r()},i.onerror=t=>{console.error("[createOrUpdateActions] Error creating actions",t),n(i.error)}})}async createOrUpdateContents(t){if(!t.length)return;const e=await this.openDB();return new Promise((r,n)=>{const i=e.transaction([we.contents],"readwrite"),o=i.objectStore(we.contents);for(const e of t)o.put(e);i.oncomplete=()=>{r()},i.onerror=t=>{console.error("[createOrUpdateContents] Error creating contents",t),n(i.error)}})}async deleteContentEntities(t){if(!t.length)return;const e=await this.openDB();return new Promise((r,n)=>{const i=e.transaction([we.contents],"readwrite"),o=i.objectStore(we.contents);for(const e of t)o.delete(e);i.oncomplete=()=>{r()},i.onerror=t=>{console.error("[deleteContentEntities] Error deleting content entities",t),n(i.error)}})}async getContentEntity(t){const e=(await this.openDB()).transaction([we.contents],"readonly").objectStore(we.contents).get(t);return new Promise((t,r)=>{e.onsuccess=()=>t(e.result),e.onerror=()=>r(e.error)})}async getAllUniqueUserIds(){await this.openDB();const t=this.db.transaction([we.actions],"readonly").objectStore(we.actions).index(An);return new Promise((e,r)=>{const n=new Set,i=t.openKeyCursor();i.onsuccess=t=>{const r=t.target.result;r?(n.add(r.key),r.continue()):e(Array.from(n))},i.onerror=()=>r(i.error)})}async getActionIdsForUser(t){await this.openDB();const e=this.db.transaction([we.actions],"readonly").objectStore(we.actions).index(An);return new Promise((r,n)=>{const i=e.getAllKeys(t);i.onsuccess=()=>r(i.result),i.onerror=()=>n(i.error)})}async deleteActionsInTransaction(t){if(t.length)return await this.openDB(),new Promise((e,r)=>{const n=this.db.transaction([we.actions],"readwrite"),i=n.objectStore(we.actions);for(const e of t)i.delete(e);n.oncomplete=()=>{e()},n.onerror=()=>{console.error("Transaction failed:",n.error),r(n.error)},n.onabort=()=>{console.error("Transaction aborted:",n.error),r(n.error)}})}}(indexedDB);"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==r.g?r.g:"undefined"!=typeof self&&self;var po={exports:{}};"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,function(t){if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)t.exports=globalThis.browser;else{const e="The message port closed before a response was received.",r=t=>{const r={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(0===Object.keys(r).length)throw new Error("api-metadata.json has not been included in browser-polyfill");class n extends WeakMap{constructor(t,e=void 0){super(e),this.createItem=t}get(t){return this.has(t)||this.set(t,this.createItem(t)),super.get(t)}}const i=(e,r)=>(...n)=>{t.runtime.lastError?e.reject(new Error(t.runtime.lastError.message)):r.singleCallbackArg||n.length<=1&&!1!==r.singleCallbackArg?e.resolve(n[0]):e.resolve(n)},o=t=>1==t?"argument":"arguments",s=(t,e,r)=>new Proxy(e,{apply:(e,n,i)=>r.call(n,t,...i)});let a=Function.call.bind(Object.prototype.hasOwnProperty);const c=(t,e={},r={})=>{let n=Object.create(null),l={has:(e,r)=>r in t||r in n,get(l,u,h){if(u in n)return n[u];if(!(u in t))return;let d=t[u];if("function"==typeof d)if("function"==typeof e[u])d=s(t,t[u],e[u]);else if(a(r,u)){let e=((t,e)=>function(r,...n){if(n.length<e.minArgs)throw new Error(`Expected at least ${e.minArgs} ${o(e.minArgs)} for ${t}(), got ${n.length}`);if(n.length>e.maxArgs)throw new Error(`Expected at most ${e.maxArgs} ${o(e.maxArgs)} for ${t}(), got ${n.length}`);return new Promise((o,s)=>{if(e.fallbackToNoCallback)try{r[t](...n,i({resolve:o,reject:s},e))}catch(i){console.warn(`${t} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,i),r[t](...n),e.fallbackToNoCallback=!1,e.noCallback=!0,o()}else e.noCallback?(r[t](...n),o()):r[t](...n,i({resolve:o,reject:s},e))})})(u,r[u]);d=s(t,t[u],e)}else d=d.bind(t);else if("object"==typeof d&&null!==d&&(a(e,u)||a(r,u)))d=c(d,e[u],r[u]);else{if(!a(r,"*"))return Object.defineProperty(n,u,{configurable:!0,enumerable:!0,get:()=>t[u],set(e){t[u]=e}}),d;d=c(d,e[u],r["*"])}return n[u]=d,d},set:(e,r,i,o)=>(r in n?n[r]=i:t[r]=i,!0),defineProperty:(t,e,r)=>Reflect.defineProperty(n,e,r),deleteProperty:(t,e)=>Reflect.deleteProperty(n,e)},u=Object.create(t);return new Proxy(u,l)},l=t=>({addListener(e,r,...n){e.addListener(t.get(r),...n)},hasListener:(e,r)=>e.hasListener(t.get(r)),removeListener(e,r){e.removeListener(t.get(r))}}),u=new n(t=>"function"!=typeof t?t:function(e){const r=c(e,{},{getContent:{minArgs:0,maxArgs:0}});t(r)}),h=new n(t=>"function"!=typeof t?t:function(e,r,n){let i,o,s=!1,a=new Promise(t=>{i=function(e){s=!0,t(e)}});try{o=t(e,r,i)}catch(t){o=Promise.reject(t)}const c=!0!==o&&(l=o)&&"object"==typeof l&&"function"==typeof l.then;var l;return!(!0!==o&&!c&&!s||((c?o:a).then(t=>{n(t)},t=>{let e;e=t&&(t instanceof Error||"string"==typeof t.message)?t.message:"An unexpected error occurred",n({__mozWebExtensionPolyfillReject__:!0,message:e})}).catch(t=>{console.error("Failed to send onMessage rejected reply",t)}),0))}),d=({reject:r,resolve:n},i)=>{t.runtime.lastError?t.runtime.lastError.message===e?n():r(new Error(t.runtime.lastError.message)):i&&i.__mozWebExtensionPolyfillReject__?r(new Error(i.message)):n(i)},f=(t,e,r,...n)=>{if(n.length<e.minArgs)throw new Error(`Expected at least ${e.minArgs} ${o(e.minArgs)} for ${t}(), got ${n.length}`);if(n.length>e.maxArgs)throw new Error(`Expected at most ${e.maxArgs} ${o(e.maxArgs)} for ${t}(), got ${n.length}`);return new Promise((t,e)=>{const i=d.bind(null,{resolve:t,reject:e});n.push(i),r.sendMessage(...n)})},g={devtools:{network:{onRequestFinished:l(u)}},runtime:{onMessage:l(h),onMessageExternal:l(h),sendMessage:f.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:f.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},p={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return r.privacy={network:{"*":p},services:{"*":p},websites:{"*":p}},c(t,g,r)};t.exports=r(chrome)}}(po);var mo,yo,bo=function(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}(po.exports);class To{constructor(){this.isLocal=!0}log({level:t,message:e,timestamp:r,data:n,title:i}){let o;switch(t){case"debug":default:o="log";break;case"info":o="info";break;case"warn":o="warn";break;case"error":case"critical":case"fatal":o="error"}const s=i?`[${i}]`:"";void 0!==n?console[o](`[${r}] - ${To.LOGGER_PREFIX} ${s} ${e}`,n):console[o](`[${r}] - ${To.LOGGER_PREFIX} ${s} ${e}`)}}To.LOGGER_PREFIX="[GFAdUnit] -",function(t){t.checkoutPopupShown="CHECKOUT-POPUP-SHOWN",t.checkoutPopupNotShown="CHECKOUT-POPUP-NOT-SHOWN",t.checkoutPopupSupressed="CHECKOUT-POPUP-SUPRESSED",t.checkoutPopupDonation="CHECKOUT-POPUP-DONATION",t.checkoutPopupFailedActivation="CHECKOUT-POPUP-FAILED-ACTIVATION",t.checkoutPopupPurchaseConfirmed="CHECKOUT-POPUP-PURCHASE-CONFIRMED",t.checkoutPopupHealthCheck="CHECKOUT-POPUP-HEALTH-CHECK",t.checkouPopupActivationFailed="CHECKOUT-POPUP-ACTIVATION-FAILED",t.checkoutPopupOfferDetailsClicked="CHECKOUT-POPUP-OFFER-DETAILS-CLICKED",t.checkoutPopupWhyAmISeeingThisClicked="CHECKOUT-POPUP-WHY-AM-I-SEEING-THIS-CLICKED",t.checkoutPopupLooserExtension="CHECKOUT-POPUP-LOOSER-EXTENSION",t.checkoutPopupActiveDomain="CHECKOUT-POPUP-ACTIVE-DOMAIN",t.checkoutPopupSiteMatches="CHECKOUT-POPUP-SITE-MATCHES",t.checkoutPopupMerchantInResultsFound="CHECKOUT-MERCHANT-IN-RESULTS-FOUND"}(mo||(mo={})),function(t){t.adUnitLog="ADUNIT-LOG"}(yo||(yo={}));class vo{constructor(t){this.isLocal=!1,this.backgroundService=t}log({level:t,message:e,data:r,title:n}){this.backgroundService.trackEvent(yo.adUnitLog,{log:{level:t,message:e,data:r,title:n}})}}const _o=["debug","info","warn","error","critical","fatal"];class Ao{constructor(t){this.config={minLevel:t?.minLevel??"debug",enabled:t?.enabled??!1,transports:t?.transports??[new To],title:t?.title??""}}static getInstance(t){return Ao.instance||(Ao.instance=new Ao(t)),Ao.instance}configure(t){this.config={...this.config,...t}}shouldLog(t){return!!this.config.enabled&&_o.indexOf(t)>=_o.indexOf(this.config.minLevel)}createLogMessage(t,e,r){return{level:t,version:"1.17.0",message:e,timestamp:(new Date).toISOString(),data:r,title:this.config.title}}log(t,e,r,n){if(!this.shouldLog(t))return;const i=this.createLogMessage(t,e,n);this.config.transports.filter(t=>!r||t.isLocal).forEach(t=>t.log(i))}debug(t,e,r=!1){this.log("debug",t,r,e)}info(t,e,r=!1){this.log("info",t,r,e)}warn(t,e,r=!1){this.log("warn",t,r,e)}error(t,e,r=!1){this.log("error",t,r,e)}critical(t,e,r=!1){this.log("critical",t,r,e)}fatal(t,e,r=!1){this.log("fatal",t,r,e)}addTransport(t){this.config.transports.push(t)}clearTransports(){this.config.transports=[]}disable(){this.config.enabled=!1}enable(){this.config.enabled=!0}}const wo=3,Eo=t=>1e3*t;async function So(t,e={},r){const{maxAttempts:n=wo,delayFn:i=Eo}=e;let o=null;for(let e=1;e<=n;e+=1)try{return await t()}catch(t){o=t,e<n&&await new Promise(t=>{setTimeout(t,i(e))})}if(o&&e.logger&&e.operationName&&e.logger.error(`Operation ${e.operationName} failed after ${n} attempts.`,o,!0),void 0!==r)return r;throw o||new Error("Operation failed after multiple attempts")}const Io=bo,No={TRACK_EVENT:"GF_TRACK_EVENT",HIDE_POPUP:"GF_HIDE_POPUP",GET_POPUP_CONFIG:"GF_GET_POPUP_CONFIG",IS_ACTIVE_DOMAIN:"GF_IS_ACTIVE_DOMAIN",LOG_MERCHANTS_IN_SEARCH_RESULTS:"GF_LOG_MERCHANTS_IN_SEARCH_RESULTS",SHOULD_STAND_DOWN:"GF_SHOULD_STAND_DOWN",ACTIVATE_OFFER:"GF_ACTIVATE_OFFER",STORE_SHOPIFY_SHOP_ID:"GF_STORE_SHOPIFY_SHOP_ID",GET_DOMAIN_BY_SHOP_ID:"GF_GET_DOMAIN_BY_SHOP_ID",GET_LANGUAGE_CONTENT:"GF_GET_LANGUAGE_CONTENT"},Oo="shopify_shop_ids",Co="gf_last_health_check",ko="gf_partner_config",Lo="gf_global_config",Do="countryCode",xo="version",Po="gf_anonymous_user_info",Ro="gf_anonymous_encrypted_token",Bo="gf_ad_event_history",Go="wfDevice",Uo="wfDomains",Mo="wfStanddownPolicy",jo="wfStanddownHistory",Fo="wfMerchantRates",$o="en",Ho="GIVE_FREELY_",Wo={async get(t){const e=`${Ho}${t}`;return(await bo.storage.local.get(e))[e]||null},async set(t,e){const r=`${Ho}${t}`;await bo.storage.local.set({[r]:e})},async remove(t){const e=Array.isArray(t)?t.map(t=>`${Ho}${t}`):`${Ho}${t}`;await bo.storage.local.remove(e)}},Vo=()=>String("1.17.0"),qo=async(t=!0)=>{const e=await Wo.get(xo),r=await Vo(),n=e!==r;var i;return t&&n&&await(i=r,Wo.set(xo,i)),n},zo=Ao.getInstance(),Ko={async get(t,e,r,n=!1){let i=await Wo.get(t);const o=i;let s=!1;if(i&&Date.now()<=i.expiration&&!n)return{content:i.content,isStale:s};try{const n=await e();i=await this.set(t,n,r)}catch(t){zo.error("Error getting cached value",{error:t}),s=!0}return{content:i?.content??o?.content,isStale:s}},async set(t,e,r){const n={content:e,expiration:Date.now()+1e3*(r??300)};return await Wo.set(t,n),n},async refresh(t,e,r,n=!1){const i=await this.get(t,e,r,n);if(i.isStale||n)try{const n=await e();if(!n)return{content:i.content,isStale:!0};i.content=n,await this.set(t,i.content,r)}catch(t){return zo.error("Error refreshing cached value",{error:t}),{content:i.content,isStale:!0}}return{content:i.content,isStale:!1}},async clear(t){await Wo.remove(t)}};class Yo{constructor(){this.listeners=new Map,this.wildcardListeners=new Set}on(t,e){return this.addListener(t,e,!1)}once(t,e){return this.addListener(t,e,!0)}off(t,e){if(!e)return this.listeners.delete(t),void(this.wildcardListeners=new Set(Array.from(this.wildcardListeners).filter(e=>e.pattern!==t)));if(t.includes("*"))this.wildcardListeners=new Set(Array.from(this.wildcardListeners).filter(r=>!(r.pattern===t&&r.callback===e)));else{const r=this.listeners.get(t);if(r){const n=Array.from(r).filter(t=>t.callback!==e);n.length>0?this.listeners.set(t,new Set(n)):this.listeners.delete(t)}}}emit(t){const e=this.listeners.get(t.path)||new Set,r=new Set;for(const t of e)r.add(t);for(const e of this.wildcardListeners)this.matchesPattern(t.path,e.pattern)&&r.add(e);for(const e of r)e.callback(t),e.once&&this.removeListener(e)}clear(){this.listeners.clear(),this.wildcardListeners.clear()}addListener(t,e,r){const n={pattern:t,callback:e,once:r};if(t.includes("*"))this.wildcardListeners.add(n);else{const e=this.listeners.get(t);e?e.add(n):this.listeners.set(t,new Set([n]))}return()=>this.off(t,e)}removeListener(t){if(t.pattern.includes("*"))this.wildcardListeners.delete(t);else{const e=this.listeners.get(t.pattern);e&&(e.delete(t),0===e.size&&this.listeners.delete(t.pattern))}}matchesPattern(t,e){if("*"===e)return!0;const r=e.split(".").map(t=>"*"===t?"[^.]+":"**"===t?".*":t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join("\\.");return new RegExp(`^${r}$`).test(t)}}function Jo(t,e,r=""){const n=[];if(t===e)return n;if(Xo(t)||Xo(e))return t!==e&&n.push({path:r||"root",oldValue:t,newValue:e}),n;if(Array.isArray(t)&&Array.isArray(e))return JSON.stringify(t)!==JSON.stringify(e)&&n.push({path:r||"root",oldValue:t,newValue:e}),n;if(Zo(t)&&Zo(e)){const i=t,o=e,s=new Set([...Object.keys(i),...Object.keys(o)]);for(const t of s){const e=r?`${r}.${t}`:t,s=i[t],a=o[t];if(t in i)if(t in o){const t=Jo(s,a,e);n.push(...t)}else n.push({path:e,oldValue:s,newValue:void 0});else n.push({path:e,oldValue:void 0,newValue:a})}}else t!==e&&n.push({path:r||"root",oldValue:t,newValue:e});return n}function Xo(t){return null==t||"object"!=typeof t}function Zo(t){return null!==t&&"object"==typeof t&&!Array.isArray(t)}var Qo;!function(t){t.CLOSED="CLOSED",t.OPEN="OPEN",t.HALF_OPEN="HALF_OPEN"}(Qo||(Qo={}));class ts{constructor(t={}){this.state=Qo.CLOSED,this.failures=[],this.lastFailureTime=0,this.halfOpenCalls=0,this.logger=Ao.getInstance({minLevel:"warn"}),this.options={failureThreshold:5,recoveryTimeout:6e4,monitoringWindow:3e5,halfOpenMaxCalls:3,storageKey:"circuit_breaker_state",...t},this.storageKey=this.options.storageKey}async initialize(){await this.loadFromStorage()}static async create(t={}){const e=new ts(t);return await e.initialize(),e}async loadFromStorage(){try{if("undefined"!=typeof chrome&&chrome.storage&&chrome.storage.local){const t=(await chrome.storage.local.get(this.storageKey))[this.storageKey];t&&(this.state=t.state,this.failures=t.failures||[],this.lastFailureTime=t.lastFailureTime||0,this.halfOpenCalls=t.halfOpenCalls||0,this.cleanupOldFailures())}else if("undefined"!=typeof localStorage){const t=localStorage.getItem(this.storageKey);if(t){const e=JSON.parse(t);this.state=e.state,this.failures=e.failures||[],this.lastFailureTime=e.lastFailureTime||0,this.halfOpenCalls=e.halfOpenCalls||0,this.cleanupOldFailures()}}}catch(t){this.logger.warn("Failed to load circuit breaker state from storage:",t)}}async saveToStorage(){try{const t={state:this.state,failures:this.failures,lastFailureTime:this.lastFailureTime,halfOpenCalls:this.halfOpenCalls};"undefined"!=typeof chrome&&chrome.storage&&chrome.storage.local?await chrome.storage.local.set({[this.storageKey]:t}):"undefined"!=typeof localStorage&&localStorage.setItem(this.storageKey,JSON.stringify(t))}catch(t){this.logger.warn("Failed to save circuit breaker state to storage:",t)}}cleanupOldFailures(){const t=Date.now();this.failures=this.failures.filter(e=>t-e.timestamp<=this.options.monitoringWindow)}async execute(t,e){if(this.state===Qo.OPEN){if(!this.shouldAttemptRecovery()){if(e)return e();throw new Error("Circuit breaker is OPEN - service temporarily unavailable")}this.state=Qo.HALF_OPEN,this.halfOpenCalls=0,await this.saveToStorage()}if(this.state===Qo.HALF_OPEN){if(this.halfOpenCalls>=this.options.halfOpenMaxCalls)throw new Error("Circuit breaker HALF_OPEN call limit exceeded");this.halfOpenCalls+=1,await this.saveToStorage()}try{const e=await t();return await this.onSuccess(),e}catch(t){throw await this.onFailure(t),t}}async onSuccess(){this.state===Qo.HALF_OPEN&&(this.state=Qo.CLOSED,this.failures=[],await this.saveToStorage())}async onFailure(t){const e=Date.now();this.lastFailureTime=e,this.failures.push({timestamp:e,error:t.message}),this.failures=this.failures.filter(t=>e-t.timestamp<=this.options.monitoringWindow),this.failures.length>=this.options.failureThreshold&&(this.state=Qo.OPEN),await this.saveToStorage()}shouldAttemptRecovery(){return Date.now()-this.lastFailureTime>=this.options.recoveryTimeout}getState(){return this.state}getFailureCount(){const t=Date.now();return this.failures.filter(e=>t-e.timestamp<=this.options.monitoringWindow).length}async reset(){this.state=Qo.CLOSED,this.failures=[],this.lastFailureTime=0,this.halfOpenCalls=0,await this.saveToStorage()}async clearStorage(){"undefined"!=typeof chrome&&chrome.storage&&chrome.storage.local?await chrome.storage.local.remove(this.storageKey):"undefined"!=typeof localStorage&&localStorage.removeItem(this.storageKey)}getStatus(){return{state:this.state,failureCount:this.getFailureCount(),nextAttemptTime:this.state===Qo.OPEN?this.lastFailureTime+this.options.recoveryTimeout:null}}}const es="https://cdn.givefreely.com/adunit/behavioral/";class rs{constructor(t){this.partnerApiKey=t,this.partnerConfig=null,this.globalConfig=null,this.mergedConfig=null,this.globalConfigRefreshInterval=60,this.partnerConfigRefreshInterval=60,this.eventEmitter=new Yo,this.isInitialized=!1,this.partnerCircuitBreaker=new ts({failureThreshold:3,recoveryTimeout:6e4,monitoringWindow:3e5,storageKey:`gf_partner_circuit_breaker_${t}`}),this.globalCircuitBreaker=new ts({failureThreshold:3,recoveryTimeout:6e4,monitoringWindow:3e5,storageKey:"gf_global_circuit_breaker"})}async initialize(){this.isInitialized||(await Promise.all([this.partnerCircuitBreaker.initialize(),this.globalCircuitBreaker.initialize()]),this.isInitialized=!0)}ensureInitialized(){if(!this.isInitialized)throw new Error("GiveFreelyConfigService must be initialized before use. Call initialize() or use create() method.")}getRetryOptions(){return{delayFn:t=>1e3*t,maxAttempts:3}}async fetchPartnerConfig(){const t=await So(async()=>{const t=await fetch(`${es}${this.partnerApiKey}.json`,{cache:"no-store"});if(!t.ok)throw new Error(`Failed to fetch partner config: ${t.statusText}`);return t.json()},this.getRetryOptions());if(!t)throw new Error("Failed to fetch or get from cache partner config");return this.partnerConfigRefreshInterval=t.configRefreshInterval||this.partnerConfigRefreshInterval,t}async fetchGlobalConfig(){const t=await So(async()=>{const t=await fetch(`${es}global.json`,{cache:"no-store"});if(!t.ok)throw new Error(`Failed to fetch global config => Status code: ${t.status} .${t.statusText}`);return t.json()},this.getRetryOptions());if(!t)throw new Error("Failed to fetch or get from cache global config",t);return this.globalConfigRefreshInterval=t.configRefreshInterval||this.globalConfigRefreshInterval,t}async getCachedConfig(){return this.mergedConfig}async getConfig(t=!1){this.ensureInitialized();let e=!1;t&&(e=await qo());const[r,n]=await Promise.all([await Ko.get(ko,this.fetchPartnerConfig.bind(this),this.partnerConfigRefreshInterval,e),await Ko.get(Lo,this.fetchGlobalConfig.bind(this),this.globalConfigRefreshInterval,e)]);if(!n.content)throw new Error("Global config is required");if(!r.content)throw new Error("Partner config is required");this.partnerConfig=r.content,this.globalConfig=n.content;const i=this.mergeConfigs(JSON.parse(JSON.stringify(this.globalConfig)),JSON.parse(JSON.stringify(this.partnerConfig)));if(!i)throw new Error("Was not able to merge configs");return((t,e,r)=>{const n=[...e.merchantExclusions??[],...r.merchantExclusions??[]];t.merchantExclusions=n})(i,this.globalConfig,this.partnerConfig),this.emitConfigChanges(i),i}async clearCache(){this.ensureInitialized(),await Promise.all([Ko.clear(ko),Ko.clear(Lo)]),this.partnerConfig=null,this.globalConfig=null,this.mergedConfig=null,this.eventEmitter.clear(),await Promise.all([this.partnerCircuitBreaker.reset(),this.globalCircuitBreaker.reset()])}getCircuitBreakerStatus(){return this.ensureInitialized(),{partner:this.partnerCircuitBreaker.getStatus(),global:this.globalCircuitBreaker.getStatus()}}mergeConfigs(t,e){if(!e)return t;if(!t)return e;const r={...t};return Object.keys(e).forEach(n=>{if(!Object.prototype.hasOwnProperty.call(e,n))return;const i=t[n],o=e[n];void 0!==o&&(Array.isArray(o)?r[n]=[...o]:r[n]=null===o||"object"!=typeof o||null===i||"object"!=typeof i?o:this.mergeConfigs(i,o))}),r}on(t,e){return this.eventEmitter.on(t,e)}once(t,e){return this.eventEmitter.once(t,e)}off(t,e){this.eventEmitter.off(t,e)}emitConfigChanges(t){if(!this.mergedConfig)return this.mergedConfig=t,void this.eventEmitter.emit({path:"root",oldValue:null,newValue:t,config:t});const e=Jo(this.mergedConfig,t);for(const r of e)this.eventEmitter.emit({path:r.path,oldValue:r.oldValue,newValue:r.newValue,config:t});this.mergedConfig=t}}class ns{constructor(t,e,r,n=60){this.track=async(t,e,r,n=!1,i=!1)=>{const o={partner:`adUnit_${this._partnerApiKey}`,eventType:t,eventData:{userId:n?void 0:this._userService?.user?.id,libVersion:Vo(),wfDeviceId:e,...r}};try{const t=JSON.stringify(o,(t,e)=>e instanceof Error?{name:e.name,message:e.message,stack:e.stack}:e),e=await this.getEventsUrl();return e?await this.BroadcastEvent(e,t,o,i):(this._logger.info("Cant broadcast event. eventsUrl cant be retrieved from config",o,!0),!1)}catch(t){return this._logger.error("Something unexpected happened when dispatching a gf event",{error:t,event:o},!0),!1}},this.getEventsHistory=async()=>{const t=await Wo.get(Bo),e=(t=>{const e=new Date;return e.setTime(e.getTime()+60*t*1e3),e.getTime()})(-this._debounceWindowInMinutes),r=(t||[]).filter(t=>t.createdAt>e);return await Wo.set(Bo,r),r},this.shouldBroadcastEvent=async(t,e)=>!!e||!(await this.getEventsHistory()).some(e=>e.payload===t),this.pushEventToHistory=async t=>{const e=await this.getEventsHistory();e.push({createdAt:Date.now(),payload:t}),await Wo.set(Bo,e)},this._partnerApiKey=t,this._userService=e,this._debounceWindowInMinutes=n,this._logger=Ao.getInstance({title:"Analytics"}),this._configService=r}async BroadcastEvent(t,e,r,n){if(await this.shouldBroadcastEvent(e,n)){const n=await fetch(t,{headers:{"Content-Type":"application/json"},method:"POST",body:e,cache:"no-store"});return n.ok?(await this.pushEventToHistory(e),!0):(this._logger.error("Something unexpected happened when dispatching an event",{status:n.status,statusText:n.statusText,event:r},!0),!1)}return this._logger.info("This event has already been broadcasted during the past hour",r,!0),!1}async getEventsUrl(){const t=await this._configService.getCachedConfig();return t?.eventsUrl}}ns.trackEvent=async(t,e,r=!1,n=!1)=>{await async function(t){return await Io.runtime.sendMessage(t)}({type:No.TRACK_EVENT,payload:{eventType:t,eventData:e,anonymous:r,skipThrottling:n}})};class is{constructor(t,e){this.lastCheck=null,this.trackEvent=t,this.logger=e}async initialize(){const t=await Wo.get(Co);t&&(this.lastCheck=t)}getToday(){return(new Date).toISOString().split("T")[0]}async check(){try{const t=this.lastCheck??0,e=this.getToday();(t?new Date(t).toISOString().split("T")[0]:null)!==e&&(this.lastCheck=Date.now(),await Wo.set(Co,this.lastCheck),await this.trackEvent(mo.checkoutPopupHealthCheck,{language:bo.i18n.getUILanguage()}))}catch(t){this.logger.error("Health check failed",{error:t instanceof Error?t.message:"Unknown error"},!0)}}}var os;!function(t){t[t.Pending=0]="Pending",t[t.Ready=1]="Ready",t[t.Received=2]="Received",t[t.Donated=3]="Donated",t[t.Disqualified=4]="Disqualified"}(os||(os={}));class ss{constructor(t,e,r){this.adUnitId=t,this.config=e,this.logger=r}async getAnonymousUserCommissions(t,e){try{const r=new URLSearchParams(e).toString(),n=await fetch(`${this.config.apiConfig.baseUri}/${this.config.apiConfig.getAnonymousUserComissionsPath}?${r}`,{method:"GET",headers:{"Content-Type":"application/json","X-AnonymousUserToken":t}});if(!n.ok)throw new Error(`Failed to fetch commissions. Status code: ${n.status} .${n.statusText}`);return await n.json()}catch(t){throw this.logger.error("[GiveFreelyApiClient] Error fetching anonymous user's commissions:",{error:t}),t}}async createOrUpdateAnonymousUser(t,e){try{const r=await fetch(`${this.config.apiConfig.baseUri}/${this.config.apiConfig.createAnonymousUserPath}?adUnitId=${this.adUnitId}`,{method:"PUT",headers:{"Content-Type":"application/json","X-GF-Platform":"adUnitLibrary","X-AnonymousUserToken":e??""},body:JSON.stringify(t)});if(!r.ok)throw this.logger.error(`Failed to create/update anonymous user. Status code: ${r.status}. ${r.statusText}`),new Error(`Failed to create/update anonymous user. Status code: ${r.status}. ${r.statusText}`);this.logger.info("[GiveFreelyApiClient] anonymous user created/updated successfully.");const n=await r.json(),i=r.headers.get("X-AnonymousUserToken");return{resultUser:{...n,charity:{ein:n.selectedCharity,thirdPartyId:n.selectedCharityThirdPartyIdentifier,name:void 0}},resultToken:i}}catch(t){throw this.logger.error("[GiveFreelyApiClient] Error creating anonymous user:",{error:t},!0),t}}}class as{constructor(t,e){this._giveFreelyApiClient=t,this._logger=e,this.user=null}async resetUser(){await Wo.remove(Ro),await Wo.remove(Po)}async upsertUser(t,e){let r=await this.fetchUser();try{const n={selectedCharity:t?.ein,selectedCharityThirdPartyIdentifier:t?.thirdPartyId,deviceId:e};if(!await this.shouldCreateOrUpdateUser(r,n))return r;const i=await Wo.get(Ro),{resultUser:o,resultToken:s}=await this._giveFreelyApiClient.createOrUpdateAnonymousUser(n,i);s&&await Wo.set(Ro,s),o&&(await Wo.set(Po,o),r=o)}catch(t){this._logger.error("Error creating/updating anonymous user:",t)}return this.user=r,r}async fetchUser(){const t=await Wo.get(Po);return this.user=t,t}async shouldCreateOrUpdateUser(t,e){return!t||t.charity?.ein!==e.selectedCharity||t.charity?.thirdPartyId!==e.selectedCharityThirdPartyIdentifier||t.deviceId!==e.deviceId}}class cs{constructor(t,e,r,n,i){this.wfSecret=t,this.wfAppId=e,this.deviceUrl=r,this.dataUrl=n,this._logger=i}async getWildfireDevice(){try{const t=await fetch(this.deviceUrl,{method:"POST",body:JSON.stringify({}),headers:{"Content-Type":"application/json","WF-Secret":this.wfSecret,"WF-App-ID":this.wfAppId}});if(t.ok)return t.json();throw new Error(`Failed to fetch Wildfire device from ${this.deviceUrl}. Status ${t.status}. ${t.statusText}`)}catch(t){throw this._logger.error("Failed to fetch the Wildfire device",{err:t}),t}}async getActiveDomains(){try{const t=`${this.dataUrl}/${this.wfAppId}/active-domain/1`,e=await fetch(t);if(e.ok)return e.json();throw new Error(`Failed to fetch active domains from ${t}. Status ${e.status}. ${e.statusText}`)}catch(t){throw this._logger.error("Failed to fetch the active domains",{err:t}),t}}async getStanddownPolicy(){const t=`${this.dataUrl}/${this.wfAppId}/stand-down-policy/1`;try{const e=await fetch(t);if(e.ok)return e.json();throw new Error(`Failed to fetch standdown policy from ${t}. Status ${e.status}. ${e.statusText}`)}catch(e){throw this._logger.error("Failed to fetch the standdown policy",{err:e,url:t}),e}}async getMerchantRates(){const t=`${this.dataUrl}/${this.wfAppId}/merchant-rate/1`;try{const e=await fetch(t);if(this._logger.debug("Merchant rates response",{response:e}),!e.ok)throw new Error(`Failed to fetch merchant rates from ${t}. Status ${e.status}. ${e.statusText}`);const r=e.json();return this._logger.debug("Merchant rates",{rates:r}),r}catch(e){throw this._logger.error("Failed to fetch the merchant rates",{err:e,url:t}),e}}}async function ls(t,e,r){try{const n=(await hs())?.[e];if(n&&n>Date.now())return t.info("Standing down because current affiliate stand down session has not expired"),ds(e),!0;await this.refreshCache();const i=await this.getStanddownPolicy();if(gs(i,new URL(r).search))return t.info("Standing down because url has affiliate params"),ds(e),!0;t.info("No need to stand down.")}catch(e){t.error("Exception produced when trying to determine if it should stand down",e)}return!1}function us(t,e){if(!this.standDownPolicy)return this.logger.warn("Couldnt check affilliation. No stand down policy found"),this.getStanddownPolicy().then(t=>{this.standDownPolicy=t}),!1;const r=t.some(t=>fs(this.standDownPolicy,t))||gs(this.standDownPolicy,e);return this.logger.info("Affilliation result:",r),r}const hs=async()=>Wo.get(jo),ds=async(t,e=1)=>{const r=await hs()??{};r[t]=Date.now()+60*e*60*1e3,await Wo.set(jo,r)},fs=(t,e)=>{if(!e)return!1;const{Domains:r}=t;return r.some(t=>e.includes(t))},gs=(t,e)=>{if(!e)return!1;const{Params:r}=t;return r.some(t=>e.toLowerCase().includes(`?${t.toLowerCase()}`))||r.some(t=>e.toLowerCase().includes(`&${t.toLowerCase()}`))};class ps{constructor(t,e,r,n){this.userId=t,this.charityEin=e,this.charityThirdPartyIdentifier=r,this.partnerId=n}toString(){return`userId=${this.encodeUserId(this.userId)},charityEin=${this.charityEin},charityThirdPartyIdentifier=${this.charityThirdPartyIdentifier},partnerId=${this.partnerId}`}encodeUserId(t){return btoa(t).replace(/_/g,"/").replace(/-/g,"+")}}class ms{constructor(t,e,r,n=21600){if(this.standDownPolicy=null,this.shouldStandDown=ls.bind(this),this.hasAffilliation=us.bind(this),!t||!r)throw new Error("WildfireService requires wildfireClient and vanityBaseUrl");this.wildfireClient=t,this.vanityBaseUrl=r.replace(/\/$/,""),this.refreshInterval=n,this.logger=e}async getActiveDomains(t=!1){try{const e=(await Ko.get(Uo,async()=>this.fetchActiveDomains(),this.refreshInterval,t)).content;if(!e)throw Error("Failed to retrieve active domains");return e}catch(t){throw this.logger.error("Failed to get active domains:",t),new Error("Failed to retrieve active domains")}}async getMerchantRates(t,e=!1){try{const r=await Ko.get(Fo,async()=>this.fetchMerchantRates(),this.refreshInterval,e);if(!r.content)throw new Error("Failed to retrieve merchant rates from cache");return r.content[t]}catch(t){throw this.logger.error("Failed to retrieve merchant rates:",t),new Error("Failed to retrieve merchant rates")}}async generateAffiliateUrl(t,e,r,n){if(!t||!e||!n)throw new Error("Missing required parameters for affiliate URL generation");try{const i=await this.getDevice(),o=await this.generateTrackingCode(r,n,i),s=encodeURIComponent(e),a=encodeURIComponent(o);return`${this.vanityBaseUrl}/e?d=${i.DeviceID}&c=${t.ID}&tc=${a}&url=${s}`}catch(t){throw this.logger.error("Failed to generate affiliate URL:",t),new Error("Failed to generate affiliate URL")}}async clearCache(){try{await Promise.all([Ko.clear(Uo),Ko.clear(Mo),Ko.clear(Fo)])}catch(t){throw this.logger.error("Failed to clear cache:",t),new Error("Failed to clear cache")}}async clearDevice(){try{await Wo.remove(Go),this.logger.info("Cleared wildfire device ID")}catch(t){throw this.logger.error("Failed to clear wildfire device:",t),new Error("Failed to clear wildfire device")}}async refreshCache(t=!1){try{const[,e]=await Promise.all([Ko.refresh(Uo,()=>this.fetchActiveDomains(),this.refreshInterval,t),Ko.refresh(Mo,()=>this.fetchStanddownPolicy(),this.refreshInterval,t),Ko.refresh(Fo,()=>this.fetchMerchantRates(),this.refreshInterval,t)]);e?.content&&(this.standDownPolicy=e.content)}catch(t){throw this.logger.error("Failed to refresh cache:",t),new Error("Failed to refresh cache")}}async getStanddownPolicy(){try{const t=await Ko.get(Mo,async()=>this.fetchStanddownPolicy(),this.refreshInterval);if(!t.content)throw new Error("Failed to retrieve standdown policy from cache");return this.logger.info("Retrieved standdown policy from cache",t.content),this.standDownPolicy=t.content,this.standDownPolicy}catch(t){throw this.logger.error("Failed to get standdown policy from cache:",t),new Error("Failed to retrieve standdown policy")}}getRetryOptions(t){return{delayFn:t=>1e3*t,maxAttempts:3,logger:this.logger,operationName:t}}async getDevice(){try{const t=await Wo.get(Go);return t?.DeviceID?t:So(()=>this.fetchAndStoreDevice(),this.getRetryOptions("Get Device"))}catch(t){throw this.logger.error("Failed to get device:",t),new Error("Failed to retrieve device information")}}async fetchAndStoreDevice(){const t=await this.wildfireClient.getWildfireDevice();if(!t?.DeviceID)throw new Error("Failed to retrieve device information");return await Wo.set(Go,t),t}async generateTrackingCode(t,e,r){if(!(t?.id&&t?.charity&&t?.charity.ein&&t?.charity.thirdPartyId)){const t=`notregistered-${r.DeviceID}`;return this.logger.info("User not provided. Using GF's default bucket instead.",t),t}return new ps(t.id,t.charity.ein,t.charity.thirdPartyId,e).toString()}async fetchActiveDomains(){const t=await So(()=>this.wildfireClient.getActiveDomains(),this.getRetryOptions("Fetch Active Domains"));return this.logger.info("Updated active domains"),t}async fetchStanddownPolicy(){const t=await So(()=>this.wildfireClient.getStanddownPolicy(),this.getRetryOptions("Get Standdown policy"),{Domains:[],LostAttribution:[],Params:[],Serp:[]});return this.logger.info("Updated standdown policy"),t}async fetchMerchantRates(){const t=await So(()=>this.wildfireClient.getMerchantRates(),this.getRetryOptions("Fetch Merchant Rates"),{});return this.logger.debug("Updated Merchant rates"),t}static async createWildfireService(t,e){t.debug("Initializing wildfire service with config",e);const r=new cs(e.wfSecret,e.wfAppId,e.deviceUrl,e.dataUrl,t),n=new ms(r,t,e.vanityBaseUrl,e.refreshInterval),i=await qo();return await n.refreshCache(i),n}}const ys=t=>{try{return new URL(t),!0}catch{return!1}},bs=new Set,Ts=new Set,vs={urls:["<all_urls>"],types:["main_frame"]};class _s extends Error{constructor(t="Service not initialized"){super(t),this.name="UninitializedServiceError"}}const As=t=>{if(!t)throw new _s};class ws{static register(t,e){this.strategies.set(t,e)}static get(t){return this.strategies.get(t)}static exists(t){return!!function(t){return"object"==typeof t&&null!==t&&"type"in t&&"payload"in t&&"string"==typeof t.type}(t)&&this.knownMessageTypes.has(t.type)}}ws.strategies=new Map,ws.knownMessageTypes=new Set([...Object.values(No)]);const Es=async(t,e)=>{As(t.isInitialized());const r=ws.get(e.type);if(!r)return;const n={giveFreelyService:t};return r.handle(e,n)};class Ss{async handle(t,e){const{activeDomain:r,originalUrl:n,selectedCharity:i}=t.payload,{giveFreelyService:o}=e,s=o.getLogger();s.debug("Activating offer",{activeDomain:r,selectedCharity:i});try{if(!i?.ein||!i?.thirdPartyId)throw new Error("Missing charity information");const t=await o.initializeWfDeviceId();if(!t)throw new Error("Failed to initialize Wildfire device ID");const e=await o.upsertUser(i,t);s.debug("Upserted user",{currentUser:e}),e||s.info("Failed to create user. Using default bucket's user");const a=await o.generateAffiliateUrl(r,n,e);return s.debug("Generated affiliate URL",{affiliateUrl:a}),(async t=>{const e=Io.tabs.getCurrent(),r=await e,n=await Io.tabs.create({url:t,openerTabId:r?.id,active:!1,pinned:!0});await(async t=>new Promise(e=>{Io.tabs.onUpdated.addListener(async function r(n,i){if(n===t&&"complete"===i.status){if(Io.tabs.onUpdated.removeListener(r),!(await Io.tabs.get(t)).url)return void e(!1);e(!0)}})}))(n.id)&&setTimeout(()=>{n?.id&&Io.tabs.remove(n.id)},3e4)})(a),await o.updateStanddownHistory(r.Domain),s.debug("Activated offer",{activeDomain:r,selectedCharity:i}),{type:No.ACTIVATE_OFFER,payload:{response:!0}}}catch(t){return s.error("Error activating offer",{activeDomain:r,error:t}),o.trackEvent(mo.checkoutPopupFailedActivation,{activeDomain:r,error:t}),{type:No.ACTIVATE_OFFER,payload:{response:!1}}}}}class Is{async handle(t,e){const{shopId:r}=t.payload,{giveFreelyService:n}=e,i=n.getLogger();try{const t=Oo,e=(await Wo.get(t)||[]).find(t=>t.shopId===r);return e?(i.debug("Found domain for shop ID",{shopId:r,domain:e.domain}),{type:No.GET_DOMAIN_BY_SHOP_ID,payload:{found:!0,domain:e.domain,shopInfo:e}}):(i.debug("No domain found for shop ID",{shopId:r}),{type:No.GET_DOMAIN_BY_SHOP_ID,payload:{found:!1}})}catch(t){return i.error("Error getting domain for shop ID",{shopId:r,error:t}),{type:No.GET_DOMAIN_BY_SHOP_ID,payload:{found:!1}}}}}class Ns{async handle(t,e){const{lang:r}=t.payload,{giveFreelyService:n}=e,i=n.getLogger();i.debug("Getting language strings",{lang:r});try{const t=await n.getLanguage(r);return i.debug("Language strings fetched",{language:t}),{type:No.GET_LANGUAGE_CONTENT,payload:{translations:t.translations,charities:t.charities}}}catch(t){return i.error("Error getting language strings",{error:t}),{type:No.GET_LANGUAGE_CONTENT,payload:{translations:null,charities:null}}}}}class Os{async handle(t,e){const{giveFreelyService:r}=e,n=r.getLogger(),i=await r.getCachedConfig();try{return n.debug("Fetching popup config"),{type:No.GET_POPUP_CONFIG,payload:{config:i}}}catch(t){return n.error("Error fetching popup config",{error:t}),{type:No.GET_POPUP_CONFIG,payload:{config:null}}}}}class Cs{async handle(t,e){const{days:r}=t.payload,{giveFreelyService:n}=e,i=n.getLogger();try{const t=new Date;return t.setDate(t.getDate()+r),await Wo.set("popup_hide",{popupHide:t.getTime()}),i.debug("Popup hidden",{days:r,expiry:t}),{type:No.HIDE_POPUP,payload:{ack:!0}}}catch(t){return i.error("Error hiding popup",{days:r,error:t}),{type:No.HIDE_POPUP,payload:{ack:!1}}}}}class ks{async handle(t,e){const{hostname:r}=t.payload,{giveFreelyService:n}=e,i=n.getLogger(),o=await n.getConfig().merchantExclusions,s=await n.getActiveDomains();i.debug("Checking hostname",{hostname:r});try{if(n.healthCheck(),o.some(t=>t.disableDomain&&(r===t.domain||r.endsWith(`.${t.domain}`))))return i.debug("Hostname is in merchant exclusions",{hostname:r}),{type:No.IS_ACTIVE_DOMAIN,payload:{isActive:!1,domain:void 0,rates:[]}};if(!s||0===s.length)throw new Error("No active domains");i.debug("Retrieved active domains",{count:s.length});const t=s.find(t=>r===t.Domain||r.endsWith(`.${t.Domain}`));i.debug("Domain check result",{hostname:r,isActive:!!t});let e=[];if(t?.ID){const r=await n.getMerchantRates(t.Merchant.ID);r&&(i.debug("Retrieved merchant rates",{merchantRates:r}),e=r)}return{type:No.IS_ACTIVE_DOMAIN,payload:{isActive:!!t,domain:t,rates:e}}}catch(t){return i.error("Error checking domain",{hostname:r,error:t}),{type:No.IS_ACTIVE_DOMAIN,payload:{isActive:!1,domain:void 0,rates:[]}}}}}class Ls{async handle(t,e){const{currentUrl:r,searchResults:n,source:i}=t.payload,{giveFreelyService:o}=e,s=o.getLogger(),a=await o.getActiveDomains();s.debug("Finding merchants in search results",{currentUrl:r});try{const t=n.filter(t=>{try{const{hostname:e}=new URL(t.url);return a.some(t=>t.Domain===e||e.endsWith(`.${t.Domain}`))}catch{return s.debug("Couldn't parse the following search result url",{x:t}),!1}});if(s.info("Number of merchants identified in the search result",{number:t.length}),t.length>0){const n=Math.floor(Math.random()*Date.now());for(const o of t)e.giveFreelyService.trackEvent(mo.checkoutPopupMerchantInResultsFound,{source:i,searchResultsId:n,currentUrl:r,searchResultUrl:o.url,sponsored:o.isSponsored},!0)}return{type:No.LOG_MERCHANTS_IN_SEARCH_RESULTS,payload:{result:!0}}}catch(t){return s.error("Error sending logs for merchants in search results",{currentUrl:r,error:t}),{type:No.LOG_MERCHANTS_IN_SEARCH_RESULTS,payload:{result:!1}}}}}class Ds{async handle(t,e){const r=t.payload,{giveFreelyService:n}=e,i=n.getLogger();try{const t=Oo,e=await Wo.get(t)||[],n=e.findIndex(t=>t.shopId===r.shopId);return n>=0?e[n]=r:e.push(r),await Wo.set(t,e),i.debug("Stored Shopify shop ID",{shopInfo:r}),{type:No.STORE_SHOPIFY_SHOP_ID,payload:{success:!0}}}catch(t){return i.error("Error storing Shopify shop ID",{shopInfo:r,error:t}),{type:No.STORE_SHOPIFY_SHOP_ID,payload:{success:!1}}}}}class xs{async handle(t,e){const{activeDomain:r,url:n}=t.payload,{giveFreelyService:i}=e,o=i.getLogger();o.debug("Checking if we should stand down",{activeDomain:r});try{const t=await i.shouldStandDown(r,n);return{type:No.SHOULD_STAND_DOWN,payload:{result:t}}}catch(t){return o.error("Error checking if we should stand down. Returning false",{activeDomain:r,error:t}),{type:No.SHOULD_STAND_DOWN,payload:{result:!1}}}}}class Ps{async handle(t,e){const{eventType:r,eventData:n,anonymous:i,skipThrottling:o}=t.payload,{giveFreelyService:s}=e,a=s.getLogger();a.debug("Broadcasting event",{eventType:r,eventData:n,anonymous:i,skipThrottling:o});try{const t=await s.trackEvent(r,n,i,o);return{type:No.TRACK_EVENT,payload:{result:t}}}catch(t){return a.error("Error broadcasting event. Returning false",{eventType:r,eventData:n,error:t}),{type:No.TRACK_EVENT,payload:{result:!1}}}}}const Rs=Ao.getInstance(),Bs="https://cdn.givefreely.com/adunit/language",Gs=async(t,e,r,n,i=[],o=!1)=>{const s=(i??[]).includes(r)?$o:r;t.debug(`Requested lang ${r} and current lang ${s}`);const a=`lang-${$o}`,c=await Ko.get(a,async()=>(t.debug(`Fetching default language ${$o} for partner ${e}`),Us(e,$o)),n||60,o);if(!c.content)throw new Error(`Failed to fetch default language ${$o} and no cache version available`);if($o===s)return c.content;const l=`lang-${s}`,u=await Ko.get(l,async()=>(t.debug(`Fetching language ${s} for partner ${e}`),Us(e,s)),n||60,o);if(!u.content)return c.content;const h=Fs(c.content,u.content);return await Ko.set(l,h,n||60),h},Us=async(t,e)=>{const r=`/global-${e}.json`,n=`/${t}/${e}.json`,[i,o]=await Promise.allSettled([Ms(`${Bs}${r}`),Ms(`${Bs}${n}`)]);let s,a;"fulfilled"===i.status&&(s=i.value),"fulfilled"===o.status&&(a=o.value);const c=js(s,a);return{translations:c.translations,charities:c.charities}},Ms=async t=>{const e=await fetch(t,{cache:"no-store"});if(!e.ok)throw new Error(`Failed to fetch partner language file ${t}. Status: ${e.status}. Reason: ${e.statusText}`);return e.json()},js=(t,e)=>({translations:{...t?.translations??{},...e??{}},charities:{...t?.charities??{}}}),Fs=(t,e)=>({translations:{...t.translations,...e.translations},charities:{...t.charities,...e.charities}});async function $s(t=async()=>(this.logger.debug("Using default partnerFilter."),!0)){if(!this.state.initialized){this.logger.info("Starting initialization with mutex protection");try{await this.dependencies.configService.initialize();const e=await this.dependencies.configService.getConfig(!0);this.logger.configure({enabled:e.loggingEnabled??!0,minLevel:e.backgroundMinLogLevel??"error"}),this.logger.info("Initializing GiveFreelyService",{partnerApiKey:this.partnerApiKey});const r=await ms.createWildfireService(this.logger,e);this.state.healthCheck=new is(this.trackEvent.bind(this),this.logger),await this.state.healthCheck.initialize();const n=new ss(this.partnerApiKey,e,this.logger);this.state.giveFreelyUserService=new as(n,this.logger),await this.state.giveFreelyUserService.fetchUser(),this.state.giveFreelyUserService.user?.id||await this.state.giveFreelyUserService.upsertUser(),this.state.analytics=new ns(this.partnerApiKey,this.state.giveFreelyUserService,this.dependencies.configService);try{const t=await Wo.get(Go);t?.DeviceID?(this.state.wfDeviceId=t,this.logger.info("Loaded existing wfDeviceId from storage",{deviceId:t.DeviceID})):this.logger.debug("No existing wfDeviceId found in storage - will be created on first offer activation")}catch(t){this.logger.debug("Could not check for existing wfDeviceId in storage",t)}ws.register(No.IS_ACTIVE_DOMAIN,new ks),ws.register(No.GET_POPUP_CONFIG,new Os),ws.register(No.HIDE_POPUP,new Cs),ws.register(No.SHOULD_STAND_DOWN,new xs),ws.register(No.TRACK_EVENT,new Ps),ws.register(No.ACTIVATE_OFFER,new Ss),ws.register(No.STORE_SHOPIFY_SHOP_ID,new Ds),ws.register(No.GET_DOMAIN_BY_SHOP_ID,new Is),ws.register(No.GET_LANGUAGE_CONTENT,new Ns),ws.register(No.LOG_MERCHANTS_IN_SEARCH_RESULTS,new Ls),await(async t=>{try{await(async()=>await Wo.get(Do)||(async()=>{Rs.debug("detecting country");const t={method:"GET",headers:{"Content-Type":"application/json",Authorization:"Basic OTEzOTkxOnFlYmpaWF9DOGNRY0lxSHA4WTVjNGxzU1pRSlM2VW9MMExzTF9tbWs="}};try{const e=await fetch("https://geoip.maxmind.com/geoip/v2.1/country/me",t);if(Rs.debug("Received geolocation response",{status:e.status}),!e.ok)return void Rs.error("Failed to get geolocation data",{status:e.status,statusText:e.statusText});const r=await e.json();if(!r)throw new Error("There was an error fetching geoip look up");return await Wo.set(Do,r.country.iso_code),r.country.iso_code}catch(t){return void Rs.error("Failed to get geolocation data",{error:t},!0)}})())()}catch(e){t.debug("Failed to get geolocation data",{error:e})}})(this.logger),await(async(t,e,r)=>{e.purgeLanguages&&e.purgeLanguages.length>0&&await Promise.all(e.purgeLanguages.flatMap(t=>[Ko.clear(`lang-${t}`),Ko.clear(`global-${t}`)])),So(async()=>{t.debug("Initializing default language with partner API key",{partnerApiKey:r}),await Gs(t,r,$o,e.configRefreshInterval)})})(this.logger,e,this.partnerApiKey),this.state=((t,e)=>{const{wildfireService:r,partnerFilter:n,config:i}=e;return{...t,initialized:!0,wildfireService:r,partnerFilter:n,config:i}})(this.state,{wildfireService:r,partnerFilter:t,config:e}),this.logger.addTransport(new vo(this)),this.cleanupListeners=(t=>{let e;if(bo.webRequest){const r=(t=>{const e=t.getLogger();return({requestId:r,url:n,initiator:i})=>{try{if(bs.has(r)||Ts.has(r)||!ys(n))return;const{hostname:o,search:s}=new URL(n);if(o.includes("wild.link"))return e.info("Cashback activation request identified, ignoring affiliate check for request"),void Ts.add(r);let a;i&&ys(i)&&(a=new URL(i).hostname),(t.hasAffiliation([o,a],s)||t.isCustomStandownMatch([n,i]))&&(e.info("Affiliation found or custom standown match on url, adding request id to track"),bs.add(r))}catch(t){e.error("Error on handleAffiliateOnBeforeRequest",t)}}})(t);bo.webRequest.onBeforeRequest.addListener(r,vs);const n=(t=>{const e=t.getLogger();return async({requestId:r,redirectUrl:n})=>{try{if(!bs.has(r))return;e.info("Attempting to find active domain");const{hostname:i}=new URL(n),o=(await t.getActiveDomains()).find(t=>i===t.Domain||i.endsWith(`.${t.Domain}`));if(!o)return;e.info("Found active domain. Updating standdown state"),await ds(o.Domain)}catch(t){e.error("Error on handleAffiliateOnBeforeRedirect",t)}}})(t);bo.webRequest.onBeforeRedirect.addListener(n,vs);const i=(t=>{const e=t.getLogger();return({requestId:t})=>{try{bs.has(t)&&(e.info("Tracking request completed. Request Id:",t),bs.delete(t))}catch(t){e.error("Error on handleAffiliateOnCompleted",t)}}})(t);bo.webRequest.onCompleted.addListener(i,vs),e=()=>{bo.webRequest.onBeforeRequest.removeListener(r),bo.webRequest.onBeforeRedirect.removeListener(n),bo.webRequest.onCompleted.removeListener(i)}}const r=function(){const e=Ao.getInstance(),r=(r,n,i)=>{const o=(async e=>(t.getLogger().debug("Received message",{type:e.type,payload:e.payload}),Es(t,e)))(r);return o instanceof Promise?(o.then(t=>{t&&function(t){i(t)}(t)}).catch(t=>{e.warn("Async message callback error:",t)}),!0):!0===o||void 0};return Io.runtime.onMessage.addListener(r),r}();return function(){e&&e(),bo.runtime.onMessage.removeListener(r)}})(this),Ws.call(this),this.logger.info("GiveFreelyService initialized successfully")}catch(t){const e=t instanceof Error?t.message:"Unknown error";throw this.logger.error("Failed to initialize GiveFreelyService",{error:e}),new Error(`Failed to initialize GiveFreelyService: ${e}`)}}}function Hs(){return this.state.initialized}function Ws(){this.onConfigChange("wfAppId",async t=>{this.logger.info(`Wildfire App ID changed from ${t.oldValue} to ${t.newValue} - clearing device`),await Vs.call(this)}),this.onConfigChange("wfSecret",async t=>{this.logger.info("Wildfire Secret changed - clearing device"),await Vs.call(this)})}async function Vs(){try{this.state.wildfireService&&(await this.state.wildfireService.clearDevice(),this.state.wfDeviceId=null,this.logger.info("Wildfire device cleared due to config change"))}catch(t){this.logger.error("Failed to clear wildfire device:",t)}}var qs={config:Object.freeze({__proto__:null,getCachedConfig:async function(){return As(this.state.initialized),this.state.config=await this.dependencies.configService.getConfig(),this.logger.configure({minLevel:this.state.config.backgroundMinLogLevel??"error"}),this.state.config},getConfig:function(){return As(this.state.initialized),this.state.config},offConfigChange:function(t,e){As(this.state.initialized),this.dependencies.configService.off(t,e)},onConfigChange:function(t,e){return As(this.state.initialized),this.dependencies.configService.on(t,e)},onceConfigChange:function(t,e){return As(this.state.initialized),this.dependencies.configService.once(t,e)}}),merchants:Object.freeze({__proto__:null,generateAffiliateUrl:async function(t,e,r){return As(this.state.initialized),this.state.wildfireService.generateAffiliateUrl(t,e,r,this.state.partnerApiKey)},getActiveDomains:async function(){return As(this.state.initialized),this.state.wildfireService.getActiveDomains()},getMerchantRates:async function(t){if(As(this.state.initialized),!this.state.wildfireService)throw new Error("Wildfire service not initialized");return this.state.wildfireService.getMerchantRates(t)}}),observability:Object.freeze({__proto__:null,getLogger:function(){return As(this.state.initialized),this.logger},healthCheck:async function(){As(this.state.initialized),await this.state.healthCheck.check()},trackEvent:function(t,e,r=!1,n=!1){return As(this.state.initialized),this.state.analytics.track(t,this.state.wfDeviceId?.DeviceID,e,r,n)}}),standdown:Object.freeze({__proto__:null,hasAffiliation:function(t,e){if(!this.state.wildfireService)return this.logger.warn("Wildfire service not initialized yet"),!1;const r=this.state.wildfireService.hasAffilliation(t,e);return r&&this.logger.info("WF Affiliation identified"),r},isCustomStandownMatch:function(t){const e=t.some(t=>this.getConfig().customStandownPolicy?.urlRegex?.some(e=>!!t&&function(t,e){return new RegExp(e).test(t)}(t,e)));return e&&this.logger.info("Custom Standown identified"),e},shouldStandDown:async function(t,e){As(this.state.initialized);const r=new URL(e);if(!await this.state.partnerFilter(r.hostname))return this.logger.info("Should standdown due to partner filter."),!0;if(this.getConfig().merchantExclusions.some(e=>e.mutePopups&&t===e.domain))return this.logger.info("Should standdown due to merchant exclusions"),!0;const n=await this.state.wildfireService.shouldStandDown(this.logger,t,e);return n&&this.logger.info("Should standdown due to vendor policy"),n},updateStanddownHistory:function(t){return As(this.state.initialized),ds(t)}}),identity:Object.freeze({__proto__:null,getCurrentUser:function(){return As(this.state.initialized),this.state.giveFreelyUserService.user},getLanguage:async function(t){return As(this.state.initialized),Gs(this.logger,this.state.partnerApiKey,t,this.state.config?.configRefreshInterval,this.state.config?.ignoredLanguages)},initializeWfDeviceId:async function(){if(As(this.state.initialized),this.state.wfDeviceId=await this.state.wildfireService.getDevice(),!this.state.wfDeviceId)throw new Error("Failed to initialize Wildfire device ID");return this.state.wfDeviceId.DeviceID},upsertUser:function(t,e){return As(this.state.initialized),this.state.giveFreelyUserService.upsertUser(t,e)}})};class zs{constructor(t){this.partnerApiKey=t,this.cleanupListeners=null,this.initialize=$s.bind(this),this.isInitialized=Hs.bind(this),this.getConfig=qs.config.getConfig.bind(this),this.getCachedConfig=qs.config.getCachedConfig.bind(this),this.onConfigChange=qs.config.onConfigChange.bind(this),this.onceConfigChange=qs.config.onceConfigChange.bind(this),this.offConfigChange=qs.config.offConfigChange.bind(this),this.getLogger=qs.observability.getLogger.bind(this),this.healthCheck=qs.observability.healthCheck.bind(this),this.trackEvent=qs.observability.trackEvent.bind(this),this.initializeWfDeviceId=qs.identity.initializeWfDeviceId.bind(this),this.upsertUser=qs.identity.upsertUser.bind(this),this.getCurrentUser=qs.identity.getCurrentUser.bind(this),this.getLanguage=qs.identity.getLanguage.bind(this),this.getActiveDomains=qs.merchants.getActiveDomains.bind(this),this.generateAffiliateUrl=qs.merchants.generateAffiliateUrl.bind(this),this.getMerchantRates=qs.merchants.getMerchantRates.bind(this),this.shouldStandDown=qs.standdown.shouldStandDown.bind(this),this.updateStanddownHistory=qs.standdown.updateStanddownHistory.bind(this),this.hasAffiliation=qs.standdown.hasAffiliation.bind(this),this.isCustomStandownMatch=qs.standdown.isCustomStandownMatch.bind(this),this.dependencies={configService:new rs(t)},this.logger=Ao.getInstance(),this.logger.configure({enabled:!0,title:"Background - GiveFreelyService"}),this.state=(t=>({initialized:!1,wildfireService:null,partnerFilter:null,config:null,wfDeviceId:null,analytics:null,giveFreelyUserService:null,partnerApiKey:t,healthCheck:null}))(t)}async destroy(){var t;this.logger.info("Destroying GiveFreelyService"),await Promise.all([this.dependencies.configService.clearCache(),this.state.wildfireService?.clearCache(),this.state.giveFreelyUserService?.resetUser()]),this.cleanupListeners&&(this.cleanupListeners(),this.logger.info("Event listeners cleared."),this.cleanupListeners=null),this.state=(t=this.state,{...t,initialized:!1,wildfireService:null,partnerFilter:null,analytics:null,config:null})}}class Ks{constructor(t){this.partnerApiKey=t,this.initialize=t=>this._adUnitService.initialize(t),this.destroy=()=>this._adUnitService.destroy(),this._adUnitService=new zs(t)}}const Ys=t=>{var e;return null===(e=null==t?void 0:t.url)||void 0===e?void 0:e.includes(D.BACKEND_URL)},Js=t=>{var e;return null===(e=null==t?void 0:t.url)||void 0===e?void 0:e.includes(D.BACKEND_URL_FALLBACK)},Xs=t=>"net::ERR_FAILED"===(null==t?void 0:t.error),Zs=[D.BACKEND_URL,D.BACKEND_URL_FALLBACK].map(t=>`${t}/*`);var Qs,ta;chrome.runtime.onInstalled.addListener(()=>{chrome.runtime.setUninstallURL(Math.random()<.95?io.uninstallURL:io.uninstallSurveyURL)}),function(){chrome.contextMenus.onClicked.addListener(t=>function(t,e,r,n){return new(r||(r=Promise))(function(i,o){function s(t){try{c(n.next(t))}catch(t){o(t)}}function a(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(s,a)}c((n=n.apply(t,e||[])).next())})}(this,void 0,void 0,function*(){chrome.tabs.query({active:!0,currentWindow:!0},()=>{t.menuItemId,be[t.menuItemId]&&E.sendMessage({id:t.menuItemId,detail:t})})}))}(),chrome.action.onClicked.addListener(t=>{t.url&&function(t){return t&&"string"==typeof t&&!(null==t||!t.length)&&Je(t)&&!ze(t)}(t.url)&&ao(t.url),E.sendMessage({id:"browserActionClicked"})}),"undefined"!=typeof chrome&&(null===(ta=null===(Qs=null===chrome||void 0===chrome?void 0:chrome.runtime)||void 0===Qs?void 0:Qs.onMessage)||void 0===ta||ta.addListener((t,e,r)=>{if(!io.featureIsEnabled.givefreely||!(t=>ws.exists(t))(t)){if(Te(t,"navigateToPdfViewer")&&ao(t.detail),Te(t,"navigateToReader")&&co(function(t){const e=typeof window<"u"&&!hr()&&!(typeof window>"u")&&window.location.href.startsWith("http://localhost")?`${window.location.origin}/reader.html`:Ze("reader.html");return t.url?`${e}?${ke}=${encodeURIComponent(t.url)}`:e}(t.detail),{newTab:!1}),Te(t,"navigateToFromBackground")&&"string"==typeof t.detail&&co(t.detail),Te(t,"backgroundIndexDbQuery")){const e=t.detail;S(go,e)&&go[e.method](e.payload).catch(console.error)}if(Te(t,"setBadge")){const{text:e,backgroundColor:r,textColor:n}=t.detail;"string"==typeof e&&"string"==typeof r&&chrome.tabs.query({currentWindow:!0,active:!0},function(t){var i;const o=null===(i=t[0])||void 0===i?void 0:i.id;o&&(chrome.action.setBadgeText({text:e,tabId:o}),n&&chrome.action.setBadgeTextColor({color:n,tabId:o}),r&&chrome.action.setBadgeBackgroundColor({color:r,tabId:o}))})}r()}}),chrome.runtime.onConnect.addListener(t=>{!function(t){const{name:e}=t;if(function(t){return"string"==typeof t&&Object.values(w).includes(t)}(e))return void function(t,e){t===w.COMMANDS&&chrome.commands.getAll().then(t=>{e.postMessage(t.filter(t=>!!t.description).map(t=>Object.assign(Object.assign({},t),{shortcut:t.shortcut||A})))})}(e,t);const r=function(t){try{return JSON.parse(t)}catch{return null}}(e);S(go,r)&&go[r.method](r.payload).then(e=>{t.postMessage(e)})}(t)}),chrome.runtime.onInstalled.addListener(t=>function(t,e,r,n){return new(r||(r=Promise))(function(i,o){function s(t){try{c(n.next(t))}catch(t){o(t)}}function a(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(s,a)}c((n=n.apply(t,e||[])).next())})}(void 0,void 0,void 0,function*(){if("install"===t.reason){chrome.tabs.query({url:["http://*/*","https://*/*","file://*/*"]},t=>{t.forEach(t=>{if(t.id)try{chrome.scripting.executeScript({target:{tabId:t.id},files:["content-loader.js"]})}catch(e){console.error(`Error loading content-loader.js in tab ${t.id}: ${e}`)}})});const t=T.extensionId===chrome.runtime.id||T.extensionIdDev===chrome.runtime.id?"https://web-highlights.com/extensions/reader-mode/welcome":v.extensionId===chrome.runtime.id||v.extensionIdDev===chrome.runtime.id?"https://web-highlights.com/extensions/youtube-highlighter/welcome":"https://web-highlights.com/extensions/pdf-web-highlighter/welcome";chrome.tabs.create({url:`${t}?ref=install`,active:!0})}so()}))),chrome.tabs.onActivated.addListener(()=>{chrome.tabs.query({currentWindow:!0,active:!0},function(t){t[0]&&lo(t[0])})}),chrome.tabs.onUpdated.addListener(function(t,e,r){so(),lo(r)}),chrome.commands.onCommand.addListener(t=>{E.sendMessage({id:"keyboardShortcut",detail:t})}),function(){!function(t,e,r,n){new(r||(r=Promise))(function(i,o){function s(t){try{c(n.next(t))}catch(t){o(t)}}function a(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(s,a)}c((n=n.apply(t,e||[])).next())})}(this,void 0,void 0,function*(){if("undefined"==typeof chrome||!("webRequest"in chrome))return;let t=!0,e=!0;chrome.webRequest.onErrorOccurred.addListener(function(r){Ys(r)&&Xs(r)&&(t=!1),Js(r)&&Xs(r)&&(e=!1),t||e||E.sendMessage({id:"allServersAreOffline"})},{urls:Zs}),chrome.webRequest.onCompleted.addListener(function(r){let n=!t&&!e;Ys(r)&&(t=!0),Js(r)&&(e=!0),n&&(t||e)&&E.sendMessage({id:"serversAreBackOnline"})},{urls:Zs})})}(),function(){!function(t,e,r,n){new(r||(r=Promise))(function(i,o){function s(t){try{c(n.next(t))}catch(t){o(t)}}function a(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(s,a)}c((n=n.apply(t,e||[])).next())})}(this,void 0,void 0,function*(){try{if(!io.featureIsEnabled.givefreely)return;const t=new Ks("webhighlightsprod");yield t.initialize()}catch(t){console.error(`initGivefreelyBackground failed: ${String(t)}`)}})}()})(),{}})());